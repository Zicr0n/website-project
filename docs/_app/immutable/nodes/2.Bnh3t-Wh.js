var DC=Object.defineProperty;var U_=n=>{throw TypeError(n)};var NC=(n,e,t)=>e in n?DC(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Vt=(n,e,t)=>NC(n,typeof e!="symbol"?e+"":e,t),tf=(n,e,t)=>e.has(n)||U_("Cannot "+t);var en=(n,e,t)=>(tf(n,e,"read from private field"),t?t.call(n):e.get(n)),As=(n,e,t)=>e.has(n)?U_("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),Tl=(n,e,t,i)=>(tf(n,e,"write to private field"),i?i.call(n,t):e.set(n,t),t),F_=(n,e,t)=>(tf(n,e,"access private method"),t);import{a as OC,c as pt,b as Pe,t as Ft}from"../chunks/DA-rvvTK.js";import{i as ys}from"../chunks/CUACNMO4.js";import{U as Ly,r as Tn,h as zu,at as kC,v as Iy,au as UC,a4 as B_,av as nf,an as vc,a8 as Ot,o as ec,d as Tu,P as V_,O as z_,aw as H_,q as FC,a2 as Pu,a3 as Ru,ap as BC,E as VC,ax as zC,g as HC,n as GC,s as Hu,c as G_,t as WC,x as $C,a5 as Dy,B as jd,ay as jC,az as XC,aA as qC,aB as KC,S as YC,a9 as st,aC as Ny,D as I,a6 as Oy,ar as Xd,aD as Rn,aE as Yt,as as un,y as hn,z as Bs,p as on,J as Be,u as an,aq as Xa,L as Jn,M as Qn,w as cs,aF as tt,aG as ws,F as Ae,K as sc,aH as hs,ad as ZC,aI as JC,N as vt,ag as W_}from"../chunks/OH1BOxI8.js";import{r as kr,i as Pn,b as us,s as zn,p as ie,a as fs,d as ky,e as qo,l as Hn,f as $_,c as Nn}from"../chunks/DdwA_GzL.js";import{s as Qi}from"../chunks/DWBvIdlh.js";import{g as km,w as Ln,d as jc,a as Si,o as Ur,r as Uy,c as Fy,b as QC}from"../chunks/6sjs22ig.js";import{b as e1,c as t1,d as n1,e as i1,n as s1,f as r1,g as sf}from"../chunks/CeVKZtyI.js";import{b as o1}from"../chunks/hhkzoCAX.js";function a1(n,e){if(e){const t=document.body;n.autofocus=!0,Ly(()=>{document.activeElement===t&&n.focus()})}}const rf=0,Sh=1,of=2;function l1(n,e,t,i,s){Tn&&zu();var r=n,o=kC(),a=FC,l=B_,c,h,u,d=(o?vc:Ot)(void 0),p=(o?vc:Ot)(void 0),f=!1;function g(v,x){f=!0,x&&(V_(m),z_(m),H_(a));try{v===rf&&t&&(c?Pu(c):c=ec(()=>t(r))),v===Sh&&i&&(h?Pu(h):h=ec(()=>i(r,d))),v===of&&s&&(u?Pu(u):u=ec(()=>s(r,p))),v!==rf&&c&&Ru(c,()=>c=null),v!==Sh&&h&&Ru(h,()=>h=null),v!==of&&u&&Ru(u,()=>u=null)}finally{x&&(H_(null),z_(null),V_(null),BC())}}var m=Iy(()=>{if(l!==(l=e())){if(UC(l)){var v=l;f=!1,v.then(x=>{v===l&&(nf(d,x),g(Sh,!0))},x=>{if(v===l&&(nf(p,x),g(of,!0),!s))throw p.v}),Tn?t&&(c=ec(()=>t(r))):Ly(()=>{f||g(rf,!0)})}else nf(d,l),g(Sh,!1);return()=>l=B_}});Tn&&(r=Tu)}function $s(n,e,t,i,s){var a;Tn&&zu();var r=(a=e.$$slots)==null?void 0:a[t],o=!1;r===!0&&(r=e.children,o=!0),r===void 0||r(n,o?()=>i:i)}function c1(n,e,t,i,s,r){let o=Tn;Tn&&zu();var a,l,c=null;Tn&&Tu.nodeType===1&&(c=Tu,zu());var h=Tn?Tu:n,u;Iy(()=>{const d=e()||null;var p=d==="svg"?zC:null;d!==a&&(u&&(d===null?Ru(u,()=>{u=null,l=null}):d===l?Pu(u):$C(u)),d&&d!==l&&(u=ec(()=>{if(c=Tn?c:p?document.createElementNS(p,d):document.createElement(d),OC(c,c),i){Tn&&e1(d)&&c.append(document.createComment(""));var f=Tn?HC(c):c.appendChild(GC());Tn&&(f===null?Hu(!1):G_(f)),i(c,f)}WC.nodes_end=c,h.before(c)})),a=d,a&&(l=a))},VC),o&&(Hu(!0),G_(h))}function h1(n,e,t){Dy(()=>{var i=jd(()=>e(n,t==null?void 0:t())||{});if(i!=null&&i.destroy)return()=>i.destroy()})}function By(n){var e,t,i="";if(typeof n=="string"||typeof n=="number")i+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=By(n[e]))&&(i&&(i+=" "),i+=t)}else for(t in n)n[t]&&(i&&(i+=" "),i+=t);return i}function u1(){for(var n,e,t=0,i="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=By(n))&&(i&&(i+=" "),i+=e);return i}function Um(n){return typeof n=="object"?u1(n):n??""}const j_=[...` 	
\r\fÂ \v\uFEFF`];function d1(n,e,t){var i=n==null?"":""+n;if(e&&(i=i?i+" "+e:e),t){for(var s in t)if(t[s])i=i?i+" "+s:s;else if(i.length)for(var r=s.length,o=0;(o=i.indexOf(s,o))>=0;){var a=o+r;(o===0||j_.includes(i[o-1]))&&(a===i.length||j_.includes(i[a]))?i=(o===0?"":i.substring(0,o))+i.substring(a+1):o=a}}return i===""?null:i}function X_(n,e=!1){var t=e?" !important;":";",i="";for(var s in n){var r=n[s];r!=null&&r!==""&&(i+=" "+s+": "+r+t)}return i}function af(n){return n[0]!=="-"||n[1]!=="-"?n.toLowerCase():n}function p1(n,e){if(e){var t="",i,s;if(Array.isArray(e)?(i=e[0],s=e[1]):i=e,n){n=String(n).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var r=!1,o=0,a=!1,l=[];i&&l.push(...Object.keys(i).map(af)),s&&l.push(...Object.keys(s).map(af));var c=0,h=-1;const g=n.length;for(var u=0;u<g;u++){var d=n[u];if(a?d==="/"&&n[u-1]==="*"&&(a=!1):r?r===d&&(r=!1):d==="/"&&n[u+1]==="*"?a=!0:d==='"'||d==="'"?r=d:d==="("?o++:d===")"&&o--,!a&&r===!1&&o===0){if(d===":"&&h===-1)h=u;else if(d===";"||u===g-1){if(h!==-1){var p=af(n.substring(c,h).trim());if(!l.includes(p)){d!==";"&&u++;var f=n.substring(c,u).trim();t+=" "+f+";"}}c=u+1,h=-1}}}}return i&&(t+=X_(i)),s&&(t+=X_(s,!0)),t=t.trim(),t===""?null:t}return n==null?null:String(n)}function Gu(n,e,t,i,s,r){var o=n.__className;if(Tn||o!==t){var a=d1(t,i,r);(!Tn||a!==n.getAttribute("class"))&&(a==null?n.removeAttribute("class"):e?n.className=a:n.setAttribute("class",a)),n.__className=t}else if(r&&s!==r)for(var l in r){var c=!!r[l];(s==null||c!==!!s[l])&&n.classList.toggle(l,c)}return r}function lf(n,e={},t,i){for(var s in t){var r=t[s];e[s]!==r&&(t[s]==null?n.style.removeProperty(s):n.style.setProperty(s,r,i))}}function _i(n,e,t,i){var s=n.__style;if(Tn||s!==e){var r=p1(e,i);(!Tn||r!==n.getAttribute("style"))&&(r==null?n.removeAttribute("style"):n.style.cssText=r),n.__style=e}else i&&(Array.isArray(i)?(lf(n,t==null?void 0:t[0],i[0]),lf(n,t==null?void 0:t[1],i[1],"important")):lf(n,t,i));return i}const Pl=Symbol("class"),Da=Symbol("style"),Vy=Symbol("is custom element"),zy=Symbol("is html");function f1(n,e){e?n.hasAttribute("selected")||n.setAttribute("selected",""):n.removeAttribute("selected")}function q_(n,e,t,i){var s=Hy(n);Tn&&(s[e]=n.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&n.nodeName==="LINK")||s[e]!==(s[e]=t)&&(e==="loading"&&(n[qC]=t),t==null?n.removeAttribute(e):typeof t!="string"&&Gy(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function m1(n,e,t,i,s=!1){var r=Hy(n),o=r[Vy],a=!r[zy];let l=Tn&&o;l&&Hu(!1);var c=e||{},h=n.tagName==="OPTION";for(var u in e)u in t||(t[u]=null);t.class?t.class=Um(t.class):t[Pl]&&(t.class=null),t[Da]&&(t.style??(t.style=null));var d=Gy(n);for(const b in t){let _=t[b];if(h&&b==="value"&&_==null){n.value=n.__value="",c[b]=_;continue}if(b==="class"){var p=n.namespaceURI==="http://www.w3.org/1999/xhtml";Gu(n,p,_,i,e==null?void 0:e[Pl],t[Pl]),c[b]=_,c[Pl]=t[Pl];continue}if(b==="style"){_i(n,_,e==null?void 0:e[Da],t[Da]),c[b]=_,c[Da]=t[Da];continue}var f=c[b];if(_!==f){c[b]=_;var g=b[0]+b[1];if(g!=="$$")if(g==="on"){const C={},M="$$"+b;let S=b.slice(2);var m=r1(S);if(t1(S)&&(S=S.slice(0,-7),C.capture=!0),!m&&f){if(_!=null)continue;n.removeEventListener(S,c[M],C),c[M]=null}if(_!=null)if(m)n[`__${S}`]=_,i1([S]);else{let P=function(E){c[b].call(this,E)};c[M]=n1(S,n,P,C)}else m&&(n[`__${S}`]=void 0)}else if(b==="style")q_(n,b,_);else if(b==="autofocus")a1(n,!!_);else if(!o&&(b==="__value"||b==="value"&&_!=null))n.value=n.__value=_;else if(b==="selected"&&h)f1(n,_);else{var v=b;a||(v=s1(v));var x=v==="defaultValue"||v==="defaultChecked";if(_==null&&!o&&!x)if(r[b]=null,v==="value"||v==="checked"){let C=n;const M=e===void 0;if(v==="value"){let S=C.defaultValue;C.removeAttribute(v),C.defaultValue=S,C.value=C.__value=M?S:null}else{let S=C.defaultChecked;C.removeAttribute(v),C.defaultChecked=S,C.checked=M?S:!1}}else n.removeAttribute(b);else x||d.includes(v)&&(o||typeof _!="string")?n[v]=_:typeof _!="function"&&q_(n,v,_)}}}return l&&Hu(!0),c}function Hy(n){return n.__attributes??(n.__attributes={[Vy]:n.nodeName.includes("-"),[zy]:n.namespaceURI===jC})}var K_=new Map;function Gy(n){var e=K_.get(n.nodeName);if(e)return e;K_.set(n.nodeName,e=[]);for(var t,i=n,s=Element.prototype;s!==i;){t=KC(i);for(var r in t)t[r].set&&e.push(r);i=XC(i)}return e}const v1=()=>performance.now(),as={tick:n=>requestAnimationFrame(n),now:()=>v1(),tasks:new Set};function Wy(){const n=as.now();as.tasks.forEach(e=>{e.c(n)||(as.tasks.delete(e),e.f())}),as.tasks.size!==0&&as.tick(Wy)}function g1(n){let e;return as.tasks.size===0&&as.tick(Wy),{promise:new Promise(t=>{as.tasks.add(e={c:n,f:t})}),abort(){as.tasks.delete(e)}}}var wr,$a,Wc,Wd,$y;const $d=class $d{constructor(e){As(this,Wd);As(this,wr,new WeakMap);As(this,$a);As(this,Wc);Tl(this,Wc,e)}observe(e,t){var i=en(this,wr).get(e)||new Set;return i.add(t),en(this,wr).set(e,i),F_(this,Wd,$y).call(this).observe(e,en(this,Wc)),()=>{var s=en(this,wr).get(e);s.delete(t),s.size===0&&(en(this,wr).delete(e),en(this,$a).unobserve(e))}}};wr=new WeakMap,$a=new WeakMap,Wc=new WeakMap,Wd=new WeakSet,$y=function(){return en(this,$a)??Tl(this,$a,new ResizeObserver(e=>{for(var t of e){$d.entries.set(t.target,t);for(var i of en(this,wr).get(t.target)||[])i(t)}}))},Vt($d,"entries",new WeakMap);let Fm=$d;var _1=new Fm({box:"border-box"});function Y_(n,e,t){var i=_1.observe(n,()=>t(n[e]));Dy(()=>(jd(()=>t(n[e])),i))}function cl(n,e){var r;var t=(r=n.$$events)==null?void 0:r[e.type],i=YC(t)?t.slice():t==null?[]:[t];for(var s of i)s.call(this,e)}function b1(n){st(n,n.v+1)}function x1(n){let e=0,t=vc(0),i;return()=>{Ny()&&(I(t),Oy(()=>(e===0&&(i=jd(()=>n(()=>b1(t)))),e+=1,()=>{Xd().then(()=>{e-=1,e===0&&(i==null||i(),i=void 0)})})))}}function y1(n){let e;const t=x1(s=>{let r=!1;const o=n.subscribe(a=>{e=a,r&&s()});return r=!0,o});function i(){return Ny()?(t(),e):km(n)}return"set"in n?{get current(){return i()},set current(s){n.set(s)}}:{get current(){return i()}}}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const qd="175",To={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},yo={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},jy=0,Bm=1,Xy=2,w1=3,E1=0,Cv=1,rc=2,os=3,ms=0,ni=1,bi=2,js=0,Po=1,Wu=2,Vm=3,zm=4,qy=5,yr=100,Ky=101,Yy=102,Zy=103,Jy=104,Qy=200,ew=201,tw=202,nw=203,$u=204,ju=205,iw=206,sw=207,rw=208,ow=209,aw=210,lw=211,cw=212,hw=213,uw=214,Xu=0,qu=1,Ku=2,Do=3,Yu=4,Zu=5,Ju=6,Qu=7,Xc=0,dw=1,pw=2,Xs=0,fw=1,mw=2,vw=3,gw=4,_w=5,ed=6,bw=7,Hm="attached",xw="detached",Kd=300,Ys=301,Pr=302,gc=303,_c=304,hl=306,Rr=1e3,xi=1001,qa=1002,xn=1003,Yd=1004,M1=1004,wo=1005,S1=1005,sn=1006,Fa=1007,C1=1007,ki=1008,A1=1008,vs=1009,Av=1010,Tv=1011,Ka=1012,Zd=1013,Zs=1014,di=1015,ul=1016,Jd=1017,Qd=1018,Ya=1020,Pv=35902,Rv=1021,Lv=1022,ei=1023,Iv=1024,Dv=1025,Za=1026,Ja=1027,ep=1028,qc=1029,Nv=1030,tp=1031,T1=1032,np=1033,oc=33776,ac=33777,lc=33778,cc=33779,td=35840,nd=35841,id=35842,sd=35843,rd=36196,od=37492,ad=37496,ld=37808,cd=37809,hd=37810,ud=37811,dd=37812,pd=37813,fd=37814,md=37815,vd=37816,gd=37817,_d=37818,bd=37819,xd=37820,yd=37821,hc=36492,wd=36494,Ed=36495,Ov=36283,Md=36284,Sd=36285,Cd=36286,yw=2200,ww=2201,Ew=2202,Qa=2300,el=2301,Lu=2302,Eo=2400,Mo=2401,bc=2402,ip=2500,kv=2501,Mw=0,Uv=1,Ad=2,Sw=3200,Cw=3201,P1=3202,R1=3203,Fr=0,Aw=1,Vs="",gn="srgb",Gn="srgb-linear",xc="linear",Dt="srgb",L1=0,_o=7680,I1=7681,D1=7682,N1=7683,O1=34055,k1=34056,U1=5386,F1=512,B1=513,V1=514,z1=515,H1=516,G1=517,W1=518,Gm=519,Tw=512,Pw=513,Rw=514,Fv=515,Lw=516,Iw=517,Dw=518,Nw=519,yc=35044,$1=35048,j1=35040,X1=35045,q1=35049,K1=35041,Y1=35046,Z1=35050,J1=35042,Q1="100",Wm="300 es",Ji=2e3,wc=2001,eA={COMPUTE:"compute",RENDER:"render"};class Es{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i===void 0?!1:i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners;if(i===void 0)return;const s=i[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const i=t[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,e);e.target=null}}}const Un=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Z_=1234567;const Ro=Math.PI/180,tl=180/Math.PI;function Ei(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Un[n&255]+Un[n>>8&255]+Un[n>>16&255]+Un[n>>24&255]+"-"+Un[e&255]+Un[e>>8&255]+"-"+Un[e>>16&15|64]+Un[e>>24&255]+"-"+Un[t&63|128]+Un[t>>8&255]+"-"+Un[t>>16&255]+Un[t>>24&255]+Un[i&255]+Un[i>>8&255]+Un[i>>16&255]+Un[i>>24&255]).toLowerCase()}function Ke(n,e,t){return Math.max(e,Math.min(t,n))}function Bv(n,e){return(n%e+e)%e}function tA(n,e,t,i,s){return i+(n-e)*(s-i)/(t-e)}function nA(n,e,t){return n!==e?(t-n)/(e-n):0}function uc(n,e,t){return(1-t)*n+t*e}function iA(n,e,t,i){return uc(n,e,1-Math.exp(-t*i))}function sA(n,e=1){return e-Math.abs(Bv(n,e*2)-e)}function rA(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function oA(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function aA(n,e){return n+Math.floor(Math.random()*(e-n+1))}function lA(n,e){return n+Math.random()*(e-n)}function cA(n){return n*(.5-Math.random())}function hA(n){n!==void 0&&(Z_=n);let e=Z_+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function uA(n){return n*Ro}function dA(n){return n*tl}function pA(n){return(n&n-1)===0&&n!==0}function fA(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function mA(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function vA(n,e,t,i,s){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+i)/2),h=o((e+i)/2),u=r((e-i)/2),d=o((e-i)/2),p=r((i-e)/2),f=o((i-e)/2);switch(s){case"XYX":n.set(a*h,l*u,l*d,a*c);break;case"YZY":n.set(l*d,a*h,l*u,a*c);break;case"ZXZ":n.set(l*u,l*d,a*h,a*c);break;case"XZX":n.set(a*h,l*f,l*p,a*c);break;case"YXY":n.set(l*p,a*h,l*f,a*c);break;case"ZYZ":n.set(l*f,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Zn(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function et(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const sp={DEG2RAD:Ro,RAD2DEG:tl,generateUUID:Ei,clamp:Ke,euclideanModulo:Bv,mapLinear:tA,inverseLerp:nA,lerp:uc,damp:iA,pingpong:sA,smoothstep:rA,smootherstep:oA,randInt:aA,randFloat:lA,randFloatSpread:cA,seededRandom:hA,degToRad:uA,radToDeg:dA,isPowerOfTwo:pA,ceilPowerOfTwo:fA,floorPowerOfTwo:mA,setQuaternionFromProperEuler:vA,normalize:et,denormalize:Zn};class ee{constructor(e=0,t=0){ee.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Ke(this.x,e.x,t.x),this.y=Ke(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Ke(this.x,e,t),this.y=Ke(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Ke(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Ke(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*s+e.x,this.y=r*s+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Je{constructor(e,t,i,s,r,o,a,l,c){Je.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,o,a,l,c)}set(e,t,i,s,r,o,a,l,c){const h=this.elements;return h[0]=e,h[1]=s,h[2]=a,h[3]=t,h[4]=r,h[5]=l,h[6]=i,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],h=i[4],u=i[7],d=i[2],p=i[5],f=i[8],g=s[0],m=s[3],v=s[6],x=s[1],b=s[4],_=s[7],C=s[2],M=s[5],S=s[8];return r[0]=o*g+a*x+l*C,r[3]=o*m+a*b+l*M,r[6]=o*v+a*_+l*S,r[1]=c*g+h*x+u*C,r[4]=c*m+h*b+u*M,r[7]=c*v+h*_+u*S,r[2]=d*g+p*x+f*C,r[5]=d*m+p*b+f*M,r[8]=d*v+p*_+f*S,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t*o*h-t*a*c-i*r*h+i*a*l+s*r*c-s*o*l}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=h*o-a*c,d=a*l-h*r,p=c*r-o*l,f=t*u+i*d+s*p;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/f;return e[0]=u*g,e[1]=(s*c-h*i)*g,e[2]=(a*i-s*o)*g,e[3]=d*g,e[4]=(h*t-s*l)*g,e[5]=(s*r-a*t)*g,e[6]=p*g,e[7]=(i*l-c*t)*g,e[8]=(o*t-i*r)*g,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-s*c,s*l,-s*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(cf.makeScale(e,t)),this}rotate(e){return this.premultiply(cf.makeRotation(-e)),this}translate(e,t){return this.premultiply(cf.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<9;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const cf=new Je;function Ow(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const gA={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Oa(n,e){return new gA[n](e)}function Ec(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function kw(){const n=Ec("canvas");return n.style.display="block",n}const J_={};function Iu(n){n in J_||(J_[n]=!0,console.warn(n))}function _A(n,e,t){return new Promise(function(i,s){function r(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:s();break;case n.TIMEOUT_EXPIRED:setTimeout(r,t);break;default:i()}}setTimeout(r,t)})}function bA(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function xA(n){const e=n.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const Q_=new Je().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),e0=new Je().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function yA(){const n={enabled:!0,workingColorSpace:Gn,spaces:{},convert:function(s,r,o){return this.enabled===!1||r===o||!r||!o||(this.spaces[r].transfer===Dt&&(s.r=qs(s.r),s.g=qs(s.g),s.b=qs(s.b)),this.spaces[r].primaries!==this.spaces[o].primaries&&(s.applyMatrix3(this.spaces[r].toXYZ),s.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Dt&&(s.r=Ba(s.r),s.g=Ba(s.g),s.b=Ba(s.b))),s},fromWorkingColorSpace:function(s,r){return this.convert(s,this.workingColorSpace,r)},toWorkingColorSpace:function(s,r){return this.convert(s,r,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===Vs?xc:this.spaces[s].transfer},getLuminanceCoefficients:function(s,r=this.workingColorSpace){return s.fromArray(this.spaces[r].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,r,o){return s.copy(this.spaces[r].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],i=[.3127,.329];return n.define({[Gn]:{primaries:e,whitePoint:i,transfer:xc,toXYZ:Q_,fromXYZ:e0,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:gn},outputColorSpaceConfig:{drawingBufferColorSpace:gn}},[gn]:{primaries:e,whitePoint:i,transfer:Dt,toXYZ:Q_,fromXYZ:e0,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:gn}}}),n}const ht=yA();function qs(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Ba(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let sa;class Uw{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{sa===void 0&&(sa=Ec("canvas")),sa.width=e.width,sa.height=e.height;const s=sa.getContext("2d");e instanceof ImageData?s.putImageData(e,0,0):s.drawImage(e,0,0,e.width,e.height),i=sa}return i.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Ec("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),r=s.data;for(let o=0;o<r.length;o++)r[o]=qs(r[o]/255)*255;return i.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(qs(t[i]/255)*255):t[i]=qs(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let wA=0;class Er{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:wA++}),this.uuid=Ei(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let o=0,a=s.length;o<a;o++)s[o].isDataTexture?r.push(hf(s[o].image)):r.push(hf(s[o]))}else r=hf(s);i.url=r}return t||(e.images[this.uuid]=i),i}}function hf(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?Uw.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let EA=0;class Wt extends Es{constructor(e=Wt.DEFAULT_IMAGE,t=Wt.DEFAULT_MAPPING,i=xi,s=xi,r=sn,o=ki,a=ei,l=vs,c=Wt.DEFAULT_ANISOTROPY,h=Vs){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:EA++}),this.uuid=Ei(),this.name="",this.source=new Er(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new ee(0,0),this.repeat=new ee(1,1),this.center=new ee(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Je,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Kd)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Rr:e.x=e.x-Math.floor(e.x);break;case xi:e.x=e.x<0?0:1;break;case qa:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Rr:e.y=e.y-Math.floor(e.y);break;case xi:e.y=e.y<0?0:1;break;case qa:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Wt.DEFAULT_IMAGE=null;Wt.DEFAULT_MAPPING=Kd;Wt.DEFAULT_ANISOTROPY=1;class ct{constructor(e=0,t=0,i=0,s=1){ct.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*s+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*s+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*s+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*s+o[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,s,r;const l=e.elements,c=l[0],h=l[4],u=l[8],d=l[1],p=l[5],f=l[9],g=l[2],m=l[6],v=l[10];if(Math.abs(h-d)<.01&&Math.abs(u-g)<.01&&Math.abs(f-m)<.01){if(Math.abs(h+d)<.1&&Math.abs(u+g)<.1&&Math.abs(f+m)<.1&&Math.abs(c+p+v-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const b=(c+1)/2,_=(p+1)/2,C=(v+1)/2,M=(h+d)/4,S=(u+g)/4,P=(f+m)/4;return b>_&&b>C?b<.01?(i=0,s=.707106781,r=.707106781):(i=Math.sqrt(b),s=M/i,r=S/i):_>C?_<.01?(i=.707106781,s=0,r=.707106781):(s=Math.sqrt(_),i=M/s,r=P/s):C<.01?(i=.707106781,s=.707106781,r=0):(r=Math.sqrt(C),i=S/r,s=P/r),this.set(i,s,r,t),this}let x=Math.sqrt((m-f)*(m-f)+(u-g)*(u-g)+(d-h)*(d-h));return Math.abs(x)<.001&&(x=1),this.x=(m-f)/x,this.y=(u-g)/x,this.z=(d-h)/x,this.w=Math.acos((c+p+v-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Ke(this.x,e.x,t.x),this.y=Ke(this.y,e.y,t.y),this.z=Ke(this.z,e.z,t.z),this.w=Ke(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Ke(this.x,e,t),this.y=Ke(this.y,e,t),this.z=Ke(this.z,e,t),this.w=Ke(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Ke(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class rp extends Es{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new ct(0,0,e,t),this.scissorTest=!1,this.viewport=new ct(0,0,e,t);const s={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:sn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const r=new Wt(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);r.flipY=!1,r.generateMipmaps=i.generateMipmaps,r.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=r.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let s=0,r=this.textures.length;s<r;s++)this.textures[s].image.width=e,this.textures[s].image.height=t,this.textures[s].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,i=e.textures.length;t<i;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const s=Object.assign({},e.textures[t].image);this.textures[t].source=new Er(s)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class gs extends rp{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class Kc extends Wt{constructor(e=null,t=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=xn,this.minFilter=xn,this.wrapR=xi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class MA extends gs{constructor(e=1,t=1,i=1,s={}){super(e,t,s),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new Kc(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class op extends Wt{constructor(e=null,t=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=xn,this.minFilter=xn,this.wrapR=xi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class SA extends gs{constructor(e=1,t=1,i=1,s={}){super(e,t,s),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new op(null,e,t,i),this.texture.isRenderTargetTexture=!0}}let In=class{constructor(e=0,t=0,i=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=s}static slerpFlat(e,t,i,s,r,o,a){let l=i[s+0],c=i[s+1],h=i[s+2],u=i[s+3];const d=r[o+0],p=r[o+1],f=r[o+2],g=r[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=u;return}if(a===1){e[t+0]=d,e[t+1]=p,e[t+2]=f,e[t+3]=g;return}if(u!==g||l!==d||c!==p||h!==f){let m=1-a;const v=l*d+c*p+h*f+u*g,x=v>=0?1:-1,b=1-v*v;if(b>Number.EPSILON){const C=Math.sqrt(b),M=Math.atan2(C,v*x);m=Math.sin(m*M)/C,a=Math.sin(a*M)/C}const _=a*x;if(l=l*m+d*_,c=c*m+p*_,h=h*m+f*_,u=u*m+g*_,m===1-a){const C=1/Math.sqrt(l*l+c*c+h*h+u*u);l*=C,c*=C,h*=C,u*=C}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,s,r,o){const a=i[s],l=i[s+1],c=i[s+2],h=i[s+3],u=r[o],d=r[o+1],p=r[o+2],f=r[o+3];return e[t]=a*f+h*u+l*p-c*d,e[t+1]=l*f+h*d+c*u-a*p,e[t+2]=c*f+h*p+a*d-l*u,e[t+3]=h*f-a*u-l*d-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,s=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(s/2),u=a(r/2),d=l(i/2),p=l(s/2),f=l(r/2);switch(o){case"XYZ":this._x=d*h*u+c*p*f,this._y=c*p*u-d*h*f,this._z=c*h*f+d*p*u,this._w=c*h*u-d*p*f;break;case"YXZ":this._x=d*h*u+c*p*f,this._y=c*p*u-d*h*f,this._z=c*h*f-d*p*u,this._w=c*h*u+d*p*f;break;case"ZXY":this._x=d*h*u-c*p*f,this._y=c*p*u+d*h*f,this._z=c*h*f+d*p*u,this._w=c*h*u-d*p*f;break;case"ZYX":this._x=d*h*u-c*p*f,this._y=c*p*u+d*h*f,this._z=c*h*f-d*p*u,this._w=c*h*u+d*p*f;break;case"YZX":this._x=d*h*u+c*p*f,this._y=c*p*u+d*h*f,this._z=c*h*f-d*p*u,this._w=c*h*u-d*p*f;break;case"XZY":this._x=d*h*u-c*p*f,this._y=c*p*u-d*h*f,this._z=c*h*f+d*p*u,this._w=c*h*u+d*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],h=t[6],u=t[10],d=i+a+u;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(h-l)*p,this._y=(r-c)*p,this._z=(o-s)*p}else if(i>a&&i>u){const p=2*Math.sqrt(1+i-a-u);this._w=(h-l)/p,this._x=.25*p,this._y=(s+o)/p,this._z=(r+c)/p}else if(a>u){const p=2*Math.sqrt(1+a-i-u);this._w=(r-c)/p,this._x=(s+o)/p,this._y=.25*p,this._z=(l+h)/p}else{const p=2*Math.sqrt(1+u-i-a);this._w=(o-s)/p,this._x=(r+c)/p,this._y=(l+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ke(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,h=t._w;return this._x=i*h+o*a+s*c-r*l,this._y=s*h+o*l+r*a-i*c,this._z=r*h+o*c+i*l-s*a,this._w=o*h-i*a-s*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,s=this._y,r=this._z,o=this._w;let a=o*e._w+i*e._x+s*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=s,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*i+t*this._x,this._y=p*s+t*this._y,this._z=p*r+t*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),u=Math.sin((1-t)*h)/c,d=Math.sin(t*h)/c;return this._w=o*u+this._w*d,this._x=i*u+this._x*d,this._y=s*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(s*Math.sin(e),s*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},R=class Fw{constructor(e=0,t=0,i=0){Fw.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(t0.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(t0.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*s,this.y=r[1]*t+r[4]*i+r[7]*s,this.z=r[2]*t+r[5]*i+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*s+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*s+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*s+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*s-a*i),h=2*(a*t-r*s),u=2*(r*i-o*t);return this.x=t+l*c+o*u-a*h,this.y=i+l*h+a*c-r*u,this.z=s+l*u+r*h-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*s,this.y=r[1]*t+r[5]*i+r[9]*s,this.z=r[2]*t+r[6]*i+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Ke(this.x,e.x,t.x),this.y=Ke(this.y,e.y,t.y),this.z=Ke(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Ke(this.x,e,t),this.y=Ke(this.y,e,t),this.z=Ke(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Ke(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=s*l-r*a,this.y=r*o-i*l,this.z=i*a-s*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return uf.copy(this).projectOnVector(e),this.sub(uf)}reflect(e){return this.sub(uf.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Ke(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const uf=new R,t0=new In;class yn{constructor(e=new R(1/0,1/0,1/0),t=new R(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(qi.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(qi.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=qi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const r=i.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=r.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,qi):qi.fromBufferAttribute(r,o),qi.applyMatrix4(e.matrixWorld),this.expandByPoint(qi);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Ch.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Ch.copy(i.boundingBox)),Ch.applyMatrix4(e.matrixWorld),this.union(Ch)}const s=e.children;for(let r=0,o=s.length;r<o;r++)this.expandByObject(s[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,qi),qi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Rl),Ah.subVectors(this.max,Rl),ra.subVectors(e.a,Rl),oa.subVectors(e.b,Rl),aa.subVectors(e.c,Rl),ir.subVectors(oa,ra),sr.subVectors(aa,oa),Kr.subVectors(ra,aa);let t=[0,-ir.z,ir.y,0,-sr.z,sr.y,0,-Kr.z,Kr.y,ir.z,0,-ir.x,sr.z,0,-sr.x,Kr.z,0,-Kr.x,-ir.y,ir.x,0,-sr.y,sr.x,0,-Kr.y,Kr.x,0];return!df(t,ra,oa,aa,Ah)||(t=[1,0,0,0,1,0,0,0,1],!df(t,ra,oa,aa,Ah))?!1:(Th.crossVectors(ir,sr),t=[Th.x,Th.y,Th.z],df(t,ra,oa,aa,Ah))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,qi).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(qi).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ts[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ts[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ts[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ts[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ts[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ts[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ts[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ts[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ts),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ts=[new R,new R,new R,new R,new R,new R,new R,new R],qi=new R,Ch=new yn,ra=new R,oa=new R,aa=new R,ir=new R,sr=new R,Kr=new R,Rl=new R,Ah=new R,Th=new R,Yr=new R;function df(n,e,t,i,s){for(let r=0,o=n.length-3;r<=o;r+=3){Yr.fromArray(n,r);const a=s.x*Math.abs(Yr.x)+s.y*Math.abs(Yr.y)+s.z*Math.abs(Yr.z),l=e.dot(Yr),c=t.dot(Yr),h=i.dot(Yr);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}const CA=new yn,Ll=new R,pf=new R;class wn{constructor(e=new R,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):CA.setFromPoints(e).getCenter(i);let s=0;for(let r=0,o=e.length;r<o;r++)s=Math.max(s,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ll.subVectors(e,this.center);const t=Ll.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),s=(i-this.radius)*.5;this.center.addScaledVector(Ll,s/i),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(pf.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ll.copy(e.center).add(pf)),this.expandByPoint(Ll.copy(e.center).sub(pf))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Ps=new R,ff=new R,Ph=new R,rr=new R,mf=new R,Rh=new R,vf=new R;class Br{constructor(e=new R,t=new R(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ps)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ps.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ps.copy(this.origin).addScaledVector(this.direction,t),Ps.distanceToSquared(e))}distanceSqToSegment(e,t,i,s){ff.copy(e).add(t).multiplyScalar(.5),Ph.copy(t).sub(e).normalize(),rr.copy(this.origin).sub(ff);const r=e.distanceTo(t)*.5,o=-this.direction.dot(Ph),a=rr.dot(this.direction),l=-rr.dot(Ph),c=rr.lengthSq(),h=Math.abs(1-o*o);let u,d,p,f;if(h>0)if(u=o*l-a,d=o*a-l,f=r*h,u>=0)if(d>=-f)if(d<=f){const g=1/h;u*=g,d*=g,p=u*(u+o*d+2*a)+d*(o*u+d+2*l)+c}else d=r,u=Math.max(0,-(o*d+a)),p=-u*u+d*(d+2*l)+c;else d=-r,u=Math.max(0,-(o*d+a)),p=-u*u+d*(d+2*l)+c;else d<=-f?(u=Math.max(0,-(-o*r+a)),d=u>0?-r:Math.min(Math.max(-r,-l),r),p=-u*u+d*(d+2*l)+c):d<=f?(u=0,d=Math.min(Math.max(-r,-l),r),p=d*(d+2*l)+c):(u=Math.max(0,-(o*r+a)),d=u>0?r:Math.min(Math.max(-r,-l),r),p=-u*u+d*(d+2*l)+c);else d=o>0?-r:r,u=Math.max(0,-(o*d+a)),p=-u*u+d*(d+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,u),s&&s.copy(ff).addScaledVector(Ph,d),p}intersectSphere(e,t){Ps.subVectors(e.center,this.origin);const i=Ps.dot(this.direction),s=Ps.dot(Ps)-i*i,r=e.radius*e.radius;if(s>r)return null;const o=Math.sqrt(r-s),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,s,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,d=this.origin;return c>=0?(i=(e.min.x-d.x)*c,s=(e.max.x-d.x)*c):(i=(e.max.x-d.x)*c,s=(e.min.x-d.x)*c),h>=0?(r=(e.min.y-d.y)*h,o=(e.max.y-d.y)*h):(r=(e.max.y-d.y)*h,o=(e.min.y-d.y)*h),i>o||r>s||((r>i||isNaN(i))&&(i=r),(o<s||isNaN(s))&&(s=o),u>=0?(a=(e.min.z-d.z)*u,l=(e.max.z-d.z)*u):(a=(e.max.z-d.z)*u,l=(e.min.z-d.z)*u),i>l||a>s)||((a>i||i!==i)&&(i=a),(l<s||s!==s)&&(s=l),s<0)?null:this.at(i>=0?i:s,t)}intersectsBox(e){return this.intersectBox(e,Ps)!==null}intersectTriangle(e,t,i,s,r){mf.subVectors(t,e),Rh.subVectors(i,e),vf.crossVectors(mf,Rh);let o=this.direction.dot(vf),a;if(o>0){if(s)return null;a=1}else if(o<0)a=-1,o=-o;else return null;rr.subVectors(this.origin,e);const l=a*this.direction.dot(Rh.crossVectors(rr,Rh));if(l<0)return null;const c=a*this.direction.dot(mf.cross(rr));if(c<0||l+c>o)return null;const h=-a*rr.dot(vf);return h<0?null:this.at(h/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class De{constructor(e,t,i,s,r,o,a,l,c,h,u,d,p,f,g,m){De.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,o,a,l,c,h,u,d,p,f,g,m)}set(e,t,i,s,r,o,a,l,c,h,u,d,p,f,g,m){const v=this.elements;return v[0]=e,v[4]=t,v[8]=i,v[12]=s,v[1]=r,v[5]=o,v[9]=a,v[13]=l,v[2]=c,v[6]=h,v[10]=u,v[14]=d,v[3]=p,v[7]=f,v[11]=g,v[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new De().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,s=1/la.setFromMatrixColumn(e,0).length(),r=1/la.setFromMatrixColumn(e,1).length(),o=1/la.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,s=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(s),c=Math.sin(s),h=Math.cos(r),u=Math.sin(r);if(e.order==="XYZ"){const d=o*h,p=o*u,f=a*h,g=a*u;t[0]=l*h,t[4]=-l*u,t[8]=c,t[1]=p+f*c,t[5]=d-g*c,t[9]=-a*l,t[2]=g-d*c,t[6]=f+p*c,t[10]=o*l}else if(e.order==="YXZ"){const d=l*h,p=l*u,f=c*h,g=c*u;t[0]=d+g*a,t[4]=f*a-p,t[8]=o*c,t[1]=o*u,t[5]=o*h,t[9]=-a,t[2]=p*a-f,t[6]=g+d*a,t[10]=o*l}else if(e.order==="ZXY"){const d=l*h,p=l*u,f=c*h,g=c*u;t[0]=d-g*a,t[4]=-o*u,t[8]=f+p*a,t[1]=p+f*a,t[5]=o*h,t[9]=g-d*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const d=o*h,p=o*u,f=a*h,g=a*u;t[0]=l*h,t[4]=f*c-p,t[8]=d*c+g,t[1]=l*u,t[5]=g*c+d,t[9]=p*c-f,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const d=o*l,p=o*c,f=a*l,g=a*c;t[0]=l*h,t[4]=g-d*u,t[8]=f*u+p,t[1]=u,t[5]=o*h,t[9]=-a*h,t[2]=-c*h,t[6]=p*u+f,t[10]=d-g*u}else if(e.order==="XZY"){const d=o*l,p=o*c,f=a*l,g=a*c;t[0]=l*h,t[4]=-u,t[8]=c*h,t[1]=d*u+g,t[5]=o*h,t[9]=p*u-f,t[2]=f*u-p,t[6]=a*h,t[10]=g*u+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(AA,e,TA)}lookAt(e,t,i){const s=this.elements;return vi.subVectors(e,t),vi.lengthSq()===0&&(vi.z=1),vi.normalize(),or.crossVectors(i,vi),or.lengthSq()===0&&(Math.abs(i.z)===1?vi.x+=1e-4:vi.z+=1e-4,vi.normalize(),or.crossVectors(i,vi)),or.normalize(),Lh.crossVectors(vi,or),s[0]=or.x,s[4]=Lh.x,s[8]=vi.x,s[1]=or.y,s[5]=Lh.y,s[9]=vi.y,s[2]=or.z,s[6]=Lh.z,s[10]=vi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],h=i[1],u=i[5],d=i[9],p=i[13],f=i[2],g=i[6],m=i[10],v=i[14],x=i[3],b=i[7],_=i[11],C=i[15],M=s[0],S=s[4],P=s[8],E=s[12],y=s[1],L=s[5],k=s[9],D=s[13],W=s[2],z=s[6],H=s[10],ne=s[14],G=s[3],ae=s[7],se=s[11],ge=s[15];return r[0]=o*M+a*y+l*W+c*G,r[4]=o*S+a*L+l*z+c*ae,r[8]=o*P+a*k+l*H+c*se,r[12]=o*E+a*D+l*ne+c*ge,r[1]=h*M+u*y+d*W+p*G,r[5]=h*S+u*L+d*z+p*ae,r[9]=h*P+u*k+d*H+p*se,r[13]=h*E+u*D+d*ne+p*ge,r[2]=f*M+g*y+m*W+v*G,r[6]=f*S+g*L+m*z+v*ae,r[10]=f*P+g*k+m*H+v*se,r[14]=f*E+g*D+m*ne+v*ge,r[3]=x*M+b*y+_*W+C*G,r[7]=x*S+b*L+_*z+C*ae,r[11]=x*P+b*k+_*H+C*se,r[15]=x*E+b*D+_*ne+C*ge,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],h=e[2],u=e[6],d=e[10],p=e[14],f=e[3],g=e[7],m=e[11],v=e[15];return f*(+r*l*u-s*c*u-r*a*d+i*c*d+s*a*p-i*l*p)+g*(+t*l*p-t*c*d+r*o*d-s*o*p+s*c*h-r*l*h)+m*(+t*c*u-t*a*p-r*o*u+i*o*p+r*a*h-i*c*h)+v*(-s*a*h-t*l*u+t*a*d+s*o*u-i*o*d+i*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=e[9],d=e[10],p=e[11],f=e[12],g=e[13],m=e[14],v=e[15],x=u*m*c-g*d*c+g*l*p-a*m*p-u*l*v+a*d*v,b=f*d*c-h*m*c-f*l*p+o*m*p+h*l*v-o*d*v,_=h*g*c-f*u*c+f*a*p-o*g*p-h*a*v+o*u*v,C=f*u*l-h*g*l-f*a*d+o*g*d+h*a*m-o*u*m,M=t*x+i*b+s*_+r*C;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/M;return e[0]=x*S,e[1]=(g*d*r-u*m*r-g*s*p+i*m*p+u*s*v-i*d*v)*S,e[2]=(a*m*r-g*l*r+g*s*c-i*m*c-a*s*v+i*l*v)*S,e[3]=(u*l*r-a*d*r-u*s*c+i*d*c+a*s*p-i*l*p)*S,e[4]=b*S,e[5]=(h*m*r-f*d*r+f*s*p-t*m*p-h*s*v+t*d*v)*S,e[6]=(f*l*r-o*m*r-f*s*c+t*m*c+o*s*v-t*l*v)*S,e[7]=(o*d*r-h*l*r+h*s*c-t*d*c-o*s*p+t*l*p)*S,e[8]=_*S,e[9]=(f*u*r-h*g*r-f*i*p+t*g*p+h*i*v-t*u*v)*S,e[10]=(o*g*r-f*a*r+f*i*c-t*g*c-o*i*v+t*a*v)*S,e[11]=(h*a*r-o*u*r-h*i*c+t*u*c+o*i*p-t*a*p)*S,e[12]=C*S,e[13]=(h*g*s-f*u*s+f*i*d-t*g*d-h*i*m+t*u*m)*S,e[14]=(f*a*s-o*g*s-f*i*l+t*g*l+o*i*m-t*a*m)*S,e[15]=(o*u*s-h*a*s+h*i*l-t*u*l-o*i*d+t*a*d)*S,this}scale(e){const t=this.elements,i=e.x,s=e.y,r=e.z;return t[0]*=i,t[4]*=s,t[8]*=r,t[1]*=i,t[5]*=s,t[9]*=r,t[2]*=i,t[6]*=s,t[10]*=r,t[3]*=i,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),r=1-i,o=e.x,a=e.y,l=e.z,c=r*o,h=r*a;return this.set(c*o+i,c*a-s*l,c*l+s*a,0,c*a+s*l,h*a+i,h*l-s*o,0,c*l-s*a,h*l+s*o,r*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,s,r,o){return this.set(1,i,r,0,e,1,o,0,t,s,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,h=o+o,u=a+a,d=r*c,p=r*h,f=r*u,g=o*h,m=o*u,v=a*u,x=l*c,b=l*h,_=l*u,C=i.x,M=i.y,S=i.z;return s[0]=(1-(g+v))*C,s[1]=(p+_)*C,s[2]=(f-b)*C,s[3]=0,s[4]=(p-_)*M,s[5]=(1-(d+v))*M,s[6]=(m+x)*M,s[7]=0,s[8]=(f+b)*S,s[9]=(m-x)*S,s[10]=(1-(d+g))*S,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;let r=la.set(s[0],s[1],s[2]).length();const o=la.set(s[4],s[5],s[6]).length(),a=la.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],Ki.copy(this);const c=1/r,h=1/o,u=1/a;return Ki.elements[0]*=c,Ki.elements[1]*=c,Ki.elements[2]*=c,Ki.elements[4]*=h,Ki.elements[5]*=h,Ki.elements[6]*=h,Ki.elements[8]*=u,Ki.elements[9]*=u,Ki.elements[10]*=u,t.setFromRotationMatrix(Ki),i.x=r,i.y=o,i.z=a,this}makePerspective(e,t,i,s,r,o,a=Ji){const l=this.elements,c=2*r/(t-e),h=2*r/(i-s),u=(t+e)/(t-e),d=(i+s)/(i-s);let p,f;if(a===Ji)p=-(o+r)/(o-r),f=-2*o*r/(o-r);else if(a===wc)p=-o/(o-r),f=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=u,l[12]=0,l[1]=0,l[5]=h,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,s,r,o,a=Ji){const l=this.elements,c=1/(t-e),h=1/(i-s),u=1/(o-r),d=(t+e)*c,p=(i+s)*h;let f,g;if(a===Ji)f=(o+r)*u,g=-2*u;else if(a===wc)f=r*u,g=-1*u;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=g,l[14]=-f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const la=new R,Ki=new De,AA=new R(0,0,0),TA=new R(1,1,1),or=new R,Lh=new R,vi=new R,n0=new De,i0=new In;let es=class Bw{constructor(e=0,t=0,i=0,s=Bw.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,s=this._order){return this._x=e,this._y=t,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const s=e.elements,r=s[0],o=s[4],a=s[8],l=s[1],c=s[5],h=s[9],u=s[2],d=s[6],p=s[10];switch(t){case"XYZ":this._y=Math.asin(Ke(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Ke(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(Ke(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-Ke(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Ke(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-Ke(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return n0.makeRotationFromQuaternion(e),this.setFromRotationMatrix(n0,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return i0.setFromEuler(this),this.setFromQuaternion(i0,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};es.DEFAULT_ORDER="XYZ";class ap{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let PA=0;const s0=new R,ca=new In,Rs=new De,Ih=new R,Il=new R,RA=new R,LA=new In,r0=new R(1,0,0),o0=new R(0,1,0),a0=new R(0,0,1),l0={type:"added"},IA={type:"removed"},ha={type:"childadded",child:null},gf={type:"childremoved",child:null};class ft extends Es{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:PA++}),this.uuid=Ei(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ft.DEFAULT_UP.clone();const e=new R,t=new es,i=new In,s=new R(1,1,1);function r(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new De},normalMatrix:{value:new Je}}),this.matrix=new De,this.matrixWorld=new De,this.matrixAutoUpdate=ft.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ft.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ap,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ca.setFromAxisAngle(e,t),this.quaternion.multiply(ca),this}rotateOnWorldAxis(e,t){return ca.setFromAxisAngle(e,t),this.quaternion.premultiply(ca),this}rotateX(e){return this.rotateOnAxis(r0,e)}rotateY(e){return this.rotateOnAxis(o0,e)}rotateZ(e){return this.rotateOnAxis(a0,e)}translateOnAxis(e,t){return s0.copy(e).applyQuaternion(this.quaternion),this.position.add(s0.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(r0,e)}translateY(e){return this.translateOnAxis(o0,e)}translateZ(e){return this.translateOnAxis(a0,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Rs.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Ih.copy(e):Ih.set(e,t,i);const s=this.parent;this.updateWorldMatrix(!0,!1),Il.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Rs.lookAt(Il,Ih,this.up):Rs.lookAt(Ih,Il,this.up),this.quaternion.setFromRotationMatrix(Rs),s&&(Rs.extractRotation(s.matrixWorld),ca.setFromRotationMatrix(Rs),this.quaternion.premultiply(ca.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(l0),ha.child=e,this.dispatchEvent(ha),ha.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(IA),gf.child=e,this.dispatchEvent(gf),gf.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Rs.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Rs.multiply(e.parent.matrixWorld)),e.applyMatrix4(Rs),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(l0),ha.child=e,this.dispatchEvent(ha),ha.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,s=this.children.length;i<s;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const s=this.children;for(let r=0,o=s.length;r<o;r++)s[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Il,e,RA),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Il,LA,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const s=this.children;for(let r=0,o=s.length;r<o;r++)s[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const u=l[c];r(e.shapes,u)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));s.material=a}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let a=0;a<this.children.length;a++)s.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];s.animations.push(r(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),h=o(e.images),u=o(e.shapes),d=o(e.skeletons),p=o(e.animations),f=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),h.length>0&&(i.images=h),u.length>0&&(i.shapes=u),d.length>0&&(i.skeletons=d),p.length>0&&(i.animations=p),f.length>0&&(i.nodes=f)}return i.object=s,i;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const s=e.children[i];this.add(s.clone())}return this}}ft.DEFAULT_UP=new R(0,1,0);ft.DEFAULT_MATRIX_AUTO_UPDATE=!0;ft.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Yi=new R,Ls=new R,_f=new R,Is=new R,ua=new R,da=new R,c0=new R,bf=new R,xf=new R,yf=new R,wf=new ct,Ef=new ct,Mf=new ct;class ui{constructor(e=new R,t=new R,i=new R){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,s){s.subVectors(i,t),Yi.subVectors(e,t),s.cross(Yi);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,i,s,r){Yi.subVectors(s,t),Ls.subVectors(i,t),_f.subVectors(e,t);const o=Yi.dot(Yi),a=Yi.dot(Ls),l=Yi.dot(_f),c=Ls.dot(Ls),h=Ls.dot(_f),u=o*c-a*a;if(u===0)return r.set(0,0,0),null;const d=1/u,p=(c*l-a*h)*d,f=(o*h-a*l)*d;return r.set(1-p-f,f,p)}static containsPoint(e,t,i,s){return this.getBarycoord(e,t,i,s,Is)===null?!1:Is.x>=0&&Is.y>=0&&Is.x+Is.y<=1}static getInterpolation(e,t,i,s,r,o,a,l){return this.getBarycoord(e,t,i,s,Is)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(r,Is.x),l.addScaledVector(o,Is.y),l.addScaledVector(a,Is.z),l)}static getInterpolatedAttribute(e,t,i,s,r,o){return wf.setScalar(0),Ef.setScalar(0),Mf.setScalar(0),wf.fromBufferAttribute(e,t),Ef.fromBufferAttribute(e,i),Mf.fromBufferAttribute(e,s),o.setScalar(0),o.addScaledVector(wf,r.x),o.addScaledVector(Ef,r.y),o.addScaledVector(Mf,r.z),o}static isFrontFacing(e,t,i,s){return Yi.subVectors(i,t),Ls.subVectors(e,t),Yi.cross(Ls).dot(s)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,s){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,i,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Yi.subVectors(this.c,this.b),Ls.subVectors(this.a,this.b),Yi.cross(Ls).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ui.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ui.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,s,r){return ui.getInterpolation(e,this.a,this.b,this.c,t,i,s,r)}containsPoint(e){return ui.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ui.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,s=this.b,r=this.c;let o,a;ua.subVectors(s,i),da.subVectors(r,i),bf.subVectors(e,i);const l=ua.dot(bf),c=da.dot(bf);if(l<=0&&c<=0)return t.copy(i);xf.subVectors(e,s);const h=ua.dot(xf),u=da.dot(xf);if(h>=0&&u<=h)return t.copy(s);const d=l*u-h*c;if(d<=0&&l>=0&&h<=0)return o=l/(l-h),t.copy(i).addScaledVector(ua,o);yf.subVectors(e,r);const p=ua.dot(yf),f=da.dot(yf);if(f>=0&&p<=f)return t.copy(r);const g=p*c-l*f;if(g<=0&&c>=0&&f<=0)return a=c/(c-f),t.copy(i).addScaledVector(da,a);const m=h*f-p*u;if(m<=0&&u-h>=0&&p-f>=0)return c0.subVectors(r,s),a=(u-h)/(u-h+(p-f)),t.copy(s).addScaledVector(c0,a);const v=1/(m+g+d);return o=g*v,a=d*v,t.copy(i).addScaledVector(ua,o).addScaledVector(da,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Vw={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ar={h:0,s:0,l:0},Dh={h:0,s:0,l:0};function Sf(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class ve{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=gn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ht.toWorkingColorSpace(this,t),this}setRGB(e,t,i,s=ht.workingColorSpace){return this.r=e,this.g=t,this.b=i,ht.toWorkingColorSpace(this,s),this}setHSL(e,t,i,s=ht.workingColorSpace){if(e=Bv(e,1),t=Ke(t,0,1),i=Ke(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=Sf(o,r,e+1/3),this.g=Sf(o,r,e),this.b=Sf(o,r,e-1/3)}return ht.toWorkingColorSpace(this,s),this}setStyle(e,t=gn){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=s[1],a=s[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=gn){const i=Vw[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=qs(e.r),this.g=qs(e.g),this.b=qs(e.b),this}copyLinearToSRGB(e){return this.r=Ba(e.r),this.g=Ba(e.g),this.b=Ba(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=gn){return ht.fromWorkingColorSpace(Fn.copy(this),e),Math.round(Ke(Fn.r*255,0,255))*65536+Math.round(Ke(Fn.g*255,0,255))*256+Math.round(Ke(Fn.b*255,0,255))}getHexString(e=gn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ht.workingColorSpace){ht.fromWorkingColorSpace(Fn.copy(this),t);const i=Fn.r,s=Fn.g,r=Fn.b,o=Math.max(i,s,r),a=Math.min(i,s,r);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const u=o-a;switch(c=h<=.5?u/(o+a):u/(2-o-a),o){case i:l=(s-r)/u+(s<r?6:0);break;case s:l=(r-i)/u+2;break;case r:l=(i-s)/u+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=ht.workingColorSpace){return ht.fromWorkingColorSpace(Fn.copy(this),t),e.r=Fn.r,e.g=Fn.g,e.b=Fn.b,e}getStyle(e=gn){ht.fromWorkingColorSpace(Fn.copy(this),e);const t=Fn.r,i=Fn.g,s=Fn.b;return e!==gn?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(e,t,i){return this.getHSL(ar),this.setHSL(ar.h+e,ar.s+t,ar.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(ar),e.getHSL(Dh);const i=uc(ar.h,Dh.h,t),s=uc(ar.s,Dh.s,t),r=uc(ar.l,Dh.l,t);return this.setHSL(i,s,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,s=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*s,this.g=r[1]*t+r[4]*i+r[7]*s,this.b=r[2]*t+r[5]*i+r[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Fn=new ve;ve.NAMES=Vw;let DA=0;class En extends Es{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:DA++}),this.uuid=Ei(),this.name="",this.type="Material",this.blending=Po,this.side=ms,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=$u,this.blendDst=ju,this.blendEquation=yr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ve(0,0,0),this.blendAlpha=0,this.depthFunc=Do,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Gm,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=_o,this.stencilZFail=_o,this.stencilZPass=_o,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Po&&(i.blending=this.blending),this.side!==ms&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==$u&&(i.blendSrc=this.blendSrc),this.blendDst!==ju&&(i.blendDst=this.blendDst),this.blendEquation!==yr&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Do&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Gm&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==_o&&(i.stencilFail=this.stencilFail),this.stencilZFail!==_o&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==_o&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(t){const r=s(e.textures),o=s(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const s=t.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class yi extends En{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ve(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new es,this.combine=Xc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const zs=NA();function NA(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),s=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(i[l]=0,i[l|256]=32768,s[l]=24,s[l|256]=24):c<-14?(i[l]=1024>>-c-14,i[l|256]=1024>>-c-14|32768,s[l]=-c-1,s[l|256]=-c-1):c<=15?(i[l]=c+15<<10,i[l|256]=c+15<<10|32768,s[l]=13,s[l|256]=13):c<128?(i[l]=31744,i[l|256]=64512,s[l]=24,s[l|256]=24):(i[l]=31744,i[l|256]=64512,s[l]=13,s[l|256]=13)}const r=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,h=0;for(;(c&8388608)===0;)c<<=1,h-=8388608;c&=-8388609,h+=947912704,r[l]=c|h}for(let l=1024;l<2048;++l)r[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:s,mantissaTable:r,exponentTable:o,offsetTable:a}}function hi(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=Ke(n,-65504,65504),zs.floatView[0]=n;const e=zs.uint32View[0],t=e>>23&511;return zs.baseTable[t]+((e&8388607)>>zs.shiftTable[t])}function tc(n){const e=n>>10;return zs.uint32View[0]=zs.mantissaTable[zs.offsetTable[e]+(n&1023)]+zs.exponentTable[e],zs.floatView[0]}class OA{static toHalfFloat(e){return hi(e)}static fromHalfFloat(e){return tc(e)}}const cn=new R,Nh=new ee;let kA=0;class dt{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:kA++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=yc,this.updateRanges=[],this.gpuType=di,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[i+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Nh.fromBufferAttribute(this,t),Nh.applyMatrix3(e),this.setXY(t,Nh.x,Nh.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)cn.fromBufferAttribute(this,t),cn.applyMatrix3(e),this.setXYZ(t,cn.x,cn.y,cn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)cn.fromBufferAttribute(this,t),cn.applyMatrix4(e),this.setXYZ(t,cn.x,cn.y,cn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)cn.fromBufferAttribute(this,t),cn.applyNormalMatrix(e),this.setXYZ(t,cn.x,cn.y,cn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)cn.fromBufferAttribute(this,t),cn.transformDirection(e),this.setXYZ(t,cn.x,cn.y,cn.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=Zn(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=et(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Zn(t,this.array)),t}setX(e,t){return this.normalized&&(t=et(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Zn(t,this.array)),t}setY(e,t){return this.normalized&&(t=et(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Zn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=et(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Zn(t,this.array)),t}setW(e,t){return this.normalized&&(t=et(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=et(t,this.array),i=et(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=et(t,this.array),i=et(i,this.array),s=et(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e*=this.itemSize,this.normalized&&(t=et(t,this.array),i=et(i,this.array),s=et(s,this.array),r=et(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==yc&&(e.usage=this.usage),e}}class UA extends dt{constructor(e,t,i){super(new Int8Array(e),t,i)}}class FA extends dt{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class BA extends dt{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class VA extends dt{constructor(e,t,i){super(new Int16Array(e),t,i)}}class Vv extends dt{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class zA extends dt{constructor(e,t,i){super(new Int32Array(e),t,i)}}class zv extends dt{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class HA extends dt{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=tc(this.array[e*this.itemSize]);return this.normalized&&(t=Zn(t,this.array)),t}setX(e,t){return this.normalized&&(t=et(t,this.array)),this.array[e*this.itemSize]=hi(t),this}getY(e){let t=tc(this.array[e*this.itemSize+1]);return this.normalized&&(t=Zn(t,this.array)),t}setY(e,t){return this.normalized&&(t=et(t,this.array)),this.array[e*this.itemSize+1]=hi(t),this}getZ(e){let t=tc(this.array[e*this.itemSize+2]);return this.normalized&&(t=Zn(t,this.array)),t}setZ(e,t){return this.normalized&&(t=et(t,this.array)),this.array[e*this.itemSize+2]=hi(t),this}getW(e){let t=tc(this.array[e*this.itemSize+3]);return this.normalized&&(t=Zn(t,this.array)),t}setW(e,t){return this.normalized&&(t=et(t,this.array)),this.array[e*this.itemSize+3]=hi(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=et(t,this.array),i=et(i,this.array)),this.array[e+0]=hi(t),this.array[e+1]=hi(i),this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=et(t,this.array),i=et(i,this.array),s=et(s,this.array)),this.array[e+0]=hi(t),this.array[e+1]=hi(i),this.array[e+2]=hi(s),this}setXYZW(e,t,i,s,r){return e*=this.itemSize,this.normalized&&(t=et(t,this.array),i=et(i,this.array),s=et(s,this.array),r=et(r,this.array)),this.array[e+0]=hi(t),this.array[e+1]=hi(i),this.array[e+2]=hi(s),this.array[e+3]=hi(r),this}}class Te extends dt{constructor(e,t,i){super(new Float32Array(e),t,i)}}let GA=0;const Ri=new De,Cf=new ft,pa=new R,gi=new yn,Dl=new yn,Cn=new R;class Ye extends Es{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:GA++}),this.uuid=Ei(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Ow(e)?zv:Vv)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new Je().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ri.makeRotationFromQuaternion(e),this.applyMatrix4(Ri),this}rotateX(e){return Ri.makeRotationX(e),this.applyMatrix4(Ri),this}rotateY(e){return Ri.makeRotationY(e),this.applyMatrix4(Ri),this}rotateZ(e){return Ri.makeRotationZ(e),this.applyMatrix4(Ri),this}translate(e,t,i){return Ri.makeTranslation(e,t,i),this.applyMatrix4(Ri),this}scale(e,t,i){return Ri.makeScale(e,t,i),this.applyMatrix4(Ri),this}lookAt(e){return Cf.lookAt(e),Cf.updateMatrix(),this.applyMatrix4(Cf.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(pa).negate(),this.translate(pa.x,pa.y,pa.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const i=[];for(let s=0,r=e.length;s<r;s++){const o=e[s];i.push(o.x,o.y,o.z||0)}this.setAttribute("position",new Te(i,3))}else{const i=Math.min(e.length,t.count);for(let s=0;s<i;s++){const r=e[s];t.setXYZ(s,r.x,r.y,r.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new yn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new R(-1/0,-1/0,-1/0),new R(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,s=t.length;i<s;i++){const r=t[i];gi.setFromBufferAttribute(r),this.morphTargetsRelative?(Cn.addVectors(this.boundingBox.min,gi.min),this.boundingBox.expandByPoint(Cn),Cn.addVectors(this.boundingBox.max,gi.max),this.boundingBox.expandByPoint(Cn)):(this.boundingBox.expandByPoint(gi.min),this.boundingBox.expandByPoint(gi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new wn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new R,1/0);return}if(e){const i=this.boundingSphere.center;if(gi.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];Dl.setFromBufferAttribute(a),this.morphTargetsRelative?(Cn.addVectors(gi.min,Dl.min),gi.expandByPoint(Cn),Cn.addVectors(gi.max,Dl.max),gi.expandByPoint(Cn)):(gi.expandByPoint(Dl.min),gi.expandByPoint(Dl.max))}gi.getCenter(i);let s=0;for(let r=0,o=e.count;r<o;r++)Cn.fromBufferAttribute(e,r),s=Math.max(s,i.distanceToSquared(Cn));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)Cn.fromBufferAttribute(a,c),l&&(pa.fromBufferAttribute(e,c),Cn.add(pa)),s=Math.max(s,i.distanceToSquared(Cn))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,s=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new dt(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let P=0;P<i.count;P++)a[P]=new R,l[P]=new R;const c=new R,h=new R,u=new R,d=new ee,p=new ee,f=new ee,g=new R,m=new R;function v(P,E,y){c.fromBufferAttribute(i,P),h.fromBufferAttribute(i,E),u.fromBufferAttribute(i,y),d.fromBufferAttribute(r,P),p.fromBufferAttribute(r,E),f.fromBufferAttribute(r,y),h.sub(c),u.sub(c),p.sub(d),f.sub(d);const L=1/(p.x*f.y-f.x*p.y);isFinite(L)&&(g.copy(h).multiplyScalar(f.y).addScaledVector(u,-p.y).multiplyScalar(L),m.copy(u).multiplyScalar(p.x).addScaledVector(h,-f.x).multiplyScalar(L),a[P].add(g),a[E].add(g),a[y].add(g),l[P].add(m),l[E].add(m),l[y].add(m))}let x=this.groups;x.length===0&&(x=[{start:0,count:e.count}]);for(let P=0,E=x.length;P<E;++P){const y=x[P],L=y.start,k=y.count;for(let D=L,W=L+k;D<W;D+=3)v(e.getX(D+0),e.getX(D+1),e.getX(D+2))}const b=new R,_=new R,C=new R,M=new R;function S(P){C.fromBufferAttribute(s,P),M.copy(C);const E=a[P];b.copy(E),b.sub(C.multiplyScalar(C.dot(E))).normalize(),_.crossVectors(M,E);const L=_.dot(l[P])<0?-1:1;o.setXYZW(P,b.x,b.y,b.z,L)}for(let P=0,E=x.length;P<E;++P){const y=x[P],L=y.start,k=y.count;for(let D=L,W=L+k;D<W;D+=3)S(e.getX(D+0)),S(e.getX(D+1)),S(e.getX(D+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new dt(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let d=0,p=i.count;d<p;d++)i.setXYZ(d,0,0,0);const s=new R,r=new R,o=new R,a=new R,l=new R,c=new R,h=new R,u=new R;if(e)for(let d=0,p=e.count;d<p;d+=3){const f=e.getX(d+0),g=e.getX(d+1),m=e.getX(d+2);s.fromBufferAttribute(t,f),r.fromBufferAttribute(t,g),o.fromBufferAttribute(t,m),h.subVectors(o,r),u.subVectors(s,r),h.cross(u),a.fromBufferAttribute(i,f),l.fromBufferAttribute(i,g),c.fromBufferAttribute(i,m),a.add(h),l.add(h),c.add(h),i.setXYZ(f,a.x,a.y,a.z),i.setXYZ(g,l.x,l.y,l.z),i.setXYZ(m,c.x,c.y,c.z)}else for(let d=0,p=t.count;d<p;d+=3)s.fromBufferAttribute(t,d+0),r.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),h.subVectors(o,r),u.subVectors(s,r),h.cross(u),i.setXYZ(d+0,h.x,h.y,h.z),i.setXYZ(d+1,h.x,h.y,h.z),i.setXYZ(d+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Cn.fromBufferAttribute(e,t),Cn.normalize(),e.setXYZ(t,Cn.x,Cn.y,Cn.z)}toNonIndexed(){function e(a,l){const c=a.array,h=a.itemSize,u=a.normalized,d=new c.constructor(l.length*h);let p=0,f=0;for(let g=0,m=l.length;g<m;g++){a.isInterleavedBufferAttribute?p=l[g]*a.data.stride+a.offset:p=l[g]*h;for(let v=0;v<h;v++)d[f++]=c[p++]}return new dt(d,h,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Ye,i=this.index.array,s=this.attributes;for(const a in s){const l=s[a],c=e(l,i);t.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let h=0,u=c.length;h<u;h++){const d=c[h],p=e(d,i);l.push(p)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const s={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let u=0,d=c.length;u<d;u++){const p=c[u];h.push(p.toJSON(e.data))}h.length>0&&(s[l]=h,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone());const s=e.attributes;for(const c in s){const h=s[c];this.setAttribute(c,h.clone(t))}const r=e.morphAttributes;for(const c in r){const h=[],u=r[c];for(let d=0,p=u.length;d<p;d++)h.push(u[d].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,h=o.length;c<h;c++){const u=o[c];this.addGroup(u.start,u.count,u.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const h0=new De,Zr=new Br,Oh=new wn,u0=new R,kh=new R,Uh=new R,Fh=new R,Af=new R,Bh=new R,d0=new R,Vh=new R;class Kt extends ft{constructor(e=new Ye,t=new yi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(e,t){const i=this.geometry,s=i.attributes.position,r=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(s,e);const a=this.morphTargetInfluences;if(r&&a){Bh.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const h=a[l],u=r[l];h!==0&&(Af.fromBufferAttribute(u,e),o?Bh.addScaledVector(Af,h):Bh.addScaledVector(Af.sub(t),h))}t.add(Bh)}return t}raycast(e,t){const i=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Oh.copy(i.boundingSphere),Oh.applyMatrix4(r),Zr.copy(e.ray).recast(e.near),!(Oh.containsPoint(Zr.origin)===!1&&(Zr.intersectSphere(Oh,u0)===null||Zr.origin.distanceToSquared(u0)>(e.far-e.near)**2))&&(h0.copy(r).invert(),Zr.copy(e.ray).applyMatrix4(h0),!(i.boundingBox!==null&&Zr.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Zr)))}_computeIntersections(e,t,i){let s;const r=this.geometry,o=this.material,a=r.index,l=r.attributes.position,c=r.attributes.uv,h=r.attributes.uv1,u=r.attributes.normal,d=r.groups,p=r.drawRange;if(a!==null)if(Array.isArray(o))for(let f=0,g=d.length;f<g;f++){const m=d[f],v=o[m.materialIndex],x=Math.max(m.start,p.start),b=Math.min(a.count,Math.min(m.start+m.count,p.start+p.count));for(let _=x,C=b;_<C;_+=3){const M=a.getX(_),S=a.getX(_+1),P=a.getX(_+2);s=zh(this,v,e,i,c,h,u,M,S,P),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=m.materialIndex,t.push(s))}}else{const f=Math.max(0,p.start),g=Math.min(a.count,p.start+p.count);for(let m=f,v=g;m<v;m+=3){const x=a.getX(m),b=a.getX(m+1),_=a.getX(m+2);s=zh(this,o,e,i,c,h,u,x,b,_),s&&(s.faceIndex=Math.floor(m/3),t.push(s))}}else if(l!==void 0)if(Array.isArray(o))for(let f=0,g=d.length;f<g;f++){const m=d[f],v=o[m.materialIndex],x=Math.max(m.start,p.start),b=Math.min(l.count,Math.min(m.start+m.count,p.start+p.count));for(let _=x,C=b;_<C;_+=3){const M=_,S=_+1,P=_+2;s=zh(this,v,e,i,c,h,u,M,S,P),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=m.materialIndex,t.push(s))}}else{const f=Math.max(0,p.start),g=Math.min(l.count,p.start+p.count);for(let m=f,v=g;m<v;m+=3){const x=m,b=m+1,_=m+2;s=zh(this,o,e,i,c,h,u,x,b,_),s&&(s.faceIndex=Math.floor(m/3),t.push(s))}}}}function WA(n,e,t,i,s,r,o,a){let l;if(e.side===ni?l=i.intersectTriangle(o,r,s,!0,a):l=i.intersectTriangle(s,r,o,e.side===ms,a),l===null)return null;Vh.copy(a),Vh.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(Vh);return c<t.near||c>t.far?null:{distance:c,point:Vh.clone(),object:n}}function zh(n,e,t,i,s,r,o,a,l,c){n.getVertexPosition(a,kh),n.getVertexPosition(l,Uh),n.getVertexPosition(c,Fh);const h=WA(n,e,t,i,kh,Uh,Fh,d0);if(h){const u=new R;ui.getBarycoord(d0,kh,Uh,Fh,u),s&&(h.uv=ui.getInterpolatedAttribute(s,a,l,c,u,new ee)),r&&(h.uv1=ui.getInterpolatedAttribute(r,a,l,c,u,new ee)),o&&(h.normal=ui.getInterpolatedAttribute(o,a,l,c,u,new R),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const d={a,b:l,c,normal:new R,materialIndex:0};ui.getNormal(kh,Uh,Fh,d.normal),h.face=d,h.barycoord=u}return h}class Vr extends Ye{constructor(e=1,t=1,i=1,s=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:s,heightSegments:r,depthSegments:o};const a=this;s=Math.floor(s),r=Math.floor(r),o=Math.floor(o);const l=[],c=[],h=[],u=[];let d=0,p=0;f("z","y","x",-1,-1,i,t,e,o,r,0),f("z","y","x",1,-1,i,t,-e,o,r,1),f("x","z","y",1,1,e,i,t,s,o,2),f("x","z","y",1,-1,e,i,-t,s,o,3),f("x","y","z",1,-1,e,t,i,s,r,4),f("x","y","z",-1,-1,e,t,-i,s,r,5),this.setIndex(l),this.setAttribute("position",new Te(c,3)),this.setAttribute("normal",new Te(h,3)),this.setAttribute("uv",new Te(u,2));function f(g,m,v,x,b,_,C,M,S,P,E){const y=_/S,L=C/P,k=_/2,D=C/2,W=M/2,z=S+1,H=P+1;let ne=0,G=0;const ae=new R;for(let se=0;se<H;se++){const ge=se*L-D;for(let Oe=0;Oe<z;Oe++){const Ze=Oe*y-k;ae[g]=Ze*x,ae[m]=ge*b,ae[v]=W,c.push(ae.x,ae.y,ae.z),ae[g]=0,ae[m]=0,ae[v]=M>0?1:-1,h.push(ae.x,ae.y,ae.z),u.push(Oe/S),u.push(1-se/P),ne+=1}}for(let se=0;se<P;se++)for(let ge=0;ge<S;ge++){const Oe=d+ge+z*se,Ze=d+ge+z*(se+1),J=d+(ge+1)+z*(se+1),ce=d+(ge+1)+z*se;l.push(Oe,Ze,ce),l.push(Ze,J,ce),G+=6}a.addGroup(p,G,E),p+=G,d+=ne}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Vr(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function nl(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const s=n[t][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=s.clone():Array.isArray(s)?e[t][i]=s.slice():e[t][i]=s}}return e}function Kn(n){const e={};for(let t=0;t<n.length;t++){const i=nl(n[t]);for(const s in i)e[s]=i[s]}return e}function $A(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function zw(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:ht.workingColorSpace}const Hv={clone:nl,merge:Kn};var jA=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,XA=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class zi extends En{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=jA,this.fragmentShader=XA,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=nl(e.uniforms),this.uniformsGroups=$A(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?t.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[s]={type:"m4",value:o.toArray()}:t.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class lp extends ft{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new De,this.projectionMatrix=new De,this.projectionMatrixInverse=new De,this.coordinateSystem=Ji}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const lr=new R,p0=new ee,f0=new ee;class _n extends lp{constructor(e=50,t=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=tl*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Ro*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return tl*2*Math.atan(Math.tan(Ro*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){lr.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(lr.x,lr.y).multiplyScalar(-e/lr.z),lr.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(lr.x,lr.y).multiplyScalar(-e/lr.z)}getViewSize(e,t){return this.getViewBounds(e,p0,f0),t.subVectors(f0,p0)}setViewOffset(e,t,i,s,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Ro*.5*this.fov)/this.zoom,i=2*t,s=this.aspect*i,r=-.5*s;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*s/l,t-=o.offsetY*i/c,s*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const fa=-90,ma=1;class Hw extends ft{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new _n(fa,ma,e,t);s.layers=this.layers,this.add(s);const r=new _n(fa,ma,e,t);r.layers=this.layers,this.add(r);const o=new _n(fa,ma,e,t);o.layers=this.layers,this.add(o);const a=new _n(fa,ma,e,t);a.layers=this.layers,this.add(a);const l=new _n(fa,ma,e,t);l.layers=this.layers,this.add(l);const c=new _n(fa,ma,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,s,r,o,a,l]=t;for(const c of t)this.remove(c);if(e===Ji)i.up.set(0,1,0),i.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===wc)i.up.set(0,-1,0),i.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,o,a,l,c,h]=this.children,u=e.getRenderTarget(),d=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const g=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,s),e.render(t,r),e.setRenderTarget(i,1,s),e.render(t,o),e.setRenderTarget(i,2,s),e.render(t,a),e.setRenderTarget(i,3,s),e.render(t,l),e.setRenderTarget(i,4,s),e.render(t,c),i.texture.generateMipmaps=g,e.setRenderTarget(i,5,s),e.render(t,h),e.setRenderTarget(u,d,p),e.xr.enabled=f,i.texture.needsPMREMUpdate=!0}}class Yc extends Wt{constructor(e=[],t=Ys,i,s,r,o,a,l,c,h){super(e,t,i,s,r,o,a,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Gw extends gs{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},s=[i,i,i,i,i,i];this.texture=new Yc(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:sn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new Vr(5,5,5),r=new zi({name:"CubemapFromEquirect",uniforms:nl(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:ni,blending:js});r.uniforms.tEquirect.value=t;const o=new Kt(s,r),a=t.minFilter;return t.minFilter===ki&&(t.minFilter=sn),new Hw(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t=!0,i=!0,s=!0){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,s);e.setRenderTarget(r)}}class wi extends ft{constructor(){super(),this.isGroup=!0,this.type="Group"}}const qA={type:"move"};class Du{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new wi,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new wi,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new R,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new R),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new wi,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new R,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new R),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let s=null,r=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const g of e.hand.values()){const m=t.getJointPose(g,i),v=this._getHandJoint(c,g);m!==null&&(v.matrix.fromArray(m.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,v.jointRadius=m.radius),v.visible=m!==null}const h=c.joints["index-finger-tip"],u=c.joints["thumb-tip"],d=h.position.distanceTo(u.position),p=.02,f=.005;c.inputState.pinching&&d>p+f?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=p-f&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(s=t.getPose(e.targetRaySpace,i),s===null&&r!==null&&(s=r),s!==null&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(qA)))}return a!==null&&(a.visible=s!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new wi;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class cp{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new ve(e),this.density=t}clone(){return new cp(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class hp{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new ve(e),this.near=t,this.far=i}clone(){return new hp(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}let Gv=class extends ft{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new es,this.environmentIntensity=1,this.environmentRotation=new es,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}};class Zc{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=yc,this.updateRanges=[],this.version=0,this.uuid=Ei()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let s=0,r=this.stride;s<r;s++)this.array[e+s]=t.array[i+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ei()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ei()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const qn=new R;class Lr{constructor(e,t,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)qn.fromBufferAttribute(this,t),qn.applyMatrix4(e),this.setXYZ(t,qn.x,qn.y,qn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)qn.fromBufferAttribute(this,t),qn.applyNormalMatrix(e),this.setXYZ(t,qn.x,qn.y,qn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)qn.fromBufferAttribute(this,t),qn.transformDirection(e),this.setXYZ(t,qn.x,qn.y,qn.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=Zn(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=et(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=et(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=et(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=et(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=et(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Zn(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Zn(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Zn(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Zn(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=et(t,this.array),i=et(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=et(t,this.array),i=et(i,this.array),s=et(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=et(t,this.array),i=et(i,this.array),s=et(s,this.array),r=et(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return new dt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Lr(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Wv extends En{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ve(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let va;const Nl=new R,ga=new R,_a=new R,ba=new ee,Ol=new ee,Ww=new De,Hh=new R,kl=new R,Gh=new R,m0=new ee,Tf=new ee,v0=new ee;class $w extends ft{constructor(e=new Wv){if(super(),this.isSprite=!0,this.type="Sprite",va===void 0){va=new Ye;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Zc(t,5);va.setIndex([0,1,2,0,2,3]),va.setAttribute("position",new Lr(i,3,0,!1)),va.setAttribute("uv",new Lr(i,2,3,!1))}this.geometry=va,this.material=e,this.center=new ee(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ga.setFromMatrixScale(this.matrixWorld),Ww.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),_a.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&ga.multiplyScalar(-_a.z);const i=this.material.rotation;let s,r;i!==0&&(r=Math.cos(i),s=Math.sin(i));const o=this.center;Wh(Hh.set(-.5,-.5,0),_a,o,ga,s,r),Wh(kl.set(.5,-.5,0),_a,o,ga,s,r),Wh(Gh.set(.5,.5,0),_a,o,ga,s,r),m0.set(0,0),Tf.set(1,0),v0.set(1,1);let a=e.ray.intersectTriangle(Hh,kl,Gh,!1,Nl);if(a===null&&(Wh(kl.set(-.5,.5,0),_a,o,ga,s,r),Tf.set(0,1),a=e.ray.intersectTriangle(Hh,Gh,kl,!1,Nl),a===null))return;const l=e.ray.origin.distanceTo(Nl);l<e.near||l>e.far||t.push({distance:l,point:Nl.clone(),uv:ui.getInterpolation(Nl,Hh,kl,Gh,m0,Tf,v0,new ee),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Wh(n,e,t,i,s,r){ba.subVectors(n,t).addScalar(.5).multiply(i),s!==void 0?(Ol.x=r*ba.x-s*ba.y,Ol.y=s*ba.x+r*ba.y):Ol.copy(ba),n.copy(e),n.x+=Ol.x,n.y+=Ol.y,n.applyMatrix4(Ww)}const $h=new R,g0=new R;class jw extends ft{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,s=t.length;i<s;i++){const r=t[i];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const s=this.levels;let r;for(r=0;r<s.length&&!(t<s[r].distance);r++);return s.splice(r,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let i=0;i<t.length;i++)if(t[i].distance===e){const s=t.splice(i,1);return this.remove(s[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,s;for(i=1,s=t.length;i<s;i++){let r=t[i].distance;if(t[i].object.visible&&(r-=r*t[i].hysteresis),e<r)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){$h.setFromMatrixPosition(this.matrixWorld);const s=e.ray.origin.distanceTo($h);this.getObjectForDistance(s).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){$h.setFromMatrixPosition(e.matrixWorld),g0.setFromMatrixPosition(this.matrixWorld);const i=$h.distanceTo(g0)/e.zoom;t[0].object.visible=!0;let s,r;for(s=1,r=t.length;s<r;s++){let o=t[s].distance;if(t[s].object.visible&&(o-=o*t[s].hysteresis),i>=o)t[s-1].object.visible=!1,t[s].object.visible=!0;else break}for(this._currentLevel=s-1;s<r;s++)t[s].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let s=0,r=i.length;s<r;s++){const o=i[s];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}}const _0=new R,b0=new ct,x0=new ct,KA=new R,y0=new De,jh=new R,Pf=new wn,w0=new De,Rf=new Br;class $v extends Kt{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Hm,this.bindMatrix=new De,this.bindMatrixInverse=new De,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new yn),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,jh),this.boundingBox.expandByPoint(jh)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new wn),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,jh),this.boundingSphere.expandByPoint(jh)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,s=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Pf.copy(this.boundingSphere),Pf.applyMatrix4(s),e.ray.intersectsSphere(Pf)!==!1&&(w0.copy(s).invert(),Rf.copy(e.ray).applyMatrix4(w0),!(this.boundingBox!==null&&Rf.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,Rf)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new ct,t=this.geometry.attributes.skinWeight;for(let i=0,s=t.count;i<s;i++){e.fromBufferAttribute(t,i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===Hm?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===xw?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,s=this.geometry;b0.fromBufferAttribute(s.attributes.skinIndex,e),x0.fromBufferAttribute(s.attributes.skinWeight,e),_0.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=x0.getComponent(r);if(o!==0){const a=b0.getComponent(r);y0.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(KA.copy(_0).applyMatrix4(y0),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class up extends ft{constructor(){super(),this.isBone=!0,this.type="Bone"}}class ds extends Wt{constructor(e=null,t=1,i=1,s,r,o,a,l,c=xn,h=xn,u,d){super(null,o,a,l,c,h,s,r,u,d),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const E0=new De,YA=new De;class Jc{constructor(e=[],t=[]){this.uuid=Ei(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new De)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new De;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:YA;E0.multiplyMatrices(a,t[r]),E0.toArray(i,r*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new Jc(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new ds(t,e,e,ei,di);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,s=e.bones.length;i<s;i++){const r=e.bones[i];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new up),this.bones.push(o),this.boneInverses.push(new De().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let s=0,r=t.length;s<r;s++){const o=t[s];e.bones.push(o.uuid);const a=i[s];e.boneInverses.push(a.toArray())}return e}}class No extends dt{constructor(e,t,i,s=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const xa=new De,M0=new De,Xh=[],S0=new yn,ZA=new De,Ul=new Kt,Fl=new wn;class jv extends Kt{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new No(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<i;s++)this.setMatrixAt(s,ZA)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new yn),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,xa),S0.copy(e.boundingBox).applyMatrix4(xa),this.boundingBox.union(S0)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new wn),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,xa),Fl.copy(e.boundingSphere).applyMatrix4(xa),this.boundingSphere.union(Fl)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,s=this.morphTexture.source.data.data,r=i.length+1,o=e*r+1;for(let a=0;a<i.length;a++)i[a]=s[o+a]}raycast(e,t){const i=this.matrixWorld,s=this.count;if(Ul.geometry=this.geometry,Ul.material=this.material,Ul.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Fl.copy(this.boundingSphere),Fl.applyMatrix4(i),e.ray.intersectsSphere(Fl)!==!1))for(let r=0;r<s;r++){this.getMatrixAt(r,xa),M0.multiplyMatrices(i,xa),Ul.matrixWorld=M0,Ul.raycast(e,Xh);for(let o=0,a=Xh.length;o<a;o++){const l=Xh[o];l.instanceId=r,l.object=this,t.push(l)}Xh.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new No(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,s=i.length+1;this.morphTexture===null&&(this.morphTexture=new ds(new Float32Array(s*this.count),s,this.count,ep,di));const r=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=s*e;r[l]=a,r.set(i,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const Lf=new R,JA=new R,QA=new Je;class Us{constructor(e=new R(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,s){return this.normal.set(e,t,i),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const s=Lf.subVectors(i,t).cross(JA.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(Lf),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||QA.getNormalMatrix(e),s=this.coplanarPoint(Lf).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Jr=new wn,qh=new R;class Qc{constructor(e=new Us,t=new Us,i=new Us,s=new Us,r=new Us,o=new Us){this.planes=[e,t,i,s,r,o]}set(e,t,i,s,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(s),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Ji){const i=this.planes,s=e.elements,r=s[0],o=s[1],a=s[2],l=s[3],c=s[4],h=s[5],u=s[6],d=s[7],p=s[8],f=s[9],g=s[10],m=s[11],v=s[12],x=s[13],b=s[14],_=s[15];if(i[0].setComponents(l-r,d-c,m-p,_-v).normalize(),i[1].setComponents(l+r,d+c,m+p,_+v).normalize(),i[2].setComponents(l+o,d+h,m+f,_+x).normalize(),i[3].setComponents(l-o,d-h,m-f,_-x).normalize(),i[4].setComponents(l-a,d-u,m-g,_-b).normalize(),t===Ji)i[5].setComponents(l+a,d+u,m+g,_+b).normalize();else if(t===wc)i[5].setComponents(a,u,g,b).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Jr.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Jr.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Jr)}intersectsSprite(e){return Jr.center.set(0,0,0),Jr.radius=.7071067811865476,Jr.applyMatrix4(e.matrixWorld),this.intersectsSphere(Jr)}intersectsSphere(e){const t=this.planes,i=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const s=t[i];if(qh.x=s.normal.x>0?e.max.x:e.min.x,qh.y=s.normal.y>0?e.max.y:e.min.y,qh.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(qh)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function If(n,e){return n-e}function eT(n,e){return n.z-e.z}function tT(n,e){return e.z-n.z}class nT{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,i,s){const r=this.pool,o=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1,index:-1});const a=r[this.index];o.push(a),this.index++,a.start=e,a.count=t,a.z=i,a.index=s}reset(){this.list.length=0,this.index=0}}const li=new De,iT=new ve(1,1,1),Df=new Qc,Kh=new yn,Qr=new wn,Bl=new R,C0=new R,sT=new R,Nf=new nT,Bn=new Kt,Yh=[];function rT(n,e,t=0){const i=e.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==e.array.constructor){const s=n.count;for(let r=0;r<s;r++)for(let o=0;o<i;o++)e.setComponent(r+t,o,n.getComponent(r,o))}else e.array.set(n.array,t*i);e.needsUpdate=!0}function eo(n,e){if(n.constructor!==e.constructor){const t=Math.min(n.length,e.length);for(let i=0;i<t;i++)e[i]=n[i]}else{const t=Math.min(n.length,e.length);e.set(new n.constructor(n.buffer,0,t))}}class Xw extends Kt{constructor(e,t,i=t*2,s){super(new Ye,s),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=i,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),i=new ds(t,e,e,ei,di);this._matricesTexture=i}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),i=new ds(t,e,e,qc,Zs);this._indirectTexture=i}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),i=new ds(t,e,e,ei,di);i.colorSpace=ht.workingColorSpace,this._colorsTexture=i}_initializeGeometry(e){const t=this.geometry,i=this._maxVertexCount,s=this._maxIndexCount;if(this._geometryInitialized===!1){for(const r in e.attributes){const o=e.getAttribute(r),{array:a,itemSize:l,normalized:c}=o,h=new a.constructor(i*l),u=new dt(h,l,c);t.setAttribute(r,u)}if(e.getIndex()!==null){const r=i>65535?new Uint32Array(s):new Uint16Array(s);t.setIndex(new dt(r,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const i in t.attributes){if(!e.hasAttribute(i))throw new Error(`THREE.BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);const s=e.getAttribute(i),r=t.getAttribute(i);if(s.itemSize!==r.itemSize||s.normalized!==r.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new yn);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let i=0,s=t.length;i<s;i++){if(t[i].active===!1)continue;const r=t[i].geometryIndex;this.getMatrixAt(i,li),this.getBoundingBoxAt(r,Kh).applyMatrix4(li),e.union(Kh)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new wn);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let i=0,s=t.length;i<s;i++){if(t[i].active===!1)continue;const r=t[i].geometryIndex;this.getMatrixAt(i,li),this.getBoundingSphereAt(r,Qr).applyMatrix4(li),e.union(Qr)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const i={visible:!0,active:!0,geometryIndex:e};let s=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(If),s=this._availableInstanceIds.shift(),this._instanceInfo[s]=i):(s=this._instanceInfo.length,this._instanceInfo.push(i));const r=this._matricesTexture;li.identity().toArray(r.image.data,s*16),r.needsUpdate=!0;const o=this._colorsTexture;return o&&(iT.toArray(o.image.data,s*4),o.needsUpdate=!0),this._visibilityChanged=!0,s}addGeometry(e,t=-1,i=-1){this._initializeGeometry(e),this._validateGeometry(e);const s={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},r=this._geometryInfo;s.vertexStart=this._nextVertexStart,s.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const o=e.getIndex();if(o!==null&&(s.indexStart=this._nextIndexStart,s.reservedIndexCount=i===-1?o.count:i),s.indexStart!==-1&&s.indexStart+s.reservedIndexCount>this._maxIndexCount||s.vertexStart+s.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(If),l=this._availableGeometryIds.shift(),r[l]=s):(l=this._geometryCount,this._geometryCount++,r.push(s)),this.setGeometryAt(l,e),this._nextIndexStart=s.indexStart+s.reservedIndexCount,this._nextVertexStart=s.vertexStart+s.reservedVertexCount,l}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const i=this.geometry,s=i.getIndex()!==null,r=i.getIndex(),o=t.getIndex(),a=this._geometryInfo[e];if(s&&o.count>a.reservedIndexCount||t.attributes.position.count>a.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const l=a.vertexStart,c=a.reservedVertexCount;a.vertexCount=t.getAttribute("position").count;for(const h in i.attributes){const u=t.getAttribute(h),d=i.getAttribute(h);rT(u,d,l);const p=u.itemSize;for(let f=u.count,g=c;f<g;f++){const m=l+f;for(let v=0;v<p;v++)d.setComponent(m,v,0)}d.needsUpdate=!0,d.addUpdateRange(l*p,c*p)}if(s){const h=a.indexStart,u=a.reservedIndexCount;a.indexCount=t.getIndex().count;for(let d=0;d<o.count;d++)r.setX(h+d,l+o.getX(d));for(let d=o.count,p=u;d<p;d++)r.setX(h+d,l);r.needsUpdate=!0,r.addUpdateRange(h,a.reservedIndexCount)}return a.start=s?a.indexStart:a.vertexStart,a.count=s?a.indexCount:a.vertexCount,a.boundingBox=null,t.boundingBox!==null&&(a.boundingBox=t.boundingBox.clone()),a.boundingSphere=null,t.boundingSphere!==null&&(a.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const i=this._instanceInfo;for(let s=0,r=i.length;s<r;s++)i[s].active&&i[s].geometryIndex===e&&this.deleteInstance(s);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const i=this._geometryInfo,s=i.map((o,a)=>a).sort((o,a)=>i[o].vertexStart-i[a].vertexStart),r=this.geometry;for(let o=0,a=i.length;o<a;o++){const l=s[o],c=i[l];if(c.active!==!1){if(r.index!==null){if(c.indexStart!==t){const{indexStart:h,vertexStart:u,reservedIndexCount:d}=c,p=r.index,f=p.array,g=e-u;for(let m=h;m<h+d;m++)f[m]=f[m]+g;p.array.copyWithin(t,h,h+d),p.addUpdateRange(t,d),c.indexStart=t}t+=c.reservedIndexCount}if(c.vertexStart!==e){const{vertexStart:h,reservedVertexCount:u}=c,d=r.attributes;for(const p in d){const f=d[p],{array:g,itemSize:m}=f;g.copyWithin(e*m,h*m,(h+u)*m),f.addUpdateRange(e*m,u*m)}c.vertexStart=e}e+=c.reservedVertexCount,c.start=r.index?c.indexStart:c.vertexStart,this._nextIndexStart=r.index?c.indexStart+c.reservedIndexCount:0,this._nextVertexStart=c.vertexStart+c.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const i=this.geometry,s=this._geometryInfo[e];if(s.boundingBox===null){const r=new yn,o=i.index,a=i.attributes.position;for(let l=s.start,c=s.start+s.count;l<c;l++){let h=l;o&&(h=o.getX(h)),r.expandByPoint(Bl.fromBufferAttribute(a,h))}s.boundingBox=r}return t.copy(s.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const i=this.geometry,s=this._geometryInfo[e];if(s.boundingSphere===null){const r=new wn;this.getBoundingBoxAt(e,Kh),Kh.getCenter(r.center);const o=i.index,a=i.attributes.position;let l=0;for(let c=s.start,h=s.start+s.count;c<h;c++){let u=c;o&&(u=o.getX(u)),Bl.fromBufferAttribute(a,u),l=Math.max(l,r.center.distanceToSquared(Bl))}r.radius=Math.sqrt(l),s.boundingSphere=r}return t.copy(s.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const i=this._matricesTexture,s=this._matricesTexture.image.data;return t.toArray(s,e*16),i.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,t){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t?this:(this._instanceInfo[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const i=this._geometryInfo[e];return t.vertexStart=i.vertexStart,t.vertexCount=i.vertexCount,t.reservedVertexCount=i.reservedVertexCount,t.indexStart=i.indexStart,t.indexCount=i.indexCount,t.reservedIndexCount=i.reservedIndexCount,t.start=i.start,t.count=i.count,t}setInstanceCount(e){const t=this._availableInstanceIds,i=this._instanceInfo;for(t.sort(If);t[t.length-1]===i.length;)i.pop(),t.pop();if(e<i.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const s=new Int32Array(e),r=new Int32Array(e);eo(this._multiDrawCounts,s),eo(this._multiDrawStarts,r),this._multiDrawCounts=s,this._multiDrawStarts=r,this._maxInstanceCount=e;const o=this._indirectTexture,a=this._matricesTexture,l=this._colorsTexture;o.dispose(),this._initIndirectTexture(),eo(o.image.data,this._indirectTexture.image.data),a.dispose(),this._initMatricesTexture(),eo(a.image.data,this._matricesTexture.image.data),l&&(l.dispose(),this._initColorsTexture(),eo(l.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const i=[...this._geometryInfo].filter(a=>a.active);if(Math.max(...i.map(a=>a.vertexStart+a.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...i.map(l=>l.indexStart+l.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const r=this.geometry;r.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Ye,this._initializeGeometry(r));const o=this.geometry;r.index&&eo(r.index.array,o.index.array);for(const a in r.attributes)eo(r.attributes[a].array,o.attributes[a].array)}raycast(e,t){const i=this._instanceInfo,s=this._geometryInfo,r=this.matrixWorld,o=this.geometry;Bn.material=this.material,Bn.geometry.index=o.index,Bn.geometry.attributes=o.attributes,Bn.geometry.boundingBox===null&&(Bn.geometry.boundingBox=new yn),Bn.geometry.boundingSphere===null&&(Bn.geometry.boundingSphere=new wn);for(let a=0,l=i.length;a<l;a++){if(!i[a].visible||!i[a].active)continue;const c=i[a].geometryIndex,h=s[c];Bn.geometry.setDrawRange(h.start,h.count),this.getMatrixAt(a,Bn.matrixWorld).premultiply(r),this.getBoundingBoxAt(c,Bn.geometry.boundingBox),this.getBoundingSphereAt(c,Bn.geometry.boundingSphere),Bn.raycast(e,Yh);for(let u=0,d=Yh.length;u<d;u++){const p=Yh[u];p.object=this,p.batchId=a,t.push(p)}Yh.length=0}Bn.material=null,Bn.geometry.index=null,Bn.geometry.attributes={},Bn.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,i,s,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=s.getIndex(),a=o===null?1:o.array.BYTES_PER_ELEMENT,l=this._instanceInfo,c=this._multiDrawStarts,h=this._multiDrawCounts,u=this._geometryInfo,d=this.perObjectFrustumCulled,p=this._indirectTexture,f=p.image.data;d&&(li.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),Df.setFromProjectionMatrix(li,e.coordinateSystem));let g=0;if(this.sortObjects){li.copy(this.matrixWorld).invert(),Bl.setFromMatrixPosition(i.matrixWorld).applyMatrix4(li),C0.set(0,0,-1).transformDirection(i.matrixWorld).transformDirection(li);for(let x=0,b=l.length;x<b;x++)if(l[x].visible&&l[x].active){const _=l[x].geometryIndex;this.getMatrixAt(x,li),this.getBoundingSphereAt(_,Qr).applyMatrix4(li);let C=!1;if(d&&(C=!Df.intersectsSphere(Qr)),!C){const M=u[_],S=sT.subVectors(Qr.center,Bl).dot(C0);Nf.push(M.start,M.count,S,x)}}const m=Nf.list,v=this.customSort;v===null?m.sort(r.transparent?tT:eT):v.call(this,m,i);for(let x=0,b=m.length;x<b;x++){const _=m[x];c[g]=_.start*a,h[g]=_.count,f[g]=_.index,g++}Nf.reset()}else for(let m=0,v=l.length;m<v;m++)if(l[m].visible&&l[m].active){const x=l[m].geometryIndex;let b=!1;if(d&&(this.getMatrixAt(m,li),this.getBoundingSphereAt(x,Qr).applyMatrix4(li),b=!Df.intersectsSphere(Qr)),!b){const _=u[x];c[g]=_.start*a,h[g]=_.count,f[g]=m,g++}}p.needsUpdate=!0,this._multiDrawCount=g,this._visibilityChanged=!1}onBeforeShadow(e,t,i,s,r,o){this.onBeforeRender(e,null,s,r,o)}}class $n extends En{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ve(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Td=new R,Pd=new R,A0=new De,Vl=new Br,Zh=new wn,Of=new R,T0=new R;class Js extends ft{constructor(e=new Ye,t=new $n){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let s=1,r=t.count;s<r;s++)Td.fromBufferAttribute(t,s-1),Pd.fromBufferAttribute(t,s),i[s]=i[s-1],i[s]+=Td.distanceTo(Pd);e.setAttribute("lineDistance",new Te(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Zh.copy(i.boundingSphere),Zh.applyMatrix4(s),Zh.radius+=r,e.ray.intersectsSphere(Zh)===!1)return;A0.copy(s).invert(),Vl.copy(e.ray).applyMatrix4(A0);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=this.isLineSegments?2:1,h=i.index,d=i.attributes.position;if(h!==null){const p=Math.max(0,o.start),f=Math.min(h.count,o.start+o.count);for(let g=p,m=f-1;g<m;g+=c){const v=h.getX(g),x=h.getX(g+1),b=Jh(this,e,Vl,l,v,x,g);b&&t.push(b)}if(this.isLineLoop){const g=h.getX(f-1),m=h.getX(p),v=Jh(this,e,Vl,l,g,m,f-1);v&&t.push(v)}}else{const p=Math.max(0,o.start),f=Math.min(d.count,o.start+o.count);for(let g=p,m=f-1;g<m;g+=c){const v=Jh(this,e,Vl,l,g,g+1,g);v&&t.push(v)}if(this.isLineLoop){const g=Jh(this,e,Vl,l,f-1,p,f-1);g&&t.push(g)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function Jh(n,e,t,i,s,r,o){const a=n.geometry.attributes.position;if(Td.fromBufferAttribute(a,s),Pd.fromBufferAttribute(a,r),t.distanceSqToSegment(Td,Pd,Of,T0)>i)return;Of.applyMatrix4(n.matrixWorld);const c=e.ray.origin.distanceTo(Of);if(!(c<e.near||c>e.far))return{distance:c,point:T0.clone().applyMatrix4(n.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:n}}const P0=new R,R0=new R;class ns extends Js{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let s=0,r=t.count;s<r;s+=2)P0.fromBufferAttribute(t,s),R0.fromBufferAttribute(t,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+P0.distanceTo(R0);e.setAttribute("lineDistance",new Te(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Xv extends Js{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class dp extends En{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ve(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const L0=new De,$m=new Br,Qh=new wn,eu=new R;class pp extends ft{constructor(e=new Ye,t=new dp){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Qh.copy(i.boundingSphere),Qh.applyMatrix4(s),Qh.radius+=r,e.ray.intersectsSphere(Qh)===!1)return;L0.copy(s).invert(),$m.copy(e.ray).applyMatrix4(L0);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,u=i.attributes.position;if(c!==null){const d=Math.max(0,o.start),p=Math.min(c.count,o.start+o.count);for(let f=d,g=p;f<g;f++){const m=c.getX(f);eu.fromBufferAttribute(u,m),I0(eu,m,l,s,e,t,this)}}else{const d=Math.max(0,o.start),p=Math.min(u.count,o.start+o.count);for(let f=d,g=p;f<g;f++)eu.fromBufferAttribute(u,f),I0(eu,f,l,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function I0(n,e,t,i,s,r,o){const a=$m.distanceSqToPoint(n);if(a<t){const l=new R;$m.closestPointToPoint(n,l),l.applyMatrix4(i);const c=s.ray.origin.distanceTo(l);if(c<s.near||c>s.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class qw extends Wt{constructor(e,t,i,s,r=sn,o=sn,a,l,c){super(e,t,i,s,r,o,a,l,c),this.isVideoTexture=!0,this.generateMipmaps=!1;const h=this;function u(){h.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class oT extends qw{constructor(e,t,i,s,r,o,a,l){super({},e,t,i,s,r,o,a,l),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class aT extends Wt{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=xn,this.minFilter=xn,this.generateMipmaps=!1,this.needsUpdate=!0}}class fp extends Wt{constructor(e,t,i,s,r,o,a,l,c,h,u,d){super(null,o,a,l,c,h,s,r,u,d),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class lT extends fp{constructor(e,t,i,s,r,o){super(e,t,i,r,o),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=xi,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class cT extends fp{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,Ys),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class hT extends Wt{constructor(e,t,i,s,r,o,a,l,c){super(e,t,i,s,r,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class qv extends Wt{constructor(e,t,i=Zs,s,r,o,a=xn,l=xn,c,h=Za){if(h!==Za&&h!==Ja)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,s,r,o,a,l,h,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Er(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class is{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,s=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),r+=i.distanceTo(s),t.push(r),s=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const i=this.getLengths();let s=0;const r=i.length;let o;t?o=t:o=e*i[r-1];let a=0,l=r-1,c;for(;a<=l;)if(s=Math.floor(a+(l-a)/2),c=i[s]-o,c<0)a=s+1;else if(c>0)l=s-1;else{l=s;break}if(s=l,i[s]===o)return s/(r-1);const h=i[s],d=i[s+1]-h,p=(o-h)/d;return(s+p)/(r-1)}getTangent(e,t){let s=e-1e-4,r=e+1e-4;s<0&&(s=0),r>1&&(r=1);const o=this.getPoint(s),a=this.getPoint(r),l=t||(o.isVector2?new ee:new R);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t=!1){const i=new R,s=[],r=[],o=[],a=new R,l=new De;for(let p=0;p<=e;p++){const f=p/e;s[p]=this.getTangentAt(f,new R)}r[0]=new R,o[0]=new R;let c=Number.MAX_VALUE;const h=Math.abs(s[0].x),u=Math.abs(s[0].y),d=Math.abs(s[0].z);h<=c&&(c=h,i.set(1,0,0)),u<=c&&(c=u,i.set(0,1,0)),d<=c&&i.set(0,0,1),a.crossVectors(s[0],i).normalize(),r[0].crossVectors(s[0],a),o[0].crossVectors(s[0],r[0]);for(let p=1;p<=e;p++){if(r[p]=r[p-1].clone(),o[p]=o[p-1].clone(),a.crossVectors(s[p-1],s[p]),a.length()>Number.EPSILON){a.normalize();const f=Math.acos(Ke(s[p-1].dot(s[p]),-1,1));r[p].applyMatrix4(l.makeRotationAxis(a,f))}o[p].crossVectors(s[p],r[p])}if(t===!0){let p=Math.acos(Ke(r[0].dot(r[e]),-1,1));p/=e,s[0].dot(a.crossVectors(r[0],r[e]))>0&&(p=-p);for(let f=1;f<=e;f++)r[f].applyMatrix4(l.makeRotationAxis(s[f],p*f)),o[f].crossVectors(s[f],r[f])}return{tangents:s,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class mp extends is{constructor(e=0,t=0,i=1,s=1,r=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=s,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t=new ee){const i=t,s=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=s;for(;r>s;)r-=s;r<Number.EPSILON&&(o?r=0:r=s),this.aClockwise===!0&&!o&&(r===s?r=-s:r=r-s);const a=this.aStartAngle+e*r;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const h=Math.cos(this.aRotation),u=Math.sin(this.aRotation),d=l-this.aX,p=c-this.aY;l=d*h-p*u+this.aX,c=d*u+p*h+this.aY}return i.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Kw extends mp{constructor(e,t,i,s,r,o){super(e,t,i,i,s,r,o),this.isArcCurve=!0,this.type="ArcCurve"}}function Kv(){let n=0,e=0,t=0,i=0;function s(r,o,a,l){n=r,e=a,t=-3*r+3*o-2*a-l,i=2*r-2*o+a+l}return{initCatmullRom:function(r,o,a,l,c){s(o,a,c*(a-r),c*(l-o))},initNonuniformCatmullRom:function(r,o,a,l,c,h,u){let d=(o-r)/c-(a-r)/(c+h)+(a-o)/h,p=(a-o)/h-(l-o)/(h+u)+(l-a)/u;d*=h,p*=h,s(o,a,d,p)},calc:function(r){const o=r*r,a=o*r;return n+e*r+t*o+i*a}}}const tu=new R,kf=new Kv,Uf=new Kv,Ff=new Kv;class Yw extends is{constructor(e=[],t=!1,i="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=s}getPoint(e,t=new R){const i=t,s=this.points,r=s.length,o=(r-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:l===0&&a===r-1&&(a=r-2,l=1);let c,h;this.closed||a>0?c=s[(a-1)%r]:(tu.subVectors(s[0],s[1]).add(s[0]),c=tu);const u=s[a%r],d=s[(a+1)%r];if(this.closed||a+2<r?h=s[(a+2)%r]:(tu.subVectors(s[r-1],s[r-2]).add(s[r-1]),h=tu),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let f=Math.pow(c.distanceToSquared(u),p),g=Math.pow(u.distanceToSquared(d),p),m=Math.pow(d.distanceToSquared(h),p);g<1e-4&&(g=1),f<1e-4&&(f=g),m<1e-4&&(m=g),kf.initNonuniformCatmullRom(c.x,u.x,d.x,h.x,f,g,m),Uf.initNonuniformCatmullRom(c.y,u.y,d.y,h.y,f,g,m),Ff.initNonuniformCatmullRom(c.z,u.z,d.z,h.z,f,g,m)}else this.curveType==="catmullrom"&&(kf.initCatmullRom(c.x,u.x,d.x,h.x,this.tension),Uf.initCatmullRom(c.y,u.y,d.y,h.y,this.tension),Ff.initCatmullRom(c.z,u.z,d.z,h.z,this.tension));return i.set(kf.calc(l),Uf.calc(l),Ff.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(new R().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function D0(n,e,t,i,s){const r=(i-e)*.5,o=(s-t)*.5,a=n*n,l=n*a;return(2*t-2*i+r+o)*l+(-3*t+3*i-2*r-o)*a+r*n+t}function uT(n,e){const t=1-n;return t*t*e}function dT(n,e){return 2*(1-n)*n*e}function pT(n,e){return n*n*e}function dc(n,e,t,i){return uT(n,e)+dT(n,t)+pT(n,i)}function fT(n,e){const t=1-n;return t*t*t*e}function mT(n,e){const t=1-n;return 3*t*t*n*e}function vT(n,e){return 3*(1-n)*n*n*e}function gT(n,e){return n*n*n*e}function pc(n,e,t,i,s){return fT(n,e)+mT(n,t)+vT(n,i)+gT(n,s)}class Yv extends is{constructor(e=new ee,t=new ee,i=new ee,s=new ee){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=s}getPoint(e,t=new ee){const i=t,s=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(pc(e,s.x,r.x,o.x,a.x),pc(e,s.y,r.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Zw extends is{constructor(e=new R,t=new R,i=new R,s=new R){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=s}getPoint(e,t=new R){const i=t,s=this.v0,r=this.v1,o=this.v2,a=this.v3;return i.set(pc(e,s.x,r.x,o.x,a.x),pc(e,s.y,r.y,o.y,a.y),pc(e,s.z,r.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Zv extends is{constructor(e=new ee,t=new ee){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ee){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ee){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Jw extends is{constructor(e=new R,t=new R){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new R){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new R){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Jv extends is{constructor(e=new ee,t=new ee,i=new ee){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ee){const i=t,s=this.v0,r=this.v1,o=this.v2;return i.set(dc(e,s.x,r.x,o.x),dc(e,s.y,r.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Qv extends is{constructor(e=new R,t=new R,i=new R){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new R){const i=t,s=this.v0,r=this.v1,o=this.v2;return i.set(dc(e,s.x,r.x,o.x),dc(e,s.y,r.y,o.y),dc(e,s.z,r.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class eg extends is{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ee){const i=t,s=this.points,r=(s.length-1)*e,o=Math.floor(r),a=r-o,l=s[o===0?o:o-1],c=s[o],h=s[o>s.length-2?s.length-1:o+1],u=s[o>s.length-3?s.length-1:o+2];return i.set(D0(a,l.x,c.x,h.x,u.x),D0(a,l.y,c.y,h.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(new ee().fromArray(s))}return this}}var Rd=Object.freeze({__proto__:null,ArcCurve:Kw,CatmullRomCurve3:Yw,CubicBezierCurve:Yv,CubicBezierCurve3:Zw,EllipseCurve:mp,LineCurve:Zv,LineCurve3:Jw,QuadraticBezierCurve:Jv,QuadraticBezierCurve3:Qv,SplineCurve:eg});class Qw extends is{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const i=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Rd[i](t,e))}return this}getPoint(e,t){const i=e*this.getLength(),s=this.getCurveLengths();let r=0;for(;r<s.length;){if(s[r]>=i){const o=s[r]-i,a=this.curves[r],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,s=this.curves.length;i<s;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let s=0,r=this.curves;s<r.length;s++){const o=r[s],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const h=l[c];i&&i.equals(h)||(t.push(h),i=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const s=e.curves[t];this.curves.push(new Rd[s.type]().fromJSON(s))}return this}}class Mc extends Qw{constructor(e){super(),this.type="Path",this.currentPoint=new ee,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new Zv(this.currentPoint.clone(),new ee(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,s){const r=new Jv(this.currentPoint.clone(),new ee(e,t),new ee(i,s));return this.curves.push(r),this.currentPoint.set(i,s),this}bezierCurveTo(e,t,i,s,r,o){const a=new Yv(this.currentPoint.clone(),new ee(e,t),new ee(i,s),new ee(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new eg(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,s,r,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,i,s,r,o),this}absarc(e,t,i,s,r,o){return this.absellipse(e,t,i,i,s,r,o),this}ellipse(e,t,i,s,r,o,a,l){const c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+c,t+h,i,s,r,o,a,l),this}absellipse(e,t,i,s,r,o,a,l){const c=new mp(e,t,i,s,r,o,a,l);if(this.curves.length>0){const u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class eh extends Ye{constructor(e=[new ee(0,-.5),new ee(.5,0),new ee(0,.5)],t=12,i=0,s=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:s},t=Math.floor(t),s=Ke(s,0,Math.PI*2);const r=[],o=[],a=[],l=[],c=[],h=1/t,u=new R,d=new ee,p=new R,f=new R,g=new R;let m=0,v=0;for(let x=0;x<=e.length-1;x++)switch(x){case 0:m=e[x+1].x-e[x].x,v=e[x+1].y-e[x].y,p.x=v*1,p.y=-m,p.z=v*0,g.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case e.length-1:l.push(g.x,g.y,g.z);break;default:m=e[x+1].x-e[x].x,v=e[x+1].y-e[x].y,p.x=v*1,p.y=-m,p.z=v*0,f.copy(p),p.x+=g.x,p.y+=g.y,p.z+=g.z,p.normalize(),l.push(p.x,p.y,p.z),g.copy(f)}for(let x=0;x<=t;x++){const b=i+x*h*s,_=Math.sin(b),C=Math.cos(b);for(let M=0;M<=e.length-1;M++){u.x=e[M].x*_,u.y=e[M].y,u.z=e[M].x*C,o.push(u.x,u.y,u.z),d.x=x/t,d.y=M/(e.length-1),a.push(d.x,d.y);const S=l[3*M+0]*_,P=l[3*M+1],E=l[3*M+0]*C;c.push(S,P,E)}}for(let x=0;x<t;x++)for(let b=0;b<e.length-1;b++){const _=b+x*e.length,C=_,M=_+e.length,S=_+e.length+1,P=_+1;r.push(C,M,P),r.push(S,P,M)}this.setIndex(r),this.setAttribute("position",new Te(o,3)),this.setAttribute("uv",new Te(a,2)),this.setAttribute("normal",new Te(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new eh(e.points,e.segments,e.phiStart,e.phiLength)}}class vp extends eh{constructor(e=1,t=1,i=4,s=8){const r=new Mc;r.absarc(0,-t/2,e,Math.PI*1.5,0),r.absarc(0,t/2,e,0,Math.PI*.5),super(r.getPoints(i),s),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:i,radialSegments:s}}static fromJSON(e){return new vp(e.radius,e.length,e.capSegments,e.radialSegments)}}class gp extends Ye{constructor(e=1,t=32,i=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:s},t=Math.max(3,t);const r=[],o=[],a=[],l=[],c=new R,h=new ee;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let u=0,d=3;u<=t;u++,d+=3){const p=i+u/t*s;c.x=e*Math.cos(p),c.y=e*Math.sin(p),o.push(c.x,c.y,c.z),a.push(0,0,1),h.x=(o[d]/e+1)/2,h.y=(o[d+1]/e+1)/2,l.push(h.x,h.y)}for(let u=1;u<=t;u++)r.push(u,u+1,0);this.setIndex(r),this.setAttribute("position",new Te(o,3)),this.setAttribute("normal",new Te(a,3)),this.setAttribute("uv",new Te(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gp(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class dl extends Ye{constructor(e=1,t=1,i=1,s=32,r=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:s,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l};const c=this;s=Math.floor(s),r=Math.floor(r);const h=[],u=[],d=[],p=[];let f=0;const g=[],m=i/2;let v=0;x(),o===!1&&(e>0&&b(!0),t>0&&b(!1)),this.setIndex(h),this.setAttribute("position",new Te(u,3)),this.setAttribute("normal",new Te(d,3)),this.setAttribute("uv",new Te(p,2));function x(){const _=new R,C=new R;let M=0;const S=(t-e)/i;for(let P=0;P<=r;P++){const E=[],y=P/r,L=y*(t-e)+e;for(let k=0;k<=s;k++){const D=k/s,W=D*l+a,z=Math.sin(W),H=Math.cos(W);C.x=L*z,C.y=-y*i+m,C.z=L*H,u.push(C.x,C.y,C.z),_.set(z,S,H).normalize(),d.push(_.x,_.y,_.z),p.push(D,1-y),E.push(f++)}g.push(E)}for(let P=0;P<s;P++)for(let E=0;E<r;E++){const y=g[E][P],L=g[E+1][P],k=g[E+1][P+1],D=g[E][P+1];(e>0||E!==0)&&(h.push(y,L,D),M+=3),(t>0||E!==r-1)&&(h.push(L,k,D),M+=3)}c.addGroup(v,M,0),v+=M}function b(_){const C=f,M=new ee,S=new R;let P=0;const E=_===!0?e:t,y=_===!0?1:-1;for(let k=1;k<=s;k++)u.push(0,m*y,0),d.push(0,y,0),p.push(.5,.5),f++;const L=f;for(let k=0;k<=s;k++){const W=k/s*l+a,z=Math.cos(W),H=Math.sin(W);S.x=E*H,S.y=m*y,S.z=E*z,u.push(S.x,S.y,S.z),d.push(0,y,0),M.x=z*.5+.5,M.y=H*.5*y+.5,p.push(M.x,M.y),f++}for(let k=0;k<s;k++){const D=C+k,W=L+k;_===!0?h.push(W,W+1,D):h.push(W+1,W,D),P+=3}c.addGroup(v,P,_===!0?1:2),v+=P}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new dl(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class _p extends dl{constructor(e=1,t=1,i=32,s=1,r=!1,o=0,a=Math.PI*2){super(0,e,t,i,s,r,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:s,openEnded:r,thetaStart:o,thetaLength:a}}static fromJSON(e){return new _p(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class zr extends Ye{constructor(e=[],t=[],i=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:s};const r=[],o=[];a(s),c(i),h(),this.setAttribute("position",new Te(r,3)),this.setAttribute("normal",new Te(r.slice(),3)),this.setAttribute("uv",new Te(o,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function a(x){const b=new R,_=new R,C=new R;for(let M=0;M<t.length;M+=3)p(t[M+0],b),p(t[M+1],_),p(t[M+2],C),l(b,_,C,x)}function l(x,b,_,C){const M=C+1,S=[];for(let P=0;P<=M;P++){S[P]=[];const E=x.clone().lerp(_,P/M),y=b.clone().lerp(_,P/M),L=M-P;for(let k=0;k<=L;k++)k===0&&P===M?S[P][k]=E:S[P][k]=E.clone().lerp(y,k/L)}for(let P=0;P<M;P++)for(let E=0;E<2*(M-P)-1;E++){const y=Math.floor(E/2);E%2===0?(d(S[P][y+1]),d(S[P+1][y]),d(S[P][y])):(d(S[P][y+1]),d(S[P+1][y+1]),d(S[P+1][y]))}}function c(x){const b=new R;for(let _=0;_<r.length;_+=3)b.x=r[_+0],b.y=r[_+1],b.z=r[_+2],b.normalize().multiplyScalar(x),r[_+0]=b.x,r[_+1]=b.y,r[_+2]=b.z}function h(){const x=new R;for(let b=0;b<r.length;b+=3){x.x=r[b+0],x.y=r[b+1],x.z=r[b+2];const _=m(x)/2/Math.PI+.5,C=v(x)/Math.PI+.5;o.push(_,1-C)}f(),u()}function u(){for(let x=0;x<o.length;x+=6){const b=o[x+0],_=o[x+2],C=o[x+4],M=Math.max(b,_,C),S=Math.min(b,_,C);M>.9&&S<.1&&(b<.2&&(o[x+0]+=1),_<.2&&(o[x+2]+=1),C<.2&&(o[x+4]+=1))}}function d(x){r.push(x.x,x.y,x.z)}function p(x,b){const _=x*3;b.x=e[_+0],b.y=e[_+1],b.z=e[_+2]}function f(){const x=new R,b=new R,_=new R,C=new R,M=new ee,S=new ee,P=new ee;for(let E=0,y=0;E<r.length;E+=9,y+=6){x.set(r[E+0],r[E+1],r[E+2]),b.set(r[E+3],r[E+4],r[E+5]),_.set(r[E+6],r[E+7],r[E+8]),M.set(o[y+0],o[y+1]),S.set(o[y+2],o[y+3]),P.set(o[y+4],o[y+5]),C.copy(x).add(b).add(_).divideScalar(3);const L=m(C);g(M,y+0,x,L),g(S,y+2,b,L),g(P,y+4,_,L)}}function g(x,b,_,C){C<0&&x.x===1&&(o[b]=x.x-1),_.x===0&&_.z===0&&(o[b]=C/2/Math.PI+.5)}function m(x){return Math.atan2(x.z,-x.x)}function v(x){return Math.atan2(-x.y,Math.sqrt(x.x*x.x+x.z*x.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new zr(e.vertices,e.indices,e.radius,e.details)}}class bp extends zr{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,s=1/i,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-i,0,-s,i,0,s,-i,0,s,i,-s,-i,0,-s,i,0,s,-i,0,s,i,0,-i,0,-s,i,0,-s,-i,0,s,i,0,s],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new bp(e.radius,e.detail)}}const nu=new R,iu=new R,Bf=new R,su=new ui;class eE extends Ye{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const s=Math.pow(10,4),r=Math.cos(Ro*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],h=["a","b","c"],u=new Array(3),d={},p=[];for(let f=0;f<l;f+=3){o?(c[0]=o.getX(f),c[1]=o.getX(f+1),c[2]=o.getX(f+2)):(c[0]=f,c[1]=f+1,c[2]=f+2);const{a:g,b:m,c:v}=su;if(g.fromBufferAttribute(a,c[0]),m.fromBufferAttribute(a,c[1]),v.fromBufferAttribute(a,c[2]),su.getNormal(Bf),u[0]=`${Math.round(g.x*s)},${Math.round(g.y*s)},${Math.round(g.z*s)}`,u[1]=`${Math.round(m.x*s)},${Math.round(m.y*s)},${Math.round(m.z*s)}`,u[2]=`${Math.round(v.x*s)},${Math.round(v.y*s)},${Math.round(v.z*s)}`,!(u[0]===u[1]||u[1]===u[2]||u[2]===u[0]))for(let x=0;x<3;x++){const b=(x+1)%3,_=u[x],C=u[b],M=su[h[x]],S=su[h[b]],P=`${_}_${C}`,E=`${C}_${_}`;E in d&&d[E]?(Bf.dot(d[E].normal)<=r&&(p.push(M.x,M.y,M.z),p.push(S.x,S.y,S.z)),d[E]=null):P in d||(d[P]={index0:c[x],index1:c[b],normal:Bf.clone()})}}for(const f in d)if(d[f]){const{index0:g,index1:m}=d[f];nu.fromBufferAttribute(a,g),iu.fromBufferAttribute(a,m),p.push(nu.x,nu.y,nu.z),p.push(iu.x,iu.y,iu.z)}this.setAttribute("position",new Te(p,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Lo extends Mc{constructor(e){super(e),this.uuid=Ei(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,s=this.holes.length;i<s;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const s=e.holes[t];this.holes.push(new Mc().fromJSON(s))}return this}}function _T(n,e,t=2){const i=e&&e.length,s=i?e[0]*t:n.length;let r=tE(n,0,s,t,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c;if(i&&(r=ET(n,e,r,t)),n.length>80*t){a=1/0,l=1/0;let h=-1/0,u=-1/0;for(let d=t;d<s;d+=t){const p=n[d],f=n[d+1];p<a&&(a=p),f<l&&(l=f),p>h&&(h=p),f>u&&(u=f)}c=Math.max(h-a,u-l),c=c!==0?32767/c:0}return Sc(r,o,t,a,l,c,0),o}function tE(n,e,t,i,s){let r;if(s===NT(n,e,t,i)>0)for(let o=e;o<t;o+=i)r=N0(o/i|0,n[o],n[o+1],r);else for(let o=t-i;o>=e;o-=i)r=N0(o/i|0,n[o],n[o+1],r);return r&&il(r,r.next)&&(Ac(r),r=r.next),r}function Oo(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(il(t,t.next)||Xt(t.prev,t,t.next)===0)){if(Ac(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Sc(n,e,t,i,s,r,o){if(!n)return;!o&&r&&TT(n,i,s,r);let a=n;for(;n.prev!==n.next;){const l=n.prev,c=n.next;if(r?xT(n,i,s,r):bT(n)){e.push(l.i,n.i,c.i),Ac(n),n=c.next,a=c.next;continue}if(n=c,n===a){o?o===1?(n=yT(Oo(n),e),Sc(n,e,t,i,s,r,2)):o===2&&wT(n,e,t,i,s,r):Sc(Oo(n),e,t,i,s,r,1);break}}}function bT(n){const e=n.prev,t=n,i=n.next;if(Xt(e,t,i)>=0)return!1;const s=e.x,r=t.x,o=i.x,a=e.y,l=t.y,c=i.y,h=Math.min(s,r,o),u=Math.min(a,l,c),d=Math.max(s,r,o),p=Math.max(a,l,c);let f=i.next;for(;f!==e;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&nc(s,a,r,l,o,c,f.x,f.y)&&Xt(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function xT(n,e,t,i){const s=n.prev,r=n,o=n.next;if(Xt(s,r,o)>=0)return!1;const a=s.x,l=r.x,c=o.x,h=s.y,u=r.y,d=o.y,p=Math.min(a,l,c),f=Math.min(h,u,d),g=Math.max(a,l,c),m=Math.max(h,u,d),v=jm(p,f,e,t,i),x=jm(g,m,e,t,i);let b=n.prevZ,_=n.nextZ;for(;b&&b.z>=v&&_&&_.z<=x;){if(b.x>=p&&b.x<=g&&b.y>=f&&b.y<=m&&b!==s&&b!==o&&nc(a,h,l,u,c,d,b.x,b.y)&&Xt(b.prev,b,b.next)>=0||(b=b.prevZ,_.x>=p&&_.x<=g&&_.y>=f&&_.y<=m&&_!==s&&_!==o&&nc(a,h,l,u,c,d,_.x,_.y)&&Xt(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;b&&b.z>=v;){if(b.x>=p&&b.x<=g&&b.y>=f&&b.y<=m&&b!==s&&b!==o&&nc(a,h,l,u,c,d,b.x,b.y)&&Xt(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;_&&_.z<=x;){if(_.x>=p&&_.x<=g&&_.y>=f&&_.y<=m&&_!==s&&_!==o&&nc(a,h,l,u,c,d,_.x,_.y)&&Xt(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function yT(n,e){let t=n;do{const i=t.prev,s=t.next.next;!il(i,s)&&iE(i,t,t.next,s)&&Cc(i,s)&&Cc(s,i)&&(e.push(i.i,t.i,s.i),Ac(t),Ac(t.next),t=n=s),t=t.next}while(t!==n);return Oo(t)}function wT(n,e,t,i,s,r){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&LT(o,a)){let l=sE(o,a);o=Oo(o,o.next),l=Oo(l,l.next),Sc(o,e,t,i,s,r,0),Sc(l,e,t,i,s,r,0);return}a=a.next}o=o.next}while(o!==n)}function ET(n,e,t,i){const s=[];for(let r=0,o=e.length;r<o;r++){const a=e[r]*i,l=r<o-1?e[r+1]*i:n.length,c=tE(n,a,l,i,!1);c===c.next&&(c.steiner=!0),s.push(RT(c))}s.sort(MT);for(let r=0;r<s.length;r++)t=ST(s[r],t);return t}function MT(n,e){let t=n.x-e.x;if(t===0&&(t=n.y-e.y,t===0)){const i=(n.next.y-n.y)/(n.next.x-n.x),s=(e.next.y-e.y)/(e.next.x-e.x);t=i-s}return t}function ST(n,e){const t=CT(n,e);if(!t)return e;const i=sE(t,n);return Oo(i,i.next),Oo(t,t.next)}function CT(n,e){let t=e;const i=n.x,s=n.y;let r=-1/0,o;if(il(n,t))return t;do{if(il(n,t.next))return t.next;if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){const u=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(u<=i&&u>r&&(r=u,o=t.x<t.next.x?t:t.next,u===i))return o}t=t.next}while(t!==e);if(!o)return null;const a=o,l=o.x,c=o.y;let h=1/0;t=o;do{if(i>=t.x&&t.x>=l&&i!==t.x&&nE(s<c?i:r,s,l,c,s<c?r:i,s,t.x,t.y)){const u=Math.abs(s-t.y)/(i-t.x);Cc(t,n)&&(u<h||u===h&&(t.x>o.x||t.x===o.x&&AT(o,t)))&&(o=t,h=u)}t=t.next}while(t!==a);return o}function AT(n,e){return Xt(n.prev,n,e.prev)<0&&Xt(e.next,n,n.next)<0}function TT(n,e,t,i){let s=n;do s.z===0&&(s.z=jm(s.x,s.y,e,t,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,PT(s)}function PT(n){let e,t=1;do{let i=n,s;n=null;let r=null;for(e=0;i;){e++;let o=i,a=0;for(let c=0;c<t&&(a++,o=o.nextZ,!!o);c++);let l=t;for(;a>0||l>0&&o;)a!==0&&(l===0||!o||i.z<=o.z)?(s=i,i=i.nextZ,a--):(s=o,o=o.nextZ,l--),r?r.nextZ=s:n=s,s.prevZ=r,r=s;i=o}r.nextZ=null,t*=2}while(e>1);return n}function jm(n,e,t,i,s){return n=(n-t)*s|0,e=(e-i)*s|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function RT(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function nE(n,e,t,i,s,r,o,a){return(s-o)*(e-a)>=(n-o)*(r-a)&&(n-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(r-a)>=(s-o)*(i-a)}function nc(n,e,t,i,s,r,o,a){return!(n===o&&e===a)&&nE(n,e,t,i,s,r,o,a)}function LT(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!IT(n,e)&&(Cc(n,e)&&Cc(e,n)&&DT(n,e)&&(Xt(n.prev,n,e.prev)||Xt(n,e.prev,e))||il(n,e)&&Xt(n.prev,n,n.next)>0&&Xt(e.prev,e,e.next)>0)}function Xt(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function il(n,e){return n.x===e.x&&n.y===e.y}function iE(n,e,t,i){const s=ou(Xt(n,e,t)),r=ou(Xt(n,e,i)),o=ou(Xt(t,i,n)),a=ou(Xt(t,i,e));return!!(s!==r&&o!==a||s===0&&ru(n,t,e)||r===0&&ru(n,i,e)||o===0&&ru(t,n,i)||a===0&&ru(t,e,i))}function ru(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function ou(n){return n>0?1:n<0?-1:0}function IT(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&iE(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function Cc(n,e){return Xt(n.prev,n,n.next)<0?Xt(n,e,n.next)>=0&&Xt(n,n.prev,e)>=0:Xt(n,e,n.prev)<0||Xt(n,n.next,e)<0}function DT(n,e){let t=n,i=!1;const s=(n.x+e.x)/2,r=(n.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&s<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function sE(n,e){const t=Xm(n.i,n.x,n.y),i=Xm(e.i,e.x,e.y),s=n.next,r=e.prev;return n.next=e,e.prev=n,t.next=s,s.prev=t,i.next=t,t.prev=i,r.next=i,i.prev=r,i}function N0(n,e,t,i){const s=Xm(n,e,t);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Ac(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Xm(n,e,t){return{i:n,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function NT(n,e,t,i){let s=0;for(let r=e,o=t-i;r<t;r+=i)s+=(n[o]-n[r])*(n[r+1]+n[o+1]),o=r;return s}class OT{static triangulate(e,t,i=2){return _T(e,t,i)}}class ps{static area(e){const t=e.length;let i=0;for(let s=t-1,r=0;r<t;s=r++)i+=e[s].x*e[r].y-e[r].x*e[s].y;return i*.5}static isClockWise(e){return ps.area(e)<0}static triangulateShape(e,t){const i=[],s=[],r=[];O0(e),k0(i,e);let o=e.length;t.forEach(O0);for(let l=0;l<t.length;l++)s.push(o),o+=t[l].length,k0(i,t[l]);const a=OT.triangulate(i,s);for(let l=0;l<a.length;l+=3)r.push(a.slice(l,l+3));return r}}function O0(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function k0(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class xp extends Ye{constructor(e=new Lo([new ee(.5,.5),new ee(-.5,.5),new ee(-.5,-.5),new ee(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,s=[],r=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new Te(s,3)),this.setAttribute("uv",new Te(r,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,u=t.depth!==void 0?t.depth:1;let d=t.bevelEnabled!==void 0?t.bevelEnabled:!0,p=t.bevelThickness!==void 0?t.bevelThickness:.2,f=t.bevelSize!==void 0?t.bevelSize:p-.1,g=t.bevelOffset!==void 0?t.bevelOffset:0,m=t.bevelSegments!==void 0?t.bevelSegments:3;const v=t.extrudePath,x=t.UVGenerator!==void 0?t.UVGenerator:kT;let b,_=!1,C,M,S,P;v&&(b=v.getSpacedPoints(h),_=!0,d=!1,C=v.computeFrenetFrames(h,!1),M=new R,S=new R,P=new R),d||(m=0,p=0,f=0,g=0);const E=a.extractPoints(c);let y=E.shape;const L=E.holes;if(!ps.isClockWise(y)){y=y.reverse();for(let q=0,te=L.length;q<te;q++){const K=L[q];ps.isClockWise(K)&&(L[q]=K.reverse())}}function D(q){const K=10000000000000001e-36;let de=q[0];for(let Y=1;Y<=q.length;Y++){const T=Y%q.length,w=q[T],U=w.x-de.x,j=w.y-de.y,Z=U*U+j*j,O=Math.max(Math.abs(w.x),Math.abs(w.y),Math.abs(de.x),Math.abs(de.y)),he=K*O*O;if(Z<=he){q.splice(T,1),Y--;continue}de=w}}D(y),L.forEach(D);const W=L.length,z=y;for(let q=0;q<W;q++){const te=L[q];y=y.concat(te)}function H(q,te,K){return te||console.error("THREE.ExtrudeGeometry: vec does not exist"),q.clone().addScaledVector(te,K)}const ne=y.length;function G(q,te,K){let de,Y,T;const w=q.x-te.x,U=q.y-te.y,j=K.x-q.x,Z=K.y-q.y,O=w*w+U*U,he=w*Z-U*j;if(Math.abs(he)>Number.EPSILON){const oe=Math.sqrt(O),fe=Math.sqrt(j*j+Z*Z),Ue=te.x-U/oe,le=te.y+w/oe,Ee=K.x-Z/fe,ke=K.y+j/fe,Ie=((Ee-Ue)*Z-(ke-le)*j)/(w*Z-U*j);de=Ue+w*Ie-q.x,Y=le+U*Ie-q.y;const be=de*de+Y*Y;if(be<=2)return new ee(de,Y);T=Math.sqrt(be/2)}else{let oe=!1;w>Number.EPSILON?j>Number.EPSILON&&(oe=!0):w<-Number.EPSILON?j<-Number.EPSILON&&(oe=!0):Math.sign(U)===Math.sign(Z)&&(oe=!0),oe?(de=-U,Y=w,T=Math.sqrt(O)):(de=w,Y=U,T=Math.sqrt(O/2))}return new ee(de/T,Y/T)}const ae=[];for(let q=0,te=z.length,K=te-1,de=q+1;q<te;q++,K++,de++)K===te&&(K=0),de===te&&(de=0),ae[q]=G(z[q],z[K],z[de]);const se=[];let ge,Oe=ae.concat();for(let q=0,te=W;q<te;q++){const K=L[q];ge=[];for(let de=0,Y=K.length,T=Y-1,w=de+1;de<Y;de++,T++,w++)T===Y&&(T=0),w===Y&&(w=0),ge[de]=G(K[de],K[T],K[w]);se.push(ge),Oe=Oe.concat(ge)}const Ze=[],J=[];for(let q=0;q<m;q++){const te=q/m,K=p*Math.cos(te*Math.PI/2),de=f*Math.sin(te*Math.PI/2)+g;for(let Y=0,T=z.length;Y<T;Y++){const w=H(z[Y],ae[Y],de);rt(w.x,w.y,-K),te==0&&Ze.push(w)}for(let Y=0,T=W;Y<T;Y++){const w=L[Y];ge=se[Y];const U=[];for(let j=0,Z=w.length;j<Z;j++){const O=H(w[j],ge[j],de);rt(O.x,O.y,-K),te==0&&U.push(O)}te==0&&J.push(U)}}const ce=ps.triangulateShape(Ze,J),_e=ce.length,pe=f+g;for(let q=0;q<ne;q++){const te=d?H(y[q],Oe[q],pe):y[q];_?(S.copy(C.normals[0]).multiplyScalar(te.x),M.copy(C.binormals[0]).multiplyScalar(te.y),P.copy(b[0]).add(S).add(M),rt(P.x,P.y,P.z)):rt(te.x,te.y,0)}for(let q=1;q<=h;q++)for(let te=0;te<ne;te++){const K=d?H(y[te],Oe[te],pe):y[te];_?(S.copy(C.normals[q]).multiplyScalar(K.x),M.copy(C.binormals[q]).multiplyScalar(K.y),P.copy(b[q]).add(S).add(M),rt(P.x,P.y,P.z)):rt(K.x,K.y,u/h*q)}for(let q=m-1;q>=0;q--){const te=q/m,K=p*Math.cos(te*Math.PI/2),de=f*Math.sin(te*Math.PI/2)+g;for(let Y=0,T=z.length;Y<T;Y++){const w=H(z[Y],ae[Y],de);rt(w.x,w.y,u+K)}for(let Y=0,T=L.length;Y<T;Y++){const w=L[Y];ge=se[Y];for(let U=0,j=w.length;U<j;U++){const Z=H(w[U],ge[U],de);_?rt(Z.x,Z.y+b[h-1].y,b[h-1].x+K):rt(Z.x,Z.y,u+K)}}}Re(),nt();function Re(){const q=s.length/3;if(d){let te=0,K=ne*te;for(let de=0;de<_e;de++){const Y=ce[de];mt(Y[2]+K,Y[1]+K,Y[0]+K)}te=h+m*2,K=ne*te;for(let de=0;de<_e;de++){const Y=ce[de];mt(Y[0]+K,Y[1]+K,Y[2]+K)}}else{for(let te=0;te<_e;te++){const K=ce[te];mt(K[2],K[1],K[0])}for(let te=0;te<_e;te++){const K=ce[te];mt(K[0]+ne*h,K[1]+ne*h,K[2]+ne*h)}}i.addGroup(q,s.length/3-q,0)}function nt(){const q=s.length/3;let te=0;Le(z,te),te+=z.length;for(let K=0,de=L.length;K<de;K++){const Y=L[K];Le(Y,te),te+=Y.length}i.addGroup(q,s.length/3-q,1)}function Le(q,te){let K=q.length;for(;--K>=0;){const de=K;let Y=K-1;Y<0&&(Y=q.length-1);for(let T=0,w=h+m*2;T<w;T++){const U=ne*T,j=ne*(T+1),Z=te+de+U,O=te+Y+U,he=te+Y+j,oe=te+de+j;Ge(Z,O,he,oe)}}}function rt(q,te,K){l.push(q),l.push(te),l.push(K)}function mt(q,te,K){N(q),N(te),N(K);const de=s.length/3,Y=x.generateTopUV(i,s,de-3,de-2,de-1);Qe(Y[0]),Qe(Y[1]),Qe(Y[2])}function Ge(q,te,K,de){N(q),N(te),N(de),N(te),N(K),N(de);const Y=s.length/3,T=x.generateSideWallUV(i,s,Y-6,Y-3,Y-2,Y-1);Qe(T[0]),Qe(T[1]),Qe(T[3]),Qe(T[1]),Qe(T[2]),Qe(T[3])}function N(q){s.push(l[q*3+0]),s.push(l[q*3+1]),s.push(l[q*3+2])}function Qe(q){r.push(q.x),r.push(q.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return UT(t,i,e)}static fromJSON(e,t){const i=[];for(let r=0,o=e.shapes.length;r<o;r++){const a=t[e.shapes[r]];i.push(a)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new Rd[s.type]().fromJSON(s)),new xp(i,e.options)}}const kT={generateTopUV:function(n,e,t,i,s){const r=e[t*3],o=e[t*3+1],a=e[i*3],l=e[i*3+1],c=e[s*3],h=e[s*3+1];return[new ee(r,o),new ee(a,l),new ee(c,h)]},generateSideWallUV:function(n,e,t,i,s,r){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[i*3],h=e[i*3+1],u=e[i*3+2],d=e[s*3],p=e[s*3+1],f=e[s*3+2],g=e[r*3],m=e[r*3+1],v=e[r*3+2];return Math.abs(a-h)<Math.abs(o-c)?[new ee(o,1-l),new ee(c,1-u),new ee(d,1-f),new ee(g,1-v)]:[new ee(a,1-l),new ee(h,1-u),new ee(p,1-f),new ee(m,1-v)]}};function UT(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,s=n.length;i<s;i++){const r=n[i];t.shapes.push(r.uuid)}else t.shapes.push(n.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class yp extends zr{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,s=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(s,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new yp(e.radius,e.detail)}}class th extends zr{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,s,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new th(e.radius,e.detail)}}class Ko extends Ye{constructor(e=1,t=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:s};const r=e/2,o=t/2,a=Math.floor(i),l=Math.floor(s),c=a+1,h=l+1,u=e/a,d=t/l,p=[],f=[],g=[],m=[];for(let v=0;v<h;v++){const x=v*d-o;for(let b=0;b<c;b++){const _=b*u-r;f.push(_,-x,0),g.push(0,0,1),m.push(b/a),m.push(1-v/l)}}for(let v=0;v<l;v++)for(let x=0;x<a;x++){const b=x+c*v,_=x+c*(v+1),C=x+1+c*(v+1),M=x+1+c*v;p.push(b,_,M),p.push(_,C,M)}this.setIndex(p),this.setAttribute("position",new Te(f,3)),this.setAttribute("normal",new Te(g,3)),this.setAttribute("uv",new Te(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ko(e.width,e.height,e.widthSegments,e.heightSegments)}}class wp extends Ye{constructor(e=.5,t=1,i=32,s=1,r=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:s,thetaStart:r,thetaLength:o},i=Math.max(3,i),s=Math.max(1,s);const a=[],l=[],c=[],h=[];let u=e;const d=(t-e)/s,p=new R,f=new ee;for(let g=0;g<=s;g++){for(let m=0;m<=i;m++){const v=r+m/i*o;p.x=u*Math.cos(v),p.y=u*Math.sin(v),l.push(p.x,p.y,p.z),c.push(0,0,1),f.x=(p.x/t+1)/2,f.y=(p.y/t+1)/2,h.push(f.x,f.y)}u+=d}for(let g=0;g<s;g++){const m=g*(i+1);for(let v=0;v<i;v++){const x=v+m,b=x,_=x+i+1,C=x+i+2,M=x+1;a.push(b,_,M),a.push(_,C,M)}}this.setIndex(a),this.setAttribute("position",new Te(l,3)),this.setAttribute("normal",new Te(c,3)),this.setAttribute("uv",new Te(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wp(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Ep extends Ye{constructor(e=new Lo([new ee(0,.5),new ee(-.5,-.5),new ee(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],s=[],r=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let h=0;h<e.length;h++)c(e[h]),this.addGroup(a,l,h),a+=l,l=0;this.setIndex(i),this.setAttribute("position",new Te(s,3)),this.setAttribute("normal",new Te(r,3)),this.setAttribute("uv",new Te(o,2));function c(h){const u=s.length/3,d=h.extractPoints(t);let p=d.shape;const f=d.holes;ps.isClockWise(p)===!1&&(p=p.reverse());for(let m=0,v=f.length;m<v;m++){const x=f[m];ps.isClockWise(x)===!0&&(f[m]=x.reverse())}const g=ps.triangulateShape(p,f);for(let m=0,v=f.length;m<v;m++){const x=f[m];p=p.concat(x)}for(let m=0,v=p.length;m<v;m++){const x=p[m];s.push(x.x,x.y,0),r.push(0,0,1),o.push(x.x,x.y)}for(let m=0,v=g.length;m<v;m++){const x=g[m],b=x[0]+u,_=x[1]+u,C=x[2]+u;i.push(b,_,C),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return FT(t,e)}static fromJSON(e,t){const i=[];for(let s=0,r=e.shapes.length;s<r;s++){const o=t[e.shapes[s]];i.push(o)}return new Ep(i,e.curveSegments)}}function FT(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const s=n[t];e.shapes.push(s.uuid)}else e.shapes.push(n.uuid);return e}class nh extends Ye{constructor(e=1,t=32,i=16,s=0,r=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:s,phiLength:r,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let c=0;const h=[],u=new R,d=new R,p=[],f=[],g=[],m=[];for(let v=0;v<=i;v++){const x=[],b=v/i;let _=0;v===0&&o===0?_=.5/t:v===i&&l===Math.PI&&(_=-.5/t);for(let C=0;C<=t;C++){const M=C/t;u.x=-e*Math.cos(s+M*r)*Math.sin(o+b*a),u.y=e*Math.cos(o+b*a),u.z=e*Math.sin(s+M*r)*Math.sin(o+b*a),f.push(u.x,u.y,u.z),d.copy(u).normalize(),g.push(d.x,d.y,d.z),m.push(M+_,1-b),x.push(c++)}h.push(x)}for(let v=0;v<i;v++)for(let x=0;x<t;x++){const b=h[v][x+1],_=h[v][x],C=h[v+1][x],M=h[v+1][x+1];(v!==0||o>0)&&p.push(b,_,M),(v!==i-1||l<Math.PI)&&p.push(_,C,M)}this.setIndex(p),this.setAttribute("position",new Te(f,3)),this.setAttribute("normal",new Te(g,3)),this.setAttribute("uv",new Te(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nh(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Mp extends zr{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],s=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,s,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Mp(e.radius,e.detail)}}class Sp extends Ye{constructor(e=1,t=.4,i=12,s=48,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:s,arc:r},i=Math.floor(i),s=Math.floor(s);const o=[],a=[],l=[],c=[],h=new R,u=new R,d=new R;for(let p=0;p<=i;p++)for(let f=0;f<=s;f++){const g=f/s*r,m=p/i*Math.PI*2;u.x=(e+t*Math.cos(m))*Math.cos(g),u.y=(e+t*Math.cos(m))*Math.sin(g),u.z=t*Math.sin(m),a.push(u.x,u.y,u.z),h.x=e*Math.cos(g),h.y=e*Math.sin(g),d.subVectors(u,h).normalize(),l.push(d.x,d.y,d.z),c.push(f/s),c.push(p/i)}for(let p=1;p<=i;p++)for(let f=1;f<=s;f++){const g=(s+1)*p+f-1,m=(s+1)*(p-1)+f-1,v=(s+1)*(p-1)+f,x=(s+1)*p+f;o.push(g,m,x),o.push(m,v,x)}this.setIndex(o),this.setAttribute("position",new Te(a,3)),this.setAttribute("normal",new Te(l,3)),this.setAttribute("uv",new Te(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Sp(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Cp extends Ye{constructor(e=1,t=.4,i=64,s=8,r=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:s,p:r,q:o},i=Math.floor(i),s=Math.floor(s);const a=[],l=[],c=[],h=[],u=new R,d=new R,p=new R,f=new R,g=new R,m=new R,v=new R;for(let b=0;b<=i;++b){const _=b/i*r*Math.PI*2;x(_,r,o,e,p),x(_+.01,r,o,e,f),m.subVectors(f,p),v.addVectors(f,p),g.crossVectors(m,v),v.crossVectors(g,m),g.normalize(),v.normalize();for(let C=0;C<=s;++C){const M=C/s*Math.PI*2,S=-t*Math.cos(M),P=t*Math.sin(M);u.x=p.x+(S*v.x+P*g.x),u.y=p.y+(S*v.y+P*g.y),u.z=p.z+(S*v.z+P*g.z),l.push(u.x,u.y,u.z),d.subVectors(u,p).normalize(),c.push(d.x,d.y,d.z),h.push(b/i),h.push(C/s)}}for(let b=1;b<=i;b++)for(let _=1;_<=s;_++){const C=(s+1)*(b-1)+(_-1),M=(s+1)*b+(_-1),S=(s+1)*b+_,P=(s+1)*(b-1)+_;a.push(C,M,P),a.push(M,S,P)}this.setIndex(a),this.setAttribute("position",new Te(l,3)),this.setAttribute("normal",new Te(c,3)),this.setAttribute("uv",new Te(h,2));function x(b,_,C,M,S){const P=Math.cos(b),E=Math.sin(b),y=C/_*b,L=Math.cos(y);S.x=M*(2+L)*.5*P,S.y=M*(2+L)*E*.5,S.z=M*Math.sin(y)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Cp(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Ap extends Ye{constructor(e=new Qv(new R(-1,-1,0),new R(-1,1,0),new R(1,1,0)),t=64,i=1,s=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:s,closed:r};const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new R,l=new R,c=new ee;let h=new R;const u=[],d=[],p=[],f=[];g(),this.setIndex(f),this.setAttribute("position",new Te(u,3)),this.setAttribute("normal",new Te(d,3)),this.setAttribute("uv",new Te(p,2));function g(){for(let b=0;b<t;b++)m(b);m(r===!1?t:0),x(),v()}function m(b){h=e.getPointAt(b/t,h);const _=o.normals[b],C=o.binormals[b];for(let M=0;M<=s;M++){const S=M/s*Math.PI*2,P=Math.sin(S),E=-Math.cos(S);l.x=E*_.x+P*C.x,l.y=E*_.y+P*C.y,l.z=E*_.z+P*C.z,l.normalize(),d.push(l.x,l.y,l.z),a.x=h.x+i*l.x,a.y=h.y+i*l.y,a.z=h.z+i*l.z,u.push(a.x,a.y,a.z)}}function v(){for(let b=1;b<=t;b++)for(let _=1;_<=s;_++){const C=(s+1)*(b-1)+(_-1),M=(s+1)*b+(_-1),S=(s+1)*b+_,P=(s+1)*(b-1)+_;f.push(C,M,P),f.push(M,S,P)}}function x(){for(let b=0;b<=t;b++)for(let _=0;_<=s;_++)c.x=b/t,c.y=_/s,p.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Ap(new Rd[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class rE extends Ye{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,s=new R,r=new R;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let c=0,h=l.length;c<h;++c){const u=l[c],d=u.start,p=u.count;for(let f=d,g=d+p;f<g;f+=3)for(let m=0;m<3;m++){const v=a.getX(f+m),x=a.getX(f+(m+1)%3);s.fromBufferAttribute(o,v),r.fromBufferAttribute(o,x),U0(s,r,i)===!0&&(t.push(s.x,s.y,s.z),t.push(r.x,r.y,r.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let c=0;c<3;c++){const h=3*a+c,u=3*a+(c+1)%3;s.fromBufferAttribute(o,h),r.fromBufferAttribute(o,u),U0(s,r,i)===!0&&(t.push(s.x,s.y,s.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new Te(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function U0(n,e,t){const i=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(i)===!0||t.has(s)===!0?!1:(t.add(i),t.add(s),!0)}var F0=Object.freeze({__proto__:null,BoxGeometry:Vr,CapsuleGeometry:vp,CircleGeometry:gp,ConeGeometry:_p,CylinderGeometry:dl,DodecahedronGeometry:bp,EdgesGeometry:eE,ExtrudeGeometry:xp,IcosahedronGeometry:yp,LatheGeometry:eh,OctahedronGeometry:th,PlaneGeometry:Ko,PolyhedronGeometry:zr,RingGeometry:wp,ShapeGeometry:Ep,SphereGeometry:nh,TetrahedronGeometry:Mp,TorusGeometry:Sp,TorusKnotGeometry:Cp,TubeGeometry:Ap,WireframeGeometry:rE});class oE extends En{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ve(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class aE extends zi{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class pl extends En{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new ve(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fr,this.normalScale=new ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new es,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Wi extends pl{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ee(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ke(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ve(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ve(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ve(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class lE extends En{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ve(16777215),this.specular=new ve(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fr,this.normalScale=new ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new es,this.combine=Xc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class cE extends En{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ve(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fr,this.normalScale=new ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class hE extends En{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fr,this.normalScale=new ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class uE extends En{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ve(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fr,this.normalScale=new ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new es,this.combine=Xc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class tg extends En{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Sw,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class ng extends En{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class dE extends En{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ve(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fr,this.normalScale=new ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class pE extends $n{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function So(n,e){return!n||n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function fE(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function mE(n){function e(s,r){return n[s]-n[r]}const t=n.length,i=new Array(t);for(let s=0;s!==t;++s)i[s]=s;return i.sort(e),i}function qm(n,e,t){const i=n.length,s=new n.constructor(i);for(let r=0,o=0;o!==i;++r){const a=t[r]*e;for(let l=0;l!==e;++l)s[o++]=n[a+l]}return s}function ig(n,e,t,i){let s=1,r=n[0];for(;r!==void 0&&r[i]===void 0;)r=n[s++];if(r===void 0)return;let o=r[i];if(o!==void 0)if(Array.isArray(o))do o=r[i],o!==void 0&&(e.push(r.time),t.push(...o)),r=n[s++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[i],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=n[s++];while(r!==void 0);else do o=r[i],o!==void 0&&(e.push(r.time),t.push(o)),r=n[s++];while(r!==void 0)}function BT(n,e,t,i,s=30){const r=n.clone();r.name=e;const o=[];for(let l=0;l<r.tracks.length;++l){const c=r.tracks[l],h=c.getValueSize(),u=[],d=[];for(let p=0;p<c.times.length;++p){const f=c.times[p]*s;if(!(f<t||f>=i)){u.push(c.times[p]);for(let g=0;g<h;++g)d.push(c.values[p*h+g])}}u.length!==0&&(c.times=So(u,c.times.constructor),c.values=So(d,c.values.constructor),o.push(c))}r.tracks=o;let a=1/0;for(let l=0;l<r.tracks.length;++l)a>r.tracks[l].times[0]&&(a=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*a);return r.resetDuration(),r}function VT(n,e=0,t=n,i=30){i<=0&&(i=30);const s=t.tracks.length,r=e/i;for(let o=0;o<s;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=n.tracks.find(function(v){return v.name===a.name&&v.ValueTypeName===l});if(c===void 0)continue;let h=0;const u=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=u/3);let d=0;const p=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=p/3);const f=a.times.length-1;let g;if(r<=a.times[0]){const v=h,x=u-h;g=a.values.slice(v,x)}else if(r>=a.times[f]){const v=f*u+h,x=v+u-h;g=a.values.slice(v,x)}else{const v=a.createInterpolant(),x=h,b=u-h;v.evaluate(r),g=v.resultBuffer.slice(x,b)}l==="quaternion"&&new In().fromArray(g).normalize().conjugate().toArray(g);const m=c.times.length;for(let v=0;v<m;++v){const x=v*p+d;if(l==="quaternion")In.multiplyQuaternionsFlat(c.values,x,g,0,c.values,x);else{const b=p-d*2;for(let _=0;_<b;++_)c.values[x+_]-=g[_]}}}return n.blendMode=kv,n}class zT{static convertArray(e,t){return So(e,t)}static isTypedArray(e){return fE(e)}static getKeyframeOrder(e){return mE(e)}static sortedArray(e,t,i){return qm(e,t,i)}static flattenJSON(e,t,i,s){ig(e,t,i,s)}static subclip(e,t,i,s,r=30){return BT(e,t,i,s,r)}static makeClipAdditive(e,t=0,i=e,s=30){return VT(e,t,i,s)}}class fl{constructor(e,t,i,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,s=t[i],r=t[i-1];e:{t:{let o;n:{i:if(!(e<s)){for(let a=i+2;;){if(s===void 0){if(e<r)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=s,s=t[++i],e<s)break t}o=t.length;break n}if(!(e>=r)){const a=t[1];e<a&&(i=2,r=a);for(let l=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(s=r,r=t[--i-1],e>=r)break t}o=i,i=0;break n}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(s=t[i],r=t[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s;for(let o=0;o!==s;++o)t[o]=i[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class vE extends fl{constructor(e,t,i,s){super(e,t,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Eo,endingEnd:Eo}}intervalChanged_(e,t,i){const s=this.parameterPositions;let r=e-2,o=e+1,a=s[r],l=s[o];if(a===void 0)switch(this.getSettings_().endingStart){case Mo:r=e,a=2*t-i;break;case bc:r=s.length-2,a=t+s[r]-s[r+1];break;default:r=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case Mo:o=e,l=2*i-t;break;case bc:o=1,l=i+s[1]-s[0];break;default:o=e-1,l=t}const c=(i-t)*.5,h=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,p=this._weightNext,f=(i-t)/(s-t),g=f*f,m=g*f,v=-d*m+2*d*g-d*f,x=(1+d)*m+(-1.5-2*d)*g+(-.5+d)*f+1,b=(-1-p)*m+(1.5+p)*g+.5*f,_=p*m-p*g;for(let C=0;C!==a;++C)r[C]=v*o[h+C]+x*o[c+C]+b*o[l+C]+_*o[u+C];return r}}class sg extends fl{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=(i-t)/(s-t),u=1-h;for(let d=0;d!==a;++d)r[d]=o[c+d]*u+o[l+d]*h;return r}}class gE extends fl{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class $i{constructor(e,t,i,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=So(t,this.TimeBufferType),this.values=So(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:So(e.times,Array),values:So(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(i.interpolation=s)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new gE(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new sg(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new vE(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Qa:t=this.InterpolantFactoryMethodDiscrete;break;case el:t=this.InterpolantFactoryMethodLinear;break;case Lu:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Qa;case this.InterpolantFactoryMethodLinear:return el;case this.InterpolantFactoryMethodSmooth:return Lu}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]*=e}return this}trim(e,t){const i=this.times,s=i.length;let r=0,o=s-1;for(;r!==s&&i[r]<e;)++r;for(;o!==-1&&i[o]>t;)--o;if(++o,r!==0||o!==s){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=i.slice(r,o),this.values=this.values.slice(r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,s=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(s!==void 0&&fE(s))for(let a=0,l=s.length;a!==l;++a){const c=s[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),s=this.getInterpolation()===Lu,r=e.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=e[a],h=e[a+1];if(c!==h&&(a!==1||c!==e[0]))if(s)l=!0;else{const u=a*i,d=u-i,p=u+i;for(let f=0;f!==i;++f){const g=t[u+f];if(g!==t[d+f]||g!==t[p+f]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const u=a*i,d=o*i;for(let p=0;p!==i;++p)t[d+p]=t[u+p]}++o}}if(r>0){e[o]=e[r];for(let a=r*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,s=new i(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}$i.prototype.ValueTypeName="";$i.prototype.TimeBufferType=Float32Array;$i.prototype.ValueBufferType=Float32Array;$i.prototype.DefaultInterpolation=el;class Yo extends $i{constructor(e,t,i){super(e,t,i)}}Yo.prototype.ValueTypeName="bool";Yo.prototype.ValueBufferType=Array;Yo.prototype.DefaultInterpolation=Qa;Yo.prototype.InterpolantFactoryMethodLinear=void 0;Yo.prototype.InterpolantFactoryMethodSmooth=void 0;class rg extends $i{constructor(e,t,i,s){super(e,t,i,s)}}rg.prototype.ValueTypeName="color";class ko extends $i{constructor(e,t,i,s){super(e,t,i,s)}}ko.prototype.ValueTypeName="number";class _E extends fl{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(s-t);let c=e*a;for(let h=c+a;c!==h;c+=4)In.slerpFlat(r,0,o,c-a,o,c,l);return r}}class Uo extends $i{constructor(e,t,i,s){super(e,t,i,s)}InterpolantFactoryMethodLinear(e){return new _E(this.times,this.values,this.getValueSize(),e)}}Uo.prototype.ValueTypeName="quaternion";Uo.prototype.InterpolantFactoryMethodSmooth=void 0;class Zo extends $i{constructor(e,t,i){super(e,t,i)}}Zo.prototype.ValueTypeName="string";Zo.prototype.ValueBufferType=Array;Zo.prototype.DefaultInterpolation=Qa;Zo.prototype.InterpolantFactoryMethodLinear=void 0;Zo.prototype.InterpolantFactoryMethodSmooth=void 0;class Fo extends $i{constructor(e,t,i,s){super(e,t,i,s)}}Fo.prototype.ValueTypeName="vector";class sl{constructor(e="",t=-1,i=[],s=ip){this.name=e,this.tracks=i,this.duration=t,this.blendMode=s,this.uuid=Ei(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,s=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(GT(i[o]).scale(s));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=i.length;r!==o;++r)t.push($i.toJSON(i[r]));return s}static CreateFromMorphTargetSequence(e,t,i,s){const r=t.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const h=mE(l);l=qm(l,1,h),c=qm(c,1,h),!s&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new ko(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const s=e;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===t)return i[s];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const s={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],h=c.name.match(r);if(h&&h.length>1){const u=h[1];let d=s[u];d||(s[u]=d=[]),d.push(c)}}const o=[];for(const a in s)o.push(this.CreateFromMorphTargetSequence(a,s[a],t,i));return o}static parseAnimation(e,t){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(u,d,p,f,g){if(p.length!==0){const m=[],v=[];ig(p,m,v,f),m.length!==0&&g.push(new u(d,m,v))}},s=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let u=0;u<c.length;u++){const d=c[u].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const p={};let f;for(f=0;f<d.length;f++)if(d[f].morphTargets)for(let g=0;g<d[f].morphTargets.length;g++)p[d[f].morphTargets[g]]=-1;for(const g in p){const m=[],v=[];for(let x=0;x!==d[f].morphTargets.length;++x){const b=d[f];m.push(b.time),v.push(b.morphTarget===g?1:0)}s.push(new ko(".morphTargetInfluence["+g+"]",m,v))}l=p.length*o}else{const p=".bones["+t[u].name+"]";i(Fo,p+".position",d,"pos",s),i(Uo,p+".quaternion",d,"rot",s),i(Fo,p+".scale",d,"scl",s)}}return s.length===0?null:new this(r,l,s,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,s=e.length;i!==s;++i){const r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function HT(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ko;case"vector":case"vector2":case"vector3":case"vector4":return Fo;case"color":return rg;case"quaternion":return Uo;case"bool":case"boolean":return Yo;case"string":return Zo}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function GT(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=HT(n.type);if(n.times===void 0){const t=[],i=[];ig(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Hs={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class og{constructor(e,t,i){const s=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(h){a++,r===!1&&s.onStart!==void 0&&s.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,s.onProgress!==void 0&&s.onProgress(h,o,a),o===a&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(h){s.onError!==void 0&&s.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,u){return c.push(h,u),this},this.removeHandler=function(h){const u=c.indexOf(h);return u!==-1&&c.splice(u,2),this},this.getHandler=function(h){for(let u=0,d=c.length;u<d;u+=2){const p=c[u],f=c[u+1];if(p.global&&(p.lastIndex=0),p.test(h))return f}return null}}}const Jo=new og;class ri{constructor(e){this.manager=e!==void 0?e:Jo,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(s,r){i.load(e,s,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}ri.DEFAULT_MATERIAL_NAME="__DEFAULT";const Ds={};class WT extends Error{constructor(e,t){super(e),this.response=t}}class ts extends ri{constructor(e){super(e),this.mimeType="",this.responseType=""}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Hs.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(Ds[e]!==void 0){Ds[e].push({onLoad:t,onProgress:i,onError:s});return}Ds[e]=[],Ds[e].push({onLoad:t,onProgress:i,onError:s});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=Ds[e],u=c.body.getReader(),d=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),p=d?parseInt(d):0,f=p!==0;let g=0;const m=new ReadableStream({start(v){x();function x(){u.read().then(({done:b,value:_})=>{if(b)v.close();else{g+=_.byteLength;const C=new ProgressEvent("progress",{lengthComputable:f,loaded:g,total:p});for(let M=0,S=h.length;M<S;M++){const P=h[M];P.onProgress&&P.onProgress(C)}v.enqueue(_),x()}},b=>{v.error(b)})}}});return new Response(m)}else throw new WT(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return c.json();default:if(a==="")return c.text();{const u=/charset="?([^;"\s]*)"?/i.exec(a),d=u&&u[1]?u[1].toLowerCase():void 0,p=new TextDecoder(d);return c.arrayBuffer().then(f=>p.decode(f))}}}).then(c=>{Hs.add(e,c);const h=Ds[e];delete Ds[e];for(let u=0,d=h.length;u<d;u++){const p=h[u];p.onLoad&&p.onLoad(c)}}).catch(c=>{const h=Ds[e];if(h===void 0)throw this.manager.itemError(e),c;delete Ds[e];for(let u=0,d=h.length;u<d;u++){const p=h[u];p.onError&&p.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class $T extends ri{constructor(e){super(e)}load(e,t,i,s){const r=this,o=new ts(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},i,s)}parse(e){const t=[];for(let i=0;i<e.length;i++){const s=sl.parse(e[i]);t.push(s)}return t}}class jT extends ri{constructor(e){super(e)}load(e,t,i,s){const r=this,o=[],a=new fp,l=new ts(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(r.withCredentials);let c=0;function h(u){l.load(e[u],function(d){const p=r.parse(d,!0);o[u]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},c+=1,c===6&&(p.mipmapCount===1&&(a.minFilter=sn),a.image=o,a.format=p.format,a.needsUpdate=!0,t&&t(a))},i,s)}if(Array.isArray(e))for(let u=0,d=e.length;u<d;++u)h(u);else l.load(e,function(u){const d=r.parse(u,!0);if(d.isCubemap){const p=d.mipmaps.length/d.mipmapCount;for(let f=0;f<p;f++){o[f]={mipmaps:[]};for(let g=0;g<d.mipmapCount;g++)o[f].mipmaps.push(d.mipmaps[f*d.mipmapCount+g]),o[f].format=d.format,o[f].width=d.width,o[f].height=d.height}a.image=o}else a.image.width=d.width,a.image.height=d.height,a.mipmaps=d.mipmaps;d.mipmapCount===1&&(a.minFilter=sn),a.format=d.format,a.needsUpdate=!0,t&&t(a)},i,s);return a}}class Tc extends ri{constructor(e){super(e)}load(e,t,i,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Hs.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a=Ec("img");function l(){h(),Hs.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(u){h(),s&&s(u),r.manager.itemError(e),r.manager.itemEnd(e)}function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class XT extends ri{constructor(e){super(e)}load(e,t,i,s){const r=new Yc;r.colorSpace=gn;const o=new Tc(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(h){r.images[c]=h,a++,a===6&&(r.needsUpdate=!0,t&&t(r))},void 0,s)}for(let c=0;c<e.length;++c)l(c);return r}}class qT extends ri{constructor(e){super(e)}load(e,t,i,s){const r=this,o=new ds,a=new ts(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,function(l){let c;try{c=r.parse(l)}catch(h){if(s!==void 0)s(h);else{console.error(h);return}}c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:xi,o.wrapT=c.wrapT!==void 0?c.wrapT:xi,o.magFilter=c.magFilter!==void 0?c.magFilter:sn,o.minFilter=c.minFilter!==void 0?c.minFilter:sn,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(o.colorSpace=c.colorSpace),c.flipY!==void 0&&(o.flipY=c.flipY),c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=ki),c.mipmapCount===1&&(o.minFilter=sn),c.generateMipmaps!==void 0&&(o.generateMipmaps=c.generateMipmaps),o.needsUpdate=!0,t&&t(o,c)},i,s),o}}class bE extends ri{constructor(e){super(e)}load(e,t,i,s){const r=new Wt,o=new Tc(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},i,s),r}}class Hr extends ft{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ve(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class xE extends Hr{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ft.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ve(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Vf=new De,B0=new R,V0=new R;class ag{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ee(512,512),this.map=null,this.mapPass=null,this.matrix=new De,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Qc,this._frameExtents=new ee(1,1),this._viewportCount=1,this._viewports=[new ct(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;B0.setFromMatrixPosition(e.matrixWorld),t.position.copy(B0),V0.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(V0),t.updateMatrixWorld(),Vf.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Vf),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Vf)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class KT extends ag{constructor(){super(new _n(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=tl*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||s!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=s,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class lg extends Hr{constructor(e,t,i=0,s=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ft.DEFAULT_UP),this.updateMatrix(),this.target=new ft,this.distance=i,this.angle=s,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new KT}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const z0=new De,zl=new R,zf=new R;class YT extends ag{constructor(){super(new _n(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ee(4,2),this._viewportCount=6,this._viewports=[new ct(2,1,1,1),new ct(0,1,1,1),new ct(3,1,1,1),new ct(1,1,1,1),new ct(3,0,1,1),new ct(1,0,1,1)],this._cubeDirections=[new R(1,0,0),new R(-1,0,0),new R(0,0,1),new R(0,0,-1),new R(0,1,0),new R(0,-1,0)],this._cubeUps=[new R(0,1,0),new R(0,1,0),new R(0,1,0),new R(0,1,0),new R(0,0,1),new R(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,s=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),zl.setFromMatrixPosition(e.matrixWorld),i.position.copy(zl),zf.copy(i.position),zf.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(zf),i.updateMatrixWorld(),s.makeTranslation(-zl.x,-zl.y,-zl.z),z0.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(z0)}}class cg extends Hr{constructor(e,t,i=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new YT}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class ml extends lp{constructor(e=-1,t=1,i=1,s=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=s,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,s,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-e,o=i+e,a=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class ZT extends ag{constructor(){super(new ml(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class hg extends Hr{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ft.DEFAULT_UP),this.updateMatrix(),this.target=new ft,this.shadow=new ZT}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class yE extends Hr{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class wE extends Hr{constructor(e,t,i=10,s=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class EE{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new R)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,s=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*s),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],1.092548*(i*s)),t.addScaledVector(o[5],1.092548*(s*r)),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],1.092548*(i*r)),t.addScaledVector(o[8],.546274*(i*i-s*s)),t}getIrradianceAt(e,t){const i=e.x,s=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*s),t.addScaledVector(o[2],2*.511664*r),t.addScaledVector(o[3],2*.511664*i),t.addScaledVector(o[4],2*.429043*i*s),t.addScaledVector(o[5],2*.429043*s*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],2*.429043*i*r),t.addScaledVector(o[8],.429043*(i*i-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].fromArray(e,t+s*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].toArray(e,t+s*3);return e}static getBasisAt(e,t){const i=e.x,s=e.y,r=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*r,t[3]=.488603*i,t[4]=1.092548*i*s,t[5]=1.092548*s*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*i*r,t[8]=.546274*(i*i-s*s)}}class ME extends Hr{constructor(e=new EE,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Tp extends ri{constructor(e){super(e),this.textures={}}load(e,t,i,s){const r=this,o=new ts(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},i,s)}parse(e){const t=this.textures;function i(r){return t[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),t[r]}const s=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(s.uuid=e.uuid),e.name!==void 0&&(s.name=e.name),e.color!==void 0&&s.color!==void 0&&s.color.setHex(e.color),e.roughness!==void 0&&(s.roughness=e.roughness),e.metalness!==void 0&&(s.metalness=e.metalness),e.sheen!==void 0&&(s.sheen=e.sheen),e.sheenColor!==void 0&&(s.sheenColor=new ve().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(s.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(e.emissive),e.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(e.specular),e.specularIntensity!==void 0&&(s.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(s.shininess=e.shininess),e.clearcoat!==void 0&&(s.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(s.dispersion=e.dispersion),e.iridescence!==void 0&&(s.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(s.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(s.transmission=e.transmission),e.thickness!==void 0&&(s.thickness=e.thickness),e.attenuationDistance!==void 0&&(s.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(s.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(s.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.combine!==void 0&&(s.combine=e.combine),e.side!==void 0&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.opacity!==void 0&&(s.opacity=e.opacity),e.transparent!==void 0&&(s.transparent=e.transparent),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(s.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(s.depthFunc=e.depthFunc),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(s.blendSrc=e.blendSrc),e.blendDst!==void 0&&(s.blendDst=e.blendDst),e.blendEquation!==void 0&&(s.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(s.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(s.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(s.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&s.blendColor!==void 0&&s.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(s.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(s.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(s.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(s.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(s.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(s.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(s.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(s.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(s.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.linewidth!==void 0&&(s.linewidth=e.linewidth),e.dashSize!==void 0&&(s.dashSize=e.dashSize),e.gapSize!==void 0&&(s.gapSize=e.gapSize),e.scale!==void 0&&(s.scale=e.scale),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(s.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(s.visible=e.visible),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.userData!==void 0&&(s.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const r in e.uniforms){const o=e.uniforms[r];switch(s.uniforms[r]={},o.type){case"t":s.uniforms[r].value=i(o.value);break;case"c":s.uniforms[r].value=new ve().setHex(o.value);break;case"v2":s.uniforms[r].value=new ee().fromArray(o.value);break;case"v3":s.uniforms[r].value=new R().fromArray(o.value);break;case"v4":s.uniforms[r].value=new ct().fromArray(o.value);break;case"m3":s.uniforms[r].value=new Je().fromArray(o.value);break;case"m4":s.uniforms[r].value=new De().fromArray(o.value);break;default:s.uniforms[r].value=o.value}}if(e.defines!==void 0&&(s.defines=e.defines),e.vertexShader!==void 0&&(s.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(s.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(s.glslVersion=e.glslVersion),e.extensions!==void 0)for(const r in e.extensions)s.extensions[r]=e.extensions[r];if(e.lights!==void 0&&(s.lights=e.lights),e.clipping!==void 0&&(s.clipping=e.clipping),e.size!==void 0&&(s.size=e.size),e.sizeAttenuation!==void 0&&(s.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(s.map=i(e.map)),e.matcap!==void 0&&(s.matcap=i(e.matcap)),e.alphaMap!==void 0&&(s.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(s.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(s.bumpScale=e.bumpScale),e.normalMap!==void 0&&(s.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(s.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),s.normalScale=new ee().fromArray(r)}return e.displacementMap!==void 0&&(s.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(s.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(s.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(s.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(s.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(s.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(s.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(s.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(s.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(s.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(s.envMap=i(e.envMap)),e.envMapRotation!==void 0&&s.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(s.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(s.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(s.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(s.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(s.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(s.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(s.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(s.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(s.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new ee().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(s.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(s.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(s.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(s.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(s.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=i(e.sheenRoughnessMap)),s}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return Tp.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:oE,SpriteMaterial:Wv,RawShaderMaterial:aE,ShaderMaterial:zi,PointsMaterial:dp,MeshPhysicalMaterial:Wi,MeshStandardMaterial:pl,MeshPhongMaterial:lE,MeshToonMaterial:cE,MeshNormalMaterial:hE,MeshLambertMaterial:uE,MeshDepthMaterial:tg,MeshDistanceMaterial:ng,MeshBasicMaterial:yi,MeshMatcapMaterial:dE,LineDashedMaterial:pE,LineBasicMaterial:$n,Material:En};return new t[e]}}class Sr{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class SE extends Ye{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class CE extends ri{constructor(e){super(e)}load(e,t,i,s){const r=this,o=new ts(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(a){try{t(r.parse(JSON.parse(a)))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},i,s)}parse(e){const t={},i={};function s(p,f){if(t[f]!==void 0)return t[f];const m=p.interleavedBuffers[f],v=r(p,m.buffer),x=Oa(m.type,v),b=new Zc(x,m.stride);return b.uuid=m.uuid,t[f]=b,b}function r(p,f){if(i[f]!==void 0)return i[f];const m=p.arrayBuffers[f],v=new Uint32Array(m).buffer;return i[f]=v,v}const o=e.isInstancedBufferGeometry?new SE:new Ye,a=e.data.index;if(a!==void 0){const p=Oa(a.type,a.array);o.setIndex(new dt(p,1))}const l=e.data.attributes;for(const p in l){const f=l[p];let g;if(f.isInterleavedBufferAttribute){const m=s(e.data,f.data);g=new Lr(m,f.itemSize,f.offset,f.normalized)}else{const m=Oa(f.type,f.array),v=f.isInstancedBufferAttribute?No:dt;g=new v(m,f.itemSize,f.normalized)}f.name!==void 0&&(g.name=f.name),f.usage!==void 0&&g.setUsage(f.usage),o.setAttribute(p,g)}const c=e.data.morphAttributes;if(c)for(const p in c){const f=c[p],g=[];for(let m=0,v=f.length;m<v;m++){const x=f[m];let b;if(x.isInterleavedBufferAttribute){const _=s(e.data,x.data);b=new Lr(_,x.itemSize,x.offset,x.normalized)}else{const _=Oa(x.type,x.array);b=new dt(_,x.itemSize,x.normalized)}x.name!==void 0&&(b.name=x.name),g.push(b)}o.morphAttributes[p]=g}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==void 0)for(let p=0,f=u.length;p!==f;++p){const g=u[p];o.addGroup(g.start,g.count,g.materialIndex)}const d=e.data.boundingSphere;if(d!==void 0){const p=new R;d.center!==void 0&&p.fromArray(d.center),o.boundingSphere=new wn(p,d.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class JT extends ri{constructor(e){super(e)}load(e,t,i,s){const r=this,o=this.path===""?Sr.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new ts(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(u){s!==void 0&&s(u),console.error("THREE:ObjectLoader: Can't parse "+e+".",u.message);return}const h=c.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry"){s!==void 0&&s(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(c,t)},i,s)}async loadAsync(e,t){const i=this,s=this.path===""?Sr.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const r=new ts(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const o=await r.loadAsync(e,t),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(a)}parse(e,t){const i=this.parseAnimations(e.animations),s=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,s),o=this.parseImages(e.images,function(){t!==void 0&&t(c)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,r,l,a,i),h=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,h),this.bindLightTargets(c),t!==void 0){let u=!1;for(const d in o)if(o[d].data instanceof HTMLImageElement){u=!0;break}u===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,i),r=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,s,a,o,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),this.bindLightTargets(l),l}parseShapes(e){const t={};if(e!==void 0)for(let i=0,s=e.length;i<s;i++){const r=new Lo().fromJSON(e[i]);t[r.uuid]=r}return t}parseSkeletons(e,t){const i={},s={};if(t.traverse(function(r){r.isBone&&(s[r.uuid]=r)}),e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=new Jc().fromJSON(e[r],s);i[a.uuid]=a}return i}parseGeometries(e,t){const i={};if(e!==void 0){const s=new CE;for(let r=0,o=e.length;r<o;r++){let a;const l=e[r];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=s.parse(l);break;default:l.type in F0?a=F0[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),i[l.uuid]=a}}return i}parseMaterials(e,t){const i={},s={};if(e!==void 0){const r=new Tp;r.setTextures(t);for(let o=0,a=e.length;o<a;o++){const l=e[o];i[l.uuid]===void 0&&(i[l.uuid]=r.parse(l)),s[l.uuid]=i[l.uuid]}}return s}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const s=e[i],r=sl.parse(s);t[r.uuid]=r}return t}parseImages(e,t){const i=this,s={};let r;function o(l){return i.manager.itemStart(l),r.load(l,function(){i.manager.itemEnd(l)},void 0,function(){i.manager.itemError(l),i.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const c=l,h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:i.resourcePath+c;return o(h)}else return l.data?{data:Oa(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new og(t);r=new Tc(l),r.setCrossOrigin(this.crossOrigin);for(let c=0,h=e.length;c<h;c++){const u=e[c],d=u.url;if(Array.isArray(d)){const p=[];for(let f=0,g=d.length;f<g;f++){const m=d[f],v=a(m);v!==null&&(v instanceof HTMLImageElement?p.push(v):p.push(new ds(v.data,v.width,v.height)))}s[u.uuid]=new Er(p)}else{const p=a(u.url);s[u.uuid]=new Er(p)}}}return s}async parseImagesAsync(e){const t=this,i={};let s;async function r(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await s.loadAsync(l)}else return o.data?{data:Oa(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){s=new Tc(this.manager),s.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],c=l.url;if(Array.isArray(c)){const h=[];for(let u=0,d=c.length;u<d;u++){const p=c[u],f=await r(p);f!==null&&(f instanceof HTMLImageElement?h.push(f):h.push(new ds(f.data,f.width,f.height)))}i[l.uuid]=new Er(h)}else{const h=await r(l.url);i[l.uuid]=new Er(h)}}}return i}parseTextures(e,t){function i(r,o){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),o[r])}const s={};if(e!==void 0)for(let r=0,o=e.length;r<o;r++){const a=e[r];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=t[a.image],c=l.data;let h;Array.isArray(c)?(h=new Yc,c.length===6&&(h.needsUpdate=!0)):(c&&c.data?h=new ds:h=new Wt,c&&(h.needsUpdate=!0)),h.source=l,h.uuid=a.uuid,a.name!==void 0&&(h.name=a.name),a.mapping!==void 0&&(h.mapping=i(a.mapping,QT)),a.channel!==void 0&&(h.channel=a.channel),a.offset!==void 0&&h.offset.fromArray(a.offset),a.repeat!==void 0&&h.repeat.fromArray(a.repeat),a.center!==void 0&&h.center.fromArray(a.center),a.rotation!==void 0&&(h.rotation=a.rotation),a.wrap!==void 0&&(h.wrapS=i(a.wrap[0],H0),h.wrapT=i(a.wrap[1],H0)),a.format!==void 0&&(h.format=a.format),a.internalFormat!==void 0&&(h.internalFormat=a.internalFormat),a.type!==void 0&&(h.type=a.type),a.colorSpace!==void 0&&(h.colorSpace=a.colorSpace),a.minFilter!==void 0&&(h.minFilter=i(a.minFilter,G0)),a.magFilter!==void 0&&(h.magFilter=i(a.magFilter,G0)),a.anisotropy!==void 0&&(h.anisotropy=a.anisotropy),a.flipY!==void 0&&(h.flipY=a.flipY),a.generateMipmaps!==void 0&&(h.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(h.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(h.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(h.compareFunction=a.compareFunction),a.userData!==void 0&&(h.userData=a.userData),s[a.uuid]=h}return s}parseObject(e,t,i,s,r){let o;function a(d){return t[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),t[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const p=[];for(let f=0,g=d.length;f<g;f++){const m=d[f];i[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",m),p.push(i[m])}return p}return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),i[d]}}function c(d){return s[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),s[d]}let h,u;switch(e.type){case"Scene":o=new Gv,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new ve(e.background):o.background=c(e.background)),e.environment!==void 0&&(o.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new hp(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new cp(e.fog.color,e.fog.density)),e.fog.name!==""&&(o.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&o.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(o.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&o.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":o=new _n(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new ml(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new yE(e.color,e.intensity);break;case"DirectionalLight":o=new hg(e.color,e.intensity),o.target=e.target||"";break;case"PointLight":o=new cg(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new wE(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new lg(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),o.target=e.target||"";break;case"HemisphereLight":o=new xE(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new ME().fromJSON(e);break;case"SkinnedMesh":h=a(e.geometry),u=l(e.material),o=new $v(h,u),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":h=a(e.geometry),u=l(e.material),o=new Kt(h,u);break;case"InstancedMesh":h=a(e.geometry),u=l(e.material);const d=e.count,p=e.instanceMatrix,f=e.instanceColor;o=new jv(h,u,d),o.instanceMatrix=new No(new Float32Array(p.array),16),f!==void 0&&(o.instanceColor=new No(new Float32Array(f.array),f.itemSize));break;case"BatchedMesh":h=a(e.geometry),u=l(e.material),o=new Xw(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,u),o.geometry=h,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map(g=>{const m=new yn;m.min.fromArray(g.boxMin),m.max.fromArray(g.boxMax);const v=new wn;return v.radius=g.sphereRadius,v.center.fromArray(g.sphereCenter),{boxInitialized:g.boxInitialized,box:m,sphereInitialized:g.sphereInitialized,sphere:v}}),o._maxInstanceCount=e.maxInstanceCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=c(e.matricesTexture.uuid),e.colorsTexture!==void 0&&(o._colorsTexture=c(e.colorsTexture.uuid));break;case"LOD":o=new jw;break;case"Line":o=new Js(a(e.geometry),l(e.material));break;case"LineLoop":o=new Xv(a(e.geometry),l(e.material));break;case"LineSegments":o=new ns(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new pp(a(e.geometry),l(e.material));break;case"Sprite":o=new $w(l(e.material));break;case"Group":o=new wi;break;case"Bone":o=new up;break;default:o=new ft}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(o.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const d=e.children;for(let p=0;p<d.length;p++)o.add(this.parseObject(d[p],t,i,s,r))}if(e.animations!==void 0){const d=e.animations;for(let p=0;p<d.length;p++){const f=d[p];o.animations.push(r[f])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const d=e.levels;for(let p=0;p<d.length;p++){const f=d[p],g=o.getObjectByProperty("uuid",f.object);g!==void 0&&o.addLevel(g,f.distance,f.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const s=t[i.skeleton];s===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(s,i.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const i=t.target,s=e.getObjectByProperty("uuid",i);s!==void 0?t.target=s:t.target=new ft}})}}const QT={UVMapping:Kd,CubeReflectionMapping:Ys,CubeRefractionMapping:Pr,EquirectangularReflectionMapping:gc,EquirectangularRefractionMapping:_c,CubeUVReflectionMapping:hl},H0={RepeatWrapping:Rr,ClampToEdgeWrapping:xi,MirroredRepeatWrapping:qa},G0={NearestFilter:xn,NearestMipmapNearestFilter:Yd,NearestMipmapLinearFilter:wo,LinearFilter:sn,LinearMipmapNearestFilter:Fa,LinearMipmapLinearFilter:ki};class AE extends ri{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Hs.get(e);if(o!==void 0){if(r.manager.itemStart(e),o.then){o.then(c=>{t&&t(c),r.manager.itemEnd(e)}).catch(c=>{s&&s(c)});return}return setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(c){return Hs.add(e,c),t&&t(c),r.manager.itemEnd(e),c}).catch(function(c){s&&s(c),Hs.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)});Hs.add(e,l),r.manager.itemStart(e)}}let au;class ug{static getContext(){return au===void 0&&(au=new(window.AudioContext||window.webkitAudioContext)),au}static setContext(e){au=e}}class eP extends ri{constructor(e){super(e)}load(e,t,i,s){const r=this,o=new ts(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const c=l.slice(0);ug.getContext().decodeAudioData(c,function(u){t(u)}).catch(a)}catch(c){a(c)}},i,s);function a(l){s?s(l):console.error(l),r.manager.itemError(e)}}}const W0=new De,$0=new De,to=new De;class tP{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new _n,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new _n,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,to.copy(e.projectionMatrix);const s=t.eyeSep/2,r=s*t.near/t.focus,o=t.near*Math.tan(Ro*t.fov*.5)/t.zoom;let a,l;$0.elements[12]=-s,W0.elements[12]=s,a=-o*t.aspect+r,l=o*t.aspect+r,to.elements[0]=2*t.near/(l-a),to.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(to),a=-o*t.aspect-r,l=o*t.aspect-r,to.elements[0]=2*t.near/(l-a),to.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(to)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply($0),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(W0)}}class TE extends _n{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e,this.index=0}}class PE{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=j0(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=j0();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function j0(){return performance.now()}const no=new R,X0=new In,nP=new R,io=new R;class iP extends ft{constructor(){super(),this.type="AudioListener",this.context=ug.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new PE}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(no,X0,nP),io.set(0,0,-1).applyQuaternion(X0),t.positionX){const s=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(no.x,s),t.positionY.linearRampToValueAtTime(no.y,s),t.positionZ.linearRampToValueAtTime(no.z,s),t.forwardX.linearRampToValueAtTime(io.x,s),t.forwardY.linearRampToValueAtTime(io.y,s),t.forwardZ.linearRampToValueAtTime(io.z,s),t.upX.linearRampToValueAtTime(i.x,s),t.upY.linearRampToValueAtTime(i.y,s),t.upZ.linearRampToValueAtTime(i.z,s)}else t.setPosition(no.x,no.y,no.z),t.setOrientation(io.x,io.y,io.z,i.x,i.y,i.z)}}class RE extends ft{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),e.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const so=new R,q0=new In,sP=new R,ro=new R;class rP extends RE{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(so,q0,sP),ro.set(0,0,1).applyQuaternion(q0);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(so.x,i),t.positionY.linearRampToValueAtTime(so.y,i),t.positionZ.linearRampToValueAtTime(so.z,i),t.orientationX.linearRampToValueAtTime(ro.x,i),t.orientationY.linearRampToValueAtTime(ro.y,i),t.orientationZ.linearRampToValueAtTime(ro.z,i)}else t.setPosition(so.x,so.y,so.z),t.setOrientation(ro.x,ro.y,ro.z)}}class oP{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class LE{constructor(e,t,i){this.binding=e,this.valueSize=i;let s,r,o;switch(t){case"quaternion":s=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":s=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:s=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,s=this.valueSize,r=e*s+s;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==s;++a)i[r+a]=i[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(i,r,0,a,s)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,s=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,s=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const l=t*this._origIndex;this._mixBufferRegion(i,s,l,1-r,t)}o>0&&this._mixBufferRegionAdditive(i,s,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(i[l]!==i[l+t]){a.setValue(i,s);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,s=i*this._origIndex;e.getValue(t,s);for(let r=i,o=s;r!==o;++r)t[r]=t[s+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,s,r){if(s>=.5)for(let o=0;o!==r;++o)e[t+o]=e[i+o]}_slerp(e,t,i,s){In.slerpFlat(e,t,e,t,e,i,s)}_slerpAdditive(e,t,i,s,r){const o=this._workIndex*r;In.multiplyQuaternionsFlat(e,o,e,t,e,i),In.slerpFlat(e,t,e,t,e,o,s)}_lerp(e,t,i,s,r){const o=1-s;for(let a=0;a!==r;++a){const l=t+a;e[l]=e[l]*o+e[i+a]*s}}_lerpAdditive(e,t,i,s,r){for(let o=0;o!==r;++o){const a=t+o;e[a]=e[a]+e[i+o]*s}}}const dg="\\[\\]\\.:\\/",aP=new RegExp("["+dg+"]","g"),pg="[^"+dg+"]",lP="[^"+dg.replace("\\.","")+"]",cP=/((?:WC+[\/:])*)/.source.replace("WC",pg),hP=/(WCOD+)?/.source.replace("WCOD",lP),uP=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",pg),dP=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",pg),pP=new RegExp("^"+cP+hP+uP+dP+"$"),fP=["material","materials","bones","map"];class mP{constructor(e,t,i){const s=i||gt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=i.length;s!==r;++s)i[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class gt{constructor(e,t,i){this.path=t,this.parsedPath=i||gt.parseTrackName(t),this.node=gt.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new gt.Composite(e,t,i):new gt(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(aP,"")}static parseTrackName(e){const t=pP.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=i.nodeName.substring(s+1);fP.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===t||a.uuid===t)return a;const l=i(a.children);if(l)return l}return null},s=i(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)e[t++]=i[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,s=t.propertyName;let r=t.propertyIndex;if(e||(e=gt.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[s];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+s+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?a=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}gt.Composite=mP;gt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};gt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};gt.prototype.GetterByBindingType=[gt.prototype._getValue_direct,gt.prototype._getValue_array,gt.prototype._getValue_arrayElement,gt.prototype._getValue_toArray];gt.prototype.SetterByBindingTypeAndVersioning=[[gt.prototype._setValue_direct,gt.prototype._setValue_direct_setNeedsUpdate,gt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[gt.prototype._setValue_array,gt.prototype._setValue_array_setNeedsUpdate,gt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[gt.prototype._setValue_arrayElement,gt.prototype._setValue_arrayElement_setNeedsUpdate,gt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[gt.prototype._setValue_fromArray,gt.prototype._setValue_fromArray_setNeedsUpdate,gt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class vP{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Ei(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,s=arguments.length;i!==s;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,s=this._parsedPaths,r=this._bindings,o=r.length;let a,l=e.length,c=this.nCachedObjects_;for(let h=0,u=arguments.length;h!==u;++h){const d=arguments[h],p=d.uuid;let f=t[p];if(f===void 0){f=l++,t[p]=f,e.push(d);for(let g=0,m=o;g!==m;++g)r[g].push(new gt(d,i[g],s[g]))}else if(f<c){a=e[f];const g=--c,m=e[g];t[m.uuid]=f,e[f]=m,t[p]=g,e[g]=d;for(let v=0,x=o;v!==x;++v){const b=r[v],_=b[g];let C=b[f];b[f]=_,C===void 0&&(C=new gt(d,i[v],s[v])),b[g]=C}}else e[f]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,s=i.length;let r=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],c=l.uuid,h=t[c];if(h!==void 0&&h>=r){const u=r++,d=e[u];t[d.uuid]=h,e[h]=d,t[c]=u,e[u]=l;for(let p=0,f=s;p!==f;++p){const g=i[p],m=g[u],v=g[h];g[h]=m,g[u]=v}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,s=i.length;let r=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],h=c.uuid,u=t[h];if(u!==void 0)if(delete t[h],u<r){const d=--r,p=e[d],f=--o,g=e[f];t[p.uuid]=u,e[u]=p,t[g.uuid]=d,e[d]=g,e.pop();for(let m=0,v=s;m!==v;++m){const x=i[m],b=x[d],_=x[f];x[u]=b,x[d]=_,x.pop()}}else{const d=--o,p=e[d];d>0&&(t[p.uuid]=u),e[u]=p,e.pop();for(let f=0,g=s;f!==g;++f){const m=i[f];m[u]=m[d],m.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const i=this._bindingsIndicesByPath;let s=i[e];const r=this._bindings;if(s!==void 0)return r[s];const o=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,h=this.nCachedObjects_,u=new Array(c);s=r.length,i[e]=s,o.push(e),a.push(t),r.push(u);for(let d=h,p=l.length;d!==p;++d){const f=l[d];u[d]=new gt(f,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const s=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],c=e[a];t[c]=i,o[i]=l,o.pop(),r[i]=r[a],r.pop(),s[i]=s[a],s.pop()}}}class IE{constructor(e,t,i=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=s;const r=t.tracks,o=r.length,a=new Array(o),l={endingStart:Eo,endingEnd:Eo};for(let c=0;c!==o;++c){const h=r[c].createInterpolant(null);a[c]=h,h.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=ww,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i=!1){if(e.fadeOut(t),this.fadeIn(t),i===!0){const s=this._clip.duration,r=e._clip.duration,o=r/s,a=s/r;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i=!1){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const s=this._mixer,r=s.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=s._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=r,l[1]=r+i,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,s){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const l=(e-r)*i;l<0||i===0?t=0:(this._startTime=null,t=i*l)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case kv:for(let h=0,u=l.length;h!==u;++h)l[h].evaluate(o),c[h].accumulateAdditive(a);break;case ip:default:for(let h=0,u=l.length;h!==u;++h)l[h].evaluate(o),c[h].accumulate(s,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let s=this.time+e,r=this._loopCount;const o=i===Ew;if(e===0)return r===-1?s:o&&(r&1)===1?t-s:s;if(i===yw){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),s>=t||s<0){const a=Math.floor(s/t);s-=t*a,r+=Math.abs(a);const l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=s;if(o&&(r&1)===1)return t-s}return s}_setEndings(e,t,i){const s=this._interpolantSettings;i?(s.endingStart=Mo,s.endingEnd=Mo):(e?s.endingStart=this.zeroSlopeAtStart?Mo:Eo:s.endingStart=bc,t?s.endingEnd=this.zeroSlopeAtEnd?Mo:Eo:s.endingEnd=bc)}_scheduleFading(e,t,i){const s=this._mixer,r=s.time;let o=this._weightInterpolant;o===null&&(o=s._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,l[0]=t,a[1]=r+e,l[1]=i,this}}const gP=new Float32Array(1);class DE extends Es{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,s=e._clip.tracks,r=s.length,o=e._propertyBindings,a=e._interpolants,l=i.uuid,c=this._bindingsByRootAndName;let h=c[l];h===void 0&&(h={},c[l]=h);for(let u=0;u!==r;++u){const d=s[u],p=d.name;let f=h[p];if(f!==void 0)++f.referenceCount,o[u]=f;else{if(f=o[u],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,l,p));continue}const g=t&&t._propertyBindings[u].binding.parsedPath;f=new LE(gt.create(i,p,g),d.ValueTypeName,d.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,l,p),o[u]=f}a[u].resultBuffer=f.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,s=e._clip.uuid,r=this._actionsByClip[s];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,s,i)}const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const r=t[i];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const r=t[i];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const s=this._actions,r=this._actionsByClip;let o=r[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=s.length,s.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],s=e._cacheIndex;i._cacheIndex=s,t[s]=i,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,a=o[r],l=a.knownActions,c=l[l.length-1],h=e._byClipCacheIndex;c._byClipCacheIndex=h,l[h]=c,l.pop(),e._byClipCacheIndex=null;const u=a.actionByRoot,d=(e._localRoot||this._root).uuid;delete u[d],l.length===0&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const r=t[i];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,s=this._nActiveActions++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,s=--this._nActiveActions,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){const s=this._bindingsByRootAndName,r=this._bindings;let o=s[t];o===void 0&&(o={},s[t]=o),o[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,s=i.rootNode.uuid,r=i.path,o=this._bindingsByRootAndName,a=o[s],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[r],Object.keys(a).length===0&&delete o[s]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,s=this._nActiveBindings++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,s=--this._nActiveBindings,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new sg(new Float32Array(2),new Float32Array(2),1,gP),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,s=--this._nActiveControlInterpolants,r=t[s];e.__cacheIndex=s,t[s]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){const s=t||this._root,r=s.uuid;let o=typeof e=="string"?sl.findByName(s,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(i===void 0&&(o!==null?i=o.blendMode:i=ip),l!==void 0){const u=l.actionByRoot[r];if(u!==void 0&&u.blendMode===i)return u;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const h=new IE(this,o,t,i);return this._bindAction(h,c),this._addInactiveAction(h,a,r),h}existingAction(e,t){const i=t||this._root,s=i.uuid,r=typeof e=="string"?sl.findByName(i,e):e,o=r?r.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[s]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,s=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==i;++c)t[c]._update(s,e,r,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,s=this._actionsByClip,r=s[i];if(r!==void 0){const o=r.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const h=c._cacheIndex,u=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,u._cacheIndex=h,t[h]=u,t.pop(),this._removeInactiveBindingsForAction(c)}delete s[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const o in i){const a=i[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const s=this._bindingsByRootAndName,r=s[t];if(r!==void 0)for(const o in r){const a=r[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class _P extends rp{constructor(e=1,t=1,i=1,s={}){super(e,t,s),this.isRenderTarget3D=!0,this.depth=i,this.texture=new op(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class bP extends rp{constructor(e=1,t=1,i=1,s={}){super(e,t,s),this.isRenderTargetArray=!0,this.depth=i,this.texture=new Kc(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class fg{constructor(e){this.value=e}clone(){return new fg(this.value.clone===void 0?this.value:this.value.clone())}}let xP=0;class yP extends Es{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:xP++}),this.name="",this.usage=yc,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,s=t.length;i<s;i++){const r=Array.isArray(t[i])?t[i]:[t[i]];for(let o=0;o<r.length;o++)this.uniforms.push(r[o].clone())}return this}clone(){return new this.constructor().copy(this)}}class wP extends Zc{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class EP{constructor(e,t,i,s,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=s,this.count=r,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const K0=new De;class mg{constructor(e,t,i=0,s=1/0){this.ray=new Br(e,t),this.near=i,this.far=s,this.camera=null,this.layers=new ap,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return K0.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(K0),this}intersectObject(e,t=!0,i=[]){return Km(e,this,i,t),i.sort(Y0),i}intersectObjects(e,t=!0,i=[]){for(let s=0,r=e.length;s<r;s++)Km(e[s],this,i,t);return i.sort(Y0),i}}function Y0(n,e){return n.distance-e.distance}function Km(n,e,t,i){let s=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(s=!1),s===!0&&i===!0){const r=n.children;for(let o=0,a=r.length;o<a;o++)Km(r[o],e,t,!0)}}class Ld{constructor(e=1,t=0,i=0){this.radius=e,this.phi=t,this.theta=i}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Ke(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Ke(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class MP{constructor(e=1,t=0,i=0){this.radius=e,this.theta=t,this.y=i}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}class vg{constructor(e,t,i,s){vg.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,i,s)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let i=0;i<4;i++)this.elements[i]=e[i+t];return this}set(e,t,i,s){const r=this.elements;return r[0]=e,r[2]=t,r[1]=i,r[3]=s,this}}const Z0=new ee;class SP{constructor(e=new ee(1/0,1/0),t=new ee(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Z0.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Z0).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const J0=new R,lu=new R;class NE{constructor(e=new R,t=new R){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){J0.subVectors(e,this.start),lu.subVectors(this.end,this.start);const i=lu.dot(lu);let r=lu.dot(J0)/i;return t&&(r=Ke(r,0,1)),r}closestPointToPoint(e,t,i){const s=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Q0=new R;class CP extends ft{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new Ye,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,h=a/l*Math.PI*2;s.push(Math.cos(c),Math.sin(c),1,Math.cos(h),Math.sin(h),1)}i.setAttribute("position",new Te(s,3));const r=new $n({fog:!1,toneMapped:!1});this.cone=new ns(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Q0.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Q0),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const cr=new R,cu=new De,Hf=new De;class AP extends ns{constructor(e){const t=OE(e),i=new Ye,s=[],r=[],o=new ve(0,0,1),a=new ve(0,1,0);for(let c=0;c<t.length;c++){const h=t[c];h.parent&&h.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}i.setAttribute("position",new Te(s,3)),i.setAttribute("color",new Te(r,3));const l=new $n({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,s=i.getAttribute("position");Hf.copy(this.root.matrixWorld).invert();for(let r=0,o=0;r<t.length;r++){const a=t[r];a.parent&&a.parent.isBone&&(cu.multiplyMatrices(Hf,a.matrixWorld),cr.setFromMatrixPosition(cu),s.setXYZ(o,cr.x,cr.y,cr.z),cu.multiplyMatrices(Hf,a.parent.matrixWorld),cr.setFromMatrixPosition(cu),s.setXYZ(o+1,cr.x,cr.y,cr.z),o+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function OE(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push(...OE(n.children[t]));return e}class TP extends Kt{constructor(e,t,i){const s=new nh(t,4,2),r=new yi({wireframe:!0,fog:!1,toneMapped:!1});super(s,r),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const PP=new R,eb=new ve,tb=new ve;class RP extends ft{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const s=new th(t);s.rotateY(Math.PI*.5),this.material=new yi({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=s.getAttribute("position"),o=new Float32Array(r.count*3);s.setAttribute("color",new dt(o,3)),this.add(new Kt(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");eb.copy(this.light.color),tb.copy(this.light.groundColor);for(let i=0,s=t.count;i<s;i++){const r=i<s/2?eb:tb;t.setXYZ(i,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(PP.setFromMatrixPosition(this.light.matrixWorld).negate())}}class LP extends ns{constructor(e=10,t=10,i=4473924,s=8947848){i=new ve(i),s=new ve(s);const r=t/2,o=e/t,a=e/2,l=[],c=[];for(let d=0,p=0,f=-a;d<=t;d++,f+=o){l.push(-a,0,f,a,0,f),l.push(f,0,-a,f,0,a);const g=d===r?i:s;g.toArray(c,p),p+=3,g.toArray(c,p),p+=3,g.toArray(c,p),p+=3,g.toArray(c,p),p+=3}const h=new Ye;h.setAttribute("position",new Te(l,3)),h.setAttribute("color",new Te(c,3));const u=new $n({vertexColors:!0,toneMapped:!1});super(h,u),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class IP extends ns{constructor(e=10,t=16,i=8,s=64,r=4473924,o=8947848){r=new ve(r),o=new ve(o);const a=[],l=[];if(t>1)for(let u=0;u<t;u++){const d=u/t*(Math.PI*2),p=Math.sin(d)*e,f=Math.cos(d)*e;a.push(0,0,0),a.push(p,0,f);const g=u&1?r:o;l.push(g.r,g.g,g.b),l.push(g.r,g.g,g.b)}for(let u=0;u<i;u++){const d=u&1?r:o,p=e-e/i*u;for(let f=0;f<s;f++){let g=f/s*(Math.PI*2),m=Math.sin(g)*p,v=Math.cos(g)*p;a.push(m,0,v),l.push(d.r,d.g,d.b),g=(f+1)/s*(Math.PI*2),m=Math.sin(g)*p,v=Math.cos(g)*p,a.push(m,0,v),l.push(d.r,d.g,d.b)}}const c=new Ye;c.setAttribute("position",new Te(a,3)),c.setAttribute("color",new Te(l,3));const h=new $n({vertexColors:!0,toneMapped:!1});super(c,h),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const nb=new R,hu=new R,ib=new R;class DP extends ft{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let s=new Ye;s.setAttribute("position",new Te([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new $n({fog:!1,toneMapped:!1});this.lightPlane=new Js(s,r),this.add(this.lightPlane),s=new Ye,s.setAttribute("position",new Te([0,0,0,0,0,1],3)),this.targetLine=new Js(s,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),nb.setFromMatrixPosition(this.light.matrixWorld),hu.setFromMatrixPosition(this.light.target.matrixWorld),ib.subVectors(hu,nb),this.lightPlane.lookAt(hu),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(hu),this.targetLine.scale.z=ib.length()}}const uu=new R,tn=new lp;class NP extends ns{constructor(e){const t=new Ye,i=new $n({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],r=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(f,g){l(f),l(g)}function l(f){s.push(0,0,0),r.push(0,0,0),o[f]===void 0&&(o[f]=[]),o[f].push(s.length/3-1)}t.setAttribute("position",new Te(s,3)),t.setAttribute("color",new Te(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new ve(16755200),h=new ve(16711680),u=new ve(43775),d=new ve(16777215),p=new ve(3355443);this.setColors(c,h,u,d,p)}setColors(e,t,i,s,r){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,s.r,s.g,s.b),a.setXYZ(39,s.r,s.g,s.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,i=1,s=1;tn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const r=this.camera.coordinateSystem===Ji?-1:0;rn("c",t,e,tn,0,0,r),rn("t",t,e,tn,0,0,1),rn("n1",t,e,tn,-1,-1,r),rn("n2",t,e,tn,i,-1,r),rn("n3",t,e,tn,-1,s,r),rn("n4",t,e,tn,i,s,r),rn("f1",t,e,tn,-1,-1,1),rn("f2",t,e,tn,i,-1,1),rn("f3",t,e,tn,-1,s,1),rn("f4",t,e,tn,i,s,1),rn("u1",t,e,tn,i*.7,s*1.1,r),rn("u2",t,e,tn,-1*.7,s*1.1,r),rn("u3",t,e,tn,0,s*2,r),rn("cf1",t,e,tn,-1,0,1),rn("cf2",t,e,tn,i,0,1),rn("cf3",t,e,tn,0,-1,1),rn("cf4",t,e,tn,0,s,1),rn("cn1",t,e,tn,-1,0,r),rn("cn2",t,e,tn,i,0,r),rn("cn3",t,e,tn,0,-1,r),rn("cn4",t,e,tn,0,s,r),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function rn(n,e,t,i,s,r,o){uu.set(s,r,o).unproject(i);const a=e[n];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,h=a.length;c<h;c++)l.setXYZ(a[c],uu.x,uu.y,uu.z)}}const du=new yn;class OP extends ns{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Float32Array(8*3),r=new Ye;r.setIndex(new dt(i,1)),r.setAttribute("position",new dt(s,3)),super(r,new $n({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&du.setFromObject(this.object),du.isEmpty())return;const e=du.min,t=du.max,i=this.geometry.attributes.position,s=i.array;s[0]=t.x,s[1]=t.y,s[2]=t.z,s[3]=e.x,s[4]=t.y,s[5]=t.z,s[6]=e.x,s[7]=e.y,s[8]=t.z,s[9]=t.x,s[10]=e.y,s[11]=t.z,s[12]=t.x,s[13]=t.y,s[14]=e.z,s[15]=e.x,s[16]=t.y,s[17]=e.z,s[18]=e.x,s[19]=e.y,s[20]=e.z,s[21]=t.x,s[22]=e.y,s[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class kP extends ns{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new Ye;r.setIndex(new dt(i,1)),r.setAttribute("position",new Te(s,3)),super(r,new $n({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class UP extends Js{constructor(e,t=1,i=16776960){const s=i,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new Ye;o.setAttribute("position",new Te(r,3)),o.computeBoundingSphere(),super(o,new $n({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new Ye;l.setAttribute("position",new Te(a,3)),l.computeBoundingSphere(),this.add(new Kt(l,new yi({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const sb=new R;let pu,Gf;class FP extends ft{constructor(e=new R(0,0,1),t=new R(0,0,0),i=1,s=16776960,r=i*.2,o=r*.2){super(),this.type="ArrowHelper",pu===void 0&&(pu=new Ye,pu.setAttribute("position",new Te([0,0,0,0,1,0],3)),Gf=new dl(0,.5,1,5,1),Gf.translate(0,-.5,0)),this.position.copy(t),this.line=new Js(pu,new $n({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Kt(Gf,new yi({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{sb.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(sb,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class BP extends ns{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new Ye;s.setAttribute("position",new Te(t,3)),s.setAttribute("color",new Te(i,3));const r=new $n({vertexColors:!0,toneMapped:!1});super(s,r),this.type="AxesHelper"}setColors(e,t,i){const s=new ve,r=this.geometry.attributes.color.array;return s.set(e),s.toArray(r,0),s.toArray(r,3),s.set(t),s.toArray(r,6),s.toArray(r,9),s.set(i),s.toArray(r,12),s.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class VP{constructor(){this.type="ShapePath",this.color=new ve,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Mc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,s){return this.currentPath.quadraticCurveTo(e,t,i,s),this}bezierCurveTo(e,t,i,s,r,o){return this.currentPath.bezierCurveTo(e,t,i,s,r,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(v){const x=[];for(let b=0,_=v.length;b<_;b++){const C=v[b],M=new Lo;M.curves=C.curves,x.push(M)}return x}function i(v,x){const b=x.length;let _=!1;for(let C=b-1,M=0;M<b;C=M++){let S=x[C],P=x[M],E=P.x-S.x,y=P.y-S.y;if(Math.abs(y)>Number.EPSILON){if(y<0&&(S=x[M],E=-E,P=x[C],y=-y),v.y<S.y||v.y>P.y)continue;if(v.y===S.y){if(v.x===S.x)return!0}else{const L=y*(v.x-S.x)-E*(v.y-S.y);if(L===0)return!0;if(L<0)continue;_=!_}}else{if(v.y!==S.y)continue;if(P.x<=v.x&&v.x<=S.x||S.x<=v.x&&v.x<=P.x)return!0}}return _}const s=ps.isClockWise,r=this.subPaths;if(r.length===0)return[];let o,a,l;const c=[];if(r.length===1)return a=r[0],l=new Lo,l.curves=a.curves,c.push(l),c;let h=!s(r[0].getPoints());h=e?!h:h;const u=[],d=[];let p=[],f=0,g;d[f]=void 0,p[f]=[];for(let v=0,x=r.length;v<x;v++)a=r[v],g=a.getPoints(),o=s(g),o=e?!o:o,o?(!h&&d[f]&&f++,d[f]={s:new Lo,p:g},d[f].s.curves=a.curves,h&&f++,p[f]=[]):p[f].push({h:a,p:g[0]});if(!d[0])return t(r);if(d.length>1){let v=!1,x=0;for(let b=0,_=d.length;b<_;b++)u[b]=[];for(let b=0,_=d.length;b<_;b++){const C=p[b];for(let M=0;M<C.length;M++){const S=C[M];let P=!0;for(let E=0;E<d.length;E++)i(S.p,d[E].p)&&(b!==E&&x++,P?(P=!1,u[E].push(S)):v=!0);P&&u[b].push(S)}}x>0&&v===!1&&(p=u)}let m;for(let v=0,x=d.length;v<x;v++){l=d[v].s,c.push(l),m=p[v];for(let b=0,_=m.length;b<_;b++)l.holes.push(m[b].h)}return c}}class kE extends Es{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function zP(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2):(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0),n}function HP(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0):(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2),n}function GP(n){return n.repeat.x=1,n.repeat.y=1,n.offset.x=0,n.offset.y=0,n}function Ym(n,e,t,i){const s=WP(i);switch(t){case Rv:return n*e;case Iv:return n*e;case Dv:return n*e*2;case ep:return n*e/s.components*s.byteLength;case qc:return n*e/s.components*s.byteLength;case Nv:return n*e*2/s.components*s.byteLength;case tp:return n*e*2/s.components*s.byteLength;case Lv:return n*e*3/s.components*s.byteLength;case ei:return n*e*4/s.components*s.byteLength;case np:return n*e*4/s.components*s.byteLength;case oc:case ac:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case lc:case cc:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case nd:case sd:return Math.max(n,16)*Math.max(e,8)/4;case td:case id:return Math.max(n,8)*Math.max(e,8)/2;case rd:case od:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case ad:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case ld:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case cd:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case hd:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case ud:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case dd:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case pd:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case fd:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case md:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case vd:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case gd:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case _d:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case bd:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case xd:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case yd:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case hc:case wd:case Ed:return Math.ceil(n/4)*Math.ceil(e/4)*16;case Ov:case Md:return Math.ceil(n/4)*Math.ceil(e/4)*8;case Sd:case Cd:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function WP(n){switch(n){case vs:case Av:return{byteLength:1,components:1};case Ka:case Tv:case ul:return{byteLength:2,components:1};case Jd:case Qd:return{byteLength:2,components:4};case Zs:case Zd:case di:return{byteLength:4,components:1};case Pv:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}class $P{static contain(e,t){return zP(e,t)}static cover(e,t){return HP(e,t)}static fill(e){return GP(e)}static getByteLength(e,t,i,s){return Ym(e,t,i,s)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:qd}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=qd);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function UE(){let n=null,e=!1,t=null,i=null;function s(r,o){t(r,o),i=n.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(s),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){n=r}}}function jP(n){const e=new WeakMap;function t(a,l){const c=a.array,h=a.usage,u=c.byteLength,d=n.createBuffer();n.bindBuffer(l,d),n.bufferData(l,c,h),a.onUploadCallback();let p;if(c instanceof Float32Array)p=n.FLOAT;else if(c instanceof Uint16Array)a.isFloat16BufferAttribute?p=n.HALF_FLOAT:p=n.UNSIGNED_SHORT;else if(c instanceof Int16Array)p=n.SHORT;else if(c instanceof Uint32Array)p=n.UNSIGNED_INT;else if(c instanceof Int32Array)p=n.INT;else if(c instanceof Int8Array)p=n.BYTE;else if(c instanceof Uint8Array)p=n.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)p=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:d,type:p,bytesPerElement:c.BYTES_PER_ELEMENT,version:a.version,size:u}}function i(a,l,c){const h=l.array,u=l.updateRanges;if(n.bindBuffer(c,a),u.length===0)n.bufferSubData(c,0,h);else{u.sort((p,f)=>p.start-f.start);let d=0;for(let p=1;p<u.length;p++){const f=u[d],g=u[p];g.start<=f.start+f.count+1?f.count=Math.max(f.count,g.start+g.count-f.start):(++d,u[d]=g)}u.length=d+1;for(let p=0,f=u.length;p<f;p++){const g=u[p];n.bufferSubData(c,g.start*h.BYTES_PER_ELEMENT,h,g.start,g.count)}l.clearUpdateRanges()}l.onUploadCallback()}function s(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function r(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=e.get(a);l&&(n.deleteBuffer(l.buffer),e.delete(a))}function o(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const h=e.get(a);(!h||h.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const c=e.get(a);if(c===void 0)e.set(a,t(a,l));else if(c.version<a.version){if(c.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(c.buffer,a,l),c.version=a.version}}return{get:s,remove:r,update:o}}var XP=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,qP=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,KP=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,YP=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,ZP=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,JP=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,QP=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,eR=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,tR=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,nR=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,iR=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,sR=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,rR=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,oR=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,aR=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,lR=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,cR=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,hR=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,uR=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,dR=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,pR=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,fR=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,mR=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,vR=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,gR=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,_R=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,bR=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,xR=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,yR=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,wR=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,ER="gl_FragColor = linearToOutputTexel( gl_FragColor );",MR=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,SR=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,CR=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,AR=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,TR=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,PR=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,RR=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,LR=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,IR=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,DR=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,NR=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,OR=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,kR=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,UR=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,FR=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,BR=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,VR=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,zR=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,HR=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,GR=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,WR=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,$R=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,jR=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,XR=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,qR=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,KR=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,YR=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,ZR=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,JR=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,QR=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,eL=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,tL=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,nL=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,iL=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,sL=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,rL=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,oL=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,aL=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,lL=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,cL=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,hL=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,uL=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,dL=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,pL=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,fL=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,mL=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,vL=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,gL=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,_L=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,bL=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,xL=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,yL=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,wL=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,EL=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,ML=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,SL=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,CL=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,AL=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,TL=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,PL=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,RL=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,LL=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,IL=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,DL=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,NL=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,OL=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,kL=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,UL=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,FL=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,BL=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,VL=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,zL=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,HL=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,GL=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,WL=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,$L=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const jL=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,XL=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,qL=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,KL=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,YL=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,ZL=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,JL=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,QL=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,eI=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,tI=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,nI=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,iI=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,sI=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,rI=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,oI=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,aI=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lI=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,cI=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hI=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,uI=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,dI=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,pI=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,fI=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,mI=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vI=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,gI=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_I=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bI=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xI=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,yI=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,wI=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,EI=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,MI=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,SI=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ze={alphahash_fragment:XP,alphahash_pars_fragment:qP,alphamap_fragment:KP,alphamap_pars_fragment:YP,alphatest_fragment:ZP,alphatest_pars_fragment:JP,aomap_fragment:QP,aomap_pars_fragment:eR,batching_pars_vertex:tR,batching_vertex:nR,begin_vertex:iR,beginnormal_vertex:sR,bsdfs:rR,iridescence_fragment:oR,bumpmap_pars_fragment:aR,clipping_planes_fragment:lR,clipping_planes_pars_fragment:cR,clipping_planes_pars_vertex:hR,clipping_planes_vertex:uR,color_fragment:dR,color_pars_fragment:pR,color_pars_vertex:fR,color_vertex:mR,common:vR,cube_uv_reflection_fragment:gR,defaultnormal_vertex:_R,displacementmap_pars_vertex:bR,displacementmap_vertex:xR,emissivemap_fragment:yR,emissivemap_pars_fragment:wR,colorspace_fragment:ER,colorspace_pars_fragment:MR,envmap_fragment:SR,envmap_common_pars_fragment:CR,envmap_pars_fragment:AR,envmap_pars_vertex:TR,envmap_physical_pars_fragment:BR,envmap_vertex:PR,fog_vertex:RR,fog_pars_vertex:LR,fog_fragment:IR,fog_pars_fragment:DR,gradientmap_pars_fragment:NR,lightmap_pars_fragment:OR,lights_lambert_fragment:kR,lights_lambert_pars_fragment:UR,lights_pars_begin:FR,lights_toon_fragment:VR,lights_toon_pars_fragment:zR,lights_phong_fragment:HR,lights_phong_pars_fragment:GR,lights_physical_fragment:WR,lights_physical_pars_fragment:$R,lights_fragment_begin:jR,lights_fragment_maps:XR,lights_fragment_end:qR,logdepthbuf_fragment:KR,logdepthbuf_pars_fragment:YR,logdepthbuf_pars_vertex:ZR,logdepthbuf_vertex:JR,map_fragment:QR,map_pars_fragment:eL,map_particle_fragment:tL,map_particle_pars_fragment:nL,metalnessmap_fragment:iL,metalnessmap_pars_fragment:sL,morphinstance_vertex:rL,morphcolor_vertex:oL,morphnormal_vertex:aL,morphtarget_pars_vertex:lL,morphtarget_vertex:cL,normal_fragment_begin:hL,normal_fragment_maps:uL,normal_pars_fragment:dL,normal_pars_vertex:pL,normal_vertex:fL,normalmap_pars_fragment:mL,clearcoat_normal_fragment_begin:vL,clearcoat_normal_fragment_maps:gL,clearcoat_pars_fragment:_L,iridescence_pars_fragment:bL,opaque_fragment:xL,packing:yL,premultiplied_alpha_fragment:wL,project_vertex:EL,dithering_fragment:ML,dithering_pars_fragment:SL,roughnessmap_fragment:CL,roughnessmap_pars_fragment:AL,shadowmap_pars_fragment:TL,shadowmap_pars_vertex:PL,shadowmap_vertex:RL,shadowmask_pars_fragment:LL,skinbase_vertex:IL,skinning_pars_vertex:DL,skinning_vertex:NL,skinnormal_vertex:OL,specularmap_fragment:kL,specularmap_pars_fragment:UL,tonemapping_fragment:FL,tonemapping_pars_fragment:BL,transmission_fragment:VL,transmission_pars_fragment:zL,uv_pars_fragment:HL,uv_pars_vertex:GL,uv_vertex:WL,worldpos_vertex:$L,background_vert:jL,background_frag:XL,backgroundCube_vert:qL,backgroundCube_frag:KL,cube_vert:YL,cube_frag:ZL,depth_vert:JL,depth_frag:QL,distanceRGBA_vert:eI,distanceRGBA_frag:tI,equirect_vert:nI,equirect_frag:iI,linedashed_vert:sI,linedashed_frag:rI,meshbasic_vert:oI,meshbasic_frag:aI,meshlambert_vert:lI,meshlambert_frag:cI,meshmatcap_vert:hI,meshmatcap_frag:uI,meshnormal_vert:dI,meshnormal_frag:pI,meshphong_vert:fI,meshphong_frag:mI,meshphysical_vert:vI,meshphysical_frag:gI,meshtoon_vert:_I,meshtoon_frag:bI,points_vert:xI,points_frag:yI,shadow_vert:wI,shadow_frag:EI,sprite_vert:MI,sprite_frag:SI},me={common:{diffuse:{value:new ve(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Je},alphaMap:{value:null},alphaMapTransform:{value:new Je},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Je}},envmap:{envMap:{value:null},envMapRotation:{value:new Je},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Je}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Je}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Je},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Je},normalScale:{value:new ee(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Je},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Je}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Je}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Je}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ve(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ve(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Je},alphaTest:{value:0},uvTransform:{value:new Je}},sprite:{diffuse:{value:new ve(16777215)},opacity:{value:1},center:{value:new ee(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Je},alphaMap:{value:null},alphaMapTransform:{value:new Je},alphaTest:{value:0}}},Oi={basic:{uniforms:Kn([me.common,me.specularmap,me.envmap,me.aomap,me.lightmap,me.fog]),vertexShader:ze.meshbasic_vert,fragmentShader:ze.meshbasic_frag},lambert:{uniforms:Kn([me.common,me.specularmap,me.envmap,me.aomap,me.lightmap,me.emissivemap,me.bumpmap,me.normalmap,me.displacementmap,me.fog,me.lights,{emissive:{value:new ve(0)}}]),vertexShader:ze.meshlambert_vert,fragmentShader:ze.meshlambert_frag},phong:{uniforms:Kn([me.common,me.specularmap,me.envmap,me.aomap,me.lightmap,me.emissivemap,me.bumpmap,me.normalmap,me.displacementmap,me.fog,me.lights,{emissive:{value:new ve(0)},specular:{value:new ve(1118481)},shininess:{value:30}}]),vertexShader:ze.meshphong_vert,fragmentShader:ze.meshphong_frag},standard:{uniforms:Kn([me.common,me.envmap,me.aomap,me.lightmap,me.emissivemap,me.bumpmap,me.normalmap,me.displacementmap,me.roughnessmap,me.metalnessmap,me.fog,me.lights,{emissive:{value:new ve(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ze.meshphysical_vert,fragmentShader:ze.meshphysical_frag},toon:{uniforms:Kn([me.common,me.aomap,me.lightmap,me.emissivemap,me.bumpmap,me.normalmap,me.displacementmap,me.gradientmap,me.fog,me.lights,{emissive:{value:new ve(0)}}]),vertexShader:ze.meshtoon_vert,fragmentShader:ze.meshtoon_frag},matcap:{uniforms:Kn([me.common,me.bumpmap,me.normalmap,me.displacementmap,me.fog,{matcap:{value:null}}]),vertexShader:ze.meshmatcap_vert,fragmentShader:ze.meshmatcap_frag},points:{uniforms:Kn([me.points,me.fog]),vertexShader:ze.points_vert,fragmentShader:ze.points_frag},dashed:{uniforms:Kn([me.common,me.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ze.linedashed_vert,fragmentShader:ze.linedashed_frag},depth:{uniforms:Kn([me.common,me.displacementmap]),vertexShader:ze.depth_vert,fragmentShader:ze.depth_frag},normal:{uniforms:Kn([me.common,me.bumpmap,me.normalmap,me.displacementmap,{opacity:{value:1}}]),vertexShader:ze.meshnormal_vert,fragmentShader:ze.meshnormal_frag},sprite:{uniforms:Kn([me.sprite,me.fog]),vertexShader:ze.sprite_vert,fragmentShader:ze.sprite_frag},background:{uniforms:{uvTransform:{value:new Je},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ze.background_vert,fragmentShader:ze.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Je}},vertexShader:ze.backgroundCube_vert,fragmentShader:ze.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ze.cube_vert,fragmentShader:ze.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ze.equirect_vert,fragmentShader:ze.equirect_frag},distanceRGBA:{uniforms:Kn([me.common,me.displacementmap,{referencePosition:{value:new R},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ze.distanceRGBA_vert,fragmentShader:ze.distanceRGBA_frag},shadow:{uniforms:Kn([me.lights,me.fog,{color:{value:new ve(0)},opacity:{value:1}}]),vertexShader:ze.shadow_vert,fragmentShader:ze.shadow_frag}};Oi.physical={uniforms:Kn([Oi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Je},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Je},clearcoatNormalScale:{value:new ee(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Je},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Je},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Je},sheen:{value:0},sheenColor:{value:new ve(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Je},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Je},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Je},transmissionSamplerSize:{value:new ee},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Je},attenuationDistance:{value:0},attenuationColor:{value:new ve(0)},specularColor:{value:new ve(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Je},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Je},anisotropyVector:{value:new ee},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Je}}]),vertexShader:ze.meshphysical_vert,fragmentShader:ze.meshphysical_frag};const fu={r:0,b:0,g:0},oo=new es,CI=new De;function AI(n,e,t,i,s,r,o){const a=new ve(0);let l=r===!0?0:1,c,h,u=null,d=0,p=null;function f(b){let _=b.isScene===!0?b.background:null;return _&&_.isTexture&&(_=(b.backgroundBlurriness>0?t:e).get(_)),_}function g(b){let _=!1;const C=f(b);C===null?v(a,l):C&&C.isColor&&(v(C,1),_=!0);const M=n.xr.getEnvironmentBlendMode();M==="additive"?i.buffers.color.setClear(0,0,0,1,o):M==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(n.autoClear||_)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function m(b,_){const C=f(_);C&&(C.isCubeTexture||C.mapping===hl)?(h===void 0&&(h=new Kt(new Vr(1,1,1),new zi({name:"BackgroundCubeMaterial",uniforms:nl(Oi.backgroundCube.uniforms),vertexShader:Oi.backgroundCube.vertexShader,fragmentShader:Oi.backgroundCube.fragmentShader,side:ni,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(M,S,P){this.matrixWorld.copyPosition(P.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(h)),oo.copy(_.backgroundRotation),oo.x*=-1,oo.y*=-1,oo.z*=-1,C.isCubeTexture&&C.isRenderTargetTexture===!1&&(oo.y*=-1,oo.z*=-1),h.material.uniforms.envMap.value=C,h.material.uniforms.flipEnvMap.value=C.isCubeTexture&&C.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=_.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(CI.makeRotationFromEuler(oo)),h.material.toneMapped=ht.getTransfer(C.colorSpace)!==Dt,(u!==C||d!==C.version||p!==n.toneMapping)&&(h.material.needsUpdate=!0,u=C,d=C.version,p=n.toneMapping),h.layers.enableAll(),b.unshift(h,h.geometry,h.material,0,0,null)):C&&C.isTexture&&(c===void 0&&(c=new Kt(new Ko(2,2),new zi({name:"BackgroundMaterial",uniforms:nl(Oi.background.uniforms),vertexShader:Oi.background.vertexShader,fragmentShader:Oi.background.fragmentShader,side:ms,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(c)),c.material.uniforms.t2D.value=C,c.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,c.material.toneMapped=ht.getTransfer(C.colorSpace)!==Dt,C.matrixAutoUpdate===!0&&C.updateMatrix(),c.material.uniforms.uvTransform.value.copy(C.matrix),(u!==C||d!==C.version||p!==n.toneMapping)&&(c.material.needsUpdate=!0,u=C,d=C.version,p=n.toneMapping),c.layers.enableAll(),b.unshift(c,c.geometry,c.material,0,0,null))}function v(b,_){b.getRGB(fu,zw(n)),i.buffers.color.setClear(fu.r,fu.g,fu.b,_,o)}function x(){h!==void 0&&(h.geometry.dispose(),h.material.dispose(),h=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return a},setClearColor:function(b,_=1){a.set(b),l=_,v(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(b){l=b,v(a,l)},render:g,addToRenderList:m,dispose:x}}function TI(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},s=d(null);let r=s,o=!1;function a(y,L,k,D,W){let z=!1;const H=u(D,k,L);r!==H&&(r=H,c(r.object)),z=p(y,D,k,W),z&&f(y,D,k,W),W!==null&&e.update(W,n.ELEMENT_ARRAY_BUFFER),(z||o)&&(o=!1,_(y,L,k,D),W!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(W).buffer))}function l(){return n.createVertexArray()}function c(y){return n.bindVertexArray(y)}function h(y){return n.deleteVertexArray(y)}function u(y,L,k){const D=k.wireframe===!0;let W=i[y.id];W===void 0&&(W={},i[y.id]=W);let z=W[L.id];z===void 0&&(z={},W[L.id]=z);let H=z[D];return H===void 0&&(H=d(l()),z[D]=H),H}function d(y){const L=[],k=[],D=[];for(let W=0;W<t;W++)L[W]=0,k[W]=0,D[W]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:L,enabledAttributes:k,attributeDivisors:D,object:y,attributes:{},index:null}}function p(y,L,k,D){const W=r.attributes,z=L.attributes;let H=0;const ne=k.getAttributes();for(const G in ne)if(ne[G].location>=0){const se=W[G];let ge=z[G];if(ge===void 0&&(G==="instanceMatrix"&&y.instanceMatrix&&(ge=y.instanceMatrix),G==="instanceColor"&&y.instanceColor&&(ge=y.instanceColor)),se===void 0||se.attribute!==ge||ge&&se.data!==ge.data)return!0;H++}return r.attributesNum!==H||r.index!==D}function f(y,L,k,D){const W={},z=L.attributes;let H=0;const ne=k.getAttributes();for(const G in ne)if(ne[G].location>=0){let se=z[G];se===void 0&&(G==="instanceMatrix"&&y.instanceMatrix&&(se=y.instanceMatrix),G==="instanceColor"&&y.instanceColor&&(se=y.instanceColor));const ge={};ge.attribute=se,se&&se.data&&(ge.data=se.data),W[G]=ge,H++}r.attributes=W,r.attributesNum=H,r.index=D}function g(){const y=r.newAttributes;for(let L=0,k=y.length;L<k;L++)y[L]=0}function m(y){v(y,0)}function v(y,L){const k=r.newAttributes,D=r.enabledAttributes,W=r.attributeDivisors;k[y]=1,D[y]===0&&(n.enableVertexAttribArray(y),D[y]=1),W[y]!==L&&(n.vertexAttribDivisor(y,L),W[y]=L)}function x(){const y=r.newAttributes,L=r.enabledAttributes;for(let k=0,D=L.length;k<D;k++)L[k]!==y[k]&&(n.disableVertexAttribArray(k),L[k]=0)}function b(y,L,k,D,W,z,H){H===!0?n.vertexAttribIPointer(y,L,k,W,z):n.vertexAttribPointer(y,L,k,D,W,z)}function _(y,L,k,D){g();const W=D.attributes,z=k.getAttributes(),H=L.defaultAttributeValues;for(const ne in z){const G=z[ne];if(G.location>=0){let ae=W[ne];if(ae===void 0&&(ne==="instanceMatrix"&&y.instanceMatrix&&(ae=y.instanceMatrix),ne==="instanceColor"&&y.instanceColor&&(ae=y.instanceColor)),ae!==void 0){const se=ae.normalized,ge=ae.itemSize,Oe=e.get(ae);if(Oe===void 0)continue;const Ze=Oe.buffer,J=Oe.type,ce=Oe.bytesPerElement,_e=J===n.INT||J===n.UNSIGNED_INT||ae.gpuType===Zd;if(ae.isInterleavedBufferAttribute){const pe=ae.data,Re=pe.stride,nt=ae.offset;if(pe.isInstancedInterleavedBuffer){for(let Le=0;Le<G.locationSize;Le++)v(G.location+Le,pe.meshPerAttribute);y.isInstancedMesh!==!0&&D._maxInstanceCount===void 0&&(D._maxInstanceCount=pe.meshPerAttribute*pe.count)}else for(let Le=0;Le<G.locationSize;Le++)m(G.location+Le);n.bindBuffer(n.ARRAY_BUFFER,Ze);for(let Le=0;Le<G.locationSize;Le++)b(G.location+Le,ge/G.locationSize,J,se,Re*ce,(nt+ge/G.locationSize*Le)*ce,_e)}else{if(ae.isInstancedBufferAttribute){for(let pe=0;pe<G.locationSize;pe++)v(G.location+pe,ae.meshPerAttribute);y.isInstancedMesh!==!0&&D._maxInstanceCount===void 0&&(D._maxInstanceCount=ae.meshPerAttribute*ae.count)}else for(let pe=0;pe<G.locationSize;pe++)m(G.location+pe);n.bindBuffer(n.ARRAY_BUFFER,Ze);for(let pe=0;pe<G.locationSize;pe++)b(G.location+pe,ge/G.locationSize,J,se,ge*ce,ge/G.locationSize*pe*ce,_e)}}else if(H!==void 0){const se=H[ne];if(se!==void 0)switch(se.length){case 2:n.vertexAttrib2fv(G.location,se);break;case 3:n.vertexAttrib3fv(G.location,se);break;case 4:n.vertexAttrib4fv(G.location,se);break;default:n.vertexAttrib1fv(G.location,se)}}}}x()}function C(){P();for(const y in i){const L=i[y];for(const k in L){const D=L[k];for(const W in D)h(D[W].object),delete D[W];delete L[k]}delete i[y]}}function M(y){if(i[y.id]===void 0)return;const L=i[y.id];for(const k in L){const D=L[k];for(const W in D)h(D[W].object),delete D[W];delete L[k]}delete i[y.id]}function S(y){for(const L in i){const k=i[L];if(k[y.id]===void 0)continue;const D=k[y.id];for(const W in D)h(D[W].object),delete D[W];delete k[y.id]}}function P(){E(),o=!0,r!==s&&(r=s,c(r.object))}function E(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:a,reset:P,resetDefaultState:E,dispose:C,releaseStatesOfGeometry:M,releaseStatesOfProgram:S,initAttributes:g,enableAttribute:m,disableUnusedAttributes:x}}function PI(n,e,t){let i;function s(c){i=c}function r(c,h){n.drawArrays(i,c,h),t.update(h,i,1)}function o(c,h,u){u!==0&&(n.drawArraysInstanced(i,c,h,u),t.update(h,i,u))}function a(c,h,u){if(u===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,c,0,h,0,u);let p=0;for(let f=0;f<u;f++)p+=h[f];t.update(p,i,1)}function l(c,h,u,d){if(u===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let f=0;f<c.length;f++)o(c[f],h[f],d[f]);else{p.multiDrawArraysInstancedWEBGL(i,c,0,h,0,d,0,u);let f=0;for(let g=0;g<u;g++)f+=h[g]*d[g];t.update(f,i,1)}}this.setMode=s,this.render=r,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function RI(n,e,t,i){let s;function r(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const S=e.get("EXT_texture_filter_anisotropic");s=n.getParameter(S.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function o(S){return!(S!==ei&&i.convert(S)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(S){const P=S===ul&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(S!==vs&&i.convert(S)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&S!==di&&!P)}function l(S){if(S==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";S="mediump"}return S==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const h=l(c);h!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",h,"instead."),c=h);const u=t.logarithmicDepthBuffer===!0,d=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),p=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),f=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),g=n.getParameter(n.MAX_TEXTURE_SIZE),m=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),v=n.getParameter(n.MAX_VERTEX_ATTRIBS),x=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),b=n.getParameter(n.MAX_VARYING_VECTORS),_=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),C=f>0,M=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:r,getMaxPrecision:l,textureFormatReadable:o,textureTypeReadable:a,precision:c,logarithmicDepthBuffer:u,reverseDepthBuffer:d,maxTextures:p,maxVertexTextures:f,maxTextureSize:g,maxCubemapSize:m,maxAttributes:v,maxVertexUniforms:x,maxVaryings:b,maxFragmentUniforms:_,vertexTextures:C,maxSamples:M}}function LI(n){const e=this;let t=null,i=0,s=!1,r=!1;const o=new Us,a=new Je,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d){const p=u.length!==0||d||i!==0||s;return s=d,i=u.length,p},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(u,d){t=h(u,d,0)},this.setState=function(u,d,p){const f=u.clippingPlanes,g=u.clipIntersection,m=u.clipShadows,v=n.get(u);if(!s||f===null||f.length===0||r&&!m)r?h(null):c();else{const x=r?0:i,b=x*4;let _=v.clippingState||null;l.value=_,_=h(f,d,b,p);for(let C=0;C!==b;++C)_[C]=t[C];v.clippingState=_,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=x}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function h(u,d,p,f){const g=u!==null?u.length:0;let m=null;if(g!==0){if(m=l.value,f!==!0||m===null){const v=p+g*4,x=d.matrixWorldInverse;a.getNormalMatrix(x),(m===null||m.length<v)&&(m=new Float32Array(v));for(let b=0,_=p;b!==g;++b,_+=4)o.copy(u[b]).applyMatrix4(x,a),o.normal.toArray(m,_),m[_+3]=o.constant}l.value=m,l.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,m}}function II(n){let e=new WeakMap;function t(o,a){return a===gc?o.mapping=Ys:a===_c&&(o.mapping=Pr),o}function i(o){if(o&&o.isTexture){const a=o.mapping;if(a===gc||a===_c)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new Gw(l.height);return c.fromEquirectangularTexture(n,o),e.set(o,c),o.addEventListener("dispose",s),t(c.texture,o.mapping)}else return null}}return o}function s(o){const a=o.target;a.removeEventListener("dispose",s);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap}return{get:i,dispose:r}}const ka=4,rb=[.125,.215,.35,.446,.526,.582],xo=20,Wf=new ml,ob=new ve;let $f=null,jf=0,Xf=0,qf=!1;const bo=(1+Math.sqrt(5))/2,ya=1/bo,ab=[new R(-bo,ya,0),new R(bo,ya,0),new R(-ya,0,bo),new R(ya,0,bo),new R(0,bo,-ya),new R(0,bo,ya),new R(-1,1,-1),new R(1,1,-1),new R(-1,1,1),new R(1,1,1)],DI=new R;class Zm{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,s=100,r={}){const{size:o=256,position:a=DI}=r;$f=this._renderer.getRenderTarget(),jf=this._renderer.getActiveCubeFace(),Xf=this._renderer.getActiveMipmapLevel(),qf=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,i,s,l,a),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=hb(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=cb(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget($f,jf,Xf),this._renderer.xr.enabled=qf,e.scissorTest=!1,mu(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Ys||e.mapping===Pr?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),$f=this._renderer.getRenderTarget(),jf=this._renderer.getActiveCubeFace(),Xf=this._renderer.getActiveMipmapLevel(),qf=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:sn,minFilter:sn,generateMipmaps:!1,type:ul,format:ei,colorSpace:Gn,depthBuffer:!1},s=lb(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=lb(e,t,i);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=NI(r)),this._blurMaterial=OI(r,e,t)}return s}_compileMaterial(e){const t=new Kt(this._lodPlanes[0],e);this._renderer.compile(t,Wf)}_sceneToCubeUV(e,t,i,s,r){const l=new _n(90,1,t,i),c=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,p=u.toneMapping;u.getClearColor(ob),u.toneMapping=Xs,u.autoClear=!1;const f=new yi({name:"PMREM.Background",side:ni,depthWrite:!1,depthTest:!1}),g=new Kt(new Vr,f);let m=!1;const v=e.background;v?v.isColor&&(f.color.copy(v),e.background=null,m=!0):(f.color.copy(ob),m=!0);for(let x=0;x<6;x++){const b=x%3;b===0?(l.up.set(0,c[x],0),l.position.set(r.x,r.y,r.z),l.lookAt(r.x+h[x],r.y,r.z)):b===1?(l.up.set(0,0,c[x]),l.position.set(r.x,r.y,r.z),l.lookAt(r.x,r.y+h[x],r.z)):(l.up.set(0,c[x],0),l.position.set(r.x,r.y,r.z),l.lookAt(r.x,r.y,r.z+h[x]));const _=this._cubeSize;mu(s,b*_,x>2?_:0,_,_),u.setRenderTarget(s),m&&u.render(g,l),u.render(e,l)}g.geometry.dispose(),g.material.dispose(),u.toneMapping=p,u.autoClear=d,e.background=v}_textureToCubeUV(e,t){const i=this._renderer,s=e.mapping===Ys||e.mapping===Pr;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=hb()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=cb());const r=s?this._cubemapMaterial:this._equirectMaterial,o=new Kt(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=e;const l=this._cubeSize;mu(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,Wf)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const s=this._lodPlanes.length;for(let r=1;r<s;r++){const o=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),a=ab[(s-r-1)%ab.length];this._blur(e,r-1,r,o,a)}t.autoClear=i}_blur(e,t,i,s,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,s,"latitudinal",r),this._halfBlur(o,e,i,i,s,"longitudinal",r)}_halfBlur(e,t,i,s,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,u=new Kt(this._lodPlanes[s],c),d=c.uniforms,p=this._sizeLods[i]-1,f=isFinite(r)?Math.PI/(2*p):2*Math.PI/(2*xo-1),g=r/f,m=isFinite(r)?1+Math.floor(h*g):xo;m>xo&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${xo}`);const v=[];let x=0;for(let S=0;S<xo;++S){const P=S/g,E=Math.exp(-P*P/2);v.push(E),S===0?x+=E:S<m&&(x+=2*E)}for(let S=0;S<v.length;S++)v[S]=v[S]/x;d.envMap.value=e.texture,d.samples.value=m,d.weights.value=v,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:b}=this;d.dTheta.value=f,d.mipInt.value=b-i;const _=this._sizeLods[s],C=3*_*(s>b-ka?s-b+ka:0),M=4*(this._cubeSize-_);mu(t,C,M,3*_,2*_),l.setRenderTarget(t),l.render(u,Wf)}}function NI(n){const e=[],t=[],i=[];let s=n;const r=n-ka+1+rb.length;for(let o=0;o<r;o++){const a=Math.pow(2,s);t.push(a);let l=1/a;o>n-ka?l=rb[o-n+ka-1]:o===0&&(l=0),i.push(l);const c=1/(a-2),h=-c,u=1+c,d=[h,h,u,h,u,u,h,h,u,u,h,u],p=6,f=6,g=3,m=2,v=1,x=new Float32Array(g*f*p),b=new Float32Array(m*f*p),_=new Float32Array(v*f*p);for(let M=0;M<p;M++){const S=M%3*2/3-1,P=M>2?0:-1,E=[S,P,0,S+2/3,P,0,S+2/3,P+1,0,S,P,0,S+2/3,P+1,0,S,P+1,0];x.set(E,g*f*M),b.set(d,m*f*M);const y=[M,M,M,M,M,M];_.set(y,v*f*M)}const C=new Ye;C.setAttribute("position",new dt(x,g)),C.setAttribute("uv",new dt(b,m)),C.setAttribute("faceIndex",new dt(_,v)),e.push(C),s>ka&&s--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function lb(n,e,t){const i=new gs(n,e,t);return i.texture.mapping=hl,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function mu(n,e,t,i,s){n.viewport.set(e,t,i,s),n.scissor.set(e,t,i,s)}function OI(n,e,t){const i=new Float32Array(xo),s=new R(0,1,0);return new zi({name:"SphericalGaussianBlur",defines:{n:xo,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:gg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:js,depthTest:!1,depthWrite:!1})}function cb(){return new zi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:gg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:js,depthTest:!1,depthWrite:!1})}function hb(){return new zi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:gg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:js,depthTest:!1,depthWrite:!1})}function gg(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function kI(n){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===gc||l===_c,h=l===Ys||l===Pr;if(c||h){let u=e.get(a);const d=u!==void 0?u.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==d)return t===null&&(t=new Zm(n)),u=c?t.fromEquirectangular(a,u):t.fromCubemap(a,u),u.texture.pmremVersion=a.pmremVersion,e.set(a,u),u.texture;if(u!==void 0)return u.texture;{const p=a.image;return c&&p&&p.height>0||h&&p&&s(p)?(t===null&&(t=new Zm(n)),u=c?t.fromEquirectangular(a):t.fromCubemap(a),u.texture.pmremVersion=a.pmremVersion,e.set(a,u),a.addEventListener("dispose",r),u.texture):null}}}return a}function s(a){let l=0;const c=6;for(let h=0;h<c;h++)a[h]!==void 0&&l++;return l===c}function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function UI(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let s;switch(i){case"WEBGL_depth_texture":s=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=n.getExtension(i)}return e[i]=s,s}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const s=t(i);return s===null&&Iu("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}function FI(n,e,t,i){const s={},r=new WeakMap;function o(u){const d=u.target;d.index!==null&&e.remove(d.index);for(const f in d.attributes)e.remove(d.attributes[f]);d.removeEventListener("dispose",o),delete s[d.id];const p=r.get(d);p&&(e.remove(p),r.delete(d)),i.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function a(u,d){return s[d.id]===!0||(d.addEventListener("dispose",o),s[d.id]=!0,t.memory.geometries++),d}function l(u){const d=u.attributes;for(const p in d)e.update(d[p],n.ARRAY_BUFFER)}function c(u){const d=[],p=u.index,f=u.attributes.position;let g=0;if(p!==null){const x=p.array;g=p.version;for(let b=0,_=x.length;b<_;b+=3){const C=x[b+0],M=x[b+1],S=x[b+2];d.push(C,M,M,S,S,C)}}else if(f!==void 0){const x=f.array;g=f.version;for(let b=0,_=x.length/3-1;b<_;b+=3){const C=b+0,M=b+1,S=b+2;d.push(C,M,M,S,S,C)}}else return;const m=new(Ow(d)?zv:Vv)(d,1);m.version=g;const v=r.get(u);v&&e.remove(v),r.set(u,m)}function h(u){const d=r.get(u);if(d){const p=u.index;p!==null&&d.version<p.version&&c(u)}else c(u);return r.get(u)}return{get:a,update:l,getWireframeAttribute:h}}function BI(n,e,t){let i;function s(d){i=d}let r,o;function a(d){r=d.type,o=d.bytesPerElement}function l(d,p){n.drawElements(i,p,r,d*o),t.update(p,i,1)}function c(d,p,f){f!==0&&(n.drawElementsInstanced(i,p,r,d*o,f),t.update(p,i,f))}function h(d,p,f){if(f===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,p,0,r,d,0,f);let m=0;for(let v=0;v<f;v++)m+=p[v];t.update(m,i,1)}function u(d,p,f,g){if(f===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let v=0;v<d.length;v++)c(d[v]/o,p[v],g[v]);else{m.multiDrawElementsInstancedWEBGL(i,p,0,r,d,0,g,0,f);let v=0;for(let x=0;x<f;x++)v+=p[x]*g[x];t.update(v,i,1)}}this.setMode=s,this.setIndex=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=h,this.renderMultiDrawInstances=u}function VI(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(r,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(r/3);break;case n.LINES:t.lines+=a*(r/2);break;case n.LINE_STRIP:t.lines+=a*(r-1);break;case n.LINE_LOOP:t.lines+=a*r;break;case n.POINTS:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function s(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:i}}function zI(n,e,t){const i=new WeakMap,s=new ct;function r(o,a,l){const c=o.morphTargetInfluences,h=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,u=h!==void 0?h.length:0;let d=i.get(a);if(d===void 0||d.count!==u){let E=function(){S.dispose(),i.delete(a),a.removeEventListener("dispose",E)};d!==void 0&&d.texture.dispose();const p=a.morphAttributes.position!==void 0,f=a.morphAttributes.normal!==void 0,g=a.morphAttributes.color!==void 0,m=a.morphAttributes.position||[],v=a.morphAttributes.normal||[],x=a.morphAttributes.color||[];let b=0;p===!0&&(b=1),f===!0&&(b=2),g===!0&&(b=3);let _=a.attributes.position.count*b,C=1;_>e.maxTextureSize&&(C=Math.ceil(_/e.maxTextureSize),_=e.maxTextureSize);const M=new Float32Array(_*C*4*u),S=new Kc(M,_,C,u);S.type=di,S.needsUpdate=!0;const P=b*4;for(let y=0;y<u;y++){const L=m[y],k=v[y],D=x[y],W=_*C*4*y;for(let z=0;z<L.count;z++){const H=z*P;p===!0&&(s.fromBufferAttribute(L,z),M[W+H+0]=s.x,M[W+H+1]=s.y,M[W+H+2]=s.z,M[W+H+3]=0),f===!0&&(s.fromBufferAttribute(k,z),M[W+H+4]=s.x,M[W+H+5]=s.y,M[W+H+6]=s.z,M[W+H+7]=0),g===!0&&(s.fromBufferAttribute(D,z),M[W+H+8]=s.x,M[W+H+9]=s.y,M[W+H+10]=s.z,M[W+H+11]=D.itemSize===4?s.w:1)}}d={count:u,texture:S,size:new ee(_,C)},i.set(a,d),a.addEventListener("dispose",E)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",o.morphTexture,t);else{let p=0;for(let g=0;g<c.length;g++)p+=c[g];const f=a.morphTargetsRelative?1:1-p;l.getUniforms().setValue(n,"morphTargetBaseInfluence",f),l.getUniforms().setValue(n,"morphTargetInfluences",c)}l.getUniforms().setValue(n,"morphTargetsTexture",d.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",d.size)}return{update:r}}function HI(n,e,t,i){let s=new WeakMap;function r(l){const c=i.render.frame,h=l.geometry,u=e.get(l,h);if(s.get(u)!==c&&(e.update(u),s.set(u,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),s.get(l)!==c&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),s.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;s.get(d)!==c&&(d.update(),s.set(d,c))}return u}function o(){s=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:o}}const FE=new Wt,ub=new qv(1,1),BE=new Kc,VE=new op,zE=new Yc,db=[],pb=[],fb=new Float32Array(16),mb=new Float32Array(9),vb=new Float32Array(4);function vl(n,e,t){const i=n[0];if(i<=0||i>0)return n;const s=e*t;let r=db[s];if(r===void 0&&(r=new Float32Array(s),db[s]=r),e!==0){i.toArray(r,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(r,a)}return r}function Mn(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Sn(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function Pp(n,e){let t=pb[e];t===void 0&&(t=new Int32Array(e),pb[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function GI(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function WI(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Mn(t,e))return;n.uniform2fv(this.addr,e),Sn(t,e)}}function $I(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Mn(t,e))return;n.uniform3fv(this.addr,e),Sn(t,e)}}function jI(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Mn(t,e))return;n.uniform4fv(this.addr,e),Sn(t,e)}}function XI(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Mn(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Sn(t,e)}else{if(Mn(t,i))return;vb.set(i),n.uniformMatrix2fv(this.addr,!1,vb),Sn(t,i)}}function qI(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Mn(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Sn(t,e)}else{if(Mn(t,i))return;mb.set(i),n.uniformMatrix3fv(this.addr,!1,mb),Sn(t,i)}}function KI(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Mn(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Sn(t,e)}else{if(Mn(t,i))return;fb.set(i),n.uniformMatrix4fv(this.addr,!1,fb),Sn(t,i)}}function YI(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function ZI(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Mn(t,e))return;n.uniform2iv(this.addr,e),Sn(t,e)}}function JI(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Mn(t,e))return;n.uniform3iv(this.addr,e),Sn(t,e)}}function QI(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Mn(t,e))return;n.uniform4iv(this.addr,e),Sn(t,e)}}function e2(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function t2(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Mn(t,e))return;n.uniform2uiv(this.addr,e),Sn(t,e)}}function n2(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Mn(t,e))return;n.uniform3uiv(this.addr,e),Sn(t,e)}}function i2(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Mn(t,e))return;n.uniform4uiv(this.addr,e),Sn(t,e)}}function s2(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s);let r;this.type===n.SAMPLER_2D_SHADOW?(ub.compareFunction=Fv,r=ub):r=FE,t.setTexture2D(e||r,s)}function r2(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture3D(e||VE,s)}function o2(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTextureCube(e||zE,s)}function a2(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture2DArray(e||BE,s)}function l2(n){switch(n){case 5126:return GI;case 35664:return WI;case 35665:return $I;case 35666:return jI;case 35674:return XI;case 35675:return qI;case 35676:return KI;case 5124:case 35670:return YI;case 35667:case 35671:return ZI;case 35668:case 35672:return JI;case 35669:case 35673:return QI;case 5125:return e2;case 36294:return t2;case 36295:return n2;case 36296:return i2;case 35678:case 36198:case 36298:case 36306:case 35682:return s2;case 35679:case 36299:case 36307:return r2;case 35680:case 36300:case 36308:case 36293:return o2;case 36289:case 36303:case 36311:case 36292:return a2}}function c2(n,e){n.uniform1fv(this.addr,e)}function h2(n,e){const t=vl(e,this.size,2);n.uniform2fv(this.addr,t)}function u2(n,e){const t=vl(e,this.size,3);n.uniform3fv(this.addr,t)}function d2(n,e){const t=vl(e,this.size,4);n.uniform4fv(this.addr,t)}function p2(n,e){const t=vl(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function f2(n,e){const t=vl(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function m2(n,e){const t=vl(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function v2(n,e){n.uniform1iv(this.addr,e)}function g2(n,e){n.uniform2iv(this.addr,e)}function _2(n,e){n.uniform3iv(this.addr,e)}function b2(n,e){n.uniform4iv(this.addr,e)}function x2(n,e){n.uniform1uiv(this.addr,e)}function y2(n,e){n.uniform2uiv(this.addr,e)}function w2(n,e){n.uniform3uiv(this.addr,e)}function E2(n,e){n.uniform4uiv(this.addr,e)}function M2(n,e,t){const i=this.cache,s=e.length,r=Pp(t,s);Mn(i,r)||(n.uniform1iv(this.addr,r),Sn(i,r));for(let o=0;o!==s;++o)t.setTexture2D(e[o]||FE,r[o])}function S2(n,e,t){const i=this.cache,s=e.length,r=Pp(t,s);Mn(i,r)||(n.uniform1iv(this.addr,r),Sn(i,r));for(let o=0;o!==s;++o)t.setTexture3D(e[o]||VE,r[o])}function C2(n,e,t){const i=this.cache,s=e.length,r=Pp(t,s);Mn(i,r)||(n.uniform1iv(this.addr,r),Sn(i,r));for(let o=0;o!==s;++o)t.setTextureCube(e[o]||zE,r[o])}function A2(n,e,t){const i=this.cache,s=e.length,r=Pp(t,s);Mn(i,r)||(n.uniform1iv(this.addr,r),Sn(i,r));for(let o=0;o!==s;++o)t.setTexture2DArray(e[o]||BE,r[o])}function T2(n){switch(n){case 5126:return c2;case 35664:return h2;case 35665:return u2;case 35666:return d2;case 35674:return p2;case 35675:return f2;case 35676:return m2;case 5124:case 35670:return v2;case 35667:case 35671:return g2;case 35668:case 35672:return _2;case 35669:case 35673:return b2;case 5125:return x2;case 36294:return y2;case 36295:return w2;case 36296:return E2;case 35678:case 36198:case 36298:case 36306:case 35682:return M2;case 35679:case 36299:case 36307:return S2;case 35680:case 36300:case 36308:case 36293:return C2;case 36289:case 36303:case 36311:case 36292:return A2}}class P2{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=l2(t.type)}}class R2{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=T2(t.type)}}class L2{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const s=this.seq;for(let r=0,o=s.length;r!==o;++r){const a=s[r];a.setValue(e,t[a.id],i)}}}const Kf=/(\w+)(\])?(\[|\.)?/g;function gb(n,e){n.seq.push(e),n.map[e.id]=e}function I2(n,e,t){const i=n.name,s=i.length;for(Kf.lastIndex=0;;){const r=Kf.exec(i),o=Kf.lastIndex;let a=r[1];const l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===s){gb(t,c===void 0?new P2(a,n,e):new R2(a,n,e));break}else{let u=t.map[a];u===void 0&&(u=new L2(a),gb(t,u)),t=u}}}class Nu{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<i;++s){const r=e.getActiveUniform(t,s),o=e.getUniformLocation(t,r.name);I2(r,o,this)}}setValue(e,t,i,s){const r=this.map[t];r!==void 0&&r.setValue(e,i,s)}setOptional(e,t,i){const s=t[i];s!==void 0&&this.setValue(e,i,s)}static upload(e,t,i,s){for(let r=0,o=t.length;r!==o;++r){const a=t[r],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,s)}}static seqWithValue(e,t){const i=[];for(let s=0,r=e.length;s!==r;++s){const o=e[s];o.id in t&&i.push(o)}return i}}function _b(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const D2=37297;let N2=0;function O2(n,e){const t=n.split(`
`),i=[],s=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=s;o<r;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}const bb=new Je;function k2(n){ht._getMatrix(bb,ht.workingColorSpace,n);const e=`mat3( ${bb.elements.map(t=>t.toFixed(4))} )`;switch(ht.getTransfer(n)){case xc:return[e,"LinearTransferOETF"];case Dt:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function xb(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),s=n.getShaderInfoLog(e).trim();if(i&&s==="")return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+s+`

`+O2(n.getShaderSource(e),o)}else return s}function U2(n,e){const t=k2(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function F2(n,e){let t;switch(e){case fw:t="Linear";break;case mw:t="Reinhard";break;case vw:t="Cineon";break;case gw:t="ACESFilmic";break;case ed:t="AgX";break;case bw:t="Neutral";break;case _w:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const vu=new R;function B2(){ht.getLuminanceCoefficients(vu);const n=vu.x.toFixed(4),e=vu.y.toFixed(4),t=vu.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function V2(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ic).join(`
`)}function z2(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function H2(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const r=n.getActiveAttrib(e,s),o=r.name;let a=1;r.type===n.FLOAT_MAT2&&(a=2),r.type===n.FLOAT_MAT3&&(a=3),r.type===n.FLOAT_MAT4&&(a=4),t[o]={type:r.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}function ic(n){return n!==""}function yb(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function wb(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const G2=/^[ \t]*#include +<([\w\d./]+)>/gm;function Jm(n){return n.replace(G2,$2)}const W2=new Map;function $2(n,e){let t=ze[e];if(t===void 0){const i=W2.get(e);if(i!==void 0)t=ze[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return Jm(t)}const j2=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Eb(n){return n.replace(j2,X2)}function X2(n,e,t,i){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function Mb(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function q2(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===Cv?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===rc?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===os&&(e="SHADOWMAP_TYPE_VSM"),e}function K2(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Ys:case Pr:e="ENVMAP_TYPE_CUBE";break;case hl:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Y2(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Pr:e="ENVMAP_MODE_REFRACTION";break}return e}function Z2(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Xc:e="ENVMAP_BLENDING_MULTIPLY";break;case dw:e="ENVMAP_BLENDING_MIX";break;case pw:e="ENVMAP_BLENDING_ADD";break}return e}function J2(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function Q2(n,e,t,i){const s=n.getContext(),r=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=q2(t),c=K2(t),h=Y2(t),u=Z2(t),d=J2(t),p=V2(t),f=z2(r),g=s.createProgram();let m,v,x=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f].filter(ic).join(`
`),m.length>0&&(m+=`
`),v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f].filter(ic).join(`
`),v.length>0&&(v+=`
`)):(m=[Mb(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ic).join(`
`),v=[Mb(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Xs?"#define TONE_MAPPING":"",t.toneMapping!==Xs?ze.tonemapping_pars_fragment:"",t.toneMapping!==Xs?F2("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ze.colorspace_pars_fragment,U2("linearToOutputTexel",t.outputColorSpace),B2(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(ic).join(`
`)),o=Jm(o),o=yb(o,t),o=wb(o,t),a=Jm(a),a=yb(a,t),a=wb(a,t),o=Eb(o),a=Eb(a),t.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,m=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,v=["#define varying in",t.glslVersion===Wm?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Wm?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const b=x+m+o,_=x+v+a,C=_b(s,s.VERTEX_SHADER,b),M=_b(s,s.FRAGMENT_SHADER,_);s.attachShader(g,C),s.attachShader(g,M),t.index0AttributeName!==void 0?s.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(g,0,"position"),s.linkProgram(g);function S(L){if(n.debug.checkShaderErrors){const k=s.getProgramInfoLog(g).trim(),D=s.getShaderInfoLog(C).trim(),W=s.getShaderInfoLog(M).trim();let z=!0,H=!0;if(s.getProgramParameter(g,s.LINK_STATUS)===!1)if(z=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(s,g,C,M);else{const ne=xb(s,C,"vertex"),G=xb(s,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(g,s.VALIDATE_STATUS)+`

Material Name: `+L.name+`
Material Type: `+L.type+`

Program Info Log: `+k+`
`+ne+`
`+G)}else k!==""?console.warn("THREE.WebGLProgram: Program Info Log:",k):(D===""||W==="")&&(H=!1);H&&(L.diagnostics={runnable:z,programLog:k,vertexShader:{log:D,prefix:m},fragmentShader:{log:W,prefix:v}})}s.deleteShader(C),s.deleteShader(M),P=new Nu(s,g),E=H2(s,g)}let P;this.getUniforms=function(){return P===void 0&&S(this),P};let E;this.getAttributes=function(){return E===void 0&&S(this),E};let y=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return y===!1&&(y=s.getProgramParameter(g,D2)),y},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(g),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=N2++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=C,this.fragmentShader=M,this}let eD=0;class tD{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,s=this._getShaderStage(t),r=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(s)===!1&&(o.add(s),s.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new nD(e),t.set(e,i)),i}}class nD{constructor(e){this.id=eD++,this.code=e,this.usedTimes=0}}function iD(n,e,t,i,s,r,o){const a=new ap,l=new tD,c=new Set,h=[],u=s.logarithmicDepthBuffer,d=s.vertexTextures;let p=s.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(E){return c.add(E),E===0?"uv":`uv${E}`}function m(E,y,L,k,D){const W=k.fog,z=D.geometry,H=E.isMeshStandardMaterial?k.environment:null,ne=(E.isMeshStandardMaterial?t:e).get(E.envMap||H),G=ne&&ne.mapping===hl?ne.image.height:null,ae=f[E.type];E.precision!==null&&(p=s.getMaxPrecision(E.precision),p!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",p,"instead."));const se=z.morphAttributes.position||z.morphAttributes.normal||z.morphAttributes.color,ge=se!==void 0?se.length:0;let Oe=0;z.morphAttributes.position!==void 0&&(Oe=1),z.morphAttributes.normal!==void 0&&(Oe=2),z.morphAttributes.color!==void 0&&(Oe=3);let Ze,J,ce,_e;if(ae){const It=Oi[ae];Ze=It.vertexShader,J=It.fragmentShader}else Ze=E.vertexShader,J=E.fragmentShader,l.update(E),ce=l.getVertexShaderID(E),_e=l.getFragmentShaderID(E);const pe=n.getRenderTarget(),Re=n.state.buffers.depth.getReversed(),nt=D.isInstancedMesh===!0,Le=D.isBatchedMesh===!0,rt=!!E.map,mt=!!E.matcap,Ge=!!ne,N=!!E.aoMap,Qe=!!E.lightMap,q=!!E.bumpMap,te=!!E.normalMap,K=!!E.displacementMap,de=!!E.emissiveMap,Y=!!E.metalnessMap,T=!!E.roughnessMap,w=E.anisotropy>0,U=E.clearcoat>0,j=E.dispersion>0,Z=E.iridescence>0,O=E.sheen>0,he=E.transmission>0,oe=w&&!!E.anisotropyMap,fe=U&&!!E.clearcoatMap,Ue=U&&!!E.clearcoatNormalMap,le=U&&!!E.clearcoatRoughnessMap,Ee=Z&&!!E.iridescenceMap,ke=Z&&!!E.iridescenceThicknessMap,Ie=O&&!!E.sheenColorMap,be=O&&!!E.sheenRoughnessMap,at=!!E.specularMap,qe=!!E.specularColorMap,At=!!E.specularIntensityMap,F=he&&!!E.transmissionMap,ye=he&&!!E.thicknessMap,Q=!!E.gradientMap,re=!!E.alphaMap,Me=E.alphaTest>0,we=!!E.alphaHash,it=!!E.extensions;let Jt=Xs;E.toneMapped&&(pe===null||pe.isXRRenderTarget===!0)&&(Jt=n.toneMapping);const kn={shaderID:ae,shaderType:E.type,shaderName:E.name,vertexShader:Ze,fragmentShader:J,defines:E.defines,customVertexShaderID:ce,customFragmentShaderID:_e,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:p,batching:Le,batchingColor:Le&&D._colorsTexture!==null,instancing:nt,instancingColor:nt&&D.instanceColor!==null,instancingMorph:nt&&D.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:pe===null?n.outputColorSpace:pe.isXRRenderTarget===!0?pe.texture.colorSpace:Gn,alphaToCoverage:!!E.alphaToCoverage,map:rt,matcap:mt,envMap:Ge,envMapMode:Ge&&ne.mapping,envMapCubeUVHeight:G,aoMap:N,lightMap:Qe,bumpMap:q,normalMap:te,displacementMap:d&&K,emissiveMap:de,normalMapObjectSpace:te&&E.normalMapType===Aw,normalMapTangentSpace:te&&E.normalMapType===Fr,metalnessMap:Y,roughnessMap:T,anisotropy:w,anisotropyMap:oe,clearcoat:U,clearcoatMap:fe,clearcoatNormalMap:Ue,clearcoatRoughnessMap:le,dispersion:j,iridescence:Z,iridescenceMap:Ee,iridescenceThicknessMap:ke,sheen:O,sheenColorMap:Ie,sheenRoughnessMap:be,specularMap:at,specularColorMap:qe,specularIntensityMap:At,transmission:he,transmissionMap:F,thicknessMap:ye,gradientMap:Q,opaque:E.transparent===!1&&E.blending===Po&&E.alphaToCoverage===!1,alphaMap:re,alphaTest:Me,alphaHash:we,combine:E.combine,mapUv:rt&&g(E.map.channel),aoMapUv:N&&g(E.aoMap.channel),lightMapUv:Qe&&g(E.lightMap.channel),bumpMapUv:q&&g(E.bumpMap.channel),normalMapUv:te&&g(E.normalMap.channel),displacementMapUv:K&&g(E.displacementMap.channel),emissiveMapUv:de&&g(E.emissiveMap.channel),metalnessMapUv:Y&&g(E.metalnessMap.channel),roughnessMapUv:T&&g(E.roughnessMap.channel),anisotropyMapUv:oe&&g(E.anisotropyMap.channel),clearcoatMapUv:fe&&g(E.clearcoatMap.channel),clearcoatNormalMapUv:Ue&&g(E.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:le&&g(E.clearcoatRoughnessMap.channel),iridescenceMapUv:Ee&&g(E.iridescenceMap.channel),iridescenceThicknessMapUv:ke&&g(E.iridescenceThicknessMap.channel),sheenColorMapUv:Ie&&g(E.sheenColorMap.channel),sheenRoughnessMapUv:be&&g(E.sheenRoughnessMap.channel),specularMapUv:at&&g(E.specularMap.channel),specularColorMapUv:qe&&g(E.specularColorMap.channel),specularIntensityMapUv:At&&g(E.specularIntensityMap.channel),transmissionMapUv:F&&g(E.transmissionMap.channel),thicknessMapUv:ye&&g(E.thicknessMap.channel),alphaMapUv:re&&g(E.alphaMap.channel),vertexTangents:!!z.attributes.tangent&&(te||w),vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!z.attributes.color&&z.attributes.color.itemSize===4,pointsUvs:D.isPoints===!0&&!!z.attributes.uv&&(rt||re),fog:!!W,useFog:E.fog===!0,fogExp2:!!W&&W.isFogExp2,flatShading:E.flatShading===!0,sizeAttenuation:E.sizeAttenuation===!0,logarithmicDepthBuffer:u,reverseDepthBuffer:Re,skinning:D.isSkinnedMesh===!0,morphTargets:z.morphAttributes.position!==void 0,morphNormals:z.morphAttributes.normal!==void 0,morphColors:z.morphAttributes.color!==void 0,morphTargetsCount:ge,morphTextureStride:Oe,numDirLights:y.directional.length,numPointLights:y.point.length,numSpotLights:y.spot.length,numSpotLightMaps:y.spotLightMap.length,numRectAreaLights:y.rectArea.length,numHemiLights:y.hemi.length,numDirLightShadows:y.directionalShadowMap.length,numPointLightShadows:y.pointShadowMap.length,numSpotLightShadows:y.spotShadowMap.length,numSpotLightShadowsWithMaps:y.numSpotLightShadowsWithMaps,numLightProbes:y.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:E.dithering,shadowMapEnabled:n.shadowMap.enabled&&L.length>0,shadowMapType:n.shadowMap.type,toneMapping:Jt,decodeVideoTexture:rt&&E.map.isVideoTexture===!0&&ht.getTransfer(E.map.colorSpace)===Dt,decodeVideoTextureEmissive:de&&E.emissiveMap.isVideoTexture===!0&&ht.getTransfer(E.emissiveMap.colorSpace)===Dt,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===bi,flipSided:E.side===ni,useDepthPacking:E.depthPacking>=0,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionClipCullDistance:it&&E.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(it&&E.extensions.multiDraw===!0||Le)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:E.customProgramCacheKey()};return kn.vertexUv1s=c.has(1),kn.vertexUv2s=c.has(2),kn.vertexUv3s=c.has(3),c.clear(),kn}function v(E){const y=[];if(E.shaderID?y.push(E.shaderID):(y.push(E.customVertexShaderID),y.push(E.customFragmentShaderID)),E.defines!==void 0)for(const L in E.defines)y.push(L),y.push(E.defines[L]);return E.isRawShaderMaterial===!1&&(x(y,E),b(y,E),y.push(n.outputColorSpace)),y.push(E.customProgramCacheKey),y.join()}function x(E,y){E.push(y.precision),E.push(y.outputColorSpace),E.push(y.envMapMode),E.push(y.envMapCubeUVHeight),E.push(y.mapUv),E.push(y.alphaMapUv),E.push(y.lightMapUv),E.push(y.aoMapUv),E.push(y.bumpMapUv),E.push(y.normalMapUv),E.push(y.displacementMapUv),E.push(y.emissiveMapUv),E.push(y.metalnessMapUv),E.push(y.roughnessMapUv),E.push(y.anisotropyMapUv),E.push(y.clearcoatMapUv),E.push(y.clearcoatNormalMapUv),E.push(y.clearcoatRoughnessMapUv),E.push(y.iridescenceMapUv),E.push(y.iridescenceThicknessMapUv),E.push(y.sheenColorMapUv),E.push(y.sheenRoughnessMapUv),E.push(y.specularMapUv),E.push(y.specularColorMapUv),E.push(y.specularIntensityMapUv),E.push(y.transmissionMapUv),E.push(y.thicknessMapUv),E.push(y.combine),E.push(y.fogExp2),E.push(y.sizeAttenuation),E.push(y.morphTargetsCount),E.push(y.morphAttributeCount),E.push(y.numDirLights),E.push(y.numPointLights),E.push(y.numSpotLights),E.push(y.numSpotLightMaps),E.push(y.numHemiLights),E.push(y.numRectAreaLights),E.push(y.numDirLightShadows),E.push(y.numPointLightShadows),E.push(y.numSpotLightShadows),E.push(y.numSpotLightShadowsWithMaps),E.push(y.numLightProbes),E.push(y.shadowMapType),E.push(y.toneMapping),E.push(y.numClippingPlanes),E.push(y.numClipIntersection),E.push(y.depthPacking)}function b(E,y){a.disableAll(),y.supportsVertexTextures&&a.enable(0),y.instancing&&a.enable(1),y.instancingColor&&a.enable(2),y.instancingMorph&&a.enable(3),y.matcap&&a.enable(4),y.envMap&&a.enable(5),y.normalMapObjectSpace&&a.enable(6),y.normalMapTangentSpace&&a.enable(7),y.clearcoat&&a.enable(8),y.iridescence&&a.enable(9),y.alphaTest&&a.enable(10),y.vertexColors&&a.enable(11),y.vertexAlphas&&a.enable(12),y.vertexUv1s&&a.enable(13),y.vertexUv2s&&a.enable(14),y.vertexUv3s&&a.enable(15),y.vertexTangents&&a.enable(16),y.anisotropy&&a.enable(17),y.alphaHash&&a.enable(18),y.batching&&a.enable(19),y.dispersion&&a.enable(20),y.batchingColor&&a.enable(21),E.push(a.mask),a.disableAll(),y.fog&&a.enable(0),y.useFog&&a.enable(1),y.flatShading&&a.enable(2),y.logarithmicDepthBuffer&&a.enable(3),y.reverseDepthBuffer&&a.enable(4),y.skinning&&a.enable(5),y.morphTargets&&a.enable(6),y.morphNormals&&a.enable(7),y.morphColors&&a.enable(8),y.premultipliedAlpha&&a.enable(9),y.shadowMapEnabled&&a.enable(10),y.doubleSided&&a.enable(11),y.flipSided&&a.enable(12),y.useDepthPacking&&a.enable(13),y.dithering&&a.enable(14),y.transmission&&a.enable(15),y.sheen&&a.enable(16),y.opaque&&a.enable(17),y.pointsUvs&&a.enable(18),y.decodeVideoTexture&&a.enable(19),y.decodeVideoTextureEmissive&&a.enable(20),y.alphaToCoverage&&a.enable(21),E.push(a.mask)}function _(E){const y=f[E.type];let L;if(y){const k=Oi[y];L=Hv.clone(k.uniforms)}else L=E.uniforms;return L}function C(E,y){let L;for(let k=0,D=h.length;k<D;k++){const W=h[k];if(W.cacheKey===y){L=W,++L.usedTimes;break}}return L===void 0&&(L=new Q2(n,y,E,r),h.push(L)),L}function M(E){if(--E.usedTimes===0){const y=h.indexOf(E);h[y]=h[h.length-1],h.pop(),E.destroy()}}function S(E){l.remove(E)}function P(){l.dispose()}return{getParameters:m,getProgramCacheKey:v,getUniforms:_,acquireProgram:C,releaseProgram:M,releaseShaderCache:S,programs:h,dispose:P}}function sD(){let n=new WeakMap;function e(o){return n.has(o)}function t(o){let a=n.get(o);return a===void 0&&(a={},n.set(o,a)),a}function i(o){n.delete(o)}function s(o,a,l){n.get(o)[a]=l}function r(){n=new WeakMap}return{has:e,get:t,remove:i,update:s,dispose:r}}function rD(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function Sb(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function Cb(){const n=[];let e=0;const t=[],i=[],s=[];function r(){e=0,t.length=0,i.length=0,s.length=0}function o(u,d,p,f,g,m){let v=n[e];return v===void 0?(v={id:u.id,object:u,geometry:d,material:p,groupOrder:f,renderOrder:u.renderOrder,z:g,group:m},n[e]=v):(v.id=u.id,v.object=u,v.geometry=d,v.material=p,v.groupOrder=f,v.renderOrder=u.renderOrder,v.z=g,v.group=m),e++,v}function a(u,d,p,f,g,m){const v=o(u,d,p,f,g,m);p.transmission>0?i.push(v):p.transparent===!0?s.push(v):t.push(v)}function l(u,d,p,f,g,m){const v=o(u,d,p,f,g,m);p.transmission>0?i.unshift(v):p.transparent===!0?s.unshift(v):t.unshift(v)}function c(u,d){t.length>1&&t.sort(u||rD),i.length>1&&i.sort(d||Sb),s.length>1&&s.sort(d||Sb)}function h(){for(let u=e,d=n.length;u<d;u++){const p=n[u];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:i,transparent:s,init:r,push:a,unshift:l,finish:h,sort:c}}function oD(){let n=new WeakMap;function e(i,s){const r=n.get(i);let o;return r===void 0?(o=new Cb,n.set(i,[o])):s>=r.length?(o=new Cb,r.push(o)):o=r[s],o}function t(){n=new WeakMap}return{get:e,dispose:t}}function aD(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new R,color:new ve};break;case"SpotLight":t={position:new R,direction:new R,color:new ve,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new R,color:new ve,distance:0,decay:0};break;case"HemisphereLight":t={direction:new R,skyColor:new ve,groundColor:new ve};break;case"RectAreaLight":t={color:new ve,position:new R,halfWidth:new R,halfHeight:new R};break}return n[e.id]=t,t}}}function lD(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ee};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ee};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ee,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let cD=0;function hD(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function uD(n){const e=new aD,t=lD(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)i.probe.push(new R);const s=new R,r=new De,o=new De;function a(c){let h=0,u=0,d=0;for(let E=0;E<9;E++)i.probe[E].set(0,0,0);let p=0,f=0,g=0,m=0,v=0,x=0,b=0,_=0,C=0,M=0,S=0;c.sort(hD);for(let E=0,y=c.length;E<y;E++){const L=c[E],k=L.color,D=L.intensity,W=L.distance,z=L.shadow&&L.shadow.map?L.shadow.map.texture:null;if(L.isAmbientLight)h+=k.r*D,u+=k.g*D,d+=k.b*D;else if(L.isLightProbe){for(let H=0;H<9;H++)i.probe[H].addScaledVector(L.sh.coefficients[H],D);S++}else if(L.isDirectionalLight){const H=e.get(L);if(H.color.copy(L.color).multiplyScalar(L.intensity),L.castShadow){const ne=L.shadow,G=t.get(L);G.shadowIntensity=ne.intensity,G.shadowBias=ne.bias,G.shadowNormalBias=ne.normalBias,G.shadowRadius=ne.radius,G.shadowMapSize=ne.mapSize,i.directionalShadow[p]=G,i.directionalShadowMap[p]=z,i.directionalShadowMatrix[p]=L.shadow.matrix,x++}i.directional[p]=H,p++}else if(L.isSpotLight){const H=e.get(L);H.position.setFromMatrixPosition(L.matrixWorld),H.color.copy(k).multiplyScalar(D),H.distance=W,H.coneCos=Math.cos(L.angle),H.penumbraCos=Math.cos(L.angle*(1-L.penumbra)),H.decay=L.decay,i.spot[g]=H;const ne=L.shadow;if(L.map&&(i.spotLightMap[C]=L.map,C++,ne.updateMatrices(L),L.castShadow&&M++),i.spotLightMatrix[g]=ne.matrix,L.castShadow){const G=t.get(L);G.shadowIntensity=ne.intensity,G.shadowBias=ne.bias,G.shadowNormalBias=ne.normalBias,G.shadowRadius=ne.radius,G.shadowMapSize=ne.mapSize,i.spotShadow[g]=G,i.spotShadowMap[g]=z,_++}g++}else if(L.isRectAreaLight){const H=e.get(L);H.color.copy(k).multiplyScalar(D),H.halfWidth.set(L.width*.5,0,0),H.halfHeight.set(0,L.height*.5,0),i.rectArea[m]=H,m++}else if(L.isPointLight){const H=e.get(L);if(H.color.copy(L.color).multiplyScalar(L.intensity),H.distance=L.distance,H.decay=L.decay,L.castShadow){const ne=L.shadow,G=t.get(L);G.shadowIntensity=ne.intensity,G.shadowBias=ne.bias,G.shadowNormalBias=ne.normalBias,G.shadowRadius=ne.radius,G.shadowMapSize=ne.mapSize,G.shadowCameraNear=ne.camera.near,G.shadowCameraFar=ne.camera.far,i.pointShadow[f]=G,i.pointShadowMap[f]=z,i.pointShadowMatrix[f]=L.shadow.matrix,b++}i.point[f]=H,f++}else if(L.isHemisphereLight){const H=e.get(L);H.skyColor.copy(L.color).multiplyScalar(D),H.groundColor.copy(L.groundColor).multiplyScalar(D),i.hemi[v]=H,v++}}m>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=me.LTC_FLOAT_1,i.rectAreaLTC2=me.LTC_FLOAT_2):(i.rectAreaLTC1=me.LTC_HALF_1,i.rectAreaLTC2=me.LTC_HALF_2)),i.ambient[0]=h,i.ambient[1]=u,i.ambient[2]=d;const P=i.hash;(P.directionalLength!==p||P.pointLength!==f||P.spotLength!==g||P.rectAreaLength!==m||P.hemiLength!==v||P.numDirectionalShadows!==x||P.numPointShadows!==b||P.numSpotShadows!==_||P.numSpotMaps!==C||P.numLightProbes!==S)&&(i.directional.length=p,i.spot.length=g,i.rectArea.length=m,i.point.length=f,i.hemi.length=v,i.directionalShadow.length=x,i.directionalShadowMap.length=x,i.pointShadow.length=b,i.pointShadowMap.length=b,i.spotShadow.length=_,i.spotShadowMap.length=_,i.directionalShadowMatrix.length=x,i.pointShadowMatrix.length=b,i.spotLightMatrix.length=_+C-M,i.spotLightMap.length=C,i.numSpotLightShadowsWithMaps=M,i.numLightProbes=S,P.directionalLength=p,P.pointLength=f,P.spotLength=g,P.rectAreaLength=m,P.hemiLength=v,P.numDirectionalShadows=x,P.numPointShadows=b,P.numSpotShadows=_,P.numSpotMaps=C,P.numLightProbes=S,i.version=cD++)}function l(c,h){let u=0,d=0,p=0,f=0,g=0;const m=h.matrixWorldInverse;for(let v=0,x=c.length;v<x;v++){const b=c[v];if(b.isDirectionalLight){const _=i.directional[u];_.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),_.direction.sub(s),_.direction.transformDirection(m),u++}else if(b.isSpotLight){const _=i.spot[p];_.position.setFromMatrixPosition(b.matrixWorld),_.position.applyMatrix4(m),_.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),_.direction.sub(s),_.direction.transformDirection(m),p++}else if(b.isRectAreaLight){const _=i.rectArea[f];_.position.setFromMatrixPosition(b.matrixWorld),_.position.applyMatrix4(m),o.identity(),r.copy(b.matrixWorld),r.premultiply(m),o.extractRotation(r),_.halfWidth.set(b.width*.5,0,0),_.halfHeight.set(0,b.height*.5,0),_.halfWidth.applyMatrix4(o),_.halfHeight.applyMatrix4(o),f++}else if(b.isPointLight){const _=i.point[d];_.position.setFromMatrixPosition(b.matrixWorld),_.position.applyMatrix4(m),d++}else if(b.isHemisphereLight){const _=i.hemi[g];_.direction.setFromMatrixPosition(b.matrixWorld),_.direction.transformDirection(m),g++}}}return{setup:a,setupView:l,state:i}}function Ab(n){const e=new uD(n),t=[],i=[];function s(h){c.camera=h,t.length=0,i.length=0}function r(h){t.push(h)}function o(h){i.push(h)}function a(){e.setup(t)}function l(h){e.setupView(t,h)}const c={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:s,state:c,setupLights:a,setupLightsView:l,pushLight:r,pushShadow:o}}function dD(n){let e=new WeakMap;function t(s,r=0){const o=e.get(s);let a;return o===void 0?(a=new Ab(n),e.set(s,[a])):r>=o.length?(a=new Ab(n),o.push(a)):a=o[r],a}function i(){e=new WeakMap}return{get:t,dispose:i}}const pD=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fD=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function mD(n,e,t){let i=new Qc;const s=new ee,r=new ee,o=new ct,a=new tg({depthPacking:Cw}),l=new ng,c={},h=t.maxTextureSize,u={[ms]:ni,[ni]:ms,[bi]:bi},d=new zi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ee},radius:{value:4}},vertexShader:pD,fragmentShader:fD}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new Ye;f.setAttribute("position",new dt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new Kt(f,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Cv;let v=this.type;this.render=function(M,S,P){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||M.length===0)return;const E=n.getRenderTarget(),y=n.getActiveCubeFace(),L=n.getActiveMipmapLevel(),k=n.state;k.setBlending(js),k.buffers.color.setClear(1,1,1,1),k.buffers.depth.setTest(!0),k.setScissorTest(!1);const D=v!==os&&this.type===os,W=v===os&&this.type!==os;for(let z=0,H=M.length;z<H;z++){const ne=M[z],G=ne.shadow;if(G===void 0){console.warn("THREE.WebGLShadowMap:",ne,"has no shadow.");continue}if(G.autoUpdate===!1&&G.needsUpdate===!1)continue;s.copy(G.mapSize);const ae=G.getFrameExtents();if(s.multiply(ae),r.copy(G.mapSize),(s.x>h||s.y>h)&&(s.x>h&&(r.x=Math.floor(h/ae.x),s.x=r.x*ae.x,G.mapSize.x=r.x),s.y>h&&(r.y=Math.floor(h/ae.y),s.y=r.y*ae.y,G.mapSize.y=r.y)),G.map===null||D===!0||W===!0){const ge=this.type!==os?{minFilter:xn,magFilter:xn}:{};G.map!==null&&G.map.dispose(),G.map=new gs(s.x,s.y,ge),G.map.texture.name=ne.name+".shadowMap",G.camera.updateProjectionMatrix()}n.setRenderTarget(G.map),n.clear();const se=G.getViewportCount();for(let ge=0;ge<se;ge++){const Oe=G.getViewport(ge);o.set(r.x*Oe.x,r.y*Oe.y,r.x*Oe.z,r.y*Oe.w),k.viewport(o),G.updateMatrices(ne,ge),i=G.getFrustum(),_(S,P,G.camera,ne,this.type)}G.isPointLightShadow!==!0&&this.type===os&&x(G,P),G.needsUpdate=!1}v=this.type,m.needsUpdate=!1,n.setRenderTarget(E,y,L)};function x(M,S){const P=e.update(g);d.defines.VSM_SAMPLES!==M.blurSamples&&(d.defines.VSM_SAMPLES=M.blurSamples,p.defines.VSM_SAMPLES=M.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),M.mapPass===null&&(M.mapPass=new gs(s.x,s.y)),d.uniforms.shadow_pass.value=M.map.texture,d.uniforms.resolution.value=M.mapSize,d.uniforms.radius.value=M.radius,n.setRenderTarget(M.mapPass),n.clear(),n.renderBufferDirect(S,null,P,d,g,null),p.uniforms.shadow_pass.value=M.mapPass.texture,p.uniforms.resolution.value=M.mapSize,p.uniforms.radius.value=M.radius,n.setRenderTarget(M.map),n.clear(),n.renderBufferDirect(S,null,P,p,g,null)}function b(M,S,P,E){let y=null;const L=P.isPointLight===!0?M.customDistanceMaterial:M.customDepthMaterial;if(L!==void 0)y=L;else if(y=P.isPointLight===!0?l:a,n.localClippingEnabled&&S.clipShadows===!0&&Array.isArray(S.clippingPlanes)&&S.clippingPlanes.length!==0||S.displacementMap&&S.displacementScale!==0||S.alphaMap&&S.alphaTest>0||S.map&&S.alphaTest>0){const k=y.uuid,D=S.uuid;let W=c[k];W===void 0&&(W={},c[k]=W);let z=W[D];z===void 0&&(z=y.clone(),W[D]=z,S.addEventListener("dispose",C)),y=z}if(y.visible=S.visible,y.wireframe=S.wireframe,E===os?y.side=S.shadowSide!==null?S.shadowSide:S.side:y.side=S.shadowSide!==null?S.shadowSide:u[S.side],y.alphaMap=S.alphaMap,y.alphaTest=S.alphaTest,y.map=S.map,y.clipShadows=S.clipShadows,y.clippingPlanes=S.clippingPlanes,y.clipIntersection=S.clipIntersection,y.displacementMap=S.displacementMap,y.displacementScale=S.displacementScale,y.displacementBias=S.displacementBias,y.wireframeLinewidth=S.wireframeLinewidth,y.linewidth=S.linewidth,P.isPointLight===!0&&y.isMeshDistanceMaterial===!0){const k=n.properties.get(y);k.light=P}return y}function _(M,S,P,E,y){if(M.visible===!1)return;if(M.layers.test(S.layers)&&(M.isMesh||M.isLine||M.isPoints)&&(M.castShadow||M.receiveShadow&&y===os)&&(!M.frustumCulled||i.intersectsObject(M))){M.modelViewMatrix.multiplyMatrices(P.matrixWorldInverse,M.matrixWorld);const D=e.update(M),W=M.material;if(Array.isArray(W)){const z=D.groups;for(let H=0,ne=z.length;H<ne;H++){const G=z[H],ae=W[G.materialIndex];if(ae&&ae.visible){const se=b(M,ae,E,y);M.onBeforeShadow(n,M,S,P,D,se,G),n.renderBufferDirect(P,null,D,se,M,G),M.onAfterShadow(n,M,S,P,D,se,G)}}}else if(W.visible){const z=b(M,W,E,y);M.onBeforeShadow(n,M,S,P,D,z,null),n.renderBufferDirect(P,null,D,z,M,null),M.onAfterShadow(n,M,S,P,D,z,null)}}const k=M.children;for(let D=0,W=k.length;D<W;D++)_(k[D],S,P,E,y)}function C(M){M.target.removeEventListener("dispose",C);for(const P in c){const E=c[P],y=M.target.uuid;y in E&&(E[y].dispose(),delete E[y])}}}const vD={[Xu]:qu,[Ku]:Ju,[Yu]:Qu,[Do]:Zu,[qu]:Xu,[Ju]:Ku,[Qu]:Yu,[Zu]:Do};function gD(n,e){function t(){let F=!1;const ye=new ct;let Q=null;const re=new ct(0,0,0,0);return{setMask:function(Me){Q!==Me&&!F&&(n.colorMask(Me,Me,Me,Me),Q=Me)},setLocked:function(Me){F=Me},setClear:function(Me,we,it,Jt,kn){kn===!0&&(Me*=Jt,we*=Jt,it*=Jt),ye.set(Me,we,it,Jt),re.equals(ye)===!1&&(n.clearColor(Me,we,it,Jt),re.copy(ye))},reset:function(){F=!1,Q=null,re.set(-1,0,0,0)}}}function i(){let F=!1,ye=!1,Q=null,re=null,Me=null;return{setReversed:function(we){if(ye!==we){const it=e.get("EXT_clip_control");we?it.clipControlEXT(it.LOWER_LEFT_EXT,it.ZERO_TO_ONE_EXT):it.clipControlEXT(it.LOWER_LEFT_EXT,it.NEGATIVE_ONE_TO_ONE_EXT),ye=we;const Jt=Me;Me=null,this.setClear(Jt)}},getReversed:function(){return ye},setTest:function(we){we?pe(n.DEPTH_TEST):Re(n.DEPTH_TEST)},setMask:function(we){Q!==we&&!F&&(n.depthMask(we),Q=we)},setFunc:function(we){if(ye&&(we=vD[we]),re!==we){switch(we){case Xu:n.depthFunc(n.NEVER);break;case qu:n.depthFunc(n.ALWAYS);break;case Ku:n.depthFunc(n.LESS);break;case Do:n.depthFunc(n.LEQUAL);break;case Yu:n.depthFunc(n.EQUAL);break;case Zu:n.depthFunc(n.GEQUAL);break;case Ju:n.depthFunc(n.GREATER);break;case Qu:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}re=we}},setLocked:function(we){F=we},setClear:function(we){Me!==we&&(ye&&(we=1-we),n.clearDepth(we),Me=we)},reset:function(){F=!1,Q=null,re=null,Me=null,ye=!1}}}function s(){let F=!1,ye=null,Q=null,re=null,Me=null,we=null,it=null,Jt=null,kn=null;return{setTest:function(It){F||(It?pe(n.STENCIL_TEST):Re(n.STENCIL_TEST))},setMask:function(It){ye!==It&&!F&&(n.stencilMask(It),ye=It)},setFunc:function(It,ji,Cs){(Q!==It||re!==ji||Me!==Cs)&&(n.stencilFunc(It,ji,Cs),Q=It,re=ji,Me=Cs)},setOp:function(It,ji,Cs){(we!==It||it!==ji||Jt!==Cs)&&(n.stencilOp(It,ji,Cs),we=It,it=ji,Jt=Cs)},setLocked:function(It){F=It},setClear:function(It){kn!==It&&(n.clearStencil(It),kn=It)},reset:function(){F=!1,ye=null,Q=null,re=null,Me=null,we=null,it=null,Jt=null,kn=null}}}const r=new t,o=new i,a=new s,l=new WeakMap,c=new WeakMap;let h={},u={},d=new WeakMap,p=[],f=null,g=!1,m=null,v=null,x=null,b=null,_=null,C=null,M=null,S=new ve(0,0,0),P=0,E=!1,y=null,L=null,k=null,D=null,W=null;const z=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let H=!1,ne=0;const G=n.getParameter(n.VERSION);G.indexOf("WebGL")!==-1?(ne=parseFloat(/^WebGL (\d)/.exec(G)[1]),H=ne>=1):G.indexOf("OpenGL ES")!==-1&&(ne=parseFloat(/^OpenGL ES (\d)/.exec(G)[1]),H=ne>=2);let ae=null,se={};const ge=n.getParameter(n.SCISSOR_BOX),Oe=n.getParameter(n.VIEWPORT),Ze=new ct().fromArray(ge),J=new ct().fromArray(Oe);function ce(F,ye,Q,re){const Me=new Uint8Array(4),we=n.createTexture();n.bindTexture(F,we),n.texParameteri(F,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(F,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let it=0;it<Q;it++)F===n.TEXTURE_3D||F===n.TEXTURE_2D_ARRAY?n.texImage3D(ye,0,n.RGBA,1,1,re,0,n.RGBA,n.UNSIGNED_BYTE,Me):n.texImage2D(ye+it,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Me);return we}const _e={};_e[n.TEXTURE_2D]=ce(n.TEXTURE_2D,n.TEXTURE_2D,1),_e[n.TEXTURE_CUBE_MAP]=ce(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),_e[n.TEXTURE_2D_ARRAY]=ce(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),_e[n.TEXTURE_3D]=ce(n.TEXTURE_3D,n.TEXTURE_3D,1,1),r.setClear(0,0,0,1),o.setClear(1),a.setClear(0),pe(n.DEPTH_TEST),o.setFunc(Do),q(!1),te(Bm),pe(n.CULL_FACE),N(js);function pe(F){h[F]!==!0&&(n.enable(F),h[F]=!0)}function Re(F){h[F]!==!1&&(n.disable(F),h[F]=!1)}function nt(F,ye){return u[F]!==ye?(n.bindFramebuffer(F,ye),u[F]=ye,F===n.DRAW_FRAMEBUFFER&&(u[n.FRAMEBUFFER]=ye),F===n.FRAMEBUFFER&&(u[n.DRAW_FRAMEBUFFER]=ye),!0):!1}function Le(F,ye){let Q=p,re=!1;if(F){Q=d.get(ye),Q===void 0&&(Q=[],d.set(ye,Q));const Me=F.textures;if(Q.length!==Me.length||Q[0]!==n.COLOR_ATTACHMENT0){for(let we=0,it=Me.length;we<it;we++)Q[we]=n.COLOR_ATTACHMENT0+we;Q.length=Me.length,re=!0}}else Q[0]!==n.BACK&&(Q[0]=n.BACK,re=!0);re&&n.drawBuffers(Q)}function rt(F){return f!==F?(n.useProgram(F),f=F,!0):!1}const mt={[yr]:n.FUNC_ADD,[Ky]:n.FUNC_SUBTRACT,[Yy]:n.FUNC_REVERSE_SUBTRACT};mt[Zy]=n.MIN,mt[Jy]=n.MAX;const Ge={[Qy]:n.ZERO,[ew]:n.ONE,[tw]:n.SRC_COLOR,[$u]:n.SRC_ALPHA,[aw]:n.SRC_ALPHA_SATURATE,[rw]:n.DST_COLOR,[iw]:n.DST_ALPHA,[nw]:n.ONE_MINUS_SRC_COLOR,[ju]:n.ONE_MINUS_SRC_ALPHA,[ow]:n.ONE_MINUS_DST_COLOR,[sw]:n.ONE_MINUS_DST_ALPHA,[lw]:n.CONSTANT_COLOR,[cw]:n.ONE_MINUS_CONSTANT_COLOR,[hw]:n.CONSTANT_ALPHA,[uw]:n.ONE_MINUS_CONSTANT_ALPHA};function N(F,ye,Q,re,Me,we,it,Jt,kn,It){if(F===js){g===!0&&(Re(n.BLEND),g=!1);return}if(g===!1&&(pe(n.BLEND),g=!0),F!==qy){if(F!==m||It!==E){if((v!==yr||_!==yr)&&(n.blendEquation(n.FUNC_ADD),v=yr,_=yr),It)switch(F){case Po:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Wu:n.blendFunc(n.ONE,n.ONE);break;case Vm:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case zm:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",F);break}else switch(F){case Po:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Wu:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case Vm:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case zm:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",F);break}x=null,b=null,C=null,M=null,S.set(0,0,0),P=0,m=F,E=It}return}Me=Me||ye,we=we||Q,it=it||re,(ye!==v||Me!==_)&&(n.blendEquationSeparate(mt[ye],mt[Me]),v=ye,_=Me),(Q!==x||re!==b||we!==C||it!==M)&&(n.blendFuncSeparate(Ge[Q],Ge[re],Ge[we],Ge[it]),x=Q,b=re,C=we,M=it),(Jt.equals(S)===!1||kn!==P)&&(n.blendColor(Jt.r,Jt.g,Jt.b,kn),S.copy(Jt),P=kn),m=F,E=!1}function Qe(F,ye){F.side===bi?Re(n.CULL_FACE):pe(n.CULL_FACE);let Q=F.side===ni;ye&&(Q=!Q),q(Q),F.blending===Po&&F.transparent===!1?N(js):N(F.blending,F.blendEquation,F.blendSrc,F.blendDst,F.blendEquationAlpha,F.blendSrcAlpha,F.blendDstAlpha,F.blendColor,F.blendAlpha,F.premultipliedAlpha),o.setFunc(F.depthFunc),o.setTest(F.depthTest),o.setMask(F.depthWrite),r.setMask(F.colorWrite);const re=F.stencilWrite;a.setTest(re),re&&(a.setMask(F.stencilWriteMask),a.setFunc(F.stencilFunc,F.stencilRef,F.stencilFuncMask),a.setOp(F.stencilFail,F.stencilZFail,F.stencilZPass)),de(F.polygonOffset,F.polygonOffsetFactor,F.polygonOffsetUnits),F.alphaToCoverage===!0?pe(n.SAMPLE_ALPHA_TO_COVERAGE):Re(n.SAMPLE_ALPHA_TO_COVERAGE)}function q(F){y!==F&&(F?n.frontFace(n.CW):n.frontFace(n.CCW),y=F)}function te(F){F!==jy?(pe(n.CULL_FACE),F!==L&&(F===Bm?n.cullFace(n.BACK):F===Xy?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Re(n.CULL_FACE),L=F}function K(F){F!==k&&(H&&n.lineWidth(F),k=F)}function de(F,ye,Q){F?(pe(n.POLYGON_OFFSET_FILL),(D!==ye||W!==Q)&&(n.polygonOffset(ye,Q),D=ye,W=Q)):Re(n.POLYGON_OFFSET_FILL)}function Y(F){F?pe(n.SCISSOR_TEST):Re(n.SCISSOR_TEST)}function T(F){F===void 0&&(F=n.TEXTURE0+z-1),ae!==F&&(n.activeTexture(F),ae=F)}function w(F,ye,Q){Q===void 0&&(ae===null?Q=n.TEXTURE0+z-1:Q=ae);let re=se[Q];re===void 0&&(re={type:void 0,texture:void 0},se[Q]=re),(re.type!==F||re.texture!==ye)&&(ae!==Q&&(n.activeTexture(Q),ae=Q),n.bindTexture(F,ye||_e[F]),re.type=F,re.texture=ye)}function U(){const F=se[ae];F!==void 0&&F.type!==void 0&&(n.bindTexture(F.type,null),F.type=void 0,F.texture=void 0)}function j(){try{n.compressedTexImage2D(...arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function Z(){try{n.compressedTexImage3D(...arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function O(){try{n.texSubImage2D(...arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function he(){try{n.texSubImage3D(...arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function oe(){try{n.compressedTexSubImage2D(...arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function fe(){try{n.compressedTexSubImage3D(...arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function Ue(){try{n.texStorage2D(...arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function le(){try{n.texStorage3D(...arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function Ee(){try{n.texImage2D(...arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function ke(){try{n.texImage3D(...arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function Ie(F){Ze.equals(F)===!1&&(n.scissor(F.x,F.y,F.z,F.w),Ze.copy(F))}function be(F){J.equals(F)===!1&&(n.viewport(F.x,F.y,F.z,F.w),J.copy(F))}function at(F,ye){let Q=c.get(ye);Q===void 0&&(Q=new WeakMap,c.set(ye,Q));let re=Q.get(F);re===void 0&&(re=n.getUniformBlockIndex(ye,F.name),Q.set(F,re))}function qe(F,ye){const re=c.get(ye).get(F);l.get(ye)!==re&&(n.uniformBlockBinding(ye,re,F.__bindingPointIndex),l.set(ye,re))}function At(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),o.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),h={},ae=null,se={},u={},d=new WeakMap,p=[],f=null,g=!1,m=null,v=null,x=null,b=null,_=null,C=null,M=null,S=new ve(0,0,0),P=0,E=!1,y=null,L=null,k=null,D=null,W=null,Ze.set(0,0,n.canvas.width,n.canvas.height),J.set(0,0,n.canvas.width,n.canvas.height),r.reset(),o.reset(),a.reset()}return{buffers:{color:r,depth:o,stencil:a},enable:pe,disable:Re,bindFramebuffer:nt,drawBuffers:Le,useProgram:rt,setBlending:N,setMaterial:Qe,setFlipSided:q,setCullFace:te,setLineWidth:K,setPolygonOffset:de,setScissorTest:Y,activeTexture:T,bindTexture:w,unbindTexture:U,compressedTexImage2D:j,compressedTexImage3D:Z,texImage2D:Ee,texImage3D:ke,updateUBOMapping:at,uniformBlockBinding:qe,texStorage2D:Ue,texStorage3D:le,texSubImage2D:O,texSubImage3D:he,compressedTexSubImage2D:oe,compressedTexSubImage3D:fe,scissor:Ie,viewport:be,reset:At}}function _D(n,e,t,i,s,r,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new ee,h=new WeakMap;let u;const d=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function f(T,w){return p?new OffscreenCanvas(T,w):Ec("canvas")}function g(T,w,U){let j=1;const Z=Y(T);if((Z.width>U||Z.height>U)&&(j=U/Math.max(Z.width,Z.height)),j<1)if(typeof HTMLImageElement<"u"&&T instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&T instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&T instanceof ImageBitmap||typeof VideoFrame<"u"&&T instanceof VideoFrame){const O=Math.floor(j*Z.width),he=Math.floor(j*Z.height);u===void 0&&(u=f(O,he));const oe=w?f(O,he):u;return oe.width=O,oe.height=he,oe.getContext("2d").drawImage(T,0,0,O,he),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Z.width+"x"+Z.height+") to ("+O+"x"+he+")."),oe}else return"data"in T&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Z.width+"x"+Z.height+")."),T;return T}function m(T){return T.generateMipmaps}function v(T){n.generateMipmap(T)}function x(T){return T.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:T.isWebGL3DRenderTarget?n.TEXTURE_3D:T.isWebGLArrayRenderTarget||T.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function b(T,w,U,j,Z=!1){if(T!==null){if(n[T]!==void 0)return n[T];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+T+"'")}let O=w;if(w===n.RED&&(U===n.FLOAT&&(O=n.R32F),U===n.HALF_FLOAT&&(O=n.R16F),U===n.UNSIGNED_BYTE&&(O=n.R8)),w===n.RED_INTEGER&&(U===n.UNSIGNED_BYTE&&(O=n.R8UI),U===n.UNSIGNED_SHORT&&(O=n.R16UI),U===n.UNSIGNED_INT&&(O=n.R32UI),U===n.BYTE&&(O=n.R8I),U===n.SHORT&&(O=n.R16I),U===n.INT&&(O=n.R32I)),w===n.RG&&(U===n.FLOAT&&(O=n.RG32F),U===n.HALF_FLOAT&&(O=n.RG16F),U===n.UNSIGNED_BYTE&&(O=n.RG8)),w===n.RG_INTEGER&&(U===n.UNSIGNED_BYTE&&(O=n.RG8UI),U===n.UNSIGNED_SHORT&&(O=n.RG16UI),U===n.UNSIGNED_INT&&(O=n.RG32UI),U===n.BYTE&&(O=n.RG8I),U===n.SHORT&&(O=n.RG16I),U===n.INT&&(O=n.RG32I)),w===n.RGB_INTEGER&&(U===n.UNSIGNED_BYTE&&(O=n.RGB8UI),U===n.UNSIGNED_SHORT&&(O=n.RGB16UI),U===n.UNSIGNED_INT&&(O=n.RGB32UI),U===n.BYTE&&(O=n.RGB8I),U===n.SHORT&&(O=n.RGB16I),U===n.INT&&(O=n.RGB32I)),w===n.RGBA_INTEGER&&(U===n.UNSIGNED_BYTE&&(O=n.RGBA8UI),U===n.UNSIGNED_SHORT&&(O=n.RGBA16UI),U===n.UNSIGNED_INT&&(O=n.RGBA32UI),U===n.BYTE&&(O=n.RGBA8I),U===n.SHORT&&(O=n.RGBA16I),U===n.INT&&(O=n.RGBA32I)),w===n.RGB&&U===n.UNSIGNED_INT_5_9_9_9_REV&&(O=n.RGB9_E5),w===n.RGBA){const he=Z?xc:ht.getTransfer(j);U===n.FLOAT&&(O=n.RGBA32F),U===n.HALF_FLOAT&&(O=n.RGBA16F),U===n.UNSIGNED_BYTE&&(O=he===Dt?n.SRGB8_ALPHA8:n.RGBA8),U===n.UNSIGNED_SHORT_4_4_4_4&&(O=n.RGBA4),U===n.UNSIGNED_SHORT_5_5_5_1&&(O=n.RGB5_A1)}return(O===n.R16F||O===n.R32F||O===n.RG16F||O===n.RG32F||O===n.RGBA16F||O===n.RGBA32F)&&e.get("EXT_color_buffer_float"),O}function _(T,w){let U;return T?w===null||w===Zs||w===Ya?U=n.DEPTH24_STENCIL8:w===di?U=n.DEPTH32F_STENCIL8:w===Ka&&(U=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):w===null||w===Zs||w===Ya?U=n.DEPTH_COMPONENT24:w===di?U=n.DEPTH_COMPONENT32F:w===Ka&&(U=n.DEPTH_COMPONENT16),U}function C(T,w){return m(T)===!0||T.isFramebufferTexture&&T.minFilter!==xn&&T.minFilter!==sn?Math.log2(Math.max(w.width,w.height))+1:T.mipmaps!==void 0&&T.mipmaps.length>0?T.mipmaps.length:T.isCompressedTexture&&Array.isArray(T.image)?w.mipmaps.length:1}function M(T){const w=T.target;w.removeEventListener("dispose",M),P(w),w.isVideoTexture&&h.delete(w)}function S(T){const w=T.target;w.removeEventListener("dispose",S),y(w)}function P(T){const w=i.get(T);if(w.__webglInit===void 0)return;const U=T.source,j=d.get(U);if(j){const Z=j[w.__cacheKey];Z.usedTimes--,Z.usedTimes===0&&E(T),Object.keys(j).length===0&&d.delete(U)}i.remove(T)}function E(T){const w=i.get(T);n.deleteTexture(w.__webglTexture);const U=T.source,j=d.get(U);delete j[w.__cacheKey],o.memory.textures--}function y(T){const w=i.get(T);if(T.depthTexture&&(T.depthTexture.dispose(),i.remove(T.depthTexture)),T.isWebGLCubeRenderTarget)for(let j=0;j<6;j++){if(Array.isArray(w.__webglFramebuffer[j]))for(let Z=0;Z<w.__webglFramebuffer[j].length;Z++)n.deleteFramebuffer(w.__webglFramebuffer[j][Z]);else n.deleteFramebuffer(w.__webglFramebuffer[j]);w.__webglDepthbuffer&&n.deleteRenderbuffer(w.__webglDepthbuffer[j])}else{if(Array.isArray(w.__webglFramebuffer))for(let j=0;j<w.__webglFramebuffer.length;j++)n.deleteFramebuffer(w.__webglFramebuffer[j]);else n.deleteFramebuffer(w.__webglFramebuffer);if(w.__webglDepthbuffer&&n.deleteRenderbuffer(w.__webglDepthbuffer),w.__webglMultisampledFramebuffer&&n.deleteFramebuffer(w.__webglMultisampledFramebuffer),w.__webglColorRenderbuffer)for(let j=0;j<w.__webglColorRenderbuffer.length;j++)w.__webglColorRenderbuffer[j]&&n.deleteRenderbuffer(w.__webglColorRenderbuffer[j]);w.__webglDepthRenderbuffer&&n.deleteRenderbuffer(w.__webglDepthRenderbuffer)}const U=T.textures;for(let j=0,Z=U.length;j<Z;j++){const O=i.get(U[j]);O.__webglTexture&&(n.deleteTexture(O.__webglTexture),o.memory.textures--),i.remove(U[j])}i.remove(T)}let L=0;function k(){L=0}function D(){const T=L;return T>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+T+" texture units while this GPU supports only "+s.maxTextures),L+=1,T}function W(T){const w=[];return w.push(T.wrapS),w.push(T.wrapT),w.push(T.wrapR||0),w.push(T.magFilter),w.push(T.minFilter),w.push(T.anisotropy),w.push(T.internalFormat),w.push(T.format),w.push(T.type),w.push(T.generateMipmaps),w.push(T.premultiplyAlpha),w.push(T.flipY),w.push(T.unpackAlignment),w.push(T.colorSpace),w.join()}function z(T,w){const U=i.get(T);if(T.isVideoTexture&&K(T),T.isRenderTargetTexture===!1&&T.version>0&&U.__version!==T.version){const j=T.image;if(j===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(j.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{J(U,T,w);return}}t.bindTexture(n.TEXTURE_2D,U.__webglTexture,n.TEXTURE0+w)}function H(T,w){const U=i.get(T);if(T.version>0&&U.__version!==T.version){J(U,T,w);return}t.bindTexture(n.TEXTURE_2D_ARRAY,U.__webglTexture,n.TEXTURE0+w)}function ne(T,w){const U=i.get(T);if(T.version>0&&U.__version!==T.version){J(U,T,w);return}t.bindTexture(n.TEXTURE_3D,U.__webglTexture,n.TEXTURE0+w)}function G(T,w){const U=i.get(T);if(T.version>0&&U.__version!==T.version){ce(U,T,w);return}t.bindTexture(n.TEXTURE_CUBE_MAP,U.__webglTexture,n.TEXTURE0+w)}const ae={[Rr]:n.REPEAT,[xi]:n.CLAMP_TO_EDGE,[qa]:n.MIRRORED_REPEAT},se={[xn]:n.NEAREST,[Yd]:n.NEAREST_MIPMAP_NEAREST,[wo]:n.NEAREST_MIPMAP_LINEAR,[sn]:n.LINEAR,[Fa]:n.LINEAR_MIPMAP_NEAREST,[ki]:n.LINEAR_MIPMAP_LINEAR},ge={[Tw]:n.NEVER,[Nw]:n.ALWAYS,[Pw]:n.LESS,[Fv]:n.LEQUAL,[Rw]:n.EQUAL,[Dw]:n.GEQUAL,[Lw]:n.GREATER,[Iw]:n.NOTEQUAL};function Oe(T,w){if(w.type===di&&e.has("OES_texture_float_linear")===!1&&(w.magFilter===sn||w.magFilter===Fa||w.magFilter===wo||w.magFilter===ki||w.minFilter===sn||w.minFilter===Fa||w.minFilter===wo||w.minFilter===ki)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(T,n.TEXTURE_WRAP_S,ae[w.wrapS]),n.texParameteri(T,n.TEXTURE_WRAP_T,ae[w.wrapT]),(T===n.TEXTURE_3D||T===n.TEXTURE_2D_ARRAY)&&n.texParameteri(T,n.TEXTURE_WRAP_R,ae[w.wrapR]),n.texParameteri(T,n.TEXTURE_MAG_FILTER,se[w.magFilter]),n.texParameteri(T,n.TEXTURE_MIN_FILTER,se[w.minFilter]),w.compareFunction&&(n.texParameteri(T,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(T,n.TEXTURE_COMPARE_FUNC,ge[w.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(w.magFilter===xn||w.minFilter!==wo&&w.minFilter!==ki||w.type===di&&e.has("OES_texture_float_linear")===!1)return;if(w.anisotropy>1||i.get(w).__currentAnisotropy){const U=e.get("EXT_texture_filter_anisotropic");n.texParameterf(T,U.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(w.anisotropy,s.getMaxAnisotropy())),i.get(w).__currentAnisotropy=w.anisotropy}}}function Ze(T,w){let U=!1;T.__webglInit===void 0&&(T.__webglInit=!0,w.addEventListener("dispose",M));const j=w.source;let Z=d.get(j);Z===void 0&&(Z={},d.set(j,Z));const O=W(w);if(O!==T.__cacheKey){Z[O]===void 0&&(Z[O]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,U=!0),Z[O].usedTimes++;const he=Z[T.__cacheKey];he!==void 0&&(Z[T.__cacheKey].usedTimes--,he.usedTimes===0&&E(w)),T.__cacheKey=O,T.__webglTexture=Z[O].texture}return U}function J(T,w,U){let j=n.TEXTURE_2D;(w.isDataArrayTexture||w.isCompressedArrayTexture)&&(j=n.TEXTURE_2D_ARRAY),w.isData3DTexture&&(j=n.TEXTURE_3D);const Z=Ze(T,w),O=w.source;t.bindTexture(j,T.__webglTexture,n.TEXTURE0+U);const he=i.get(O);if(O.version!==he.__version||Z===!0){t.activeTexture(n.TEXTURE0+U);const oe=ht.getPrimaries(ht.workingColorSpace),fe=w.colorSpace===Vs?null:ht.getPrimaries(w.colorSpace),Ue=w.colorSpace===Vs||oe===fe?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,w.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,w.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,w.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ue);let le=g(w.image,!1,s.maxTextureSize);le=de(w,le);const Ee=r.convert(w.format,w.colorSpace),ke=r.convert(w.type);let Ie=b(w.internalFormat,Ee,ke,w.colorSpace,w.isVideoTexture);Oe(j,w);let be;const at=w.mipmaps,qe=w.isVideoTexture!==!0,At=he.__version===void 0||Z===!0,F=O.dataReady,ye=C(w,le);if(w.isDepthTexture)Ie=_(w.format===Ja,w.type),At&&(qe?t.texStorage2D(n.TEXTURE_2D,1,Ie,le.width,le.height):t.texImage2D(n.TEXTURE_2D,0,Ie,le.width,le.height,0,Ee,ke,null));else if(w.isDataTexture)if(at.length>0){qe&&At&&t.texStorage2D(n.TEXTURE_2D,ye,Ie,at[0].width,at[0].height);for(let Q=0,re=at.length;Q<re;Q++)be=at[Q],qe?F&&t.texSubImage2D(n.TEXTURE_2D,Q,0,0,be.width,be.height,Ee,ke,be.data):t.texImage2D(n.TEXTURE_2D,Q,Ie,be.width,be.height,0,Ee,ke,be.data);w.generateMipmaps=!1}else qe?(At&&t.texStorage2D(n.TEXTURE_2D,ye,Ie,le.width,le.height),F&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,le.width,le.height,Ee,ke,le.data)):t.texImage2D(n.TEXTURE_2D,0,Ie,le.width,le.height,0,Ee,ke,le.data);else if(w.isCompressedTexture)if(w.isCompressedArrayTexture){qe&&At&&t.texStorage3D(n.TEXTURE_2D_ARRAY,ye,Ie,at[0].width,at[0].height,le.depth);for(let Q=0,re=at.length;Q<re;Q++)if(be=at[Q],w.format!==ei)if(Ee!==null)if(qe){if(F)if(w.layerUpdates.size>0){const Me=Ym(be.width,be.height,w.format,w.type);for(const we of w.layerUpdates){const it=be.data.subarray(we*Me/be.data.BYTES_PER_ELEMENT,(we+1)*Me/be.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Q,0,0,we,be.width,be.height,1,Ee,it)}w.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Q,0,0,0,be.width,be.height,le.depth,Ee,be.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,Q,Ie,be.width,be.height,le.depth,0,be.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else qe?F&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,Q,0,0,0,be.width,be.height,le.depth,Ee,ke,be.data):t.texImage3D(n.TEXTURE_2D_ARRAY,Q,Ie,be.width,be.height,le.depth,0,Ee,ke,be.data)}else{qe&&At&&t.texStorage2D(n.TEXTURE_2D,ye,Ie,at[0].width,at[0].height);for(let Q=0,re=at.length;Q<re;Q++)be=at[Q],w.format!==ei?Ee!==null?qe?F&&t.compressedTexSubImage2D(n.TEXTURE_2D,Q,0,0,be.width,be.height,Ee,be.data):t.compressedTexImage2D(n.TEXTURE_2D,Q,Ie,be.width,be.height,0,be.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):qe?F&&t.texSubImage2D(n.TEXTURE_2D,Q,0,0,be.width,be.height,Ee,ke,be.data):t.texImage2D(n.TEXTURE_2D,Q,Ie,be.width,be.height,0,Ee,ke,be.data)}else if(w.isDataArrayTexture)if(qe){if(At&&t.texStorage3D(n.TEXTURE_2D_ARRAY,ye,Ie,le.width,le.height,le.depth),F)if(w.layerUpdates.size>0){const Q=Ym(le.width,le.height,w.format,w.type);for(const re of w.layerUpdates){const Me=le.data.subarray(re*Q/le.data.BYTES_PER_ELEMENT,(re+1)*Q/le.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,re,le.width,le.height,1,Ee,ke,Me)}w.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,le.width,le.height,le.depth,Ee,ke,le.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,Ie,le.width,le.height,le.depth,0,Ee,ke,le.data);else if(w.isData3DTexture)qe?(At&&t.texStorage3D(n.TEXTURE_3D,ye,Ie,le.width,le.height,le.depth),F&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,le.width,le.height,le.depth,Ee,ke,le.data)):t.texImage3D(n.TEXTURE_3D,0,Ie,le.width,le.height,le.depth,0,Ee,ke,le.data);else if(w.isFramebufferTexture){if(At)if(qe)t.texStorage2D(n.TEXTURE_2D,ye,Ie,le.width,le.height);else{let Q=le.width,re=le.height;for(let Me=0;Me<ye;Me++)t.texImage2D(n.TEXTURE_2D,Me,Ie,Q,re,0,Ee,ke,null),Q>>=1,re>>=1}}else if(at.length>0){if(qe&&At){const Q=Y(at[0]);t.texStorage2D(n.TEXTURE_2D,ye,Ie,Q.width,Q.height)}for(let Q=0,re=at.length;Q<re;Q++)be=at[Q],qe?F&&t.texSubImage2D(n.TEXTURE_2D,Q,0,0,Ee,ke,be):t.texImage2D(n.TEXTURE_2D,Q,Ie,Ee,ke,be);w.generateMipmaps=!1}else if(qe){if(At){const Q=Y(le);t.texStorage2D(n.TEXTURE_2D,ye,Ie,Q.width,Q.height)}F&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Ee,ke,le)}else t.texImage2D(n.TEXTURE_2D,0,Ie,Ee,ke,le);m(w)&&v(j),he.__version=O.version,w.onUpdate&&w.onUpdate(w)}T.__version=w.version}function ce(T,w,U){if(w.image.length!==6)return;const j=Ze(T,w),Z=w.source;t.bindTexture(n.TEXTURE_CUBE_MAP,T.__webglTexture,n.TEXTURE0+U);const O=i.get(Z);if(Z.version!==O.__version||j===!0){t.activeTexture(n.TEXTURE0+U);const he=ht.getPrimaries(ht.workingColorSpace),oe=w.colorSpace===Vs?null:ht.getPrimaries(w.colorSpace),fe=w.colorSpace===Vs||he===oe?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,w.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,w.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,w.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,fe);const Ue=w.isCompressedTexture||w.image[0].isCompressedTexture,le=w.image[0]&&w.image[0].isDataTexture,Ee=[];for(let re=0;re<6;re++)!Ue&&!le?Ee[re]=g(w.image[re],!0,s.maxCubemapSize):Ee[re]=le?w.image[re].image:w.image[re],Ee[re]=de(w,Ee[re]);const ke=Ee[0],Ie=r.convert(w.format,w.colorSpace),be=r.convert(w.type),at=b(w.internalFormat,Ie,be,w.colorSpace),qe=w.isVideoTexture!==!0,At=O.__version===void 0||j===!0,F=Z.dataReady;let ye=C(w,ke);Oe(n.TEXTURE_CUBE_MAP,w);let Q;if(Ue){qe&&At&&t.texStorage2D(n.TEXTURE_CUBE_MAP,ye,at,ke.width,ke.height);for(let re=0;re<6;re++){Q=Ee[re].mipmaps;for(let Me=0;Me<Q.length;Me++){const we=Q[Me];w.format!==ei?Ie!==null?qe?F&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Me,0,0,we.width,we.height,Ie,we.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Me,at,we.width,we.height,0,we.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):qe?F&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Me,0,0,we.width,we.height,Ie,be,we.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Me,at,we.width,we.height,0,Ie,be,we.data)}}}else{if(Q=w.mipmaps,qe&&At){Q.length>0&&ye++;const re=Y(Ee[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,ye,at,re.width,re.height)}for(let re=0;re<6;re++)if(le){qe?F&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,0,0,Ee[re].width,Ee[re].height,Ie,be,Ee[re].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,at,Ee[re].width,Ee[re].height,0,Ie,be,Ee[re].data);for(let Me=0;Me<Q.length;Me++){const it=Q[Me].image[re].image;qe?F&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Me+1,0,0,it.width,it.height,Ie,be,it.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Me+1,at,it.width,it.height,0,Ie,be,it.data)}}else{qe?F&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,0,0,Ie,be,Ee[re]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,at,Ie,be,Ee[re]);for(let Me=0;Me<Q.length;Me++){const we=Q[Me];qe?F&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Me+1,0,0,Ie,be,we.image[re]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+re,Me+1,at,Ie,be,we.image[re])}}}m(w)&&v(n.TEXTURE_CUBE_MAP),O.__version=Z.version,w.onUpdate&&w.onUpdate(w)}T.__version=w.version}function _e(T,w,U,j,Z,O){const he=r.convert(U.format,U.colorSpace),oe=r.convert(U.type),fe=b(U.internalFormat,he,oe,U.colorSpace),Ue=i.get(w),le=i.get(U);if(le.__renderTarget=w,!Ue.__hasExternalTextures){const Ee=Math.max(1,w.width>>O),ke=Math.max(1,w.height>>O);Z===n.TEXTURE_3D||Z===n.TEXTURE_2D_ARRAY?t.texImage3D(Z,O,fe,Ee,ke,w.depth,0,he,oe,null):t.texImage2D(Z,O,fe,Ee,ke,0,he,oe,null)}t.bindFramebuffer(n.FRAMEBUFFER,T),te(w)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,j,Z,le.__webglTexture,0,q(w)):(Z===n.TEXTURE_2D||Z>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Z<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,j,Z,le.__webglTexture,O),t.bindFramebuffer(n.FRAMEBUFFER,null)}function pe(T,w,U){if(n.bindRenderbuffer(n.RENDERBUFFER,T),w.depthBuffer){const j=w.depthTexture,Z=j&&j.isDepthTexture?j.type:null,O=_(w.stencilBuffer,Z),he=w.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,oe=q(w);te(w)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,oe,O,w.width,w.height):U?n.renderbufferStorageMultisample(n.RENDERBUFFER,oe,O,w.width,w.height):n.renderbufferStorage(n.RENDERBUFFER,O,w.width,w.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,he,n.RENDERBUFFER,T)}else{const j=w.textures;for(let Z=0;Z<j.length;Z++){const O=j[Z],he=r.convert(O.format,O.colorSpace),oe=r.convert(O.type),fe=b(O.internalFormat,he,oe,O.colorSpace),Ue=q(w);U&&te(w)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Ue,fe,w.width,w.height):te(w)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Ue,fe,w.width,w.height):n.renderbufferStorage(n.RENDERBUFFER,fe,w.width,w.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Re(T,w){if(w&&w.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,T),!(w.depthTexture&&w.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const j=i.get(w.depthTexture);j.__renderTarget=w,(!j.__webglTexture||w.depthTexture.image.width!==w.width||w.depthTexture.image.height!==w.height)&&(w.depthTexture.image.width=w.width,w.depthTexture.image.height=w.height,w.depthTexture.needsUpdate=!0),z(w.depthTexture,0);const Z=j.__webglTexture,O=q(w);if(w.depthTexture.format===Za)te(w)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Z,0,O):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Z,0);else if(w.depthTexture.format===Ja)te(w)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Z,0,O):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Z,0);else throw new Error("Unknown depthTexture format")}function nt(T){const w=i.get(T),U=T.isWebGLCubeRenderTarget===!0;if(w.__boundDepthTexture!==T.depthTexture){const j=T.depthTexture;if(w.__depthDisposeCallback&&w.__depthDisposeCallback(),j){const Z=()=>{delete w.__boundDepthTexture,delete w.__depthDisposeCallback,j.removeEventListener("dispose",Z)};j.addEventListener("dispose",Z),w.__depthDisposeCallback=Z}w.__boundDepthTexture=j}if(T.depthTexture&&!w.__autoAllocateDepthBuffer){if(U)throw new Error("target.depthTexture not supported in Cube render targets");Re(w.__webglFramebuffer,T)}else if(U){w.__webglDepthbuffer=[];for(let j=0;j<6;j++)if(t.bindFramebuffer(n.FRAMEBUFFER,w.__webglFramebuffer[j]),w.__webglDepthbuffer[j]===void 0)w.__webglDepthbuffer[j]=n.createRenderbuffer(),pe(w.__webglDepthbuffer[j],T,!1);else{const Z=T.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,O=w.__webglDepthbuffer[j];n.bindRenderbuffer(n.RENDERBUFFER,O),n.framebufferRenderbuffer(n.FRAMEBUFFER,Z,n.RENDERBUFFER,O)}}else if(t.bindFramebuffer(n.FRAMEBUFFER,w.__webglFramebuffer),w.__webglDepthbuffer===void 0)w.__webglDepthbuffer=n.createRenderbuffer(),pe(w.__webglDepthbuffer,T,!1);else{const j=T.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Z=w.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,Z),n.framebufferRenderbuffer(n.FRAMEBUFFER,j,n.RENDERBUFFER,Z)}t.bindFramebuffer(n.FRAMEBUFFER,null)}function Le(T,w,U){const j=i.get(T);w!==void 0&&_e(j.__webglFramebuffer,T,T.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),U!==void 0&&nt(T)}function rt(T){const w=T.texture,U=i.get(T),j=i.get(w);T.addEventListener("dispose",S);const Z=T.textures,O=T.isWebGLCubeRenderTarget===!0,he=Z.length>1;if(he||(j.__webglTexture===void 0&&(j.__webglTexture=n.createTexture()),j.__version=w.version,o.memory.textures++),O){U.__webglFramebuffer=[];for(let oe=0;oe<6;oe++)if(w.mipmaps&&w.mipmaps.length>0){U.__webglFramebuffer[oe]=[];for(let fe=0;fe<w.mipmaps.length;fe++)U.__webglFramebuffer[oe][fe]=n.createFramebuffer()}else U.__webglFramebuffer[oe]=n.createFramebuffer()}else{if(w.mipmaps&&w.mipmaps.length>0){U.__webglFramebuffer=[];for(let oe=0;oe<w.mipmaps.length;oe++)U.__webglFramebuffer[oe]=n.createFramebuffer()}else U.__webglFramebuffer=n.createFramebuffer();if(he)for(let oe=0,fe=Z.length;oe<fe;oe++){const Ue=i.get(Z[oe]);Ue.__webglTexture===void 0&&(Ue.__webglTexture=n.createTexture(),o.memory.textures++)}if(T.samples>0&&te(T)===!1){U.__webglMultisampledFramebuffer=n.createFramebuffer(),U.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,U.__webglMultisampledFramebuffer);for(let oe=0;oe<Z.length;oe++){const fe=Z[oe];U.__webglColorRenderbuffer[oe]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,U.__webglColorRenderbuffer[oe]);const Ue=r.convert(fe.format,fe.colorSpace),le=r.convert(fe.type),Ee=b(fe.internalFormat,Ue,le,fe.colorSpace,T.isXRRenderTarget===!0),ke=q(T);n.renderbufferStorageMultisample(n.RENDERBUFFER,ke,Ee,T.width,T.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+oe,n.RENDERBUFFER,U.__webglColorRenderbuffer[oe])}n.bindRenderbuffer(n.RENDERBUFFER,null),T.depthBuffer&&(U.__webglDepthRenderbuffer=n.createRenderbuffer(),pe(U.__webglDepthRenderbuffer,T,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(O){t.bindTexture(n.TEXTURE_CUBE_MAP,j.__webglTexture),Oe(n.TEXTURE_CUBE_MAP,w);for(let oe=0;oe<6;oe++)if(w.mipmaps&&w.mipmaps.length>0)for(let fe=0;fe<w.mipmaps.length;fe++)_e(U.__webglFramebuffer[oe][fe],T,w,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+oe,fe);else _e(U.__webglFramebuffer[oe],T,w,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0);m(w)&&v(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(he){for(let oe=0,fe=Z.length;oe<fe;oe++){const Ue=Z[oe],le=i.get(Ue);t.bindTexture(n.TEXTURE_2D,le.__webglTexture),Oe(n.TEXTURE_2D,Ue),_e(U.__webglFramebuffer,T,Ue,n.COLOR_ATTACHMENT0+oe,n.TEXTURE_2D,0),m(Ue)&&v(n.TEXTURE_2D)}t.unbindTexture()}else{let oe=n.TEXTURE_2D;if((T.isWebGL3DRenderTarget||T.isWebGLArrayRenderTarget)&&(oe=T.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(oe,j.__webglTexture),Oe(oe,w),w.mipmaps&&w.mipmaps.length>0)for(let fe=0;fe<w.mipmaps.length;fe++)_e(U.__webglFramebuffer[fe],T,w,n.COLOR_ATTACHMENT0,oe,fe);else _e(U.__webglFramebuffer,T,w,n.COLOR_ATTACHMENT0,oe,0);m(w)&&v(oe),t.unbindTexture()}T.depthBuffer&&nt(T)}function mt(T){const w=T.textures;for(let U=0,j=w.length;U<j;U++){const Z=w[U];if(m(Z)){const O=x(T),he=i.get(Z).__webglTexture;t.bindTexture(O,he),v(O),t.unbindTexture()}}}const Ge=[],N=[];function Qe(T){if(T.samples>0){if(te(T)===!1){const w=T.textures,U=T.width,j=T.height;let Z=n.COLOR_BUFFER_BIT;const O=T.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,he=i.get(T),oe=w.length>1;if(oe)for(let fe=0;fe<w.length;fe++)t.bindFramebuffer(n.FRAMEBUFFER,he.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+fe,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,he.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+fe,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,he.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,he.__webglFramebuffer);for(let fe=0;fe<w.length;fe++){if(T.resolveDepthBuffer&&(T.depthBuffer&&(Z|=n.DEPTH_BUFFER_BIT),T.stencilBuffer&&T.resolveStencilBuffer&&(Z|=n.STENCIL_BUFFER_BIT)),oe){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,he.__webglColorRenderbuffer[fe]);const Ue=i.get(w[fe]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Ue,0)}n.blitFramebuffer(0,0,U,j,0,0,U,j,Z,n.NEAREST),l===!0&&(Ge.length=0,N.length=0,Ge.push(n.COLOR_ATTACHMENT0+fe),T.depthBuffer&&T.resolveDepthBuffer===!1&&(Ge.push(O),N.push(O),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,N)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Ge))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),oe)for(let fe=0;fe<w.length;fe++){t.bindFramebuffer(n.FRAMEBUFFER,he.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+fe,n.RENDERBUFFER,he.__webglColorRenderbuffer[fe]);const Ue=i.get(w[fe]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,he.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+fe,n.TEXTURE_2D,Ue,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,he.__webglMultisampledFramebuffer)}else if(T.depthBuffer&&T.resolveDepthBuffer===!1&&l){const w=T.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[w])}}}function q(T){return Math.min(s.maxSamples,T.samples)}function te(T){const w=i.get(T);return T.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&w.__useRenderToTexture!==!1}function K(T){const w=o.render.frame;h.get(T)!==w&&(h.set(T,w),T.update())}function de(T,w){const U=T.colorSpace,j=T.format,Z=T.type;return T.isCompressedTexture===!0||T.isVideoTexture===!0||U!==Gn&&U!==Vs&&(ht.getTransfer(U)===Dt?(j!==ei||Z!==vs)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",U)),w}function Y(T){return typeof HTMLImageElement<"u"&&T instanceof HTMLImageElement?(c.width=T.naturalWidth||T.width,c.height=T.naturalHeight||T.height):typeof VideoFrame<"u"&&T instanceof VideoFrame?(c.width=T.displayWidth,c.height=T.displayHeight):(c.width=T.width,c.height=T.height),c}this.allocateTextureUnit=D,this.resetTextureUnits=k,this.setTexture2D=z,this.setTexture2DArray=H,this.setTexture3D=ne,this.setTextureCube=G,this.rebindTextures=Le,this.setupRenderTarget=rt,this.updateRenderTargetMipmap=mt,this.updateMultisampleRenderTarget=Qe,this.setupDepthRenderbuffer=nt,this.setupFrameBufferTexture=_e,this.useMultisampledRTT=te}function HE(n,e){function t(i,s=Vs){let r;const o=ht.getTransfer(s);if(i===vs)return n.UNSIGNED_BYTE;if(i===Jd)return n.UNSIGNED_SHORT_4_4_4_4;if(i===Qd)return n.UNSIGNED_SHORT_5_5_5_1;if(i===Pv)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===Av)return n.BYTE;if(i===Tv)return n.SHORT;if(i===Ka)return n.UNSIGNED_SHORT;if(i===Zd)return n.INT;if(i===Zs)return n.UNSIGNED_INT;if(i===di)return n.FLOAT;if(i===ul)return n.HALF_FLOAT;if(i===Rv)return n.ALPHA;if(i===Lv)return n.RGB;if(i===ei)return n.RGBA;if(i===Iv)return n.LUMINANCE;if(i===Dv)return n.LUMINANCE_ALPHA;if(i===Za)return n.DEPTH_COMPONENT;if(i===Ja)return n.DEPTH_STENCIL;if(i===ep)return n.RED;if(i===qc)return n.RED_INTEGER;if(i===Nv)return n.RG;if(i===tp)return n.RG_INTEGER;if(i===np)return n.RGBA_INTEGER;if(i===oc||i===ac||i===lc||i===cc)if(o===Dt)if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(i===oc)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===ac)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===lc)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===cc)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=e.get("WEBGL_compressed_texture_s3tc"),r!==null){if(i===oc)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===ac)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===lc)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===cc)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===td||i===nd||i===id||i===sd)if(r=e.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(i===td)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===nd)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===id)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===sd)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===rd||i===od||i===ad)if(r=e.get("WEBGL_compressed_texture_etc"),r!==null){if(i===rd||i===od)return o===Dt?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(i===ad)return o===Dt?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===ld||i===cd||i===hd||i===ud||i===dd||i===pd||i===fd||i===md||i===vd||i===gd||i===_d||i===bd||i===xd||i===yd)if(r=e.get("WEBGL_compressed_texture_astc"),r!==null){if(i===ld)return o===Dt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===cd)return o===Dt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===hd)return o===Dt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===ud)return o===Dt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===dd)return o===Dt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===pd)return o===Dt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===fd)return o===Dt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===md)return o===Dt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===vd)return o===Dt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===gd)return o===Dt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===_d)return o===Dt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===bd)return o===Dt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===xd)return o===Dt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===yd)return o===Dt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===hc||i===wd||i===Ed)if(r=e.get("EXT_texture_compression_bptc"),r!==null){if(i===hc)return o===Dt?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===wd)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===Ed)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===Ov||i===Md||i===Sd||i===Cd)if(r=e.get("EXT_texture_compression_rgtc"),r!==null){if(i===hc)return r.COMPRESSED_RED_RGTC1_EXT;if(i===Md)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===Sd)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===Cd)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===Ya?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}const bD=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,xD=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class yD{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const s=new Wt,r=e.properties.get(s);r.__webglTexture=t.texture,(t.depthNear!==i.depthNear||t.depthFar!==i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=s}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new zi({vertexShader:bD,fragmentShader:xD,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Kt(new Ko(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class wD extends Es{constructor(e,t){super();const i=this;let s=null,r=1,o=null,a="local-floor",l=1,c=null,h=null,u=null,d=null,p=null,f=null;const g=new yD,m=t.getContextAttributes();let v=null,x=null;const b=[],_=[],C=new ee;let M=null;const S=new _n;S.viewport=new ct;const P=new _n;P.viewport=new ct;const E=[S,P],y=new TE;let L=null,k=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(J){let ce=b[J];return ce===void 0&&(ce=new Du,b[J]=ce),ce.getTargetRaySpace()},this.getControllerGrip=function(J){let ce=b[J];return ce===void 0&&(ce=new Du,b[J]=ce),ce.getGripSpace()},this.getHand=function(J){let ce=b[J];return ce===void 0&&(ce=new Du,b[J]=ce),ce.getHandSpace()};function D(J){const ce=_.indexOf(J.inputSource);if(ce===-1)return;const _e=b[ce];_e!==void 0&&(_e.update(J.inputSource,J.frame,c||o),_e.dispatchEvent({type:J.type,data:J.inputSource}))}function W(){s.removeEventListener("select",D),s.removeEventListener("selectstart",D),s.removeEventListener("selectend",D),s.removeEventListener("squeeze",D),s.removeEventListener("squeezestart",D),s.removeEventListener("squeezeend",D),s.removeEventListener("end",W),s.removeEventListener("inputsourceschange",z);for(let J=0;J<b.length;J++){const ce=_[J];ce!==null&&(_[J]=null,b[J].disconnect(ce))}L=null,k=null,g.reset(),e.setRenderTarget(v),p=null,d=null,u=null,s=null,x=null,Ze.stop(),i.isPresenting=!1,e.setPixelRatio(M),e.setSize(C.width,C.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(J){r=J,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(J){a=J,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(J){c=J},this.getBaseLayer=function(){return d!==null?d:p},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return s},this.setSession=async function(J){if(s=J,s!==null){if(v=e.getRenderTarget(),s.addEventListener("select",D),s.addEventListener("selectstart",D),s.addEventListener("selectend",D),s.addEventListener("squeeze",D),s.addEventListener("squeezestart",D),s.addEventListener("squeezeend",D),s.addEventListener("end",W),s.addEventListener("inputsourceschange",z),m.xrCompatible!==!0&&await t.makeXRCompatible(),M=e.getPixelRatio(),e.getSize(C),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let _e=null,pe=null,Re=null;m.depth&&(Re=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,_e=m.stencil?Ja:Za,pe=m.stencil?Ya:Zs);const nt={colorFormat:t.RGBA8,depthFormat:Re,scaleFactor:r};u=new XRWebGLBinding(s,t),d=u.createProjectionLayer(nt),s.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),x=new gs(d.textureWidth,d.textureHeight,{format:ei,type:vs,depthTexture:new qv(d.textureWidth,d.textureHeight,pe,void 0,void 0,void 0,void 0,void 0,void 0,_e),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1,resolveStencilBuffer:d.ignoreDepthValues===!1})}else{const _e={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:r};p=new XRWebGLLayer(s,t,_e),s.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),x=new gs(p.framebufferWidth,p.framebufferHeight,{format:ei,type:vs,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1})}x.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await s.requestReferenceSpace(a),Ze.setContext(s),Ze.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode},this.getDepthTexture=function(){return g.getDepthTexture()};function z(J){for(let ce=0;ce<J.removed.length;ce++){const _e=J.removed[ce],pe=_.indexOf(_e);pe>=0&&(_[pe]=null,b[pe].disconnect(_e))}for(let ce=0;ce<J.added.length;ce++){const _e=J.added[ce];let pe=_.indexOf(_e);if(pe===-1){for(let nt=0;nt<b.length;nt++)if(nt>=_.length){_.push(_e),pe=nt;break}else if(_[nt]===null){_[nt]=_e,pe=nt;break}if(pe===-1)break}const Re=b[pe];Re&&Re.connect(_e)}}const H=new R,ne=new R;function G(J,ce,_e){H.setFromMatrixPosition(ce.matrixWorld),ne.setFromMatrixPosition(_e.matrixWorld);const pe=H.distanceTo(ne),Re=ce.projectionMatrix.elements,nt=_e.projectionMatrix.elements,Le=Re[14]/(Re[10]-1),rt=Re[14]/(Re[10]+1),mt=(Re[9]+1)/Re[5],Ge=(Re[9]-1)/Re[5],N=(Re[8]-1)/Re[0],Qe=(nt[8]+1)/nt[0],q=Le*N,te=Le*Qe,K=pe/(-N+Qe),de=K*-N;if(ce.matrixWorld.decompose(J.position,J.quaternion,J.scale),J.translateX(de),J.translateZ(K),J.matrixWorld.compose(J.position,J.quaternion,J.scale),J.matrixWorldInverse.copy(J.matrixWorld).invert(),Re[10]===-1)J.projectionMatrix.copy(ce.projectionMatrix),J.projectionMatrixInverse.copy(ce.projectionMatrixInverse);else{const Y=Le+K,T=rt+K,w=q-de,U=te+(pe-de),j=mt*rt/T*Y,Z=Ge*rt/T*Y;J.projectionMatrix.makePerspective(w,U,j,Z,Y,T),J.projectionMatrixInverse.copy(J.projectionMatrix).invert()}}function ae(J,ce){ce===null?J.matrixWorld.copy(J.matrix):J.matrixWorld.multiplyMatrices(ce.matrixWorld,J.matrix),J.matrixWorldInverse.copy(J.matrixWorld).invert()}this.updateCamera=function(J){if(s===null)return;let ce=J.near,_e=J.far;g.texture!==null&&(g.depthNear>0&&(ce=g.depthNear),g.depthFar>0&&(_e=g.depthFar)),y.near=P.near=S.near=ce,y.far=P.far=S.far=_e,(L!==y.near||k!==y.far)&&(s.updateRenderState({depthNear:y.near,depthFar:y.far}),L=y.near,k=y.far),S.layers.mask=J.layers.mask|2,P.layers.mask=J.layers.mask|4,y.layers.mask=S.layers.mask|P.layers.mask;const pe=J.parent,Re=y.cameras;ae(y,pe);for(let nt=0;nt<Re.length;nt++)ae(Re[nt],pe);Re.length===2?G(y,S,P):y.projectionMatrix.copy(S.projectionMatrix),se(J,y,pe)};function se(J,ce,_e){_e===null?J.matrix.copy(ce.matrixWorld):(J.matrix.copy(_e.matrixWorld),J.matrix.invert(),J.matrix.multiply(ce.matrixWorld)),J.matrix.decompose(J.position,J.quaternion,J.scale),J.updateMatrixWorld(!0),J.projectionMatrix.copy(ce.projectionMatrix),J.projectionMatrixInverse.copy(ce.projectionMatrixInverse),J.isPerspectiveCamera&&(J.fov=tl*2*Math.atan(1/J.projectionMatrix.elements[5]),J.zoom=1)}this.getCamera=function(){return y},this.getFoveation=function(){if(!(d===null&&p===null))return l},this.setFoveation=function(J){l=J,d!==null&&(d.fixedFoveation=J),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=J)},this.hasDepthSensing=function(){return g.texture!==null},this.getDepthSensingMesh=function(){return g.getMesh(y)};let ge=null;function Oe(J,ce){if(h=ce.getViewerPose(c||o),f=ce,h!==null){const _e=h.views;p!==null&&(e.setRenderTargetFramebuffer(x,p.framebuffer),e.setRenderTarget(x));let pe=!1;_e.length!==y.cameras.length&&(y.cameras.length=0,pe=!0);for(let Le=0;Le<_e.length;Le++){const rt=_e[Le];let mt=null;if(p!==null)mt=p.getViewport(rt);else{const N=u.getViewSubImage(d,rt);mt=N.viewport,Le===0&&(e.setRenderTargetTextures(x,N.colorTexture,N.depthStencilTexture),e.setRenderTarget(x))}let Ge=E[Le];Ge===void 0&&(Ge=new _n,Ge.layers.enable(Le),Ge.viewport=new ct,E[Le]=Ge),Ge.matrix.fromArray(rt.transform.matrix),Ge.matrix.decompose(Ge.position,Ge.quaternion,Ge.scale),Ge.projectionMatrix.fromArray(rt.projectionMatrix),Ge.projectionMatrixInverse.copy(Ge.projectionMatrix).invert(),Ge.viewport.set(mt.x,mt.y,mt.width,mt.height),Le===0&&(y.matrix.copy(Ge.matrix),y.matrix.decompose(y.position,y.quaternion,y.scale)),pe===!0&&y.cameras.push(Ge)}const Re=s.enabledFeatures;if(Re&&Re.includes("depth-sensing")&&s.depthUsage=="gpu-optimized"&&u){const Le=u.getDepthInformation(_e[0]);Le&&Le.isValid&&Le.texture&&g.init(e,Le,s.renderState)}}for(let _e=0;_e<b.length;_e++){const pe=_[_e],Re=b[_e];pe!==null&&Re!==void 0&&Re.update(pe,ce,c||o)}ge&&ge(J,ce),ce.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:ce}),f=null}const Ze=new UE;Ze.setAnimationLoop(Oe),this.setAnimationLoop=function(J){ge=J},this.dispose=function(){}}}const ao=new es,ED=new De;function MD(n,e){function t(m,v){m.matrixAutoUpdate===!0&&m.updateMatrix(),v.value.copy(m.matrix)}function i(m,v){v.color.getRGB(m.fogColor.value,zw(n)),v.isFog?(m.fogNear.value=v.near,m.fogFar.value=v.far):v.isFogExp2&&(m.fogDensity.value=v.density)}function s(m,v,x,b,_){v.isMeshBasicMaterial||v.isMeshLambertMaterial?r(m,v):v.isMeshToonMaterial?(r(m,v),u(m,v)):v.isMeshPhongMaterial?(r(m,v),h(m,v)):v.isMeshStandardMaterial?(r(m,v),d(m,v),v.isMeshPhysicalMaterial&&p(m,v,_)):v.isMeshMatcapMaterial?(r(m,v),f(m,v)):v.isMeshDepthMaterial?r(m,v):v.isMeshDistanceMaterial?(r(m,v),g(m,v)):v.isMeshNormalMaterial?r(m,v):v.isLineBasicMaterial?(o(m,v),v.isLineDashedMaterial&&a(m,v)):v.isPointsMaterial?l(m,v,x,b):v.isSpriteMaterial?c(m,v):v.isShadowMaterial?(m.color.value.copy(v.color),m.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function r(m,v){m.opacity.value=v.opacity,v.color&&m.diffuse.value.copy(v.color),v.emissive&&m.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(m.map.value=v.map,t(v.map,m.mapTransform)),v.alphaMap&&(m.alphaMap.value=v.alphaMap,t(v.alphaMap,m.alphaMapTransform)),v.bumpMap&&(m.bumpMap.value=v.bumpMap,t(v.bumpMap,m.bumpMapTransform),m.bumpScale.value=v.bumpScale,v.side===ni&&(m.bumpScale.value*=-1)),v.normalMap&&(m.normalMap.value=v.normalMap,t(v.normalMap,m.normalMapTransform),m.normalScale.value.copy(v.normalScale),v.side===ni&&m.normalScale.value.negate()),v.displacementMap&&(m.displacementMap.value=v.displacementMap,t(v.displacementMap,m.displacementMapTransform),m.displacementScale.value=v.displacementScale,m.displacementBias.value=v.displacementBias),v.emissiveMap&&(m.emissiveMap.value=v.emissiveMap,t(v.emissiveMap,m.emissiveMapTransform)),v.specularMap&&(m.specularMap.value=v.specularMap,t(v.specularMap,m.specularMapTransform)),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);const x=e.get(v),b=x.envMap,_=x.envMapRotation;b&&(m.envMap.value=b,ao.copy(_),ao.x*=-1,ao.y*=-1,ao.z*=-1,b.isCubeTexture&&b.isRenderTargetTexture===!1&&(ao.y*=-1,ao.z*=-1),m.envMapRotation.value.setFromMatrix4(ED.makeRotationFromEuler(ao)),m.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=v.reflectivity,m.ior.value=v.ior,m.refractionRatio.value=v.refractionRatio),v.lightMap&&(m.lightMap.value=v.lightMap,m.lightMapIntensity.value=v.lightMapIntensity,t(v.lightMap,m.lightMapTransform)),v.aoMap&&(m.aoMap.value=v.aoMap,m.aoMapIntensity.value=v.aoMapIntensity,t(v.aoMap,m.aoMapTransform))}function o(m,v){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,v.map&&(m.map.value=v.map,t(v.map,m.mapTransform))}function a(m,v){m.dashSize.value=v.dashSize,m.totalSize.value=v.dashSize+v.gapSize,m.scale.value=v.scale}function l(m,v,x,b){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,m.size.value=v.size*x,m.scale.value=b*.5,v.map&&(m.map.value=v.map,t(v.map,m.uvTransform)),v.alphaMap&&(m.alphaMap.value=v.alphaMap,t(v.alphaMap,m.alphaMapTransform)),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest)}function c(m,v){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,m.rotation.value=v.rotation,v.map&&(m.map.value=v.map,t(v.map,m.mapTransform)),v.alphaMap&&(m.alphaMap.value=v.alphaMap,t(v.alphaMap,m.alphaMapTransform)),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest)}function h(m,v){m.specular.value.copy(v.specular),m.shininess.value=Math.max(v.shininess,1e-4)}function u(m,v){v.gradientMap&&(m.gradientMap.value=v.gradientMap)}function d(m,v){m.metalness.value=v.metalness,v.metalnessMap&&(m.metalnessMap.value=v.metalnessMap,t(v.metalnessMap,m.metalnessMapTransform)),m.roughness.value=v.roughness,v.roughnessMap&&(m.roughnessMap.value=v.roughnessMap,t(v.roughnessMap,m.roughnessMapTransform)),v.envMap&&(m.envMapIntensity.value=v.envMapIntensity)}function p(m,v,x){m.ior.value=v.ior,v.sheen>0&&(m.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),m.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(m.sheenColorMap.value=v.sheenColorMap,t(v.sheenColorMap,m.sheenColorMapTransform)),v.sheenRoughnessMap&&(m.sheenRoughnessMap.value=v.sheenRoughnessMap,t(v.sheenRoughnessMap,m.sheenRoughnessMapTransform))),v.clearcoat>0&&(m.clearcoat.value=v.clearcoat,m.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(m.clearcoatMap.value=v.clearcoatMap,t(v.clearcoatMap,m.clearcoatMapTransform)),v.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap,t(v.clearcoatRoughnessMap,m.clearcoatRoughnessMapTransform)),v.clearcoatNormalMap&&(m.clearcoatNormalMap.value=v.clearcoatNormalMap,t(v.clearcoatNormalMap,m.clearcoatNormalMapTransform),m.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),v.side===ni&&m.clearcoatNormalScale.value.negate())),v.dispersion>0&&(m.dispersion.value=v.dispersion),v.iridescence>0&&(m.iridescence.value=v.iridescence,m.iridescenceIOR.value=v.iridescenceIOR,m.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(m.iridescenceMap.value=v.iridescenceMap,t(v.iridescenceMap,m.iridescenceMapTransform)),v.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=v.iridescenceThicknessMap,t(v.iridescenceThicknessMap,m.iridescenceThicknessMapTransform))),v.transmission>0&&(m.transmission.value=v.transmission,m.transmissionSamplerMap.value=x.texture,m.transmissionSamplerSize.value.set(x.width,x.height),v.transmissionMap&&(m.transmissionMap.value=v.transmissionMap,t(v.transmissionMap,m.transmissionMapTransform)),m.thickness.value=v.thickness,v.thicknessMap&&(m.thicknessMap.value=v.thicknessMap,t(v.thicknessMap,m.thicknessMapTransform)),m.attenuationDistance.value=v.attenuationDistance,m.attenuationColor.value.copy(v.attenuationColor)),v.anisotropy>0&&(m.anisotropyVector.value.set(v.anisotropy*Math.cos(v.anisotropyRotation),v.anisotropy*Math.sin(v.anisotropyRotation)),v.anisotropyMap&&(m.anisotropyMap.value=v.anisotropyMap,t(v.anisotropyMap,m.anisotropyMapTransform))),m.specularIntensity.value=v.specularIntensity,m.specularColor.value.copy(v.specularColor),v.specularColorMap&&(m.specularColorMap.value=v.specularColorMap,t(v.specularColorMap,m.specularColorMapTransform)),v.specularIntensityMap&&(m.specularIntensityMap.value=v.specularIntensityMap,t(v.specularIntensityMap,m.specularIntensityMapTransform))}function f(m,v){v.matcap&&(m.matcap.value=v.matcap)}function g(m,v){const x=e.get(v).light;m.referencePosition.value.setFromMatrixPosition(x.matrixWorld),m.nearDistance.value=x.shadow.camera.near,m.farDistance.value=x.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:s}}function SD(n,e,t,i){let s={},r={},o=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(x,b){const _=b.program;i.uniformBlockBinding(x,_)}function c(x,b){let _=s[x.id];_===void 0&&(f(x),_=h(x),s[x.id]=_,x.addEventListener("dispose",m));const C=b.program;i.updateUBOMapping(x,C);const M=e.render.frame;r[x.id]!==M&&(d(x),r[x.id]=M)}function h(x){const b=u();x.__bindingPointIndex=b;const _=n.createBuffer(),C=x.__size,M=x.usage;return n.bindBuffer(n.UNIFORM_BUFFER,_),n.bufferData(n.UNIFORM_BUFFER,C,M),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,b,_),_}function u(){for(let x=0;x<a;x++)if(o.indexOf(x)===-1)return o.push(x),x;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(x){const b=s[x.id],_=x.uniforms,C=x.__cache;n.bindBuffer(n.UNIFORM_BUFFER,b);for(let M=0,S=_.length;M<S;M++){const P=Array.isArray(_[M])?_[M]:[_[M]];for(let E=0,y=P.length;E<y;E++){const L=P[E];if(p(L,M,E,C)===!0){const k=L.__offset,D=Array.isArray(L.value)?L.value:[L.value];let W=0;for(let z=0;z<D.length;z++){const H=D[z],ne=g(H);typeof H=="number"||typeof H=="boolean"?(L.__data[0]=H,n.bufferSubData(n.UNIFORM_BUFFER,k+W,L.__data)):H.isMatrix3?(L.__data[0]=H.elements[0],L.__data[1]=H.elements[1],L.__data[2]=H.elements[2],L.__data[3]=0,L.__data[4]=H.elements[3],L.__data[5]=H.elements[4],L.__data[6]=H.elements[5],L.__data[7]=0,L.__data[8]=H.elements[6],L.__data[9]=H.elements[7],L.__data[10]=H.elements[8],L.__data[11]=0):(H.toArray(L.__data,W),W+=ne.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,k,L.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function p(x,b,_,C){const M=x.value,S=b+"_"+_;if(C[S]===void 0)return typeof M=="number"||typeof M=="boolean"?C[S]=M:C[S]=M.clone(),!0;{const P=C[S];if(typeof M=="number"||typeof M=="boolean"){if(P!==M)return C[S]=M,!0}else if(P.equals(M)===!1)return P.copy(M),!0}return!1}function f(x){const b=x.uniforms;let _=0;const C=16;for(let S=0,P=b.length;S<P;S++){const E=Array.isArray(b[S])?b[S]:[b[S]];for(let y=0,L=E.length;y<L;y++){const k=E[y],D=Array.isArray(k.value)?k.value:[k.value];for(let W=0,z=D.length;W<z;W++){const H=D[W],ne=g(H),G=_%C,ae=G%ne.boundary,se=G+ae;_+=ae,se!==0&&C-se<ne.storage&&(_+=C-se),k.__data=new Float32Array(ne.storage/Float32Array.BYTES_PER_ELEMENT),k.__offset=_,_+=ne.storage}}}const M=_%C;return M>0&&(_+=C-M),x.__size=_,x.__cache={},this}function g(x){const b={boundary:0,storage:0};return typeof x=="number"||typeof x=="boolean"?(b.boundary=4,b.storage=4):x.isVector2?(b.boundary=8,b.storage=8):x.isVector3||x.isColor?(b.boundary=16,b.storage=12):x.isVector4?(b.boundary=16,b.storage=16):x.isMatrix3?(b.boundary=48,b.storage=48):x.isMatrix4?(b.boundary=64,b.storage=64):x.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",x),b}function m(x){const b=x.target;b.removeEventListener("dispose",m);const _=o.indexOf(b.__bindingPointIndex);o.splice(_,1),n.deleteBuffer(s[b.id]),delete s[b.id],delete r[b.id]}function v(){for(const x in s)n.deleteBuffer(s[x]);o=[],s={},r={}}return{bind:l,update:c,dispose:v}}class GE{constructor(e={}){const{canvas:t=kw(),context:i=null,depth:s=!0,stencil:r=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:u=!1,reverseDepthBuffer:d=!1}=e;this.isWebGLRenderer=!0;let p;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=i.getContextAttributes().alpha}else p=o;const f=new Uint32Array(4),g=new Int32Array(4);let m=null,v=null;const x=[],b=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Xs,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const _=this;let C=!1;this._outputColorSpace=gn;let M=0,S=0,P=null,E=-1,y=null;const L=new ct,k=new ct;let D=null;const W=new ve(0);let z=0,H=t.width,ne=t.height,G=1,ae=null,se=null;const ge=new ct(0,0,H,ne),Oe=new ct(0,0,H,ne);let Ze=!1;const J=new Qc;let ce=!1,_e=!1;const pe=new De,Re=new De,nt=new R,Le=new ct,rt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let mt=!1;function Ge(){return P===null?G:1}let N=i;function Qe(A,B){return t.getContext(A,B)}try{const A={alpha:!0,depth:s,stencil:r,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${qd}`),t.addEventListener("webglcontextlost",re,!1),t.addEventListener("webglcontextrestored",Me,!1),t.addEventListener("webglcontextcreationerror",we,!1),N===null){const B="webgl2";if(N=Qe(B,A),N===null)throw Qe(B)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(A){throw console.error("THREE.WebGLRenderer: "+A.message),A}let q,te,K,de,Y,T,w,U,j,Z,O,he,oe,fe,Ue,le,Ee,ke,Ie,be,at,qe,At,F;function ye(){q=new UI(N),q.init(),qe=new HE(N,q),te=new RI(N,q,e,qe),K=new gD(N,q),te.reverseDepthBuffer&&d&&K.buffers.depth.setReversed(!0),de=new VI(N),Y=new sD,T=new _D(N,q,K,Y,te,qe,de),w=new II(_),U=new kI(_),j=new jP(N),At=new TI(N,j),Z=new FI(N,j,de,At),O=new HI(N,Z,j,de),Ie=new zI(N,te,T),le=new LI(Y),he=new iD(_,w,U,q,te,At,le),oe=new MD(_,Y),fe=new oD,Ue=new dD(q),ke=new AI(_,w,U,K,O,p,l),Ee=new mD(_,O,te),F=new SD(N,de,te,K),be=new PI(N,q,de),at=new BI(N,q,de),de.programs=he.programs,_.capabilities=te,_.extensions=q,_.properties=Y,_.renderLists=fe,_.shadowMap=Ee,_.state=K,_.info=de}ye();const Q=new wD(_,N);this.xr=Q,this.getContext=function(){return N},this.getContextAttributes=function(){return N.getContextAttributes()},this.forceContextLoss=function(){const A=q.get("WEBGL_lose_context");A&&A.loseContext()},this.forceContextRestore=function(){const A=q.get("WEBGL_lose_context");A&&A.restoreContext()},this.getPixelRatio=function(){return G},this.setPixelRatio=function(A){A!==void 0&&(G=A,this.setSize(H,ne,!1))},this.getSize=function(A){return A.set(H,ne)},this.setSize=function(A,B,$=!0){if(Q.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}H=A,ne=B,t.width=Math.floor(A*G),t.height=Math.floor(B*G),$===!0&&(t.style.width=A+"px",t.style.height=B+"px"),this.setViewport(0,0,A,B)},this.getDrawingBufferSize=function(A){return A.set(H*G,ne*G).floor()},this.setDrawingBufferSize=function(A,B,$){H=A,ne=B,G=$,t.width=Math.floor(A*$),t.height=Math.floor(B*$),this.setViewport(0,0,A,B)},this.getCurrentViewport=function(A){return A.copy(L)},this.getViewport=function(A){return A.copy(ge)},this.setViewport=function(A,B,$,X){A.isVector4?ge.set(A.x,A.y,A.z,A.w):ge.set(A,B,$,X),K.viewport(L.copy(ge).multiplyScalar(G).round())},this.getScissor=function(A){return A.copy(Oe)},this.setScissor=function(A,B,$,X){A.isVector4?Oe.set(A.x,A.y,A.z,A.w):Oe.set(A,B,$,X),K.scissor(k.copy(Oe).multiplyScalar(G).round())},this.getScissorTest=function(){return Ze},this.setScissorTest=function(A){K.setScissorTest(Ze=A)},this.setOpaqueSort=function(A){ae=A},this.setTransparentSort=function(A){se=A},this.getClearColor=function(A){return A.copy(ke.getClearColor())},this.setClearColor=function(){ke.setClearColor(...arguments)},this.getClearAlpha=function(){return ke.getClearAlpha()},this.setClearAlpha=function(){ke.setClearAlpha(...arguments)},this.clear=function(A=!0,B=!0,$=!0){let X=0;if(A){let V=!1;if(P!==null){const ue=P.texture.format;V=ue===np||ue===tp||ue===qc}if(V){const ue=P.texture.type,xe=ue===vs||ue===Zs||ue===Ka||ue===Ya||ue===Jd||ue===Qd,Se=ke.getClearColor(),Ce=ke.getClearAlpha(),je=Se.r,$e=Se.g,Fe=Se.b;xe?(f[0]=je,f[1]=$e,f[2]=Fe,f[3]=Ce,N.clearBufferuiv(N.COLOR,0,f)):(g[0]=je,g[1]=$e,g[2]=Fe,g[3]=Ce,N.clearBufferiv(N.COLOR,0,g))}else X|=N.COLOR_BUFFER_BIT}B&&(X|=N.DEPTH_BUFFER_BIT),$&&(X|=N.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),N.clear(X)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",re,!1),t.removeEventListener("webglcontextrestored",Me,!1),t.removeEventListener("webglcontextcreationerror",we,!1),ke.dispose(),fe.dispose(),Ue.dispose(),Y.dispose(),w.dispose(),U.dispose(),O.dispose(),At.dispose(),F.dispose(),he.dispose(),Q.dispose(),Q.removeEventListener("sessionstart",R_),Q.removeEventListener("sessionend",L_),Xr.stop()};function re(A){A.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),C=!0}function Me(){console.log("THREE.WebGLRenderer: Context Restored."),C=!1;const A=de.autoReset,B=Ee.enabled,$=Ee.autoUpdate,X=Ee.needsUpdate,V=Ee.type;ye(),de.autoReset=A,Ee.enabled=B,Ee.autoUpdate=$,Ee.needsUpdate=X,Ee.type=V}function we(A){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",A.statusMessage)}function it(A){const B=A.target;B.removeEventListener("dispose",it),Jt(B)}function Jt(A){kn(A),Y.remove(A)}function kn(A){const B=Y.get(A).programs;B!==void 0&&(B.forEach(function($){he.releaseProgram($)}),A.isShaderMaterial&&he.releaseShaderCache(A))}this.renderBufferDirect=function(A,B,$,X,V,ue){B===null&&(B=rt);const xe=V.isMesh&&V.matrixWorld.determinant()<0,Se=AC(A,B,$,X,V);K.setMaterial(X,xe);let Ce=$.index,je=1;if(X.wireframe===!0){if(Ce=Z.getWireframeAttribute($),Ce===void 0)return;je=2}const $e=$.drawRange,Fe=$.attributes.position;let _t=$e.start*je,Tt=($e.start+$e.count)*je;ue!==null&&(_t=Math.max(_t,ue.start*je),Tt=Math.min(Tt,(ue.start+ue.count)*je)),Ce!==null?(_t=Math.max(_t,0),Tt=Math.min(Tt,Ce.count)):Fe!=null&&(_t=Math.max(_t,0),Tt=Math.min(Tt,Fe.count));const ln=Tt-_t;if(ln<0||ln===1/0)return;At.setup(V,X,Se,$,Ce);let Qt,xt=be;if(Ce!==null&&(Qt=j.get(Ce),xt=at,xt.setIndex(Qt)),V.isMesh)X.wireframe===!0?(K.setLineWidth(X.wireframeLinewidth*Ge()),xt.setMode(N.LINES)):xt.setMode(N.TRIANGLES);else if(V.isLine){let Ve=X.linewidth;Ve===void 0&&(Ve=1),K.setLineWidth(Ve*Ge()),V.isLineSegments?xt.setMode(N.LINES):V.isLineLoop?xt.setMode(N.LINE_LOOP):xt.setMode(N.LINE_STRIP)}else V.isPoints?xt.setMode(N.POINTS):V.isSprite&&xt.setMode(N.TRIANGLES);if(V.isBatchedMesh)if(V._multiDrawInstances!==null)Iu("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),xt.renderMultiDrawInstances(V._multiDrawStarts,V._multiDrawCounts,V._multiDrawCount,V._multiDrawInstances);else if(q.get("WEBGL_multi_draw"))xt.renderMultiDraw(V._multiDrawStarts,V._multiDrawCounts,V._multiDrawCount);else{const Ve=V._multiDrawStarts,Dn=V._multiDrawCounts,Pt=V._multiDrawCount,Xi=Ce?j.get(Ce).bytesPerElement:1,ia=Y.get(X).currentProgram.getUniforms();for(let mi=0;mi<Pt;mi++)ia.setValue(N,"_gl_DrawID",mi),xt.render(Ve[mi]/Xi,Dn[mi])}else if(V.isInstancedMesh)xt.renderInstances(_t,ln,V.count);else if($.isInstancedBufferGeometry){const Ve=$._maxInstanceCount!==void 0?$._maxInstanceCount:1/0,Dn=Math.min($.instanceCount,Ve);xt.renderInstances(_t,ln,Dn)}else xt.render(_t,ln)};function It(A,B,$){A.transparent===!0&&A.side===bi&&A.forceSinglePass===!1?(A.side=ni,A.needsUpdate=!0,Mh(A,B,$),A.side=ms,A.needsUpdate=!0,Mh(A,B,$),A.side=bi):Mh(A,B,$)}this.compile=function(A,B,$=null){$===null&&($=A),v=Ue.get($),v.init(B),b.push(v),$.traverseVisible(function(V){V.isLight&&V.layers.test(B.layers)&&(v.pushLight(V),V.castShadow&&v.pushShadow(V))}),A!==$&&A.traverseVisible(function(V){V.isLight&&V.layers.test(B.layers)&&(v.pushLight(V),V.castShadow&&v.pushShadow(V))}),v.setupLights();const X=new Set;return A.traverse(function(V){if(!(V.isMesh||V.isPoints||V.isLine||V.isSprite))return;const ue=V.material;if(ue)if(Array.isArray(ue))for(let xe=0;xe<ue.length;xe++){const Se=ue[xe];It(Se,$,V),X.add(Se)}else It(ue,$,V),X.add(ue)}),v=b.pop(),X},this.compileAsync=function(A,B,$=null){const X=this.compile(A,B,$);return new Promise(V=>{function ue(){if(X.forEach(function(xe){Y.get(xe).currentProgram.isReady()&&X.delete(xe)}),X.size===0){V(A);return}setTimeout(ue,10)}q.get("KHR_parallel_shader_compile")!==null?ue():setTimeout(ue,10)})};let ji=null;function Cs(A){ji&&ji(A)}function R_(){Xr.stop()}function L_(){Xr.start()}const Xr=new UE;Xr.setAnimationLoop(Cs),typeof self<"u"&&Xr.setContext(self),this.setAnimationLoop=function(A){ji=A,Q.setAnimationLoop(A),A===null?Xr.stop():Xr.start()},Q.addEventListener("sessionstart",R_),Q.addEventListener("sessionend",L_),this.render=function(A,B){if(B!==void 0&&B.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(C===!0)return;if(A.matrixWorldAutoUpdate===!0&&A.updateMatrixWorld(),B.parent===null&&B.matrixWorldAutoUpdate===!0&&B.updateMatrixWorld(),Q.enabled===!0&&Q.isPresenting===!0&&(Q.cameraAutoUpdate===!0&&Q.updateCamera(B),B=Q.getCamera()),A.isScene===!0&&A.onBeforeRender(_,A,B,P),v=Ue.get(A,b.length),v.init(B),b.push(v),Re.multiplyMatrices(B.projectionMatrix,B.matrixWorldInverse),J.setFromProjectionMatrix(Re),_e=this.localClippingEnabled,ce=le.init(this.clippingPlanes,_e),m=fe.get(A,x.length),m.init(),x.push(m),Q.enabled===!0&&Q.isPresenting===!0){const ue=_.xr.getDepthSensingMesh();ue!==null&&Qp(ue,B,-1/0,_.sortObjects)}Qp(A,B,0,_.sortObjects),m.finish(),_.sortObjects===!0&&m.sort(ae,se),mt=Q.enabled===!1||Q.isPresenting===!1||Q.hasDepthSensing()===!1,mt&&ke.addToRenderList(m,A),this.info.render.frame++,ce===!0&&le.beginShadows();const $=v.state.shadowsArray;Ee.render($,A,B),ce===!0&&le.endShadows(),this.info.autoReset===!0&&this.info.reset();const X=m.opaque,V=m.transmissive;if(v.setupLights(),B.isArrayCamera){const ue=B.cameras;if(V.length>0)for(let xe=0,Se=ue.length;xe<Se;xe++){const Ce=ue[xe];D_(X,V,A,Ce)}mt&&ke.render(A);for(let xe=0,Se=ue.length;xe<Se;xe++){const Ce=ue[xe];I_(m,A,Ce,Ce.viewport)}}else V.length>0&&D_(X,V,A,B),mt&&ke.render(A),I_(m,A,B);P!==null&&S===0&&(T.updateMultisampleRenderTarget(P),T.updateRenderTargetMipmap(P)),A.isScene===!0&&A.onAfterRender(_,A,B),At.resetDefaultState(),E=-1,y=null,b.pop(),b.length>0?(v=b[b.length-1],ce===!0&&le.setGlobalState(_.clippingPlanes,v.state.camera)):v=null,x.pop(),x.length>0?m=x[x.length-1]:m=null};function Qp(A,B,$,X){if(A.visible===!1)return;if(A.layers.test(B.layers)){if(A.isGroup)$=A.renderOrder;else if(A.isLOD)A.autoUpdate===!0&&A.update(B);else if(A.isLight)v.pushLight(A),A.castShadow&&v.pushShadow(A);else if(A.isSprite){if(!A.frustumCulled||J.intersectsSprite(A)){X&&Le.setFromMatrixPosition(A.matrixWorld).applyMatrix4(Re);const xe=O.update(A),Se=A.material;Se.visible&&m.push(A,xe,Se,$,Le.z,null)}}else if((A.isMesh||A.isLine||A.isPoints)&&(!A.frustumCulled||J.intersectsObject(A))){const xe=O.update(A),Se=A.material;if(X&&(A.boundingSphere!==void 0?(A.boundingSphere===null&&A.computeBoundingSphere(),Le.copy(A.boundingSphere.center)):(xe.boundingSphere===null&&xe.computeBoundingSphere(),Le.copy(xe.boundingSphere.center)),Le.applyMatrix4(A.matrixWorld).applyMatrix4(Re)),Array.isArray(Se)){const Ce=xe.groups;for(let je=0,$e=Ce.length;je<$e;je++){const Fe=Ce[je],_t=Se[Fe.materialIndex];_t&&_t.visible&&m.push(A,xe,_t,$,Le.z,Fe)}}else Se.visible&&m.push(A,xe,Se,$,Le.z,null)}}const ue=A.children;for(let xe=0,Se=ue.length;xe<Se;xe++)Qp(ue[xe],B,$,X)}function I_(A,B,$,X){const V=A.opaque,ue=A.transmissive,xe=A.transparent;v.setupLightsView($),ce===!0&&le.setGlobalState(_.clippingPlanes,$),X&&K.viewport(L.copy(X)),V.length>0&&Eh(V,B,$),ue.length>0&&Eh(ue,B,$),xe.length>0&&Eh(xe,B,$),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1)}function D_(A,B,$,X){if(($.isScene===!0?$.overrideMaterial:null)!==null)return;v.state.transmissionRenderTarget[X.id]===void 0&&(v.state.transmissionRenderTarget[X.id]=new gs(1,1,{generateMipmaps:!0,type:q.has("EXT_color_buffer_half_float")||q.has("EXT_color_buffer_float")?ul:vs,minFilter:ki,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ht.workingColorSpace}));const ue=v.state.transmissionRenderTarget[X.id],xe=X.viewport||L;ue.setSize(xe.z*_.transmissionResolutionScale,xe.w*_.transmissionResolutionScale);const Se=_.getRenderTarget();_.setRenderTarget(ue),_.getClearColor(W),z=_.getClearAlpha(),z<1&&_.setClearColor(16777215,.5),_.clear(),mt&&ke.render($);const Ce=_.toneMapping;_.toneMapping=Xs;const je=X.viewport;if(X.viewport!==void 0&&(X.viewport=void 0),v.setupLightsView(X),ce===!0&&le.setGlobalState(_.clippingPlanes,X),Eh(A,$,X),T.updateMultisampleRenderTarget(ue),T.updateRenderTargetMipmap(ue),q.has("WEBGL_multisampled_render_to_texture")===!1){let $e=!1;for(let Fe=0,_t=B.length;Fe<_t;Fe++){const Tt=B[Fe],ln=Tt.object,Qt=Tt.geometry,xt=Tt.material,Ve=Tt.group;if(xt.side===bi&&ln.layers.test(X.layers)){const Dn=xt.side;xt.side=ni,xt.needsUpdate=!0,N_(ln,$,X,Qt,xt,Ve),xt.side=Dn,xt.needsUpdate=!0,$e=!0}}$e===!0&&(T.updateMultisampleRenderTarget(ue),T.updateRenderTargetMipmap(ue))}_.setRenderTarget(Se),_.setClearColor(W,z),je!==void 0&&(X.viewport=je),_.toneMapping=Ce}function Eh(A,B,$){const X=B.isScene===!0?B.overrideMaterial:null;for(let V=0,ue=A.length;V<ue;V++){const xe=A[V],Se=xe.object,Ce=xe.geometry,je=xe.group;let $e=xe.material;$e.allowOverride===!0&&X!==null&&($e=X),Se.layers.test($.layers)&&N_(Se,B,$,Ce,$e,je)}}function N_(A,B,$,X,V,ue){A.onBeforeRender(_,B,$,X,V,ue),A.modelViewMatrix.multiplyMatrices($.matrixWorldInverse,A.matrixWorld),A.normalMatrix.getNormalMatrix(A.modelViewMatrix),V.onBeforeRender(_,B,$,X,A,ue),V.transparent===!0&&V.side===bi&&V.forceSinglePass===!1?(V.side=ni,V.needsUpdate=!0,_.renderBufferDirect($,B,X,V,A,ue),V.side=ms,V.needsUpdate=!0,_.renderBufferDirect($,B,X,V,A,ue),V.side=bi):_.renderBufferDirect($,B,X,V,A,ue),A.onAfterRender(_,B,$,X,V,ue)}function Mh(A,B,$){B.isScene!==!0&&(B=rt);const X=Y.get(A),V=v.state.lights,ue=v.state.shadowsArray,xe=V.state.version,Se=he.getParameters(A,V.state,ue,B,$),Ce=he.getProgramCacheKey(Se);let je=X.programs;X.environment=A.isMeshStandardMaterial?B.environment:null,X.fog=B.fog,X.envMap=(A.isMeshStandardMaterial?U:w).get(A.envMap||X.environment),X.envMapRotation=X.environment!==null&&A.envMap===null?B.environmentRotation:A.envMapRotation,je===void 0&&(A.addEventListener("dispose",it),je=new Map,X.programs=je);let $e=je.get(Ce);if($e!==void 0){if(X.currentProgram===$e&&X.lightsStateVersion===xe)return k_(A,Se),$e}else Se.uniforms=he.getUniforms(A),A.onBeforeCompile(Se,_),$e=he.acquireProgram(Se,Ce),je.set(Ce,$e),X.uniforms=Se.uniforms;const Fe=X.uniforms;return(!A.isShaderMaterial&&!A.isRawShaderMaterial||A.clipping===!0)&&(Fe.clippingPlanes=le.uniform),k_(A,Se),X.needsLights=PC(A),X.lightsStateVersion=xe,X.needsLights&&(Fe.ambientLightColor.value=V.state.ambient,Fe.lightProbe.value=V.state.probe,Fe.directionalLights.value=V.state.directional,Fe.directionalLightShadows.value=V.state.directionalShadow,Fe.spotLights.value=V.state.spot,Fe.spotLightShadows.value=V.state.spotShadow,Fe.rectAreaLights.value=V.state.rectArea,Fe.ltc_1.value=V.state.rectAreaLTC1,Fe.ltc_2.value=V.state.rectAreaLTC2,Fe.pointLights.value=V.state.point,Fe.pointLightShadows.value=V.state.pointShadow,Fe.hemisphereLights.value=V.state.hemi,Fe.directionalShadowMap.value=V.state.directionalShadowMap,Fe.directionalShadowMatrix.value=V.state.directionalShadowMatrix,Fe.spotShadowMap.value=V.state.spotShadowMap,Fe.spotLightMatrix.value=V.state.spotLightMatrix,Fe.spotLightMap.value=V.state.spotLightMap,Fe.pointShadowMap.value=V.state.pointShadowMap,Fe.pointShadowMatrix.value=V.state.pointShadowMatrix),X.currentProgram=$e,X.uniformsList=null,$e}function O_(A){if(A.uniformsList===null){const B=A.currentProgram.getUniforms();A.uniformsList=Nu.seqWithValue(B.seq,A.uniforms)}return A.uniformsList}function k_(A,B){const $=Y.get(A);$.outputColorSpace=B.outputColorSpace,$.batching=B.batching,$.batchingColor=B.batchingColor,$.instancing=B.instancing,$.instancingColor=B.instancingColor,$.instancingMorph=B.instancingMorph,$.skinning=B.skinning,$.morphTargets=B.morphTargets,$.morphNormals=B.morphNormals,$.morphColors=B.morphColors,$.morphTargetsCount=B.morphTargetsCount,$.numClippingPlanes=B.numClippingPlanes,$.numIntersection=B.numClipIntersection,$.vertexAlphas=B.vertexAlphas,$.vertexTangents=B.vertexTangents,$.toneMapping=B.toneMapping}function AC(A,B,$,X,V){B.isScene!==!0&&(B=rt),T.resetTextureUnits();const ue=B.fog,xe=X.isMeshStandardMaterial?B.environment:null,Se=P===null?_.outputColorSpace:P.isXRRenderTarget===!0?P.texture.colorSpace:Gn,Ce=(X.isMeshStandardMaterial?U:w).get(X.envMap||xe),je=X.vertexColors===!0&&!!$.attributes.color&&$.attributes.color.itemSize===4,$e=!!$.attributes.tangent&&(!!X.normalMap||X.anisotropy>0),Fe=!!$.morphAttributes.position,_t=!!$.morphAttributes.normal,Tt=!!$.morphAttributes.color;let ln=Xs;X.toneMapped&&(P===null||P.isXRRenderTarget===!0)&&(ln=_.toneMapping);const Qt=$.morphAttributes.position||$.morphAttributes.normal||$.morphAttributes.color,xt=Qt!==void 0?Qt.length:0,Ve=Y.get(X),Dn=v.state.lights;if(ce===!0&&(_e===!0||A!==y)){const Xn=A===y&&X.id===E;le.setState(X,A,Xn)}let Pt=!1;X.version===Ve.__version?(Ve.needsLights&&Ve.lightsStateVersion!==Dn.state.version||Ve.outputColorSpace!==Se||V.isBatchedMesh&&Ve.batching===!1||!V.isBatchedMesh&&Ve.batching===!0||V.isBatchedMesh&&Ve.batchingColor===!0&&V.colorTexture===null||V.isBatchedMesh&&Ve.batchingColor===!1&&V.colorTexture!==null||V.isInstancedMesh&&Ve.instancing===!1||!V.isInstancedMesh&&Ve.instancing===!0||V.isSkinnedMesh&&Ve.skinning===!1||!V.isSkinnedMesh&&Ve.skinning===!0||V.isInstancedMesh&&Ve.instancingColor===!0&&V.instanceColor===null||V.isInstancedMesh&&Ve.instancingColor===!1&&V.instanceColor!==null||V.isInstancedMesh&&Ve.instancingMorph===!0&&V.morphTexture===null||V.isInstancedMesh&&Ve.instancingMorph===!1&&V.morphTexture!==null||Ve.envMap!==Ce||X.fog===!0&&Ve.fog!==ue||Ve.numClippingPlanes!==void 0&&(Ve.numClippingPlanes!==le.numPlanes||Ve.numIntersection!==le.numIntersection)||Ve.vertexAlphas!==je||Ve.vertexTangents!==$e||Ve.morphTargets!==Fe||Ve.morphNormals!==_t||Ve.morphColors!==Tt||Ve.toneMapping!==ln||Ve.morphTargetsCount!==xt)&&(Pt=!0):(Pt=!0,Ve.__version=X.version);let Xi=Ve.currentProgram;Pt===!0&&(Xi=Mh(X,B,V));let ia=!1,mi=!1,Al=!1;const Bt=Xi.getUniforms(),Ti=Ve.uniforms;if(K.useProgram(Xi.program)&&(ia=!0,mi=!0,Al=!0),X.id!==E&&(E=X.id,mi=!0),ia||y!==A){K.buffers.depth.getReversed()?(pe.copy(A.projectionMatrix),bA(pe),xA(pe),Bt.setValue(N,"projectionMatrix",pe)):Bt.setValue(N,"projectionMatrix",A.projectionMatrix),Bt.setValue(N,"viewMatrix",A.matrixWorldInverse);const ai=Bt.map.cameraPosition;ai!==void 0&&ai.setValue(N,nt.setFromMatrixPosition(A.matrixWorld)),te.logarithmicDepthBuffer&&Bt.setValue(N,"logDepthBufFC",2/(Math.log(A.far+1)/Math.LN2)),(X.isMeshPhongMaterial||X.isMeshToonMaterial||X.isMeshLambertMaterial||X.isMeshBasicMaterial||X.isMeshStandardMaterial||X.isShaderMaterial)&&Bt.setValue(N,"isOrthographic",A.isOrthographicCamera===!0),y!==A&&(y=A,mi=!0,Al=!0)}if(V.isSkinnedMesh){Bt.setOptional(N,V,"bindMatrix"),Bt.setOptional(N,V,"bindMatrixInverse");const Xn=V.skeleton;Xn&&(Xn.boneTexture===null&&Xn.computeBoneTexture(),Bt.setValue(N,"boneTexture",Xn.boneTexture,T))}V.isBatchedMesh&&(Bt.setOptional(N,V,"batchingTexture"),Bt.setValue(N,"batchingTexture",V._matricesTexture,T),Bt.setOptional(N,V,"batchingIdTexture"),Bt.setValue(N,"batchingIdTexture",V._indirectTexture,T),Bt.setOptional(N,V,"batchingColorTexture"),V._colorsTexture!==null&&Bt.setValue(N,"batchingColorTexture",V._colorsTexture,T));const Pi=$.morphAttributes;if((Pi.position!==void 0||Pi.normal!==void 0||Pi.color!==void 0)&&Ie.update(V,$,Xi),(mi||Ve.receiveShadow!==V.receiveShadow)&&(Ve.receiveShadow=V.receiveShadow,Bt.setValue(N,"receiveShadow",V.receiveShadow)),X.isMeshGouraudMaterial&&X.envMap!==null&&(Ti.envMap.value=Ce,Ti.flipEnvMap.value=Ce.isCubeTexture&&Ce.isRenderTargetTexture===!1?-1:1),X.isMeshStandardMaterial&&X.envMap===null&&B.environment!==null&&(Ti.envMapIntensity.value=B.environmentIntensity),mi&&(Bt.setValue(N,"toneMappingExposure",_.toneMappingExposure),Ve.needsLights&&TC(Ti,Al),ue&&X.fog===!0&&oe.refreshFogUniforms(Ti,ue),oe.refreshMaterialUniforms(Ti,X,G,ne,v.state.transmissionRenderTarget[A.id]),Nu.upload(N,O_(Ve),Ti,T)),X.isShaderMaterial&&X.uniformsNeedUpdate===!0&&(Nu.upload(N,O_(Ve),Ti,T),X.uniformsNeedUpdate=!1),X.isSpriteMaterial&&Bt.setValue(N,"center",V.center),Bt.setValue(N,"modelViewMatrix",V.modelViewMatrix),Bt.setValue(N,"normalMatrix",V.normalMatrix),Bt.setValue(N,"modelMatrix",V.matrixWorld),X.isShaderMaterial||X.isRawShaderMaterial){const Xn=X.uniformsGroups;for(let ai=0,ef=Xn.length;ai<ef;ai++){const qr=Xn[ai];F.update(qr,Xi),F.bind(qr,Xi)}}return Xi}function TC(A,B){A.ambientLightColor.needsUpdate=B,A.lightProbe.needsUpdate=B,A.directionalLights.needsUpdate=B,A.directionalLightShadows.needsUpdate=B,A.pointLights.needsUpdate=B,A.pointLightShadows.needsUpdate=B,A.spotLights.needsUpdate=B,A.spotLightShadows.needsUpdate=B,A.rectAreaLights.needsUpdate=B,A.hemisphereLights.needsUpdate=B}function PC(A){return A.isMeshLambertMaterial||A.isMeshToonMaterial||A.isMeshPhongMaterial||A.isMeshStandardMaterial||A.isShadowMaterial||A.isShaderMaterial&&A.lights===!0}this.getActiveCubeFace=function(){return M},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return P},this.setRenderTargetTextures=function(A,B,$){const X=Y.get(A);X.__autoAllocateDepthBuffer=A.resolveDepthBuffer===!1,X.__autoAllocateDepthBuffer===!1&&(X.__useRenderToTexture=!1),Y.get(A.texture).__webglTexture=B,Y.get(A.depthTexture).__webglTexture=X.__autoAllocateDepthBuffer?void 0:$,X.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(A,B){const $=Y.get(A);$.__webglFramebuffer=B,$.__useDefaultFramebuffer=B===void 0};const RC=N.createFramebuffer();this.setRenderTarget=function(A,B=0,$=0){P=A,M=B,S=$;let X=!0,V=null,ue=!1,xe=!1;if(A){const Ce=Y.get(A);if(Ce.__useDefaultFramebuffer!==void 0)K.bindFramebuffer(N.FRAMEBUFFER,null),X=!1;else if(Ce.__webglFramebuffer===void 0)T.setupRenderTarget(A);else if(Ce.__hasExternalTextures)T.rebindTextures(A,Y.get(A.texture).__webglTexture,Y.get(A.depthTexture).__webglTexture);else if(A.depthBuffer){const Fe=A.depthTexture;if(Ce.__boundDepthTexture!==Fe){if(Fe!==null&&Y.has(Fe)&&(A.width!==Fe.image.width||A.height!==Fe.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");T.setupDepthRenderbuffer(A)}}const je=A.texture;(je.isData3DTexture||je.isDataArrayTexture||je.isCompressedArrayTexture)&&(xe=!0);const $e=Y.get(A).__webglFramebuffer;A.isWebGLCubeRenderTarget?(Array.isArray($e[B])?V=$e[B][$]:V=$e[B],ue=!0):A.samples>0&&T.useMultisampledRTT(A)===!1?V=Y.get(A).__webglMultisampledFramebuffer:Array.isArray($e)?V=$e[$]:V=$e,L.copy(A.viewport),k.copy(A.scissor),D=A.scissorTest}else L.copy(ge).multiplyScalar(G).floor(),k.copy(Oe).multiplyScalar(G).floor(),D=Ze;if($!==0&&(V=RC),K.bindFramebuffer(N.FRAMEBUFFER,V)&&X&&K.drawBuffers(A,V),K.viewport(L),K.scissor(k),K.setScissorTest(D),ue){const Ce=Y.get(A.texture);N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_CUBE_MAP_POSITIVE_X+B,Ce.__webglTexture,$)}else if(xe){const Ce=Y.get(A.texture),je=B;N.framebufferTextureLayer(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,Ce.__webglTexture,$,je)}else if(A!==null&&$!==0){const Ce=Y.get(A.texture);N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_2D,Ce.__webglTexture,$)}E=-1},this.readRenderTargetPixels=function(A,B,$,X,V,ue,xe){if(!(A&&A.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Se=Y.get(A).__webglFramebuffer;if(A.isWebGLCubeRenderTarget&&xe!==void 0&&(Se=Se[xe]),Se){K.bindFramebuffer(N.FRAMEBUFFER,Se);try{const Ce=A.texture,je=Ce.format,$e=Ce.type;if(!te.textureFormatReadable(je)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!te.textureTypeReadable($e)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}B>=0&&B<=A.width-X&&$>=0&&$<=A.height-V&&N.readPixels(B,$,X,V,qe.convert(je),qe.convert($e),ue)}finally{const Ce=P!==null?Y.get(P).__webglFramebuffer:null;K.bindFramebuffer(N.FRAMEBUFFER,Ce)}}},this.readRenderTargetPixelsAsync=async function(A,B,$,X,V,ue,xe){if(!(A&&A.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Se=Y.get(A).__webglFramebuffer;if(A.isWebGLCubeRenderTarget&&xe!==void 0&&(Se=Se[xe]),Se)if(B>=0&&B<=A.width-X&&$>=0&&$<=A.height-V){K.bindFramebuffer(N.FRAMEBUFFER,Se);const Ce=A.texture,je=Ce.format,$e=Ce.type;if(!te.textureFormatReadable(je))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!te.textureTypeReadable($e))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Fe=N.createBuffer();N.bindBuffer(N.PIXEL_PACK_BUFFER,Fe),N.bufferData(N.PIXEL_PACK_BUFFER,ue.byteLength,N.STREAM_READ),N.readPixels(B,$,X,V,qe.convert(je),qe.convert($e),0);const _t=P!==null?Y.get(P).__webglFramebuffer:null;K.bindFramebuffer(N.FRAMEBUFFER,_t);const Tt=N.fenceSync(N.SYNC_GPU_COMMANDS_COMPLETE,0);return N.flush(),await _A(N,Tt,4),N.bindBuffer(N.PIXEL_PACK_BUFFER,Fe),N.getBufferSubData(N.PIXEL_PACK_BUFFER,0,ue),N.deleteBuffer(Fe),N.deleteSync(Tt),ue}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(A,B=null,$=0){const X=Math.pow(2,-$),V=Math.floor(A.image.width*X),ue=Math.floor(A.image.height*X),xe=B!==null?B.x:0,Se=B!==null?B.y:0;T.setTexture2D(A,0),N.copyTexSubImage2D(N.TEXTURE_2D,$,0,0,xe,Se,V,ue),K.unbindTexture()};const LC=N.createFramebuffer(),IC=N.createFramebuffer();this.copyTextureToTexture=function(A,B,$=null,X=null,V=0,ue=null){ue===null&&(V!==0?(Iu("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),ue=V,V=0):ue=0);let xe,Se,Ce,je,$e,Fe,_t,Tt,ln;const Qt=A.isCompressedTexture?A.mipmaps[ue]:A.image;if($!==null)xe=$.max.x-$.min.x,Se=$.max.y-$.min.y,Ce=$.isBox3?$.max.z-$.min.z:1,je=$.min.x,$e=$.min.y,Fe=$.isBox3?$.min.z:0;else{const Pi=Math.pow(2,-V);xe=Math.floor(Qt.width*Pi),Se=Math.floor(Qt.height*Pi),A.isDataArrayTexture?Ce=Qt.depth:A.isData3DTexture?Ce=Math.floor(Qt.depth*Pi):Ce=1,je=0,$e=0,Fe=0}X!==null?(_t=X.x,Tt=X.y,ln=X.z):(_t=0,Tt=0,ln=0);const xt=qe.convert(B.format),Ve=qe.convert(B.type);let Dn;B.isData3DTexture?(T.setTexture3D(B,0),Dn=N.TEXTURE_3D):B.isDataArrayTexture||B.isCompressedArrayTexture?(T.setTexture2DArray(B,0),Dn=N.TEXTURE_2D_ARRAY):(T.setTexture2D(B,0),Dn=N.TEXTURE_2D),N.pixelStorei(N.UNPACK_FLIP_Y_WEBGL,B.flipY),N.pixelStorei(N.UNPACK_PREMULTIPLY_ALPHA_WEBGL,B.premultiplyAlpha),N.pixelStorei(N.UNPACK_ALIGNMENT,B.unpackAlignment);const Pt=N.getParameter(N.UNPACK_ROW_LENGTH),Xi=N.getParameter(N.UNPACK_IMAGE_HEIGHT),ia=N.getParameter(N.UNPACK_SKIP_PIXELS),mi=N.getParameter(N.UNPACK_SKIP_ROWS),Al=N.getParameter(N.UNPACK_SKIP_IMAGES);N.pixelStorei(N.UNPACK_ROW_LENGTH,Qt.width),N.pixelStorei(N.UNPACK_IMAGE_HEIGHT,Qt.height),N.pixelStorei(N.UNPACK_SKIP_PIXELS,je),N.pixelStorei(N.UNPACK_SKIP_ROWS,$e),N.pixelStorei(N.UNPACK_SKIP_IMAGES,Fe);const Bt=A.isDataArrayTexture||A.isData3DTexture,Ti=B.isDataArrayTexture||B.isData3DTexture;if(A.isDepthTexture){const Pi=Y.get(A),Xn=Y.get(B),ai=Y.get(Pi.__renderTarget),ef=Y.get(Xn.__renderTarget);K.bindFramebuffer(N.READ_FRAMEBUFFER,ai.__webglFramebuffer),K.bindFramebuffer(N.DRAW_FRAMEBUFFER,ef.__webglFramebuffer);for(let qr=0;qr<Ce;qr++)Bt&&(N.framebufferTextureLayer(N.READ_FRAMEBUFFER,N.COLOR_ATTACHMENT0,Y.get(A).__webglTexture,V,Fe+qr),N.framebufferTextureLayer(N.DRAW_FRAMEBUFFER,N.COLOR_ATTACHMENT0,Y.get(B).__webglTexture,ue,ln+qr)),N.blitFramebuffer(je,$e,xe,Se,_t,Tt,xe,Se,N.DEPTH_BUFFER_BIT,N.NEAREST);K.bindFramebuffer(N.READ_FRAMEBUFFER,null),K.bindFramebuffer(N.DRAW_FRAMEBUFFER,null)}else if(V!==0||A.isRenderTargetTexture||Y.has(A)){const Pi=Y.get(A),Xn=Y.get(B);K.bindFramebuffer(N.READ_FRAMEBUFFER,LC),K.bindFramebuffer(N.DRAW_FRAMEBUFFER,IC);for(let ai=0;ai<Ce;ai++)Bt?N.framebufferTextureLayer(N.READ_FRAMEBUFFER,N.COLOR_ATTACHMENT0,Pi.__webglTexture,V,Fe+ai):N.framebufferTexture2D(N.READ_FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_2D,Pi.__webglTexture,V),Ti?N.framebufferTextureLayer(N.DRAW_FRAMEBUFFER,N.COLOR_ATTACHMENT0,Xn.__webglTexture,ue,ln+ai):N.framebufferTexture2D(N.DRAW_FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_2D,Xn.__webglTexture,ue),V!==0?N.blitFramebuffer(je,$e,xe,Se,_t,Tt,xe,Se,N.COLOR_BUFFER_BIT,N.NEAREST):Ti?N.copyTexSubImage3D(Dn,ue,_t,Tt,ln+ai,je,$e,xe,Se):N.copyTexSubImage2D(Dn,ue,_t,Tt,je,$e,xe,Se);K.bindFramebuffer(N.READ_FRAMEBUFFER,null),K.bindFramebuffer(N.DRAW_FRAMEBUFFER,null)}else Ti?A.isDataTexture||A.isData3DTexture?N.texSubImage3D(Dn,ue,_t,Tt,ln,xe,Se,Ce,xt,Ve,Qt.data):B.isCompressedArrayTexture?N.compressedTexSubImage3D(Dn,ue,_t,Tt,ln,xe,Se,Ce,xt,Qt.data):N.texSubImage3D(Dn,ue,_t,Tt,ln,xe,Se,Ce,xt,Ve,Qt):A.isDataTexture?N.texSubImage2D(N.TEXTURE_2D,ue,_t,Tt,xe,Se,xt,Ve,Qt.data):A.isCompressedTexture?N.compressedTexSubImage2D(N.TEXTURE_2D,ue,_t,Tt,Qt.width,Qt.height,xt,Qt.data):N.texSubImage2D(N.TEXTURE_2D,ue,_t,Tt,xe,Se,xt,Ve,Qt);N.pixelStorei(N.UNPACK_ROW_LENGTH,Pt),N.pixelStorei(N.UNPACK_IMAGE_HEIGHT,Xi),N.pixelStorei(N.UNPACK_SKIP_PIXELS,ia),N.pixelStorei(N.UNPACK_SKIP_ROWS,mi),N.pixelStorei(N.UNPACK_SKIP_IMAGES,Al),ue===0&&B.generateMipmaps&&N.generateMipmap(Dn),K.unbindTexture()},this.copyTextureToTexture3D=function(A,B,$=null,X=null,V=0){return Iu('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(A,B,$,X,V)},this.initRenderTarget=function(A){Y.get(A).__webglFramebuffer===void 0&&T.setupRenderTarget(A)},this.initTexture=function(A){A.isCubeTexture?T.setTextureCube(A,0):A.isData3DTexture?T.setTexture3D(A,0):A.isDataArrayTexture||A.isCompressedArrayTexture?T.setTexture2DArray(A,0):T.setTexture2D(A,0),K.unbindTexture()},this.resetState=function(){M=0,S=0,P=null,K.reset(),At.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ji}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=ht._getDrawingBufferColorSpace(e),t.unpackColorSpace=ht._getUnpackColorSpace()}}const CD=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:gw,AddEquation:yr,AddOperation:pw,AdditiveAnimationBlendMode:kv,AdditiveBlending:Wu,AgXToneMapping:ed,AlphaFormat:Rv,AlwaysCompare:Nw,AlwaysDepth:qu,AlwaysStencilFunc:Gm,AmbientLight:yE,AnimationAction:IE,AnimationClip:sl,AnimationLoader:$T,AnimationMixer:DE,AnimationObjectGroup:vP,AnimationUtils:zT,ArcCurve:Kw,ArrayCamera:TE,ArrowHelper:FP,AttachedBindMode:Hm,Audio:RE,AudioAnalyser:oP,AudioContext:ug,AudioListener:iP,AudioLoader:eP,AxesHelper:BP,BackSide:ni,BasicDepthPacking:Sw,BasicShadowMap:E1,BatchedMesh:Xw,Bone:up,BooleanKeyframeTrack:Yo,Box2:SP,Box3:yn,Box3Helper:kP,BoxGeometry:Vr,BoxHelper:OP,BufferAttribute:dt,BufferGeometry:Ye,BufferGeometryLoader:CE,ByteType:Av,Cache:Hs,Camera:lp,CameraHelper:NP,CanvasTexture:hT,CapsuleGeometry:vp,CatmullRomCurve3:Yw,CineonToneMapping:vw,CircleGeometry:gp,ClampToEdgeWrapping:xi,Clock:PE,Color:ve,ColorKeyframeTrack:rg,ColorManagement:ht,CompressedArrayTexture:lT,CompressedCubeTexture:cT,CompressedTexture:fp,CompressedTextureLoader:jT,ConeGeometry:_p,ConstantAlphaFactor:hw,ConstantColorFactor:lw,Controls:kE,CubeCamera:Hw,CubeReflectionMapping:Ys,CubeRefractionMapping:Pr,CubeTexture:Yc,CubeTextureLoader:XT,CubeUVReflectionMapping:hl,CubicBezierCurve:Yv,CubicBezierCurve3:Zw,CubicInterpolant:vE,CullFaceBack:Bm,CullFaceFront:Xy,CullFaceFrontBack:w1,CullFaceNone:jy,Curve:is,CurvePath:Qw,CustomBlending:qy,CustomToneMapping:_w,CylinderGeometry:dl,Cylindrical:MP,Data3DTexture:op,DataArrayTexture:Kc,DataTexture:ds,DataTextureLoader:qT,DataUtils:OA,DecrementStencilOp:N1,DecrementWrapStencilOp:k1,DefaultLoadingManager:Jo,DepthFormat:Za,DepthStencilFormat:Ja,DepthTexture:qv,DetachedBindMode:xw,DirectionalLight:hg,DirectionalLightHelper:DP,DiscreteInterpolant:gE,DodecahedronGeometry:bp,DoubleSide:bi,DstAlphaFactor:iw,DstColorFactor:rw,DynamicCopyUsage:Z1,DynamicDrawUsage:$1,DynamicReadUsage:q1,EdgesGeometry:eE,EllipseCurve:mp,EqualCompare:Rw,EqualDepth:Yu,EqualStencilFunc:V1,EquirectangularReflectionMapping:gc,EquirectangularRefractionMapping:_c,Euler:es,EventDispatcher:Es,ExtrudeGeometry:xp,FileLoader:ts,Float16BufferAttribute:HA,Float32BufferAttribute:Te,FloatType:di,Fog:hp,FogExp2:cp,FramebufferTexture:aT,FrontSide:ms,Frustum:Qc,GLBufferAttribute:EP,GLSL1:Q1,GLSL3:Wm,GreaterCompare:Lw,GreaterDepth:Ju,GreaterEqualCompare:Dw,GreaterEqualDepth:Zu,GreaterEqualStencilFunc:W1,GreaterStencilFunc:H1,GridHelper:LP,Group:wi,HalfFloatType:ul,HemisphereLight:xE,HemisphereLightHelper:RP,IcosahedronGeometry:yp,ImageBitmapLoader:AE,ImageLoader:Tc,ImageUtils:Uw,IncrementStencilOp:D1,IncrementWrapStencilOp:O1,InstancedBufferAttribute:No,InstancedBufferGeometry:SE,InstancedInterleavedBuffer:wP,InstancedMesh:jv,Int16BufferAttribute:VA,Int32BufferAttribute:zA,Int8BufferAttribute:UA,IntType:Zd,InterleavedBuffer:Zc,InterleavedBufferAttribute:Lr,Interpolant:fl,InterpolateDiscrete:Qa,InterpolateLinear:el,InterpolateSmooth:Lu,InvertStencilOp:U1,KeepStencilOp:_o,KeyframeTrack:$i,LOD:jw,LatheGeometry:eh,Layers:ap,LessCompare:Pw,LessDepth:Ku,LessEqualCompare:Fv,LessEqualDepth:Do,LessEqualStencilFunc:z1,LessStencilFunc:B1,Light:Hr,LightProbe:ME,Line:Js,Line3:NE,LineBasicMaterial:$n,LineCurve:Zv,LineCurve3:Jw,LineDashedMaterial:pE,LineLoop:Xv,LineSegments:ns,LinearFilter:sn,LinearInterpolant:sg,LinearMipMapLinearFilter:A1,LinearMipMapNearestFilter:C1,LinearMipmapLinearFilter:ki,LinearMipmapNearestFilter:Fa,LinearSRGBColorSpace:Gn,LinearToneMapping:fw,LinearTransfer:xc,Loader:ri,LoaderUtils:Sr,LoadingManager:og,LoopOnce:yw,LoopPingPong:Ew,LoopRepeat:ww,LuminanceAlphaFormat:Dv,LuminanceFormat:Iv,MOUSE:To,Material:En,MaterialLoader:Tp,MathUtils:sp,Matrix2:vg,Matrix3:Je,Matrix4:De,MaxEquation:Jy,Mesh:Kt,MeshBasicMaterial:yi,MeshDepthMaterial:tg,MeshDistanceMaterial:ng,MeshLambertMaterial:uE,MeshMatcapMaterial:dE,MeshNormalMaterial:hE,MeshPhongMaterial:lE,MeshPhysicalMaterial:Wi,MeshStandardMaterial:pl,MeshToonMaterial:cE,MinEquation:Zy,MirroredRepeatWrapping:qa,MixOperation:dw,MultiplyBlending:zm,MultiplyOperation:Xc,NearestFilter:xn,NearestMipMapLinearFilter:S1,NearestMipMapNearestFilter:M1,NearestMipmapLinearFilter:wo,NearestMipmapNearestFilter:Yd,NeutralToneMapping:bw,NeverCompare:Tw,NeverDepth:Xu,NeverStencilFunc:F1,NoBlending:js,NoColorSpace:Vs,NoToneMapping:Xs,NormalAnimationBlendMode:ip,NormalBlending:Po,NotEqualCompare:Iw,NotEqualDepth:Qu,NotEqualStencilFunc:G1,NumberKeyframeTrack:ko,Object3D:ft,ObjectLoader:JT,ObjectSpaceNormalMap:Aw,OctahedronGeometry:th,OneFactor:ew,OneMinusConstantAlphaFactor:uw,OneMinusConstantColorFactor:cw,OneMinusDstAlphaFactor:sw,OneMinusDstColorFactor:ow,OneMinusSrcAlphaFactor:ju,OneMinusSrcColorFactor:nw,OrthographicCamera:ml,PCFShadowMap:Cv,PCFSoftShadowMap:rc,PMREMGenerator:Zm,Path:Mc,PerspectiveCamera:_n,Plane:Us,PlaneGeometry:Ko,PlaneHelper:UP,PointLight:cg,PointLightHelper:TP,Points:pp,PointsMaterial:dp,PolarGridHelper:IP,PolyhedronGeometry:zr,PositionalAudio:rP,PropertyBinding:gt,PropertyMixer:LE,QuadraticBezierCurve:Jv,QuadraticBezierCurve3:Qv,Quaternion:In,QuaternionKeyframeTrack:Uo,QuaternionLinearInterpolant:_E,RED_GREEN_RGTC2_Format:Sd,RED_RGTC1_Format:Ov,REVISION:qd,RGBADepthPacking:Cw,RGBAFormat:ei,RGBAIntegerFormat:np,RGBA_ASTC_10x10_Format:bd,RGBA_ASTC_10x5_Format:vd,RGBA_ASTC_10x6_Format:gd,RGBA_ASTC_10x8_Format:_d,RGBA_ASTC_12x10_Format:xd,RGBA_ASTC_12x12_Format:yd,RGBA_ASTC_4x4_Format:ld,RGBA_ASTC_5x4_Format:cd,RGBA_ASTC_5x5_Format:hd,RGBA_ASTC_6x5_Format:ud,RGBA_ASTC_6x6_Format:dd,RGBA_ASTC_8x5_Format:pd,RGBA_ASTC_8x6_Format:fd,RGBA_ASTC_8x8_Format:md,RGBA_BPTC_Format:hc,RGBA_ETC2_EAC_Format:ad,RGBA_PVRTC_2BPPV1_Format:sd,RGBA_PVRTC_4BPPV1_Format:id,RGBA_S3TC_DXT1_Format:ac,RGBA_S3TC_DXT3_Format:lc,RGBA_S3TC_DXT5_Format:cc,RGBDepthPacking:P1,RGBFormat:Lv,RGBIntegerFormat:T1,RGB_BPTC_SIGNED_Format:wd,RGB_BPTC_UNSIGNED_Format:Ed,RGB_ETC1_Format:rd,RGB_ETC2_Format:od,RGB_PVRTC_2BPPV1_Format:nd,RGB_PVRTC_4BPPV1_Format:td,RGB_S3TC_DXT1_Format:oc,RGDepthPacking:R1,RGFormat:Nv,RGIntegerFormat:tp,RawShaderMaterial:aE,Ray:Br,Raycaster:mg,RectAreaLight:wE,RedFormat:ep,RedIntegerFormat:qc,ReinhardToneMapping:mw,RenderTarget:rp,RenderTarget3D:_P,RenderTargetArray:bP,RepeatWrapping:Rr,ReplaceStencilOp:I1,ReverseSubtractEquation:Yy,RingGeometry:wp,SIGNED_RED_GREEN_RGTC2_Format:Cd,SIGNED_RED_RGTC1_Format:Md,SRGBColorSpace:gn,SRGBTransfer:Dt,Scene:Gv,ShaderChunk:ze,ShaderLib:Oi,ShaderMaterial:zi,ShadowMaterial:oE,Shape:Lo,ShapeGeometry:Ep,ShapePath:VP,ShapeUtils:ps,ShortType:Tv,Skeleton:Jc,SkeletonHelper:AP,SkinnedMesh:$v,Source:Er,Sphere:wn,SphereGeometry:nh,Spherical:Ld,SphericalHarmonics3:EE,SplineCurve:eg,SpotLight:lg,SpotLightHelper:CP,Sprite:$w,SpriteMaterial:Wv,SrcAlphaFactor:$u,SrcAlphaSaturateFactor:aw,SrcColorFactor:tw,StaticCopyUsage:Y1,StaticDrawUsage:yc,StaticReadUsage:X1,StereoCamera:tP,StreamCopyUsage:J1,StreamDrawUsage:j1,StreamReadUsage:K1,StringKeyframeTrack:Zo,SubtractEquation:Ky,SubtractiveBlending:Vm,TOUCH:yo,TangentSpaceNormalMap:Fr,TetrahedronGeometry:Mp,Texture:Wt,TextureLoader:bE,TextureUtils:$P,TimestampQuery:eA,TorusGeometry:Sp,TorusKnotGeometry:Cp,Triangle:ui,TriangleFanDrawMode:Ad,TriangleStripDrawMode:Uv,TrianglesDrawMode:Mw,TubeGeometry:Ap,UVMapping:Kd,Uint16BufferAttribute:Vv,Uint32BufferAttribute:zv,Uint8BufferAttribute:FA,Uint8ClampedBufferAttribute:BA,Uniform:fg,UniformsGroup:yP,UniformsLib:me,UniformsUtils:Hv,UnsignedByteType:vs,UnsignedInt248Type:Ya,UnsignedInt5999Type:Pv,UnsignedIntType:Zs,UnsignedShort4444Type:Jd,UnsignedShort5551Type:Qd,UnsignedShortType:Ka,VSMShadowMap:os,Vector2:ee,Vector3:R,Vector4:ct,VectorKeyframeTrack:Fo,VideoFrameTexture:oT,VideoTexture:qw,WebGL3DRenderTarget:SA,WebGLArrayRenderTarget:MA,WebGLCoordinateSystem:Ji,WebGLCubeRenderTarget:Gw,WebGLRenderTarget:gs,WebGLRenderer:GE,WebGLUtils:HE,WebGPUCoordinateSystem:wc,WebXRController:Du,WireframeGeometry:rE,WrapAroundEnding:bc,ZeroCurvatureEnding:Eo,ZeroFactor:Qy,ZeroSlopeEnding:Mo,ZeroStencilOp:L1,createCanvasElement:kw},Symbol.toStringTag,{value:"Module"})),Tb=(n,e)=>{if(n===e)return!0;if(!n||!e)return!1;const t=n.length;if(e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0},AD=()=>{const n=[],i={items:n,remember:(s,r)=>{for(let a=0;a<n.length;a++){const l=n[a];if(Tb(r,l.keys)&&l.promise)return l.promise}const o={promise:s(),keys:r};return n.push(o),o.promise},clear:s=>{for(let r=0;r<n.length;r++){const o=n[r];if(Tb(s,o.keys)){n.splice(r,1);return}}}};return Rn("threlte-cache",i),i},TD=()=>{const n=Yt("threlte-cache");if(!n)throw new Error("No cache found. The cache can only be used in a child component to <Canvas>.");return n},Pb=Symbol(),PD=n=>typeof(n==null?void 0:n.subscribe)=="function",WE=(n,e,t)=>{const i=n().map(o=>PD(o)?y1(o):Pb),s=un(()=>n().map((o,a)=>i[a]===Pb?o:i[a].current)),r=()=>{I(s);let o;return jd(()=>{o=e(I(s))}),o};t?hn(r):Bs(r)},RD=(n,e)=>WE(n,e,!1),LD=(n,e)=>WE(n,e,!0),ID=Object.assign(RD,{pre:LD}),On=(n,e)=>(n==null?void 0:n[`is${e}`])===!0,Yf=n=>{const e=Ln(void 0),t=Ln(void 0);return n.then(i=>{e.set(i)}).catch(i=>{console.error("Error in asyncWritable:",i.message),t.set(i)}),Object.assign(Object.assign(n,e),{error:t,promise:n})},DD=typeof window<"u",Vn=(n,e)=>{const t=jc(n,r=>r);let i;const s=t.subscribe(async r=>{i&&i();const o=await e(r);o&&(i=o)});Si(()=>{s(),i&&i()})},Ht=n=>{const e=Ln(n),t={set:i=>{t.current=i,e.set(i)},subscribe:e.subscribe,update:i=>{const s=i(t.current);t.current=s,e.set(s)},current:n};return t},ND=n=>({subscribe:n.subscribe,get current(){return n.current}}),$E=(n,e)=>{if(e.includes(".")){const t=e.split("."),i=t.pop();for(let s=0;s<t.length;s+=1)n=n[t[s]];return{target:n,key:i}}else return{target:n,key:e}},OD=n=>{const{dom:e,canvas:t}=n,i=Ht({width:e.offsetWidth,height:e.offsetHeight});Ur(()=>{const r=new ResizeObserver(()=>{const{offsetWidth:o,offsetHeight:a}=e;(i.current.width!==o||i.current.height!==a)&&i.set({width:o,height:a})});return r.observe(e),()=>{r.disconnect()}});const s={dom:e,canvas:t,size:ND(i)};return Rn("threlte-dom-context",s),s},Rp=()=>{const n=Yt("threlte-dom-context");if(!n)throw new Error("useDOM can only be used in a child component to <Canvas>.");return n};function kD(n){return{all:n=n||new Map,on:function(e,t){var i=n.get(e);i?i.push(t):n.set(e,[t])},off:function(e,t){var i=n.get(e);i&&(t?i.splice(i.indexOf(t)>>>0,1):n.set(e,[]))},emit:function(e,t){var i=n.get(e);i&&i.slice().map(function(s){s(t)}),(i=n.get("*"))&&i.slice().map(function(s){s(e,t)})}}}class xr{constructor(){Vt(this,"allVertices",{});Vt(this,"isolatedVertices",{});Vt(this,"connectedVertices",{});Vt(this,"sortedConnectedValues",[]);Vt(this,"needsSort",!1);Vt(this,"emitter",kD());Vt(this,"emit",this.emitter.emit.bind(this.emitter));Vt(this,"on",this.emitter.on.bind(this.emitter));Vt(this,"off",this.emitter.off.bind(this.emitter));Vt(this,"getKey",e=>typeof e=="object"?e.key:e)}get sortedVertices(){return this.mapNodes(e=>e)}moveToIsolated(e){const t=this.connectedVertices[e];t&&(this.isolatedVertices[e]=t,delete this.connectedVertices[e])}moveToConnected(e){const t=this.isolatedVertices[e];t&&(this.connectedVertices[e]=t,delete this.isolatedVertices[e])}add(e,t,i){if(this.allVertices[e]&&this.allVertices[e].value!==void 0)throw new Error(`A node with the key ${e.toString()} already exists`);let s=this.allVertices[e];s?s.value===void 0&&(s.value=t):(s={value:t,previous:new Set,next:new Set},this.allVertices[e]=s);const r=s.next.size>0||s.previous.size>0;if(!(i!=null&&i.after)&&!(i!=null&&i.before)&&!r){this.isolatedVertices[e]=s,this.emit("node:added",{key:e,type:"isolated",value:t});return}else this.connectedVertices[e]=s;if(i!=null&&i.after){const o=Array.isArray(i.after)?i.after:[i.after];o.forEach(a=>{s.previous.add(this.getKey(a))}),o.forEach(a=>{const l=this.getKey(a),c=this.allVertices[l];c?(c.next.add(e),this.moveToConnected(l)):(this.allVertices[l]={value:void 0,previous:new Set,next:new Set([e])},this.connectedVertices[l]=this.allVertices[l])})}if(i!=null&&i.before){const o=Array.isArray(i.before)?i.before:[i.before];o.forEach(a=>{s.next.add(this.getKey(a))}),o.forEach(a=>{const l=this.getKey(a),c=this.allVertices[l];c?(c.previous.add(e),this.moveToConnected(l)):(this.allVertices[l]={value:void 0,previous:new Set([e]),next:new Set},this.connectedVertices[l]=this.allVertices[l])})}this.emit("node:added",{key:e,type:"connected",value:t}),this.needsSort=!0}remove(e){const t=this.getKey(e);if(this.isolatedVertices[t]){delete this.isolatedVertices[t],delete this.allVertices[t],this.emit("node:removed",{key:t,type:"isolated"});return}const s=this.connectedVertices[t];s&&(s.next.forEach(r=>{const o=this.connectedVertices[r];o&&(o.previous.delete(t),o.previous.size===0&&o.next.size===0&&this.moveToIsolated(r))}),s.previous.forEach(r=>{const o=this.connectedVertices[r];o&&(o.next.delete(t),o.previous.size===0&&o.next.size===0&&this.moveToIsolated(r))}),delete this.connectedVertices[t],delete this.allVertices[t],this.emit("node:removed",{key:t,type:"connected"}),this.needsSort=!0)}mapNodes(e){this.needsSort&&this.sort();const t=[];return this.forEachNode((i,s)=>{t.push(e(i,s))}),t}forEachNode(e){this.needsSort&&this.sort();let t=0;for(;t<this.sortedConnectedValues.length;t++)e(this.sortedConnectedValues[t],t);Reflect.ownKeys(this.isolatedVertices).forEach(i=>{const s=this.isolatedVertices[i];s.value!==void 0&&e(s.value,t++)})}getValueByKey(e){var t;return(t=this.allVertices[e])==null?void 0:t.value}getKeyByValue(e){return Reflect.ownKeys(this.connectedVertices).find(t=>this.connectedVertices[t].value===e)??Reflect.ownKeys(this.isolatedVertices).find(t=>this.isolatedVertices[t].value===e)}sort(){var o;const e=new Map,t=[],i=[],s=Reflect.ownKeys(this.connectedVertices).filter(a=>this.connectedVertices[a].value!==void 0);for(s.forEach(a=>{e.set(a,0)}),s.forEach(a=>{this.connectedVertices[a].next.forEach(c=>{this.connectedVertices[c]&&e.set(c,(e.get(c)||0)+1)})}),e.forEach((a,l)=>{a===0&&t.push(l)});t.length>0;){const a=t.shift();i.push(a);const l=s.find(c=>c===a);l&&((o=this.connectedVertices[l])==null||o.next.forEach(c=>{const h=(e.get(c)||0)-1;e.set(c,h),h===0&&t.push(c)}))}if(i.length!==s.length)throw new Error("The graph contains a cycle, and thus can not be sorted topologically.");const r=a=>a!==void 0;this.sortedConnectedValues=i.map(a=>this.connectedVertices[a].value).filter(r),this.needsSort=!1}clear(){this.allVertices={},this.isolatedVertices={},this.connectedVertices={},this.sortedConnectedValues=[],this.needsSort=!1}static isKey(e){return typeof e=="string"||typeof e=="symbol"}static isValue(e){return typeof e=="object"&&"key"in e}}class UD{constructor(e,t,i){Vt(this,"key");Vt(this,"stage");Vt(this,"callback");Vt(this,"runTask",!0);this.stage=e,this.key=t,this.callback=i}stop(){this.runTask=!1}start(){this.runTask=!0}run(e){this.runTask&&this.callback(e)}}class FD extends xr{constructor(t,i,s){super();Vt(this,"key");Vt(this,"scheduler");Vt(this,"runTask",!0);Vt(this,"callback",(t,i)=>i());Vt(this,"removeTask",this.remove.bind(this));this.scheduler=t,this.key=i,this.start=this.start.bind(this),this.stop=this.stop.bind(this),s&&(this.callback=s.bind(this))}stop(){this.runTask=!1}start(){this.runTask=!0}get tasks(){return this.sortedVertices}createTask(t,i,s){const r=new UD(this,t,i);return this.add(t,r,s),r}getTask(t){return this.getValueByKey(t)}run(t){this.runTask&&this.callback(t,i=>{this.forEachNode(s=>{s.run(i??t)})})}runWithTiming(t){if(!this.runTask)return{};const i={};return this.callback(t,s=>{this.forEachNode(r=>{const o=performance.now();r.run(s??t);const a=performance.now()-o;i[r.key]=a})}),i}getSchedule(){return this.mapNodes(t=>t.key.toString())}}class BD extends xr{constructor(t){super();Vt(this,"lastTime",performance.now());Vt(this,"clampDeltaTo",.1);Vt(this,"removeStage",this.remove.bind(this));t!=null&&t.clampDeltaTo&&(this.clampDeltaTo=t.clampDeltaTo),this.run=this.run.bind(this)}get stages(){return this.sortedVertices}createStage(t,i){const s=new FD(this,t,i==null?void 0:i.callback);return this.add(t,s,{after:i==null?void 0:i.after,before:i==null?void 0:i.before}),s}getStage(t){return this.getValueByKey(t)}run(t){const i=t-this.lastTime;this.forEachNode(s=>{s.run(Math.min(i/1e3,this.clampDeltaTo))}),this.lastTime=t}runWithTiming(t){const i=t-this.lastTime,s={},r=performance.now();return this.forEachNode(o=>{const a=performance.now(),l=o.runWithTiming(Math.min(i/1e3,this.clampDeltaTo)),c=performance.now()-a;s[o.key.toString()]={duration:c,tasks:l}}),{total:performance.now()-r,stages:s}}getSchedule(t={tasks:!0}){return{stages:this.mapNodes(i=>{if(i===void 0)throw new Error("Stage not found");return{key:i.key.toString(),tasks:t.tasks?i.getSchedule():void 0}})}}dispose(){this.clear()}}const VD=n=>{const e=new BD,t=e.createStage(Symbol("threlte-main-stage")),i={scheduler:e,frameInvalidated:!0,autoInvalidations:new Set,shouldAdvance:!1,advance:()=>{i.shouldAdvance=!0},autoRender:Ht(n.autoRender??!0),renderMode:Ht(n.renderMode??"on-demand"),invalidate(){i.frameInvalidated=!0},mainStage:t,shouldRender:()=>i.renderMode.current==="always"||i.renderMode.current==="on-demand"&&(i.frameInvalidated||i.autoInvalidations.size>0)||i.renderMode.current==="manual"&&i.shouldAdvance,renderStage:e.createStage(Symbol("threlte-render-stage"),{after:t,callback(s,r){i.shouldRender()&&r()}}),resetFrameInvalidation(){i.frameInvalidated=!1,i.shouldAdvance=!1}};return Bs(()=>{i.autoRender.set(n.autoRender??!0)}),Bs(()=>{i.renderMode.set(n.renderMode??"on-demand")}),Si(()=>{i.scheduler.dispose()}),Rn("threlte-scheduler-context",i),i},Lp=()=>{const n=Yt("threlte-scheduler-context");if(!n)throw new Error("useScheduler can only be used in a child component to <Canvas>.");return n},zD=()=>{const{size:n}=Rp(),{invalidate:e}=Lp(),t=new _n(75,0,.1,1e3);t.position.z=5,t.lookAt(0,0,0);const i=Ht(t);Vn(n,r=>{if(i.current===t){const o=i.current;o.aspect=r.width/r.height,o.updateProjectionMatrix(),e()}});const s={camera:i};return Rn("threlte-camera-context",s),s},jE=()=>{const n=Yt("threlte-camera-context");if(!n)throw new Error("useCamera can only be used in a child component to <Canvas>.");return n},HD=()=>{const n={removeObjectFromDisposal:e=>{n.disposableObjects.delete(e)},disposableObjectMounted:e=>{const t=n.disposableObjects.get(e);t?n.disposableObjects.set(e,t+1):n.disposableObjects.set(e,1)},disposableObjectUnmounted:e=>{const t=n.disposableObjects.get(e);t&&t>0&&(n.disposableObjects.set(e,t-1),t-1<=0&&(n.shouldDispose=!0))},disposableObjects:new Map,shouldDispose:!1,dispose:async(e=!1)=>{await Xd(),!(!n.shouldDispose&&!e)&&(n.disposableObjects.forEach((t,i)=>{var s;(t===0||e)&&((s=i==null?void 0:i.dispose)==null||s.call(i),n.disposableObjects.delete(i))}),n.shouldDispose=!1)}};return Si(()=>{n.dispose(!0)}),Rn("threlte-disposal-context",n),n},XE=()=>{const n=Yt("threlte-disposal-context");if(!n)throw new Error("useDisposal can only be used in a child component to <Canvas>.");return n},qE=Symbol("threlte-parent-context"),KE=n=>{const e=Ht(n);return Rn(qE,e),e},YE=()=>Yt(qE),Id=Symbol("threlte-parent-object3d-context"),GD=n=>{const e=Uy(n);return Rn(Id,e),e},WD=n=>{const e=Yt(Id),t=Ln(n),i=jc([t,e],([s,r])=>s??r);return Rn(Id,i),t},$D=()=>Yt(Id);function gl(n,e,t){if(!DD)return{task:void 0,start:()=>{},stop:()=>{},started:Uy(!1)};let i,s,r;xr.isKey(n)?(i=n,s=e,r=t):(i=Symbol("useTask"),s=n,r=e);const o=Lp();let a=o.mainStage;if(r){if(r.stage)if(xr.isValue(r.stage))a=r.stage;else{const d=o.scheduler.getStage(r.stage);if(!d)throw new Error(`No stage found with key ${r.stage.toString()}`);a=d}else if(r.after)if(Array.isArray(r.after))for(let d=0;d<r.after.length;d++){const p=r.after[d];if(xr.isValue(p)){a=p.stage;break}}else xr.isValue(r.after)&&(a=r.after.stage);else if(r.before)if(Array.isArray(r.before))for(let d=0;d<r.before.length;d++){const p=r.before[d];if(xr.isValue(p)){a=p.stage;break}}else xr.isValue(r.before)&&(a=r.before.stage)}const l=Ln(!1),c=a.createTask(i,s,r),h=()=>{l.set(!0),((r==null?void 0:r.autoInvalidate)??!0)&&o.autoInvalidations.add(s),c.start()},u=()=>{l.set(!1),((r==null?void 0:r.autoInvalidate)??!0)&&o.autoInvalidations.delete(s),c.stop()};return(r==null?void 0:r.autoStart)??!0?h():u(),Si(()=>{u(),a.removeTask(i)}),{task:c,start:h,stop:u,started:{subscribe:l.subscribe}}}const jD=n=>{const e={scene:new Gv};return Rn("threlte-scene-context",e),e},ZE=()=>{const n=Yt("threlte-scene-context");if(!n)throw new Error("useScene can only be used in a child component to <Canvas>.");return n},XD=n=>{const{dispose:e}=XE(),{camera:t}=jE(),{scene:i}=ZE(),{invalidate:s,renderStage:r,autoRender:o,scheduler:a,resetFrameInvalidation:l}=Lp(),{size:c,canvas:h}=Rp(),u=n.createRenderer?n.createRenderer(h):new GE({canvas:h,powerPreference:"high-performance",antialias:!0,alpha:!0}),d=r.createTask(Symbol("threlte-auto-render-task"),()=>{u.render(i,t.current)}),p={renderer:u,colorManagementEnabled:Ht(n.colorManagementEnabled??!0),colorSpace:Ht(n.colorSpace??"srgb"),dpr:Ht(n.dpr??window.devicePixelRatio),shadows:Ht(n.shadows??rc),toneMapping:Ht(n.toneMapping??ed),autoRenderTask:d};Rn("threlte-renderer-context",p),Vn([p.colorManagementEnabled],([m])=>{ht.enabled=m}),Vn([p.colorSpace],([m])=>{"outputColorSpace"in u&&(u.outputColorSpace=m)}),Vn([p.dpr],([m])=>{"setPixelRatio"in u&&u.setPixelRatio(m)});const{start:f,stop:g}=gl(()=>{var m;!("xr"in u)||(m=u.xr)!=null&&m.isPresenting||(u.setSize(c.current.width,c.current.height),s(),g())},{before:d,autoStart:!1,autoInvalidate:!1});return Vn([c],()=>{f()}),Vn([p.shadows],([m])=>{"shadowMap"in u&&(u.shadowMap.enabled=!!m,m&&m!==!0?u.shadowMap.type=m:m===!0&&(u.shadowMap.type=rc))}),Vn([p.toneMapping],([m])=>{"toneMapping"in u&&(u.toneMapping=m)}),Vn([o],([m])=>(m?p.autoRenderTask.start():p.autoRenderTask.stop(),()=>{p.autoRenderTask.stop()})),"setAnimationLoop"in p.renderer&&p.renderer.setAnimationLoop(v=>{e(),a.run(v),l()}),Si(()=>{if("dispose"in p.renderer){const m=p.renderer.dispose;m()}}),Bs(()=>{p.colorManagementEnabled.set(n.colorManagementEnabled??!0)}),Bs(()=>{p.colorSpace.set(n.colorSpace??"srgb")}),Bs(()=>{p.toneMapping.set(n.toneMapping??ed)}),Bs(()=>{p.shadows.set(n.shadows??rc)}),Bs(()=>{p.dpr.set(n.dpr??window.devicePixelRatio)}),p},qD=()=>{const n=Yt("threlte-renderer-context");if(!n)throw new Error("useRenderer can only be used in a child component to <Canvas>.");return n},KD=()=>{const n=Ht({});return Rn("threlte-user-context",n),n},YD=()=>{const n=Yt("threlte-user-context");if(!n)throw new Error("useUserContext can only be used in a child component to <Canvas>.");return n},ZD=n=>{const{scene:e}=jD();return{scene:e,...OD(n),...AD(),...KE(e),...GD(e),...HD(),...VD(n),...zD(),...XD(n),...KD()}};function JD(n,e){on(e,!0);let t=kr(e,["$$slots","$$events","$$legacy","children"]);ZD(t);var i=pt(),s=Be(i);Qi(s,()=>e.children),Pe(n,i),an()}var QD=Ft('<div class="svelte-1osucwe"><canvas class="svelte-1osucwe"><!></canvas></div>');function eN(n,e){let t=kr(e,["$$slots","$$events","$$legacy","children"]),i=Xa(void 0),s=Xa(void 0);var r=QD(),o=Jn(r),a=Jn(o);{var l=c=>{JD(c,zn({get dom(){return I(s)},get canvas(){return I(i)}},()=>t,{children:(h,u)=>{var d=pt(),p=Be(d);Qi(p,()=>e.children??cs),Pe(h,d)},$$slots:{default:!0}}))};Pn(a,c=>{I(i)&&I(s)&&c(l)})}Qn(o),us(o,c=>st(i,c),()=>I(i)),Qn(r),us(r,c=>st(s,c),()=>I(s)),Pe(n,r)}const _l=()=>{const n=Lp(),e=qD(),t=jE(),i=ZE(),s=Rp();return{advance:n.advance,autoRender:n.autoRender,autoRenderTask:e.autoRenderTask,camera:t.camera,colorManagementEnabled:e.colorManagementEnabled,colorSpace:e.colorSpace,dpr:e.dpr,invalidate:n.invalidate,mainStage:n.mainStage,renderer:e.renderer,renderMode:n.renderMode,renderStage:n.renderStage,scheduler:n.scheduler,shadows:e.shadows,shouldRender:n.shouldRender,dom:s.dom,canvas:s.canvas,size:s.size,toneMapping:e.toneMapping,get scene(){return i.scene},set scene(o){i.scene=o}}},tN=n=>typeof n=="object"&&n!==null,nN=()=>{const{invalidate:n}=_l();let e;const t=Ln(),i=YE(),s=$D(),r=KE(),o=WD();Vn([t,r,i,s],([c,h,u,d])=>{if(e==null||e(),e=void 0,!h){n();return}if(c!==void 0){if(c){if(typeof c=="function")e=c({ref:h,parent:u,parentObject3D:d});else if(On(c,"Object3D")&&On(h,"Object3D"))e=()=>c==null?void 0:c.remove(h),c==null||c.add(h);else if(typeof c=="string"){const{target:p,key:f}=$E(u,c),g=p[f];e=()=>p[f]=g,p[f]=h}}}else On(h,"Object3D")?(e=()=>d==null?void 0:d.remove(h),d==null||d.add(h)):tN(u)&&(On(h,"Material")?u.material=h:On(h,"BufferGeometry")&&(u.geometry=h));n()});const a=c=>{t.set(c)},l=c=>{r.set(c),On(c,"Object3D")&&o.set(c)};return Si(()=>{e==null||e(),n()}),{updateRef:l,updateAttach:a}},iN=n=>On(n,"PerspectiveCamera")||On(n,"OrthographicCamera"),sN=()=>{const{invalidate:n,size:e,camera:t}=_l(),i=Ln(),s=Ln(!0),r=Ln(!1);return Vn([i,r],([c,h])=>{!c||!h||(t.set(c),n())}),Vn([i,s,e],([c,h,u])=>{!c||h||(On(c,"OrthographicCamera")?(c.left=u.width/-2,c.right=u.width/2,c.top=u.height/2,c.bottom=u.height/-2,c.updateProjectionMatrix(),c.updateMatrixWorld(),n()):On(c,"PerspectiveCamera")&&(c.aspect=u.width/u.height,c.updateProjectionMatrix(),c.updateMatrixWorld(),n()))}),{updateRef:c=>{iN(c)&&i.set(c)},updateManual:c=>{s.set(c)},updateMakeDefault:c=>{r.set(c)}}},rN=n=>{let e,t,i=!1;const s=()=>{e==null||e(),e=n==null?void 0:n(t)},r=o=>{t=o,i&&s()};return Ur(()=>{s(),i=!0}),Si(()=>e==null?void 0:e()),{updateRef:r}},Rb=Symbol("threlte-disposable-object-context"),oN=n=>typeof(n==null?void 0:n.dispose)=="function"&&!On(n,"Scene"),aN=n=>{let e;const t=Ln(void 0),i=Ln(n),{disposableObjectMounted:s,disposableObjectUnmounted:r,removeObjectFromDisposal:o}=XE(),a=Yt(Rb),l=jc([i,a??Ln(!0)],([u,d])=>u??d??!0);return Rn(Rb,l),Vn([t,l],([u,d])=>{u===e?d?e&&s(e):e&&o(e):d&&(e&&r(e),u&&s(u)),e=u}),Si(()=>{if(!km(l))return;const u=km(t);u&&r(u)}),{updateRef:u=>{oN(u)&&t.set(u)},updateDispose:u=>{i.set(u)}}},lN=n=>n!==null&&typeof n=="object"&&"addEventListener"in n&&"removeEventListener"in n,cN=(n={})=>{const e=s=>{var r;s!=null&&s.type&&((r=n[`on${s.type}`])==null||r.call(n,s))},t=(s,r)=>{const o=[];for(const a of Object.keys(r))a.startsWith("on")&&(s.addEventListener(a.slice(2),e),o.push(a));return()=>{for(let a=0;a<o.length;a++)s.removeEventListener(o[a],e)}};return{updateRef:s=>{if(lN(s))return t(s,n)}}};let Qm;const hN=n=>{Qm=n},uN=()=>{const n=Qm;return Qm=void 0,n},dN=n=>{const t=Yt("threlte-plugin-context");if(!t)return;const i=[],s=Object.values(t);if(s.length){const r=n();for(let o=0;o<s.length;o++){const a=s[o],l=a(r);l&&l.pluginProps&&i.push(...l.pluginProps)}}return{pluginsProps:i}},pN=new Set(["$$scope","$$slots","type","args","attach","instance"]),fN=new Set(["fov","aspect","near","far","left","right","top","bottom","zoom"]),mN=n=>typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n>"u"||n===null,Lb=(n,e,t)=>{var i,s,r;return!Array.isArray(t)&&typeof t=="number"&&typeof((i=n[e])==null?void 0:i.setScalar)=="function"&&!((s=n[e])!=null&&s.isColor)?(o,a,l)=>{o[a].setScalar(l)}:typeof((r=n[e])==null?void 0:r.set)=="function"?Array.isArray(t)?(o,a,l)=>{o[a].set(...l)}:(o,a,l)=>{o[a].set(l)}:(o,a,l)=>{o[a]=l}},vN=()=>{const{invalidate:n}=_l(),e=new Map,t=new Map,i=(r,o,a,l)=>{if(mN(a)){const u=e.get(o);if(u&&u.instance===r&&u.value===a)return;e.set(o,{instance:r,value:a})}const{key:c,target:h}=$E(r,o);if(a!=null){const u=t.get(o);if(u)u(h,c,a);else{const d=Lb(h,c,a);t.set(o,d),d(h,c,a)}}else Lb(h,c,a)(h,c,a);l.manualCamera||fN.has(c)&&(h.isPerspectiveCamera||h.isOrthographicCamera)&&h.updateProjectionMatrix()};return{updateProp:(r,o,a,l)=>{var c;!pN.has(o)&&!((c=l.pluginsProps)!=null&&c.includes(o))&&i(r,o,a,l),n()}}},gN=/^\s*class\s+/,_N=n=>typeof n!="function"?!1:gN.test(n.toString()),bN=n=>Array.isArray(n),xN=(n,e)=>_N(n)?bN(e)?new n(...e):new n:n;function Zf(n,e){on(e,!0);let t=ie(e,"is",19,uN),i=ie(e,"manual",3,!1),s=ie(e,"makeDefault",3,!1),r=ie(e,"ref",15),o=kr(e,["$$slots","$$events","$$legacy","is","args","attach","manual","makeDefault","dispose","ref","oncreate","children"]),a=un(()=>xN(t(),e.args));const l=rN(e.oncreate);hn(()=>{r()!==I(a)&&(r(I(a)),l.updateRef(I(a)))});const c=dN(()=>({get ref(){return I(a)},get args(){return e.args},get attach(){return e.attach},get manual(){return i()},get makeDefault(){return s()},get dispose(){return e.dispose},get props(){return o}})),{updateProp:h}=vN();Object.keys(o).forEach(v=>{hn(()=>{h(I(a),v,o[v],{manualCamera:i(),pluginsProps:c==null?void 0:c.pluginsProps})})});const u=nN();hn(()=>u.updateAttach(e.attach)),hn(()=>u.updateRef(I(a)));const d=sN();hn(()=>d.updateRef(I(a))),hn(()=>d.updateManual(i())),hn(()=>d.updateMakeDefault(s()));const p=aN(e.dispose);hn(()=>p.updateRef(I(a))),hn(()=>p.updateDispose(e.dispose));const f=cN(o);hn(()=>f.updateRef(I(a)));var g=pt(),m=Be(g);Qi(m,()=>e.children??cs,()=>({ref:I(a)})),Pe(n,g),an()}const yN={},lt=new Proxy(function(){},{apply(n,e,t){return Zf(...t)},get(n,e){if(typeof e!="string")return Zf;const t=yN[e]||CD[e];if(t===void 0)throw new Error(`No Three.js module found for ${e}. Did you forget to extend the catalogue?`);return hN(t),Zf}});function wN(n,e){const t="threlte-plugin-context";e&&Rn(t,{...Yt(t),[n]:e})}function EN(n,e,t){const i=YD();if(!i)throw new Error("No user context store found, did you invoke this function outside of your main <Canvas> component?");return e?(i.update(s=>{if(n in s)return s;const r=typeof e=="function"?e():e;return s[n]=r,s}),i.current[n]):jc(i,s=>s[n])}function MN(n,e){const{remember:t,clear:i}=TD();let s;const r=()=>{var c;const l=new n(...(e==null?void 0:e.args)??[]);return(c=e==null?void 0:e.extend)==null||c.call(e,l),l};return{load:(l,c)=>{const h=async u=>{var d;if(s||(s=r()),"loadAsync"in s){const p=await s.loadAsync(u,c==null?void 0:c.onProgress);return((d=c==null?void 0:c.transform)==null?void 0:d.call(c,p))??p}else return new Promise((p,f)=>{s.load(u,g=>{var m;return p(((m=c==null?void 0:c.transform)==null?void 0:m.call(c,g))??g)},g=>{var m;return(m=c==null?void 0:c.onProgress)==null?void 0:m.call(c,g)},f)})};if(Array.isArray(l)){const u=l.map(p=>t(()=>h(p),[n,p]));return Yf(Promise.all(u))}else if(typeof l=="string"){const u=t(()=>h(l),[n,l]);return Yf(u)}else{const u=Object.values(l).map(p=>t(()=>h(p),[n,p]));return Yf(Promise.all(u).then(p=>Object.fromEntries(Object.entries(l).map(([f],g)=>[f,p[g]]))))}},clear:l=>{Array.isArray(l)?l.forEach(c=>{i([n,c])}):typeof l=="string"?i([n,l]):Object.entries(l).forEach(([c,h])=>{i([n,c,h])})},loader:s}}function kt(n){return n==null}function _g(n){return n!==null&&typeof n=="object"}function ev(n){return n!==null&&typeof n=="object"}function SN(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Bo(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return ev(r)&&ev(o)?Object.assign(Object.assign({},i),{[s]:Bo(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function CN(n){return _g(n)?"target"in n:!1}const AN={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let Hi=class Na{static alreadyDisposed(){return new Na({type:"alreadydisposed"})}static notBindable(){return new Na({type:"notbindable"})}static notCompatible(e,t){return new Na({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new Na({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new Na({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=AN[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},Ib=class JE{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!JE.isBindable(i))throw Hi.notBindable();if(!(e in i))throw Hi.propertyNotFound(e);i[e]=t}},jn=class{constructor(){this.observers_={}}on(e,t,i){var s;let r=this.observers_[e];return r||(r=this.observers_[e]=[]),r.push({handler:t,key:(s=i==null?void 0:i.key)!==null&&s!==void 0?s:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.key!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},TN=class{constructor(e,t){var i;this.constraint_=t==null?void 0:t.constraint,this.equals_=(i=t==null?void 0:t.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new jn,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},PN=class{constructor(e){this.emitter=new jn,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},RN=class{constructor(e){this.emitter=new jn,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function $t(n,e){const t=e==null?void 0:e.constraint,i=e==null?void 0:e.equals;return!t&&!i?new PN(n):new TN(n,e)}function LN(n){return[new RN(n),(e,t)=>{n.setRawValue(e,t)}]}let We=class QE{constructor(e){this.emitter=new jn,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:$t(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new QE(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},ih=class{constructor(e){this.values=We.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},Ip=class{constructor(e){this.values=We.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return kt(i)||(s=Math.max(s,i)),kt(t)||(s=Math.min(s,t)),s}},eM=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},IN=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const DN={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let NN=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=DN[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const ON={"+":n=>n,"-":n=>-n,"~":n=>~n};let kN=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=ON[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function bg(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function Pc(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function UN(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Rc(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function FN(n,e){const t=Rc(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=Rc(n,e);return s===""?"":i+s}function xg(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=FN(n,e);return i===""?"":t+i}function tM(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=UN(n,e);return e+=i.length,i===""?"":i+Rc(n,e)}function BN(n,e){const t=tM(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=Rc(n,e);return e+=s.length,t+i+s+xg(n,e)}function VN(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Rc(n,e);return e+=i.length,i===""?"":t+i+xg(n,e)}function zN(n,e){const t=tM(n,e);return e+=t.length,t===""?"":t+xg(n,e)}const HN=bg([BN,VN,zN]);function GN(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function WN(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=GN(n,e);return i===""?"":t+i}function $N(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function jN(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=$N(n,e);return i===""?"":t+i}function XN(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function qN(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=XN(n,e);return i===""?"":t+i}const KN=bg([WN,jN,qN]),YN=bg([KN,HN]);function ZN(n,e){const t=YN(n,e);return e+=t.length,t===""?null:{evaluable:new IN(t),cursor:e}}function JN(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=iM(n,e);if(!i)return null;e=i.cursor,e+=Pc(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function QN(n,e){var t;return(t=ZN(n,e))!==null&&t!==void 0?t:JN(n,e)}function nM(n,e){const t=QN(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=nM(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new kN(i,s.evaluable)}):null}function eO(n,e,t){t+=Pc(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=Pc(e,t).length,{cursor:t,operator:i}):null}function tO(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=eO(e,t,i);if(!o)break;i=o.cursor;const a=n(t,i);if(!a)return null;i=a.cursor,r=new NN(o.operator,r,a.evaluable)}return r?{cursor:i,evaluable:r}:null}}const nO=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>tO(n,e),nM);function iM(n,e){return e+=Pc(n,e).length,nO(n,e)}function iO(n){const e=iM(n,0);return!e||e.cursor+Pc(n,e.cursor).length!==n.length?null:e.evaluable}function Wn(n){var e;const t=iO(n);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function sh(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=Wn(n);if(!kt(e))return e}return 0}function pn(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function Xe(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function tv(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Gt(n,e,t){return Math.min(Math.max(n,e),t)}function sM(n,e){return(n%e+e)%e}function sO(n,e){return kt(n.step)?Math.max(tv(e),2):tv(n.step)}function rM(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function rO(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function rh(n,e){return kt(n.step)?null:new eM(n.step,e)}function oh(n){return!kt(n.max)&&!kt(n.min)?new ih({max:n.max,min:n.min}):!kt(n.max)||!kt(n.min)?new Ip({max:n.max,min:n.min}):null}function bl(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:pn(sO(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:rM(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:rO(n,e)}}function ah(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function yg(n){return{constraint:n.constraint,textProps:We.fromObject(bl(n.params,n.initialValue))}}let Gr=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},Qo=class{constructor(e){this.target=e}},Dp=class extends Qo{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},oO=class extends Qo{constructor(e,t){super(e),this.expanded=t}},aO=class extends Qo{constructor(e,t){super(e),this.index=t}},lO=class extends Qo{constructor(e,t){super(e),this.native=t}},wg=class extends Gr{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new jn,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new Dp(this,t.binding.target.read(),e.options.last))}};function cO(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],a=o(n[r]);return a.succeeded?Object.assign(Object.assign({},s),{[r]:a.value}):void 0},{});return i}function hO(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function uO(n){return n===null?!1:typeof n=="object"}function Ns(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function Db(n){return{custom:e=>Ns(e)(n),boolean:Ns(e=>typeof e=="boolean"?e:void 0)(n),number:Ns(e=>typeof e=="number"?e:void 0)(n),string:Ns(e=>typeof e=="string"?e:void 0)(n),function:Ns(e=>typeof e=="function"?e:void 0)(n),constant:e=>Ns(t=>t===e?e:void 0)(n),raw:Ns(e=>e)(n),object:e=>Ns(t=>{if(uO(t))return cO(t,e)})(n),array:e=>Ns(t=>{if(Array.isArray(t))return hO(t,e)})(n)}}const nv={optional:Db(!0),required:Db(!1)};function Mt(n,e){const t=e(nv),i=nv.required.object(t)(n);return i.succeeded?i.value:void 0}function ss(n,e,t,i){if(e&&!e(n))return!1;const s=Mt(n,t);return s?i(s):!1}function rs(n,e){var t;return Bo((t=n==null?void 0:n())!==null&&t!==void 0?t:{},e)}function Ou(n){return"value"in n}function dO(n){if(!_g(n)||!("binding"in n))return!1;const e=n.binding;return CN(e)}const St="http://www.w3.org/2000/svg";function Dd(n){n.offsetHeight}function pO(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function lh(n){return n.ontouchstart!==void 0}function fO(){return globalThis}function mO(){return fO().document}function vO(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const gO={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Np(n,e){const t=n.createElementNS(St,"svg");return t.innerHTML=gO[e],t}function oM(n,e,t){n.insertBefore(e,n.children[t])}function Lc(n){n.parentElement&&n.parentElement.removeChild(n)}function aM(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function _O(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function Op(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function Bi(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function Mi(n,e,t){Bi(n.value(e),t)}const bO="tp";function Ne(n){return(t,i)=>[bO,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const Hl=Ne("lbl");function xO(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let lM=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Hl()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Hl("l")),Mi(t.props,"label",r=>{kt(r)?this.element.classList.add(Hl(void 0,"nol")):(this.element.classList.remove(Hl(void 0,"nol")),_O(i),i.appendChild(xO(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(Hl("v")),this.element.appendChild(s),this.valueElement=s}},ch=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new lM(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return ss(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return rs(null,{label:this.props.get("label")})}};function yO(){return["veryfirst","first","last","verylast"]}const Nb=Ne(""),Ob={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let xl=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{yO().forEach(i=>{t.classList.remove(Nb(void 0,Ob[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(Nb(void 0,Ob[i]))})}),this.viewProps.handleDispose(()=>{Lc(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return ss(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return rs(null,Object.assign({},this.viewProps.exportState()))}},Nd=class extends xl{constructor(e,t){if(t.value!==t.valueController.value)throw Hi.shouldNeverHappen();const i=t.valueController.viewProps,s=new ch(e,{blade:t.blade,props:t.props,valueController:t.valueController});super(Object.assign(Object.assign({},t),{view:new lM(e,{props:t.props,viewProps:i}),viewProps:i})),this.labelController=s,this.value=t.value,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(e){return ss(e,t=>{var i,s,r;return super.importState(t)&&this.labelController.importProps(t)&&((r=(s=(i=this.valueController).importProps)===null||s===void 0?void 0:s.call(i,e))!==null&&r!==void 0?r:!0)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var e,t,i;return rs(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(i=(t=(e=this.valueController).exportProps)===null||t===void 0?void 0:t.call(e))!==null&&i!==void 0?i:{}))}};function cM(n,e){for(;n.length<e;)n.push(void 0)}function wO(n){const e=[];return cM(e,n),e}function EO(n){const e=n.indexOf(void 0);return e<0?n:n.slice(0,e)}function MO(n,e){const t=[...EO(n),e];return t.length>n.length?t.splice(0,t.length-n.length):cM(t,n.length),t}let SO=class extends Gr{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,r=>{i(new lO(this,r.nativeEvent))}),this}off(e,t){return this.controller.buttonController.emitter.off(e,t),this}};function CO(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function tr(n,e){return t=>{CO(n,e,t)}}function Eg(n,e){Bi(n,t=>{e.textContent=t??""})}const Jf=Ne("btn");let AO=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Jf()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(Jf("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Jf("t")),Eg(t.props.value("title"),s),this.buttonElement.appendChild(s)}},hM=class{constructor(e,t){this.emitter=new jn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new AO(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return ss(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return rs(null,{title:this.props.get("title")})}onClick_(e){this.emitter.emit("click",{nativeEvent:e,sender:this})}},kb=class extends xl{constructor(e,t){const i=new hM(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new ch(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return ss(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return rs(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},TO=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const PO=new TO("2.0.5");function Ct(n){return Object.assign({core:PO},n)}Ct({id:"button",type:"blade",accept(n){const e=Mt(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new kb(n.document,{blade:n.blade,buttonProps:We.fromObject({title:n.params.title}),labelProps:We.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof kb?new SO(n.controller):null}});function RO(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function LO(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function IO(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function DO(n){return _g(n)?"refresh"in n&&typeof n.refresh=="function":!1}function NO(n,e){if(!Ib.isBindable(n))throw Hi.notBindable();return new Ib(n,e)}let OO=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new jn,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,NO(e,t),s),a=this.pool_.createBindingApi(o);return this.add(a,s.index)}addFolder(e){return LO(this,e)}addButton(e){return RO(this,e)}addTab(e){return IO(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.children.forEach(e=>{DO(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=dO(t.value)?t.value.binding:null;this.emitter_.emit("change",new Dp(i,s?s.target.read():t.value.rawValue,e.options.last))}},Mg=class extends Gr{constructor(e,t){super(e),this.rackApi_=new OO(e.rackController,t)}refresh(){this.rackApi_.refresh()}},Sg=class extends xl{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return ss(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return rs(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function iv(n){return"rackController"in n}let kO=class{constructor(e){this.emitter=new jn,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw Hi.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function UO(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(Ou(i)&&i.value===e)return i}return null}function FO(n){return iv(n)?n.rackController.rack.bcSet_:null}let BO=class{constructor(e){var t,i;this.emitter=new jn,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new kO(FO),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),Ou(i))i.value.emitter.on("change",this.onChildValueChange_);else if(iv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(Ou(i))i.value.emitter.off("change",this.onChildValueChange_);else if(iv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=UO(this.find(Ou),e.sender);if(!t)throw Hi.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},Cg=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new BO({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&oM(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&Lc(e.bladeController.view.element)}};function uM(){return new We({positions:$t([],{equals:SN})})}let hh=class dM extends We{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=We.createCore(t);return new dM(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!kt(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};Mi(this,"expanded",i),Mi(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function VO(n,e){let t=0;return pO(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),Dd(e),t=e.clientHeight,n.set("temporaryExpanded",null),Dd(e)}),t}function Ub(n,e){e.style.height=n.styleHeight}function uh(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),kt(n.get("expandedHeight"))){const t=VO(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),Dd(e)}),n.emitter.on("change",()=>{Ub(n,e)}),Ub(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let zO=class extends Mg{constructor(e,t){super(e,t),this.emitter_=new jn,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new oO(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}};const pM=Ne("cnt");let HO=class{constructor(e,t){var i;this.className_=Ne((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),pM()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Mi(this.foldable_,"completed",tr(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),Mi(t.props,"title",c=>{kt(c)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),Eg(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const a=e.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);const l=e.createElement("div");l.classList.add(this.className_("c")),this.element.appendChild(l),this.containerElement=l}},Fb=class extends Sg{constructor(e,t){var i;const s=hh.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new HO(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Cg({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,uh(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return ss(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return rs(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};Ct({id:"folder",type:"blade",accept(n){const e=Mt(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new Fb(n.document,{blade:n.blade,expanded:n.params.expanded,props:We.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof Fb?new zO(n.controller,n.pool):null}});const GO=Ne("");function Bb(n,e){return tr(n,GO(void 0,e))}let Vo=class fM extends We{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=LN($t(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new fM(We.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){Bi(this.globalDisabled_,Bb(e,"disabled")),Mi(this,"hidden",Bb(e,"hidden"))}bindDisabled(e){Bi(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){Bi(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i==null||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const Vb=Ne("tbp");let WO=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Vb()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Vb("c")),this.element.appendChild(i),this.containerElement=i}};const Gl=Ne("tbi");let $O=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Gl()),t.viewProps.bindClassModifiers(this.element),Mi(t.props,"selected",r=>{r?this.element.classList.add(Gl(void 0,"sel")):this.element.classList.remove(Gl(void 0,"sel"))});const i=e.createElement("button");i.classList.add(Gl("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Gl("t")),Eg(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},jO=class{constructor(e,t){this.emitter=new jn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new $O(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},sv=class extends Sg{constructor(e,t){const i=new WO(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Cg({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new jO(e,{props:t.itemProps,viewProps:Vo.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,Mi(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return ss(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return rs(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},XO=class extends Mg{constructor(e,t){super(e,t),this.emitter_=new jn,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new sv(t,{blade:uM(),itemProps:We.fromObject({selected:!1,title:e.title}),props:We.fromObject({selected:!1}),viewProps:Vo.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}onSelect_(e){this.emitter_.emit("select",new aO(this,e.rawValue))}},qO=class extends Mg{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}};const zb=-1;let KO=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=$t(!0),this.selectedIndex=$t(zb),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=zb,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const Wl=Ne("tab");let YO=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Wl(),pM()),t.viewProps.bindClassModifiers(this.element),Bi(t.empty,tr(this.element,Wl(void 0,"nop")));const i=e.createElement("div");i.classList.add(Wl("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(Wl("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(Wl("c")),this.element.appendChild(r),this.contentsElement=r}},Hb=class extends Sg{constructor(e,t){const i=new KO,s=new YO(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new Cg({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;oM(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;Lc(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};Ct({id:"tab",type:"blade",accept(n){const e=Mt(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new Hb(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new sv(n.document,{blade:uM(),itemProps:We.fromObject({selected:!1,title:t.title}),props:We.fromObject({selected:!1}),viewProps:Vo.create()});e.add(i)}),e},api(n){return n.controller instanceof Hb?new XO(n.controller,n.pool):n.controller instanceof sv?new qO(n.controller,n.pool):null}});let Ag=class extends wg{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},mM=class{constructor(){this.disabled=!1,this.emitter=new jn}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}},vM=class{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new jn,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}},Ms=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function Ic(n,e){if(n instanceof e)return n;if(n instanceof Ms){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let kp=class{constructor(e){this.values=We.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function Up(n){var e;const t=nv;if(Array.isArray(n))return(e=Mt({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function gM(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function Tg(n){return kt(n)?null:new kp(gM(n))}const Qf=Ne("lst");let ZO=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(Qf()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(Qf("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(Qf("m")),s.appendChild(Np(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,Mi(this.props_,"options",r=>{aM(this.selectElement),r.forEach(o=>{const a=e.createElement("option");a.textContent=o.text,this.selectElement.appendChild(a)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},rl=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new ZO(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return ss(e,null,t=>({options:t.required.custom(Up)}),t=>(this.props.set("options",gM(t.options)),!0))}exportProps(){return rs(null,{options:this.props.get("options")})}};const Gb=Ne("pop");let JO=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Gb()),t.viewProps.bindClassModifiers(this.element),Bi(t.shows,tr(this.element,Gb(void 0,"v")))}},Fp=class{constructor(e,t){this.shows=$t(!1),this.viewProps=t.viewProps,this.view=new JO(e,{shows:this.shows,viewProps:this.viewProps})}};const Wb=Ne("txt");let QO=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Wb()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(Wb("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},Bp=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new QO(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);kt(s)||(this.value.rawValue=s),this.view.refresh()}};function ek(n){return String(n)}function Pg(n){return n==="false"?!1:!!n}function $b(n){return ek(n)}function tk(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const nk=pn(0);function Od(n){return nk(n)+"%"}function Rg(n){return String(n)}function rv(n){return n}function Wr({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function dn(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function Ir(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function Gi(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function ik(n){return n==="ArrowUp"||n==="ArrowDown"}function Dc(n){return ik(n)||n==="ArrowLeft"||n==="ArrowRight"}function em(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let vn=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new jn,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(em(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(em(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(em(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const Li=Ne("txt");let sk=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Li(),Li(void 0,"num")),t.arrayPosition&&this.element.classList.add(Li(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Li("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Li()),this.inputElement.classList.add(Li("i"));const s=e.createElement("div");s.classList.add(Li("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(St,"svg");r.classList.add(Li("g")),this.knobElement.appendChild(r);const o=e.createElementNS(St,"path");o.classList.add(Li("gb")),r.appendChild(o),this.guideBodyElem_=o;const a=e.createElementNS(St,"path");a.classList.add(Li("gh")),r.appendChild(a),this.guideHeadElem_=a;const l=e.createElement("div");l.classList.add(Ne("tt")()),this.knobElement.appendChild(l),this.tooltipElem_=l,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Li(void 0,"drg"));return}this.element.classList.add(Li(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=Gt(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},yl=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=$t(null),this.view=new sk(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new vn(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);kt(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=dn(this.props.get("keyScale"),Ir(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){dn(this.props.get("keyScale"),Ir(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const tm=Ne("sld");let rk=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(tm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(tm("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(tm("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Gt(Xe(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},ok=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new rk(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new vn(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(Xe(Gt(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=dn(this.props.get("keyScale"),Gi(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){dn(this.props.get("keyScale"),Gi(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const nm=Ne("sldtxt");let ak=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(nm());const i=e.createElement("div");i.classList.add(nm("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(nm("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},jb=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new ok(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new yl(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new ak(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return ss(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return rs(null,{max:e.get("max"),min:e.get("min")})}};function lk(n){return{sliderProps:new We({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new We({formatter:$t(n.formatter),keyScale:n.keyScale,pointerScale:$t(n.pointerScale)})}}const ck={containerUnitSize:"cnt-usz"};function _M(n){return`--${ck[n]}`}class bM{constructor(e,t){const i=Ne(t.viewName);this.element=e.createElement("div"),this.element.classList.add(i()),t.viewProps.bindClassModifiers(this.element)}}function Nc(n){return ah(n)}function ti(n){if(ev(n))return Mt(n,Nc)}function Gs(n,e){if(!n)return;const t=[],i=rh(n,e);i&&t.push(i);const s=oh(n);return s&&t.push(s),new Ms(t)}function Vp(n){if(n==="inline"||n==="popup")return n}function Ss(n,e){n.write(e)}const gu=Ne("ckb");let hk=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(gu()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(gu("l")),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("input");s.classList.add(gu("i")),s.type="checkbox",this.labelElement.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(gu("w")),this.labelElement.appendChild(r);const o=Np(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},uk=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new hk(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked,e.preventDefault(),e.stopPropagation()}onLabelMouseDown_(e){e.preventDefault()}};function dk(n){const e=[],t=Tg(n.options);return t&&e.push(t),new Ms(e)}Ct({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Mt(e,i=>({options:i.optional.custom(Up),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Pg,constraint:n=>dk(n.params),writer:n=>Ss},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&Ic(i,kp);return s?new rl(e,{props:new We({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new uk(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof rl?new Ag(n.controller):null}});const lo=Ne("col");let pk=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(lo()),t.foldable.bindExpandedClass(this.element,lo(void 0,"expanded")),Mi(t.foldable,"completed",tr(this.element,lo(void 0,"cpl")));const i=e.createElement("div");i.classList.add(lo("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(lo("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(lo("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(lo("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function fk(n,e,t){const i=Gt(n/255,0,1),s=Gt(e/255,0,1),r=Gt(t/255,0,1),o=Math.max(i,s,r),a=Math.min(i,s,r),l=o-a;let c=0,h=0;const u=(a+o)/2;return l!==0&&(h=l/(1-Math.abs(o+a-1)),i===o?c=(s-r)/l:s===o?c=2+(r-i)/l:c=4+(i-s)/l,c=c/6+(c<0?1:0)),[c*360,h*100,u*100]}function mk(n,e,t){const i=(n%360+360)%360,s=Gt(e/100,0,1),r=Gt(t/100,0,1),o=(1-Math.abs(2*r-1))*s,a=o*(1-Math.abs(i/60%2-1)),l=r-o/2;let c,h,u;return i>=0&&i<60?[c,h,u]=[o,a,0]:i>=60&&i<120?[c,h,u]=[a,o,0]:i>=120&&i<180?[c,h,u]=[0,o,a]:i>=180&&i<240?[c,h,u]=[0,a,o]:i>=240&&i<300?[c,h,u]=[a,0,o]:[c,h,u]=[o,0,a],[(c+l)*255,(h+l)*255,(u+l)*255]}function vk(n,e,t){const i=Gt(n/255,0,1),s=Gt(e/255,0,1),r=Gt(t/255,0,1),o=Math.max(i,s,r),a=Math.min(i,s,r),l=o-a;let c;l===0?c=0:o===i?c=60*(((s-r)/l%6+6)%6):o===s?c=60*((r-i)/l+2):c=60*((i-s)/l+4);const h=o===0?0:l/o,u=o;return[c,h*100,u*100]}function xM(n,e,t){const i=sM(n,360),s=Gt(e/100,0,1),r=Gt(t/100,0,1),o=r*s,a=o*(1-Math.abs(i/60%2-1)),l=r-o;let c,h,u;return i>=0&&i<60?[c,h,u]=[o,a,0]:i>=60&&i<120?[c,h,u]=[a,o,0]:i>=120&&i<180?[c,h,u]=[0,o,a]:i>=180&&i<240?[c,h,u]=[0,a,o]:i>=240&&i<300?[c,h,u]=[a,0,o]:[c,h,u]=[o,0,a],[(c+l)*255,(h+l)*255,(u+l)*255]}function gk(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function _k(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function _s(n){return[n[0],n[1],n[2]]}function zp(n,e){return[n[0],n[1],n[2],e]}const bk={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:gk,rgb:mk},hsv:{hsl:_k,hsv:(n,e,t)=>[n,e,t],rgb:xM},rgb:{hsl:fk,hsv:vk,rgb:(n,e,t)=>[n,e,t]}};function ol(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function xk(n,e){return n===e?e:sM(n,e)}function yM(n,e,t){var i;const s=ol(e,t);return[e==="rgb"?Gt(n[0],0,s[0]):xk(n[0],s[0]),Gt(n[1],0,s[1]),Gt(n[2],0,s[2]),Gt((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function Xb(n,e,t,i){const s=ol(e,t),r=ol(e,i);return n.map((o,a)=>o/s[a]*r[a])}function wM(n,e,t){const i=Xb(n,e.mode,e.type,"int"),s=bk[e.mode][t.mode](...i);return Xb(s,t.mode,"int",t.type)}let Lt=class EM{static black(){return new EM([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=yM(e,t,this.type)}getComponents(e){return zp(wM(_s(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const hr=Ne("colp");let yk=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(hr()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(hr("hsv"));const s=e.createElement("div");s.classList.add(hr("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(hr("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(hr("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const a=e.createElement("div");a.classList.add(hr("a"));const l=e.createElement("div");l.classList.add(hr("ap")),l.appendChild(this.alphaViews_.palette.element),a.appendChild(l);const c=e.createElement("div");c.classList.add(hr("at")),c.appendChild(this.alphaViews_.text.element),a.appendChild(c),this.element.appendChild(a)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function wk(n){return n==="int"?"int":n==="float"?"float":void 0}function Lg(n){return Mt(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(wk)}),expanded:e.optional.boolean,picker:e.optional.custom(Vp),readonly:e.optional.constant(!1)}))}function zo(n){return n?.1:1}function MM(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let Ig=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=yM(e,t,this.type)}getComponents(e){return zp(wM(_s(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Ek={int:(n,e)=>new Lt(n,e),float:(n,e)=>new Ig(n,e)};function Dg(n,e,t){return Ek[t](n,e)}function Mk(n){return n.type==="float"}function Sk(n){return n.type==="int"}function Ck(n){const e=n.getComponents(),t=ol(n.mode,"int");return new Lt([Math.round(Xe(e[0],0,1,0,t[0])),Math.round(Xe(e[1],0,1,0,t[1])),Math.round(Xe(e[2],0,1,0,t[2])),e[3]],n.mode)}function Ak(n){const e=n.getComponents(),t=ol(n.mode,"int");return new Ig([Xe(e[0],0,t[0],0,1),Xe(e[1],0,t[1],0,1),Xe(e[2],0,t[2],0,1),e[3]],n.mode)}function ii(n,e){if(n.type===e)return n;if(Sk(n)&&e==="float")return Ak(n);if(Mk(n)&&e==="int")return Ck(n);throw Hi.shouldNeverHappen()}function Tk(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Ui(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const Pk={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function SM(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return Pk[i](t)}function CM(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Ui(e[1],255),Ui(e[2],255),Ui(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Rk(n){const e=CM(n);return e?new Lt(e,"rgb"):null}function AM(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Ui(e[1],255),Ui(e[2],255),Ui(e[3],255),Ui(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Lk(n){const e=AM(n);return e?new Lt(e,"rgb"):null}function TM(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[SM(e[1]),Ui(e[2],100),Ui(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Ik(n){const e=TM(n);return e?new Lt(e,"hsl"):null}function PM(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[SM(e[1]),Ui(e[2],100),Ui(e[3],100),Ui(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Dk(n){const e=PM(n);return e?new Lt(e,"hsl"):null}function RM(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function Nk(n){const e=RM(n);return e?new Lt(e,"rgb"):null}function LM(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),Xe(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),Xe(parseInt(t[4],16),0,255,0,1)]:null}function Ok(n){const e=LM(n);return e?new Lt(e,"rgb"):null}function IM(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function kk(n){return e=>{const t=IM(e);return t?Dg(t,"rgb",n):null}}function DM(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Uk(n){return e=>{const t=DM(e);return t?Dg(t,"rgb",n):null}}const Fk=[{parser:RM,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:LM,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:CM,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:AM,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:TM,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:PM,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:IM,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:DM,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Bk(n){return Fk.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function Vk(n,e="int"){const t=Bk(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function dh(n){const e=[Nk,Ok,Rk,Lk,Ik,Dk];e.push(kk("int"),Uk("int"));const t=tk(e);return i=>{const s=t(i);return s?ii(s,n):null}}function zk(n){const e=dh("int");if(typeof n!="string")return Lt.black();const t=e(n);return t??Lt.black()}function NM(n){const e=Gt(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function Ng(n,e="#"){const t=_s(n.getComponents("rgb")).map(NM).join("");return`${e}${t}`}function Og(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(NM).join("");return`${e}${i}`}function OM(n){const e=pn(0),t=ii(n,"int");return`rgb(${_s(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function ku(n){const e=pn(2),t=pn(0);return`rgba(${ii(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function Hk(n){const e=[pn(0),Od,Od],t=ii(n,"int");return`hsl(${_s(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function Gk(n){const e=[pn(0),Od,Od,pn(2)];return`hsla(${ii(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function kM(n,e){const t=pn(e==="float"?2:0),i=["r","g","b"],s=ii(n,e);return`{${_s(s.getComponents("rgb")).map((o,a)=>`${i[a]}: ${t(o)}`).join(", ")}}`}function Wk(n){return e=>kM(e,n)}function UM(n,e){const t=pn(2),i=pn(e==="float"?2:0),s=["r","g","b","a"];return`{${ii(n,e).getComponents("rgb").map((a,l)=>{const c=l===3?t:i;return`${s[l]}: ${c(a)}`}).join(", ")}}`}function $k(n){return e=>UM(e,n)}const jk=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Ng},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Og},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:OM},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:ku},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:Hk},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:Gk},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:Wk(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:$k(e)}],[])];function FM(n){return jk.reduce((e,t)=>e||(Tk(t.format,n)?t.stringifier:null),null)}const $l=Ne("apl");let Xk=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add($l()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add($l("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add($l("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add($l("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add($l("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new Lt([t[0],t[1],t[2],0],"rgb"),s=new Lt([t[0],t[1],t[2],255],"rgb"),r=["to right",ku(i),ku(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=ku(e);const o=Xe(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},qk=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Xk(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new vn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,a]=s.getComponents("hsv");this.value.setRawValue(new Lt([r,o,a,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=dn(zo(!0),Gi(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,a]=i.getComponents("hsv");this.value.setRawValue(new Lt([s,r,o,a+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){dn(zo(!0),Gi(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const wa=Ne("coltxt");function Kk(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let Yk=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(wa()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(wa("m")),this.modeElem_=Kk(e),this.modeElem_.classList.add(wa("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(wa("mm")),s.appendChild(Np(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(wa("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),Bi(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){aM(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(wa("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function Zk(n){return pn(n==="float"?2:0)}function Jk(n,e,t){const i=ol(n,e)[t];return new ih({min:0,max:i})}function Qk(n,e,t){return new yl(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:We.fromObject({formatter:Zk(e.colorType),keyScale:zo(!1),pointerScale:e.colorType==="float"?.01:1}),value:$t(0,{constraint:Jk(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function eU(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Wn,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=Qk(n,t,i);return Wr({primary:e.value,secondary:s.value,forward(r){return ii(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const a=e.colorMode,c=ii(r,e.colorType).getComponents(a);c[i]=o;const h=Dg(zp(_s(c),c[3]),a,e.colorType);return ii(h,"int")}}),s})}function tU(n,e){const t=new Bp(n,{parser:dh("int"),props:We.fromObject({formatter:Ng}),value:$t(Lt.black()),viewProps:e.viewProps});return Wr({primary:e.value,secondary:t.value,forward:i=>new Lt(_s(i.getComponents()),i.mode),backward:(i,s)=>new Lt(zp(_s(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function nU(n){return n!=="hex"}let iU=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=$t(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new Yk(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return nU(t)?eU(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):tU(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const im=Ne("hpl");let sU=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(im()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(im("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(im("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=OM(new Lt([t,100,100],"hsv"));const i=Xe(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},rU=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new sU(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new vn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=Xe(Gt(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,a]=s.getComponents("hsv");this.value.setRawValue(new Lt([i,r,o,a],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=dn(zo(!1),Gi(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,a]=i.getComponents("hsv");this.value.setRawValue(new Lt([s+t,r,o,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){dn(zo(!1),Gi(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const sm=Ne("svp"),qb=64;let oU=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(sm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=qb,i.width=qb,i.classList.add(sm("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(sm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=vO(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),a=o.data;for(let h=0;h<r;h++)for(let u=0;u<s;u++){const d=Xe(u,0,s,0,100),p=Xe(h,0,r,100,0),f=xM(i[0],d,p),g=(h*s+u)*4;a[g]=f[0],a[g+1]=f[1],a[g+2]=f[2],a[g+3]=255}e.putImageData(o,0,0);const l=Xe(i[1],0,100,0,100);this.markerElem_.style.left=`${l}%`;const c=Xe(i[2],0,100,100,0);this.markerElem_.style.top=`${c}%`}onValueChange_(){this.update_()}},aU=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new oU(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new vn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=Xe(e.point.x,0,e.bounds.width,0,100),s=Xe(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Lt([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){Dc(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=zo(!1),a=dn(o,Gi(e)),l=dn(o,Ir(e));a===0&&l===0||this.value.setRawValue(new Lt([t,i+a,s+l,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=zo(!1),i=dn(t,Gi(e)),s=dn(t,Ir(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},lU=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new rU(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new aU(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new qk(e,{value:this.value,viewProps:this.viewProps}),text:new yl(e,{parser:Wn,props:We.fromObject({pointerScale:.01,keyScale:.1,formatter:pn(2)}),value:$t(0,{constraint:new ih({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Wr({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new Lt(r,i.mode)}}),this.textsC_=new iU(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new yk(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const rm=Ne("colsw");let cU=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(rm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(rm("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(rm("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Og(e)}onValueChange_(){this.update_()}},hU=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new cU(e,{value:this.value,viewProps:this.viewProps})}},kg=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=hh.create(t.expanded),this.swatchC_=new hU(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new Bp(e,{parser:t.parser,props:We.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new pk(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new Fp(e,{viewProps:this.viewProps}):null;const s=new lU(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),Wr({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),uh(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Op(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!lh(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function uU(n){return _s(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function dU(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function pU(n){return new Lt([n>>16&255,n>>8&255,n&255],"rgb")}function fU(n){return new Lt([n>>24&255,n>>16&255,n>>8&255,Xe(n&255,0,255,0,1)],"rgb")}function mU(n){return typeof n!="number"?Lt.black():pU(n)}function vU(n){return typeof n!="number"?Lt.black():fU(n)}function Uu(n,e){return typeof n!="object"||kt(n)?!1:e in n&&typeof n[e]=="number"}function Ug(n){return Uu(n,"r")&&Uu(n,"g")&&Uu(n,"b")}function Fg(n){return Ug(n)&&Uu(n,"a")}function BM(n){return Ug(n)}function Bg(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function Kb(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function gU(n){const e=FM(n);return e?(t,i)=>{Ss(t,e(i))}:null}function _U(n){const e=n?dU:uU;return(t,i)=>{Ss(t,e(i))}}function bU(n,e,t){const s=ii(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function xU(n,e,t){const s=ii(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function yU(n,e){return(t,i)=>{n?bU(t,i,e):xU(t,i,e)}}function wU(n){var e;return!!(!((e=n==null?void 0:n.color)===null||e===void 0)&&e.alpha)}function EU(n){return n?e=>Og(e,"0x"):e=>Ng(e,"0x")}function MU(n){return"color"in n||n.view==="color"}Ct({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!MU(e))return null;const t=Lg(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:wU(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?vU:mU,equals:Bg,writer:n=>_U(n.params.supportsAlpha)},controller:n=>{var e,t;return new kg(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:EU(n.params.supportsAlpha),parser:dh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function SU(n,e){if(!BM(n))return ii(Lt.black(),e);if(e==="int"){const t=Kb(n);return new Lt(t,"rgb")}if(e==="float"){const t=Kb(n);return new Ig(t,"rgb")}return ii(Lt.black(),"int")}function CU(n){return Fg(n)}function AU(n){return e=>{const t=SU(e,n);return ii(t,"int")}}function TU(n,e){return t=>n?UM(t,e):kM(t,e)}Ct({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!BM(n))return null;const i=Lg(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=MM(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>AU(n.params.colorType),equals:Bg,writer:n=>yU(CU(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=Fg(n.initialValue);return new kg(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:TU(i,n.params.colorType),parser:dh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});Ct({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=Vk(n,MM(e));if(!t)return null;const i=FM(t);if(!i)return null;const s=Lg(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>zk,equals:Bg,writer:n=>{const e=gU(n.params.format);if(!e)throw Hi.notBindable();return e}},controller:n=>{var e,t;return new kg(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:dh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let Dr=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const Yb=Ne("pndtxt");let PU=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(Yb()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(Yb("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function RU(n,e,t){return new yl(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:$t(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let $r=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>RU(e,t,s)),this.acs_.forEach((i,s)=>{Wr({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const a=t.assembly.toComponents(r);return a[s]=o,t.assembly.fromComponents(a)}})}),this.view=new PU(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},LU=class extends wg{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function IU(n,e){const t=[],i=rh(n,e);i&&t.push(i);const s=oh(n);s&&t.push(s);const r=Tg(n.options);return r&&t.push(r),new Ms(t)}Ct({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=Mt(e,i=>Object.assign(Object.assign({},ah(i)),{options:i.optional.custom(Up),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>sh,constraint:n=>IU(n.params,n.initialValue),writer:n=>Ss},controller:n=>{const e=n.value,t=n.constraint,i=t&&Ic(t,kp);if(i)return new rl(n.document,{props:new We({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=bl(n.params,e.rawValue),r=t&&Ic(t,ih);return r?new jb(n.document,Object.assign(Object.assign({},lk(Object.assign(Object.assign({},s),{keyScale:$t(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:Wn,value:e,viewProps:n.viewProps})):new yl(n.document,{parser:Wn,props:We.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof jb?new LU(n.controller):n.controller.valueController instanceof rl?new Ag(n.controller):null}});let Cr=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(kt(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const VM={toComponents:n=>n.getComponents(),fromComponents:n=>new Cr(...n)},Ea=Ne("p2d");let DU=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ea()),t.viewProps.bindClassModifiers(this.element),Bi(t.expanded,tr(this.element,Ea(void 0,"expanded")));const i=e.createElement("div");i.classList.add(Ea("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(Ea("b")),s.appendChild(Np(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(Ea("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Ea("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const ur=Ne("p2dp");let NU=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(ur()),t.layout==="popup"&&this.element.classList.add(ur(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(ur("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(St,"svg");s.classList.add(ur("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(St,"line");r.classList.add(ur("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(St,"line");o.classList.add(ur("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const a=e.createElementNS(St,"line");a.classList.add(ur("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;const l=e.createElement("div");l.classList.add(ur("m")),this.padElement.appendChild(l),this.markerElem_=l,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=Xe(e,-i,+i,0,100),r=Xe(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function Zb(n,e,t){return[dn(e[0],Gi(n)),dn(e[1],Ir(n))*(t?1:-1)]}let OU=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new NU(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new vn(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=Xe(e.point.x,0,e.bounds.width,-i,+i),r=Xe(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new Cr(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){Dc(e.key)&&e.preventDefault();const[t,i]=Zb(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new Cr(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=Zb(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},kU=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=hh.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new Fp(e,{viewProps:this.viewProps}):null;const r=new OU(e,{layout:t.pickerLayout,props:new We({invertsY:$t(t.invertsY),max:$t(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new $r(e,{assembly:VM,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new DU(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Wr({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,a)=>a})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),uh(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Op(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!lh(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function UU(n){return Cr.isObject(n)?new Cr(n.x,n.y):new Cr}function FU(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function BU(n,e){return new Dr({assembly:VM,components:[Gs(Object.assign(Object.assign({},n),n.x),e.x),Gs(Object.assign(Object.assign({},n),n.y),e.y)]})}function Jb(n,e){var t,i;if(!kt(n.min)||!kt(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=rM(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function VU(n,e){var t,i;const s=Jb(Bo(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=Jb(Bo(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function zU(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}Ct({id:"input-point2d",type:"input",accept:(n,e)=>{if(!Cr.isObject(n))return null;const t=Mt(e,i=>Object.assign(Object.assign({},Nc(i)),{expanded:i.optional.boolean,picker:i.optional.custom(Vp),readonly:i.optional.constant(!1),x:i.optional.custom(ti),y:i.optional.object(Object.assign(Object.assign({},Nc(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>UU,constraint:n=>BU(n.params,n.initialValue),equals:Cr.equals,writer:()=>FU},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new kU(i,{axes:s.rawValue.getComponents().map((a,l)=>{var c;return yg({constraint:r.components[l],initialValue:a,params:Bo(n.params,(c=o[l])!==null&&c!==void 0?c:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:zU(n.params),max:VU(n.params,s.rawValue),parser:Wn,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let Va=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(kt(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const zM={toComponents:n=>n.getComponents(),fromComponents:n=>new Va(...n)};function HU(n){return Va.isObject(n)?new Va(n.x,n.y,n.z):new Va}function GU(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function WU(n,e){return new Dr({assembly:zM,components:[Gs(Object.assign(Object.assign({},n),n.x),e.x),Gs(Object.assign(Object.assign({},n),n.y),e.y),Gs(Object.assign(Object.assign({},n),n.z),e.z)]})}Ct({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Va.isObject(n))return null;const t=Mt(e,i=>Object.assign(Object.assign({},Nc(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(ti),y:i.optional.custom(ti),z:i.optional.custom(ti)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>HU,constraint:n=>WU(n.params,n.initialValue),equals:Va.equals,writer:n=>GU},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new $r(n.document,{assembly:zM,axes:e.rawValue.getComponents().map((s,r)=>{var o;return yg({constraint:t.components[r],initialValue:s,params:Bo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Wn,value:e,viewProps:n.viewProps})}});let za=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(kt(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const HM={toComponents:n=>n.getComponents(),fromComponents:n=>new za(...n)};function $U(n){return za.isObject(n)?new za(n.x,n.y,n.z,n.w):new za}function jU(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function XU(n,e){return new Dr({assembly:HM,components:[Gs(Object.assign(Object.assign({},n),n.x),e.x),Gs(Object.assign(Object.assign({},n),n.y),e.y),Gs(Object.assign(Object.assign({},n),n.z),e.z),Gs(Object.assign(Object.assign({},n),n.w),e.w)]})}Ct({id:"input-point4d",type:"input",accept:(n,e)=>{if(!za.isObject(n))return null;const t=Mt(e,i=>Object.assign(Object.assign({},Nc(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(ti),x:i.optional.custom(ti),y:i.optional.custom(ti),z:i.optional.custom(ti)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>$U,constraint:n=>XU(n.params,n.initialValue),equals:za.equals,writer:n=>jU},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new $r(n.document,{assembly:HM,axes:e.rawValue.getComponents().map((s,r)=>{var o;return yg({constraint:t.components[r],initialValue:s,params:Bo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Wn,value:e,viewProps:n.viewProps})}});function qU(n){const e=[],t=Tg(n.options);return t&&e.push(t),new Ms(e)}Ct({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=Mt(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(Up)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Rg,constraint:n=>qU(n.params),writer:n=>Ss},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&Ic(i,kp);return s?new rl(e,{props:new We({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new Bp(e,{parser:r=>r,props:We.fromObject({formatter:rv}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof rl?new Ag(n.controller):null}});const wl={monitor:{defaultInterval:200,defaultRows:3}},Qb=Ne("mll");let KU=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Qb()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(Qb("i")),i.style.height=`calc(var(${_M("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},Vg=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new KU(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const ex=Ne("sgl");let YU=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(ex()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(ex("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},zg=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new YU(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};Ct({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Mt(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Pg},controller:n=>{var e;return n.value.rawValue.length===1?new zg(n.document,{formatter:$b,value:n.value,viewProps:n.viewProps}):new Vg(n.document,{formatter:$b,rows:(e=n.params.rows)!==null&&e!==void 0?e:wl.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let ZU=class extends wg{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const dr=Ne("grl");let JU=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(dr()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(St,"svg");i.classList.add(dr("g")),i.style.height=`calc(var(${_M("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(St,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(dr("t"),Ne("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:e,clientHeight:t}=this.element,i=this.value.rawValue.length-1,s=this.props_.get("min"),r=this.props_.get("max"),o=[];this.value.rawValue.forEach((u,d)=>{if(u===void 0)return;const p=Xe(d,0,i,0,e),f=Xe(u,s,r,t,0);o.push([p,f].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const a=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){a.classList.remove(dr("t","a"));return}const c=Xe(this.cursor_.rawValue,0,i,0,e),h=Xe(l,s,r,t,0);a.style.left=`${c}px`,a.style.top=`${h}px`,a.textContent=`${this.formatter_(l)}`,a.classList.contains(dr("t","a"))||(a.classList.add(dr("t","a"),dr("t","in")),Dd(a),a.classList.remove(dr("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},Hg=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=$t(-1),this.view=new JU(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!lh(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new vn(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return ss(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return rs(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const{clientWidth:t}=this.view.element;this.cursor_.rawValue=Math.floor(Xe(e.offsetX,0,t,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(Xe(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function ov(n){return kt(n.format)?pn(2):n.format}function QU(n){var e;return n.value.rawValue.length===1?new zg(n.document,{formatter:ov(n.params),value:n.value,viewProps:n.viewProps}):new Vg(n.document,{formatter:ov(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:wl.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function e3(n){var e,t,i;return new Hg(n.document,{formatter:ov(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:wl.monitor.defaultRows,props:We.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function tx(n){return n.view==="graph"}Ct({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=Mt(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>tx(n)?64:1,reader:n=>sh},controller:n=>tx(n.params)?e3(n):QU(n),api:n=>n.controller.valueController instanceof Hg?new ZU(n.controller):null});Ct({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=Mt(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Rg},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new Vg(n.document,{formatter:rv,rows:(e=n.params.rows)!==null&&e!==void 0?e:wl.monitor.defaultRows,value:t,viewProps:n.viewProps}):new zg(n.document,{formatter:rv,value:t,viewProps:n.viewProps})}});const av={baseBackgroundColor:"hsl(230, 7%, 17%)",baseBorderRadius:"6px",baseFontFamily:"Roboto Mono, Source Code Pro, Menlo, Courier, monospace",baseShadowColor:"rgba(0, 0, 0, 0.2)",bladeBorderRadius:"2px",bladeHorizontalPadding:"4px",bladeValueWidth:"160px",buttonBackgroundColor:"hsl(230, 7%, 70%)",buttonBackgroundColorActive:"#d6d7db",buttonBackgroundColorFocus:"#c8cad0",buttonBackgroundColorHover:"#bbbcc4",buttonForegroundColor:"hsl(230, 7%, 17%)",containerBackgroundColor:"rgba(187, 188, 196, 0.1)",containerBackgroundColorActive:"rgba(187, 188, 196, 0.25)",containerBackgroundColorFocus:"rgba(187, 188, 196, 0.2)",containerBackgroundColorHover:"rgba(187, 188, 196, 0.15)",containerForegroundColor:"hsl(230, 7%, 75%)",containerHorizontalPadding:"4px",containerUnitSize:"20px",containerUnitSpacing:"4px",containerVerticalPadding:"4px",grooveForegroundColor:"rgba(187, 188, 196, 0.1)",inputBackgroundColor:"rgba(187, 188, 196, 0.1)",inputBackgroundColorActive:"rgba(187, 188, 196, 0.25)",inputBackgroundColorFocus:"rgba(187, 188, 196, 0.2)",inputBackgroundColorHover:"rgba(187, 188, 196, 0.15)",inputForegroundColor:"hsl(230, 7%, 75%)",labelForegroundColor:"rgba(187, 188, 196, 0.7)",monitorBackgroundColor:"rgba(0, 0, 0, 0.2)",monitorForegroundColor:"rgba(187, 188, 196, 0.7)",pluginImageDraggingColor:"hsla(230, 100%, 66%, 1)"};Object.keys(av).reduce((n,e)=>(n[e]=e,n),{});const t3=new Map([["baseBackgroundColor","--tp-base-background-color"],["baseBorderRadius","--tp-base-border-radius"],["baseFontFamily","--tp-base-font-family"],["baseShadowColor","--tp-base-shadow-color"],["bladeBorderRadius","--tp-blade-border-radius"],["bladeHorizontalPadding","--tp-blade-horizontal-padding"],["bladeValueWidth","--tp-blade-value-width"],["buttonBackgroundColor","--tp-button-background-color"],["buttonBackgroundColorActive","--tp-button-background-color-active"],["buttonBackgroundColorFocus","--tp-button-background-color-focus"],["buttonBackgroundColorHover","--tp-button-background-color-hover"],["buttonForegroundColor","--tp-button-foreground-color"],["containerBackgroundColor","--tp-container-background-color"],["containerBackgroundColorActive","--tp-container-background-color-active"],["containerBackgroundColorFocus","--tp-container-background-color-focus"],["containerBackgroundColorHover","--tp-container-background-color-hover"],["containerForegroundColor","--tp-container-foreground-color"],["containerHorizontalPadding","--tp-container-horizontal-padding"],["containerUnitSize","--tp-container-unit-size"],["containerUnitSpacing","--tp-container-unit-spacing"],["containerVerticalPadding","--tp-container-vertical-padding"],["grooveForegroundColor","--tp-groove-foreground-color"],["inputBackgroundColor","--tp-input-background-color"],["inputBackgroundColorActive","--tp-input-background-color-active"],["inputBackgroundColorFocus","--tp-input-background-color-focus"],["inputBackgroundColorHover","--tp-input-background-color-hover"],["inputForegroundColor","--tp-input-foreground-color"],["labelForegroundColor","--tp-label-foreground-color"],["monitorBackgroundColor","--tp-monitor-background-color"],["monitorForegroundColor","--tp-monitor-foreground-color"],["pluginImageDraggingColor","--tp-plugin-image-dragging-color"]]);function n3(n){if(n!==void 0){if(typeof n=="string")return n;if(Fg(n))return`rgba(${n.r}, ${n.g}, ${n.b}, ${n.a})`;if(Ug(n))return`rgb(${n.r}, ${n.g}, ${n.b})`}}function nx(n){if(n.startsWith("--tp-"))return n;const e=t3.get(n);if(e)return e;throw new Error(`Unknown Tweakpane CSS theme map variable key: "${n}"`)}function i3(n,e){const t=mO().documentElement;if(e===void 0)for(const i of Object.keys(av)){const s=nx(i);n.style.getPropertyValue(s).length>0&&n.style.removeProperty(s)}else for(const[i,s]of Object.entries(e)){const r=nx(i),o=n3(s),a=av[i]||void 0,l=t.style.getPropertyValue(r)||void 0;o!==void 0&&(((l&&o!==l)??!1)||!l&&((a&&o!==a)??!1))?n.style.setProperty(r,o):n.style.getPropertyValue(r).length>0&&n.style.removeProperty(r)}}function al(n){return n.constructor.name==="Pane"}function om(n,e,t){return Math.min(Math.max(n,e),t)}function Gg(n){let e=0,t=n;for(;(t=t.previousElementSibling)!==null;)t.classList.contains("skip-element-index")||e++;return e}function Hp(n,...e){for(const t of e)t in n&&delete n[t];return n}function ix(n){n.isTrusted&&n.stopPropagation()}function GM(n,e,t,i){if(e){const s=e.querySelector(`.${t}`);if(s){const r=i?e.querySelector(`.${i}`):void 0;n?(s.removeEventListener("click",ix,{capture:!0}),s.style.cursor="pointer",r&&(r.style.display="block")):(s.addEventListener("click",ix,{capture:!0}),s.style.cursor="default",r&&(r.style.display="none"))}}else console.warn(`Title bar element not found with class "${t}"`)}function s3(n){var e,t,i,s;return!!((s=(i=(t=(e=n.controller.valueController)==null?void 0:e.foldable_)==null?void 0:t.valMap_)==null?void 0:i.expanded)!=null&&s.value_)}function r3(n){var t,i,s,r,o,a,l;return((r=(s=(i=(t=n.controller)==null?void 0:t.valueController)==null?void 0:i.view)==null?void 0:s.swatchElement)==null?void 0:r.querySelector("button"))??((l=(a=(o=n.controller)==null?void 0:o.valueController)==null?void 0:a.view)==null?void 0:l.buttonElement)}/*! Tweakpane 4.0.5 (c) 2016 cocopon, licensed under the MIT license. */function Ut(n){return n==null}function Wg(n){return n!==null&&typeof n=="object"}function lv(n){return n!==null&&typeof n=="object"}function o3(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Ho(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return lv(r)&&lv(o)?Object.assign(Object.assign({},i),{[s]:Ho(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function $g(n){return Wg(n)?"target"in n:!1}const a3={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class nn{static alreadyDisposed(){return new nn({type:"alreadydisposed"})}static notBindable(){return new nn({type:"notbindable"})}static notCompatible(e,t){return new nn({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new nn({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new nn({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=a3[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}}class kd{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!kd.isBindable(i))throw nn.notBindable();if(!(e in i))throw nn.propertyNotFound(e);i[e]=t}}class fn{constructor(){this.observers_={}}on(e,t,i){var s;let r=this.observers_[e];return r||(r=this.observers_[e]=[]),r.push({handler:t,key:(s=i==null?void 0:i.key)!==null&&s!==void 0?s:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.key!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}}class l3{constructor(e,t){var i;this.constraint_=t==null?void 0:t.constraint,this.equals_=(i=t==null?void 0:t.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new fn,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}}class c3{constructor(e){this.emitter=new fn,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}}class h3{constructor(e){this.emitter=new fn,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function jt(n,e){const t=e==null?void 0:e.constraint,i=e==null?void 0:e.equals;return!t&&!i?new c3(n):new l3(n,e)}function u3(n){return[new h3(n),(e,t)=>{n.setRawValue(e,t)}]}class ot{constructor(e){this.emitter=new fn,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:jt(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new ot(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}class ph{constructor(e){this.values=ot.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}}class d3{constructor(e){this.values=ot.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return Ut(i)||(s=Math.max(s,i)),Ut(t)||(s=Math.min(s,t)),s}}class p3{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}}class f3{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const m3={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};class v3{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=m3[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const g3={"+":n=>n,"-":n=>-n,"~":n=>~n};class _3{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=g3[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function jg(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function Oc(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function b3(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function kc(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function x3(n,e){const t=kc(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=kc(n,e);return s===""?"":i+s}function Xg(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=x3(n,e);return i===""?"":t+i}function WM(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=b3(n,e);return e+=i.length,i===""?"":i+kc(n,e)}function y3(n,e){const t=WM(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=kc(n,e);return e+=s.length,t+i+s+Xg(n,e)}function w3(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=kc(n,e);return e+=i.length,i===""?"":t+i+Xg(n,e)}function E3(n,e){const t=WM(n,e);return e+=t.length,t===""?"":t+Xg(n,e)}const M3=jg([y3,w3,E3]);function S3(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function C3(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=S3(n,e);return i===""?"":t+i}function A3(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function T3(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=A3(n,e);return i===""?"":t+i}function P3(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function R3(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=P3(n,e);return i===""?"":t+i}const L3=jg([C3,T3,R3]),I3=jg([L3,M3]);function D3(n,e){const t=I3(n,e);return e+=t.length,t===""?null:{evaluable:new f3(t),cursor:e}}function N3(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=jM(n,e);if(!i)return null;e=i.cursor,e+=Oc(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function O3(n,e){var t;return(t=D3(n,e))!==null&&t!==void 0?t:N3(n,e)}function $M(n,e){const t=O3(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=$M(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new _3(i,s.evaluable)}):null}function k3(n,e,t){t+=Oc(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=Oc(e,t).length,{cursor:t,operator:i}):null}function U3(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=k3(e,t,i);if(!o)break;i=o.cursor;const a=n(t,i);if(!a)return null;i=a.cursor,r=new v3(o.operator,r,a.evaluable)}return r?{cursor:i,evaluable:r}:null}}const F3=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>U3(n,e),$M);function jM(n,e){return e+=Oc(n,e).length,F3(n,e)}function B3(n){const e=jM(n,0);return!e||e.cursor+Oc(n,e.cursor).length!==n.length?null:e.evaluable}function Qs(n){var e;const t=B3(n);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function XM(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=Qs(n);if(!Ut(e))return e}return 0}function V3(n){return String(n)}function fi(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function Rt(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function sx(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function bn(n,e,t){return Math.min(Math.max(n,e),t)}function qM(n,e){return(n%e+e)%e}function z3(n,e){return Ut(n.step)?Math.max(sx(e),2):sx(n.step)}function KM(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function YM(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function ZM(n,e){return Ut(n.step)?null:new p3(n.step,e)}function JM(n){return!Ut(n.max)&&!Ut(n.min)?new ph({max:n.max,min:n.min}):!Ut(n.max)||!Ut(n.min)?new d3({max:n.max,min:n.min}):null}function QM(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:fi(z3(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:KM(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:YM(n,e)}}function eS(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function qg(n){return{constraint:n.constraint,textProps:ot.fromObject(QM(n.params,n.initialValue))}}class ea{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}}class Gp{constructor(e){this.target=e}}class fh extends Gp{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}}class H3 extends Gp{constructor(e,t){super(e),this.expanded=t}}class G3 extends Gp{constructor(e,t){super(e),this.index=t}}class W3 extends Gp{constructor(e,t){super(e),this.native=t}}class Uc extends ea{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new fn,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new fh(this,t.binding.target.read(),e.options.last))}}class $3{constructor(e,t){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t,this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new fn}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function j3(n){if(!("binding"in n))return!1;const e=n.binding;return $g(e)&&"read"in e&&"write"in e}function X3(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],a=o(n[r]);return a.succeeded?Object.assign(Object.assign({},s),{[r]:a.value}):void 0},{});return i}function q3(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function K3(n){return n===null?!1:typeof n=="object"}function Os(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function rx(n){return{custom:e=>Os(e)(n),boolean:Os(e=>typeof e=="boolean"?e:void 0)(n),number:Os(e=>typeof e=="number"?e:void 0)(n),string:Os(e=>typeof e=="string"?e:void 0)(n),function:Os(e=>typeof e=="function"?e:void 0)(n),constant:e=>Os(t=>t===e?e:void 0)(n),raw:Os(e=>e)(n),object:e=>Os(t=>{if(K3(t))return X3(t,e)})(n),array:e=>Os(t=>{if(Array.isArray(t))return q3(t,e)})(n)}}const cv={optional:rx(!0),required:rx(!1)};function Zt(n,e){const t=e(cv),i=cv.required.object(t)(n);return i.succeeded?i.value:void 0}function Ci(n,e,t,i){if(e&&!e(n))return!1;const s=Zt(n,t);return s?i(s):!1}function Ai(n,e){var t;return Ho((t=n==null?void 0:n())!==null&&t!==void 0?t:{},e)}function Io(n){return"value"in n}function tS(n){if(!Wg(n)||!("binding"in n))return!1;const e=n.binding;return $g(e)}const ls="http://www.w3.org/2000/svg";function Ud(n){n.offsetHeight}function Y3(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function Kg(n){return n.ontouchstart!==void 0}function Z3(){return globalThis}function J3(){return Z3().document}function Q3(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const eF={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Wp(n,e){const t=n.createElementNS(ls,"svg");return t.innerHTML=eF[e],t}function nS(n,e,t){n.insertBefore(e,n.children[t])}function Yg(n){n.parentElement&&n.parentElement.removeChild(n)}function iS(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function tF(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function sS(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function Ks(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function bs(n,e,t){Ks(n.value(e),t)}const nF="tp";function bt(n){return(t,i)=>[nF,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const jl=bt("lbl");function iF(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}class rS{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(jl()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(jl("l")),bs(t.props,"label",r=>{Ut(r)?this.element.classList.add(jl(void 0,"nol")):(this.element.classList.remove(jl(void 0,"nol")),tF(i),i.appendChild(iF(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(jl("v")),this.element.appendChild(s),this.valueElement=s}}class oS{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new rS(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Ci(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return Ai(null,{label:this.props.get("label")})}}function sF(){return["veryfirst","first","last","verylast"]}const ox=bt(""),ax={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class $p{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{sF().forEach(i=>{t.classList.remove(ox(void 0,ax[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(ox(void 0,ax[i]))})}),this.viewProps.handleDispose(()=>{Yg(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Ci(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return Ai(null,Object.assign({},this.viewProps.exportState()))}}class Go extends $p{constructor(e,t){if(t.value!==t.valueController.value)throw nn.shouldNeverHappen();const i=t.valueController.viewProps,s=new oS(e,{blade:t.blade,props:t.props,valueController:t.valueController});super(Object.assign(Object.assign({},t),{view:new rS(e,{props:t.props,viewProps:i}),viewProps:i})),this.labelController=s,this.value=t.value,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(e){return Ci(e,t=>{var i,s,r;return super.importState(t)&&this.labelController.importProps(t)&&((r=(s=(i=this.valueController).importProps)===null||s===void 0?void 0:s.call(i,e))!==null&&r!==void 0?r:!0)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var e,t,i;return Ai(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(i=(t=(e=this.valueController).exportProps)===null||t===void 0?void 0:t.call(e))!==null&&i!==void 0?i:{}))}}function lx(n){const e=Object.assign({},n);return delete e.value,e}class aS extends Go{constructor(e,t){super(e,t),this.tag=t.tag}importState(e){return Ci(e,t=>super.importState(lx(e)),t=>({tag:t.optional.string}),t=>(this.tag=t.tag,!0))}exportState(){return Ai(()=>lx(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}function rF(n){return Io(n)&&tS(n.value)}class oF extends aS{importState(e){return Ci(e,t=>super.importState(t),t=>({binding:t.required.object({value:t.required.raw})}),t=>(this.value.binding.inject(t.binding.value),this.value.fetch(),!0))}}function aF(n){return Io(n)&&j3(n.value)}function lS(n,e){for(;n.length<e;)n.push(void 0)}function lF(n){const e=[];return lS(e,n),e}function cF(n){const e=n.indexOf(void 0);return e<0?n:n.slice(0,e)}function hF(n,e){const t=[...cF(n),e];return t.length>n.length?t.splice(0,t.length-n.length):lS(t,n.length),t}class uF{constructor(e){this.emitter=new fn,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e.binding,this.value_=jt(lF(e.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=hF(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function dF(n){if(!("binding"in n))return!1;const e=n.binding;return $g(e)&&"read"in e&&!("write"in e)}class pF extends aS{exportState(){return Ai(()=>super.exportState(),{binding:{readonly:!0}})}}function fF(n){return Io(n)&&dF(n.value)}class mF extends ea{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,r=>{i(new W3(this,r.nativeEvent))}),this}off(e,t){return this.controller.buttonController.emitter.off(e,t),this}}function vF(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function El(n,e){return t=>{vF(n,e,t)}}function Zg(n,e){Ks(n,t=>{e.textContent=t??""})}const am=bt("btn");class gF{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(am()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(am("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(am("t")),Zg(t.props.value("title"),s),this.buttonElement.appendChild(s)}}class _F{constructor(e,t){this.emitter=new fn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new gF(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Ci(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return Ai(null,{title:this.props.get("title")})}onClick_(e){this.emitter.emit("click",{nativeEvent:e,sender:this})}}class cx extends $p{constructor(e,t){const i=new _F(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new oS(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return Ci(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return Ai(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class cS{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}}const Ml=new cS("2.0.5");function oi(n){return Object.assign({core:Ml},n)}const bF=oi({id:"button",type:"blade",accept(n){const e=Zt(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new cx(n.document,{blade:n.blade,buttonProps:ot.fromObject({title:n.params.title}),labelProps:ot.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof cx?new mF(n.controller):null}});function xF(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function yF(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function wF(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function EF(n){return Wg(n)?"refresh"in n&&typeof n.refresh=="function":!1}function MF(n,e){if(!kd.isBindable(n))throw nn.notBindable();return new kd(n,e)}class SF{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new fn,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,MF(e,t),s),a=this.pool_.createBindingApi(o);return this.add(a,s.index)}addFolder(e){return yF(this,e)}addButton(e){return xF(this,e)}addTab(e){return wF(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.children.forEach(e=>{EF(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=tS(t.value)?t.value.binding:null;this.emitter_.emit("change",new fh(i,s?s.target.read():t.value.rawValue,e.options.last))}}class Jg extends ea{constructor(e,t){super(e),this.rackApi_=new SF(e.rackController,t)}refresh(){this.rackApi_.refresh()}}class Qg extends $p{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Ci(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return Ai(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}}function hv(n){return"rackController"in n}class CF{constructor(e){this.emitter=new fn,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw nn.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}function AF(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(Io(i)&&i.value===e)return i}return null}function TF(n){return hv(n)?n.rackController.rack.bcSet_:null}class PF{constructor(e){var t,i;this.emitter=new fn,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new CF(TF),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),Io(i))i.value.emitter.on("change",this.onChildValueChange_);else if(hv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(Io(i))i.value.emitter.off("change",this.onChildValueChange_);else if(hv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=AF(this.find(Io),e.sender);if(!t)throw nn.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class e_{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new PF({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&nS(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&Yg(e.bladeController.view.element)}}function Sl(){return new ot({positions:jt([],{equals:o3})})}class mh extends ot{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=ot.createCore(t);return new mh(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Ut(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};bs(this,"expanded",i),bs(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function RF(n,e){let t=0;return Y3(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),Ud(e),t=e.clientHeight,n.set("temporaryExpanded",null),Ud(e)}),t}function hx(n,e){e.style.height=n.styleHeight}function t_(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),Ut(n.get("expandedHeight"))){const t=RF(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),Ud(e)}),n.emitter.on("change",()=>{hx(n,e)}),hx(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}class hS extends Jg{constructor(e,t){super(e,t),this.emitter_=new fn,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new H3(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}const uS=bt("cnt");class LF{constructor(e,t){var i;this.className_=bt((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),uS()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),bs(this.foldable_,"completed",El(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),bs(t.props,"title",c=>{Ut(c)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),Zg(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const a=e.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);const l=e.createElement("div");l.classList.add(this.className_("c")),this.element.appendChild(l),this.containerElement=l}}class uv extends Qg{constructor(e,t){var i;const s=mh.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new LF(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new e_({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,t_(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Ci(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return Ai(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const IF=oi({id:"folder",type:"blade",accept(n){const e=Zt(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new uv(n.document,{blade:n.blade,expanded:n.params.expanded,props:ot.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof uv?new hS(n.controller,n.pool):null}}),DF=bt("");function ux(n,e){return El(n,DF(void 0,e))}class nr extends ot{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=u3(jt(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new nr(ot.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){Ks(this.globalDisabled_,ux(e,"disabled")),bs(this,"hidden",ux(e,"hidden"))}bindDisabled(e){Ks(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){Ks(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i==null||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const dx=bt("tbp");class NF{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(dx()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(dx("c")),this.element.appendChild(i),this.containerElement=i}}const Xl=bt("tbi");class OF{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Xl()),t.viewProps.bindClassModifiers(this.element),bs(t.props,"selected",r=>{r?this.element.classList.add(Xl(void 0,"sel")):this.element.classList.remove(Xl(void 0,"sel"))});const i=e.createElement("button");i.classList.add(Xl("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Xl("t")),Zg(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}}class kF{constructor(e,t){this.emitter=new fn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new OF(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class dv extends Qg{constructor(e,t){const i=new NF(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new e_({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new kF(e,{props:t.itemProps,viewProps:nr.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,bs(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return Ci(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return Ai(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class UF extends Jg{constructor(e,t){super(e,t),this.emitter_=new fn,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new dv(t,{blade:Sl(),itemProps:ot.fromObject({selected:!1,title:e.title}),props:ot.fromObject({selected:!1}),viewProps:nr.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}onSelect_(e){this.emitter_.emit("select",new G3(this,e.rawValue))}}class FF extends Jg{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}}const px=-1;class BF{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=jt(!0),this.selectedIndex=jt(px),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=px,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const ql=bt("tab");class VF{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ql(),uS()),t.viewProps.bindClassModifiers(this.element),Ks(t.empty,El(this.element,ql(void 0,"nop")));const i=e.createElement("div");i.classList.add(ql("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(ql("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(ql("c")),this.element.appendChild(r),this.contentsElement=r}}class fx extends Qg{constructor(e,t){const i=new BF,s=new VF(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new e_({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;nS(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;Yg(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}}const dS=oi({id:"tab",type:"blade",accept(n){const e=Zt(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new fx(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new dv(n.document,{blade:Sl(),itemProps:ot.fromObject({selected:!1,title:t.title}),props:ot.fromObject({selected:!1}),viewProps:nr.create()});e.add(i)}),e},api(n){return n.controller instanceof fx?new UF(n.controller,n.pool):n.controller instanceof dv?new FF(n.controller,n.pool):null}});function zF(n,e){const t=n.accept(e.params);if(!t)return null;const i=Zt(e.params,s=>({disabled:s.optional.boolean,hidden:s.optional.boolean}));return n.controller({blade:Sl(),document:e.document,params:Object.assign(Object.assign({},t.params),{disabled:i==null?void 0:i.disabled,hidden:i==null?void 0:i.hidden}),viewProps:nr.create({disabled:i==null?void 0:i.disabled,hidden:i==null?void 0:i.hidden})})}class n_ extends Uc{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}}class HF{constructor(){this.disabled=!1,this.emitter=new fn}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class GF{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new fn,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class vh{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}}function Fd(n,e){if(n instanceof e)return n;if(n instanceof vh){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}class gh{constructor(e){this.values=ot.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}}function _h(n){var e;const t=cv;if(Array.isArray(n))return(e=Zt({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function i_(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function s_(n){return Ut(n)?null:new gh(i_(n))}const lm=bt("lst");class WF{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(lm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(lm("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(lm("m")),s.appendChild(Wp(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,bs(this.props_,"options",r=>{iS(this.selectElement),r.forEach(o=>{const a=e.createElement("option");a.textContent=o.text,this.selectElement.appendChild(a)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class Nr{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new WF(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Ci(e,null,t=>({options:t.required.custom(_h)}),t=>(this.props.set("options",i_(t.options)),!0))}exportProps(){return Ai(null,{options:this.props.get("options")})}}const mx=bt("pop");class $F{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(mx()),t.viewProps.bindClassModifiers(this.element),Ks(t.shows,El(this.element,mx(void 0,"v")))}}class pS{constructor(e,t){this.shows=jt(!1),this.viewProps=t.viewProps,this.view=new $F(e,{shows:this.shows,viewProps:this.viewProps})}}const vx=bt("txt");class jF{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(vx()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(vx("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class Fc{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new jF(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Ut(s)||(this.value.rawValue=s),this.view.refresh()}}function XF(n){return String(n)}function fS(n){return n==="false"?!1:!!n}function gx(n){return XF(n)}function qF(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const KF=fi(0);function Bd(n){return KF(n)+"%"}function mS(n){return String(n)}function pv(n){return n}function Cl({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function pi(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function Bc(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function er(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function YF(n){return n==="ArrowUp"||n==="ArrowDown"}function vS(n){return YF(n)||n==="ArrowLeft"||n==="ArrowRight"}function cm(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}class ta{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new fn,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(cm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(cm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(cm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}}const Ii=bt("txt");class ZF{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Ii(),Ii(void 0,"num")),t.arrayPosition&&this.element.classList.add(Ii(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Ii("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Ii()),this.inputElement.classList.add(Ii("i"));const s=e.createElement("div");s.classList.add(Ii("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(ls,"svg");r.classList.add(Ii("g")),this.knobElement.appendChild(r);const o=e.createElementNS(ls,"path");o.classList.add(Ii("gb")),r.appendChild(o),this.guideBodyElem_=o;const a=e.createElementNS(ls,"path");a.classList.add(Ii("gh")),r.appendChild(a),this.guideHeadElem_=a;const l=e.createElement("div");l.classList.add(bt("tt")()),this.knobElement.appendChild(l),this.tooltipElem_=l,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Ii(void 0,"drg"));return}this.element.classList.add(Ii(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=bn(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class bh{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=jt(null),this.view=new ZF(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new ta(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Ut(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=pi(this.props.get("keyScale"),Bc(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){pi(this.props.get("keyScale"),Bc(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const hm=bt("sld");class JF{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(hm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(hm("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(hm("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=bn(Rt(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class QF{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new JF(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ta(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(Rt(bn(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=pi(this.props.get("keyScale"),er(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){pi(this.props.get("keyScale"),er(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const um=bt("sldtxt");class eB{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(um());const i=e.createElement("div");i.classList.add(um("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(um("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}}class Vd{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new QF(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new bh(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new eB(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Ci(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return Ai(null,{max:e.get("max"),min:e.get("min")})}}function gS(n){return{sliderProps:new ot({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new ot({formatter:jt(n.formatter),keyScale:n.keyScale,pointerScale:jt(n.pointerScale)})}}const tB={containerUnitSize:"cnt-usz"};function _S(n){return`--${tB[n]}`}function Vc(n){return eS(n)}function Mr(n){if(lv(n))return Zt(n,Vc)}function Ws(n,e){if(!n)return;const t=[],i=ZM(n,e);i&&t.push(i);const s=JM(n);return s&&t.push(s),new vh(t)}function nB(n){return n?n.major===Ml.major:!1}function bS(n){if(n==="inline"||n==="popup")return n}function xh(n,e){n.write(e)}const _u=bt("ckb");class iB{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(_u()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(_u("l")),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("input");s.classList.add(_u("i")),s.type="checkbox",this.labelElement.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(_u("w")),this.labelElement.appendChild(r);const o=Wp(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class sB{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new iB(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked,e.preventDefault(),e.stopPropagation()}onLabelMouseDown_(e){e.preventDefault()}}function rB(n){const e=[],t=s_(n.options);return t&&e.push(t),new vh(e)}const oB=oi({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Zt(e,i=>({options:i.optional.custom(_h),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>fS,constraint:n=>rB(n.params),writer:n=>xh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&Fd(i,gh);return s?new Nr(e,{props:new ot({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new sB(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof Nr?new n_(n.controller):null}}),co=bt("col");class aB{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(co()),t.foldable.bindExpandedClass(this.element,co(void 0,"expanded")),bs(t.foldable,"completed",El(this.element,co(void 0,"cpl")));const i=e.createElement("div");i.classList.add(co("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(co("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(co("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(co("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}function lB(n,e,t){const i=bn(n/255,0,1),s=bn(e/255,0,1),r=bn(t/255,0,1),o=Math.max(i,s,r),a=Math.min(i,s,r),l=o-a;let c=0,h=0;const u=(a+o)/2;return l!==0&&(h=l/(1-Math.abs(o+a-1)),i===o?c=(s-r)/l:s===o?c=2+(r-i)/l:c=4+(i-s)/l,c=c/6+(c<0?1:0)),[c*360,h*100,u*100]}function cB(n,e,t){const i=(n%360+360)%360,s=bn(e/100,0,1),r=bn(t/100,0,1),o=(1-Math.abs(2*r-1))*s,a=o*(1-Math.abs(i/60%2-1)),l=r-o/2;let c,h,u;return i>=0&&i<60?[c,h,u]=[o,a,0]:i>=60&&i<120?[c,h,u]=[a,o,0]:i>=120&&i<180?[c,h,u]=[0,o,a]:i>=180&&i<240?[c,h,u]=[0,a,o]:i>=240&&i<300?[c,h,u]=[a,0,o]:[c,h,u]=[o,0,a],[(c+l)*255,(h+l)*255,(u+l)*255]}function hB(n,e,t){const i=bn(n/255,0,1),s=bn(e/255,0,1),r=bn(t/255,0,1),o=Math.max(i,s,r),a=Math.min(i,s,r),l=o-a;let c;l===0?c=0:o===i?c=60*(((s-r)/l%6+6)%6):o===s?c=60*((r-i)/l+2):c=60*((i-s)/l+4);const h=o===0?0:l/o,u=o;return[c,h*100,u*100]}function xS(n,e,t){const i=qM(n,360),s=bn(e/100,0,1),r=bn(t/100,0,1),o=r*s,a=o*(1-Math.abs(i/60%2-1)),l=r-o;let c,h,u;return i>=0&&i<60?[c,h,u]=[o,a,0]:i>=60&&i<120?[c,h,u]=[a,o,0]:i>=120&&i<180?[c,h,u]=[0,o,a]:i>=180&&i<240?[c,h,u]=[0,a,o]:i>=240&&i<300?[c,h,u]=[a,0,o]:[c,h,u]=[o,0,a],[(c+l)*255,(h+l)*255,(u+l)*255]}function uB(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function dB(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function xs(n){return[n[0],n[1],n[2]]}function jp(n,e){return[n[0],n[1],n[2],e]}const pB={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:uB,rgb:cB},hsv:{hsl:dB,hsv:(n,e,t)=>[n,e,t],rgb:xS},rgb:{hsl:lB,hsv:hB,rgb:(n,e,t)=>[n,e,t]}};function ll(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function fB(n,e){return n===e?e:qM(n,e)}function yS(n,e,t){var i;const s=ll(e,t);return[e==="rgb"?bn(n[0],0,s[0]):fB(n[0],s[0]),bn(n[1],0,s[1]),bn(n[2],0,s[2]),bn((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function _x(n,e,t,i){const s=ll(e,t),r=ll(e,i);return n.map((o,a)=>o/s[a]*r[a])}function wS(n,e,t){const i=_x(n,e.mode,e.type,"int"),s=pB[e.mode][t.mode](...i);return _x(s,t.mode,"int",t.type)}class Et{static black(){return new Et([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=yS(e,t,this.type)}getComponents(e){return jp(wS(xs(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const pr=bt("colp");class mB{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(pr()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(pr("hsv"));const s=e.createElement("div");s.classList.add(pr("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(pr("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(pr("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const a=e.createElement("div");a.classList.add(pr("a"));const l=e.createElement("div");l.classList.add(pr("ap")),l.appendChild(this.alphaViews_.palette.element),a.appendChild(l);const c=e.createElement("div");c.classList.add(pr("at")),c.appendChild(this.alphaViews_.text.element),a.appendChild(c),this.element.appendChild(a)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function vB(n){return n==="int"?"int":n==="float"?"float":void 0}function r_(n){return Zt(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(vB)}),expanded:e.optional.boolean,picker:e.optional.custom(bS),readonly:e.optional.constant(!1)}))}function Wo(n){return n?.1:1}function ES(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}class o_{constructor(e,t){this.type="float",this.mode=t,this.comps_=yS(e,t,this.type)}getComponents(e){return jp(wS(xs(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const gB={int:(n,e)=>new Et(n,e),float:(n,e)=>new o_(n,e)};function a_(n,e,t){return gB[t](n,e)}function _B(n){return n.type==="float"}function bB(n){return n.type==="int"}function xB(n){const e=n.getComponents(),t=ll(n.mode,"int");return new Et([Math.round(Rt(e[0],0,1,0,t[0])),Math.round(Rt(e[1],0,1,0,t[1])),Math.round(Rt(e[2],0,1,0,t[2])),e[3]],n.mode)}function yB(n){const e=n.getComponents(),t=ll(n.mode,"int");return new o_([Rt(e[0],0,t[0],0,1),Rt(e[1],0,t[1],0,1),Rt(e[2],0,t[2],0,1),e[3]],n.mode)}function si(n,e){if(n.type===e)return n;if(bB(n)&&e==="float")return yB(n);if(_B(n)&&e==="int")return xB(n);throw nn.shouldNeverHappen()}function wB(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Fi(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const EB={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function MS(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return EB[i](t)}function SS(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Fi(e[1],255),Fi(e[2],255),Fi(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function MB(n){const e=SS(n);return e?new Et(e,"rgb"):null}function CS(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Fi(e[1],255),Fi(e[2],255),Fi(e[3],255),Fi(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function SB(n){const e=CS(n);return e?new Et(e,"rgb"):null}function AS(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[MS(e[1]),Fi(e[2],100),Fi(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function CB(n){const e=AS(n);return e?new Et(e,"hsl"):null}function TS(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[MS(e[1]),Fi(e[2],100),Fi(e[3],100),Fi(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function AB(n){const e=TS(n);return e?new Et(e,"hsl"):null}function PS(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function TB(n){const e=PS(n);return e?new Et(e,"rgb"):null}function RS(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),Rt(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),Rt(parseInt(t[4],16),0,255,0,1)]:null}function PB(n){const e=RS(n);return e?new Et(e,"rgb"):null}function LS(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function RB(n){return e=>{const t=LS(e);return t?a_(t,"rgb",n):null}}function IS(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function LB(n){return e=>{const t=IS(e);return t?a_(t,"rgb",n):null}}const IB=[{parser:PS,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:RS,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:SS,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:CS,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:AS,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:TS,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:LS,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:IS,result:{alpha:!0,mode:"rgb",notation:"object"}}];function DB(n){return IB.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function NB(n,e="int"){const t=DB(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function yh(n){const e=[TB,PB,MB,SB,CB,AB];e.push(RB("int"),LB("int"));const t=qF(e);return i=>{const s=t(i);return s?si(s,n):null}}function OB(n){const e=yh("int");if(typeof n!="string")return Et.black();const t=e(n);return t??Et.black()}function DS(n){const e=bn(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function l_(n,e="#"){const t=xs(n.getComponents("rgb")).map(DS).join("");return`${e}${t}`}function c_(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(DS).join("");return`${e}${i}`}function NS(n){const e=fi(0),t=si(n,"int");return`rgb(${xs(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function Fu(n){const e=fi(2),t=fi(0);return`rgba(${si(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function kB(n){const e=[fi(0),Bd,Bd],t=si(n,"int");return`hsl(${xs(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function UB(n){const e=[fi(0),Bd,Bd,fi(2)];return`hsla(${si(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function OS(n,e){const t=fi(e==="float"?2:0),i=["r","g","b"],s=si(n,e);return`{${xs(s.getComponents("rgb")).map((o,a)=>`${i[a]}: ${t(o)}`).join(", ")}}`}function FB(n){return e=>OS(e,n)}function kS(n,e){const t=fi(2),i=fi(e==="float"?2:0),s=["r","g","b","a"];return`{${si(n,e).getComponents("rgb").map((a,l)=>{const c=l===3?t:i;return`${s[l]}: ${c(a)}`}).join(", ")}}`}function BB(n){return e=>kS(e,n)}const VB=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:l_},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:c_},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:NS},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Fu},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:kB},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:UB},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:FB(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:BB(e)}],[])];function US(n){return VB.reduce((e,t)=>e||(wB(t.format,n)?t.stringifier:null),null)}const Kl=bt("apl");class zB{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Kl()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Kl("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Kl("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(Kl("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(Kl("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new Et([t[0],t[1],t[2],0],"rgb"),s=new Et([t[0],t[1],t[2],255],"rgb"),r=["to right",Fu(i),Fu(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Fu(e);const o=Rt(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}}class HB{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new zB(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ta(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,a]=s.getComponents("hsv");this.value.setRawValue(new Et([r,o,a,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=pi(Wo(!0),er(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,a]=i.getComponents("hsv");this.value.setRawValue(new Et([s,r,o,a+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){pi(Wo(!0),er(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ma=bt("coltxt");function GB(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}class WB{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ma()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ma("m")),this.modeElem_=GB(e),this.modeElem_.classList.add(Ma("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(Ma("mm")),s.appendChild(Wp(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(Ma("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),Ks(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){iS(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(Ma("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}}function $B(n){return fi(n==="float"?2:0)}function jB(n,e,t){const i=ll(n,e)[t];return new ph({min:0,max:i})}function XB(n,e,t){return new bh(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:ot.fromObject({formatter:$B(e.colorType),keyScale:Wo(!1),pointerScale:e.colorType==="float"?.01:1}),value:jt(0,{constraint:jB(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function qB(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Qs,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=XB(n,t,i);return Cl({primary:e.value,secondary:s.value,forward(r){return si(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const a=e.colorMode,c=si(r,e.colorType).getComponents(a);c[i]=o;const h=a_(jp(xs(c),c[3]),a,e.colorType);return si(h,"int")}}),s})}function KB(n,e){const t=new Fc(n,{parser:yh("int"),props:ot.fromObject({formatter:l_}),value:jt(Et.black()),viewProps:e.viewProps});return Cl({primary:e.value,secondary:t.value,forward:i=>new Et(xs(i.getComponents()),i.mode),backward:(i,s)=>new Et(jp(xs(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function YB(n){return n!=="hex"}class ZB{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=jt(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new WB(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return YB(t)?qB(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):KB(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}}const dm=bt("hpl");class JB{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(dm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(dm("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(dm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=NS(new Et([t,100,100],"hsv"));const i=Rt(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}}class QB{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new JB(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ta(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=Rt(bn(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,a]=s.getComponents("hsv");this.value.setRawValue(new Et([i,r,o,a],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=pi(Wo(!1),er(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,a]=i.getComponents("hsv");this.value.setRawValue(new Et([s+t,r,o,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){pi(Wo(!1),er(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const pm=bt("svp"),bx=64;class eV{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(pm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=bx,i.width=bx,i.classList.add(pm("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(pm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=Q3(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),a=o.data;for(let h=0;h<r;h++)for(let u=0;u<s;u++){const d=Rt(u,0,s,0,100),p=Rt(h,0,r,100,0),f=xS(i[0],d,p),g=(h*s+u)*4;a[g]=f[0],a[g+1]=f[1],a[g+2]=f[2],a[g+3]=255}e.putImageData(o,0,0);const l=Rt(i[1],0,100,0,100);this.markerElem_.style.left=`${l}%`;const c=Rt(i[2],0,100,100,0);this.markerElem_.style.top=`${c}%`}onValueChange_(){this.update_()}}class tV{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new eV(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ta(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=Rt(e.point.x,0,e.bounds.width,0,100),s=Rt(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Et([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){vS(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=Wo(!1),a=pi(o,er(e)),l=pi(o,Bc(e));a===0&&l===0||this.value.setRawValue(new Et([t,i+a,s+l,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=Wo(!1),i=pi(t,er(e)),s=pi(t,Bc(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class nV{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new QB(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new tV(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new HB(e,{value:this.value,viewProps:this.viewProps}),text:new bh(e,{parser:Qs,props:ot.fromObject({pointerScale:.01,keyScale:.1,formatter:fi(2)}),value:jt(0,{constraint:new ph({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Cl({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new Et(r,i.mode)}}),this.textsC_=new ZB(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new mB(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const fm=bt("colsw");class iV{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(fm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(fm("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(fm("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=c_(e)}onValueChange_(){this.update_()}}class sV{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new iV(e,{value:this.value,viewProps:this.viewProps})}}class h_{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=mh.create(t.expanded),this.swatchC_=new sV(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new Fc(e,{parser:t.parser,props:ot.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new aB(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new pS(e,{viewProps:this.viewProps}):null;const s=new nV(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),Cl({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),t_(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=sS(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!Kg(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function rV(n){return xs(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function oV(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function aV(n){return new Et([n>>16&255,n>>8&255,n&255],"rgb")}function lV(n){return new Et([n>>24&255,n>>16&255,n>>8&255,Rt(n&255,0,255,0,1)],"rgb")}function cV(n){return typeof n!="number"?Et.black():aV(n)}function hV(n){return typeof n!="number"?Et.black():lV(n)}function Bu(n,e){return typeof n!="object"||Ut(n)?!1:e in n&&typeof n[e]=="number"}function FS(n){return Bu(n,"r")&&Bu(n,"g")&&Bu(n,"b")}function BS(n){return FS(n)&&Bu(n,"a")}function VS(n){return FS(n)}function u_(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function xx(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function uV(n){const e=US(n);return e?(t,i)=>{xh(t,e(i))}:null}function dV(n){const e=n?oV:rV;return(t,i)=>{xh(t,e(i))}}function pV(n,e,t){const s=si(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function fV(n,e,t){const s=si(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function mV(n,e){return(t,i)=>{n?pV(t,i,e):fV(t,i,e)}}function vV(n){var e;return!!(!((e=n==null?void 0:n.color)===null||e===void 0)&&e.alpha)}function gV(n){return n?e=>c_(e,"0x"):e=>l_(e,"0x")}function _V(n){return"color"in n||n.view==="color"}const bV=oi({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!_V(e))return null;const t=r_(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:vV(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?hV:cV,equals:u_,writer:n=>dV(n.params.supportsAlpha)},controller:n=>{var e,t;return new h_(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:gV(n.params.supportsAlpha),parser:yh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function xV(n,e){if(!VS(n))return si(Et.black(),e);if(e==="int"){const t=xx(n);return new Et(t,"rgb")}if(e==="float"){const t=xx(n);return new o_(t,"rgb")}return si(Et.black(),"int")}function yV(n){return BS(n)}function wV(n){return e=>{const t=xV(e,n);return si(t,"int")}}function EV(n,e){return t=>n?kS(t,e):OS(t,e)}const MV=oi({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!VS(n))return null;const i=r_(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=ES(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>wV(n.params.colorType),equals:u_,writer:n=>mV(yV(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=BS(n.initialValue);return new h_(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:EV(i,n.params.colorType),parser:yh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}}),SV=oi({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=NB(n,ES(e));if(!t)return null;const i=US(t);if(!i)return null;const s=r_(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>OB,equals:u_,writer:n=>{const e=uV(n.params.format);if(!e)throw nn.notBindable();return e}},controller:n=>{var e,t;return new h_(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:yh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});class d_{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}}const yx=bt("pndtxt");class CV{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(yx()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(yx("a")),s.appendChild(i.element),this.element.appendChild(s)})}}function AV(n,e,t){return new bh(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:jt(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}class p_{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>AV(e,t,s)),this.acs_.forEach((i,s)=>{Cl({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const a=t.assembly.toComponents(r);return a[s]=o,t.assembly.fromComponents(a)}})}),this.view=new CV(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}}class TV extends Uc{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}}function PV(n,e){const t=[],i=ZM(n,e);i&&t.push(i);const s=JM(n);s&&t.push(s);const r=s_(n.options);return r&&t.push(r),new vh(t)}const RV=oi({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=Zt(e,i=>Object.assign(Object.assign({},eS(i)),{options:i.optional.custom(_h),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>XM,constraint:n=>PV(n.params,n.initialValue),writer:n=>xh},controller:n=>{const e=n.value,t=n.constraint,i=t&&Fd(t,gh);if(i)return new Nr(n.document,{props:new ot({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=QM(n.params,e.rawValue),r=t&&Fd(t,ph);return r?new Vd(n.document,Object.assign(Object.assign({},gS(Object.assign(Object.assign({},s),{keyScale:jt(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:Qs,value:e,viewProps:n.viewProps})):new bh(n.document,{parser:Qs,props:ot.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof Vd?new TV(n.controller):n.controller.valueController instanceof Nr?new n_(n.controller):null}});class Ar{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Ut(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const zS={toComponents:n=>n.getComponents(),fromComponents:n=>new Ar(...n)},Sa=bt("p2d");class LV{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Sa()),t.viewProps.bindClassModifiers(this.element),Ks(t.expanded,El(this.element,Sa(void 0,"expanded")));const i=e.createElement("div");i.classList.add(Sa("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(Sa("b")),s.appendChild(Wp(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(Sa("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Sa("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}const fr=bt("p2dp");class IV{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(fr()),t.layout==="popup"&&this.element.classList.add(fr(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(fr("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(ls,"svg");s.classList.add(fr("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(ls,"line");r.classList.add(fr("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(ls,"line");o.classList.add(fr("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const a=e.createElementNS(ls,"line");a.classList.add(fr("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;const l=e.createElement("div");l.classList.add(fr("m")),this.padElement.appendChild(l),this.markerElem_=l,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=Rt(e,-i,+i,0,100),r=Rt(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function wx(n,e,t){return[pi(e[0],er(n)),pi(e[1],Bc(n))*(t?1:-1)]}class DV{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new IV(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ta(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=Rt(e.point.x,0,e.bounds.width,-i,+i),r=Rt(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new Ar(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){vS(e.key)&&e.preventDefault();const[t,i]=wx(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new Ar(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=wx(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class NV{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=mh.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new pS(e,{viewProps:this.viewProps}):null;const r=new DV(e,{layout:t.pickerLayout,props:new ot({invertsY:jt(t.invertsY),max:jt(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new p_(e,{assembly:zS,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new LV(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Cl({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,a)=>a})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),t_(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=sS(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!Kg(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}}function OV(n){return Ar.isObject(n)?new Ar(n.x,n.y):new Ar}function kV(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function UV(n,e){return new d_({assembly:zS,components:[Ws(Object.assign(Object.assign({},n),n.x),e.x),Ws(Object.assign(Object.assign({},n),n.y),e.y)]})}function Ex(n,e){var t,i;if(!Ut(n.min)||!Ut(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=KM(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function FV(n,e){var t,i;const s=Ex(Ho(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=Ex(Ho(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function BV(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}const VV=oi({id:"input-point2d",type:"input",accept:(n,e)=>{if(!Ar.isObject(n))return null;const t=Zt(e,i=>Object.assign(Object.assign({},Vc(i)),{expanded:i.optional.boolean,picker:i.optional.custom(bS),readonly:i.optional.constant(!1),x:i.optional.custom(Mr),y:i.optional.object(Object.assign(Object.assign({},Vc(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>OV,constraint:n=>UV(n.params,n.initialValue),equals:Ar.equals,writer:()=>kV},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new NV(i,{axes:s.rawValue.getComponents().map((a,l)=>{var c;return qg({constraint:r.components[l],initialValue:a,params:Ho(n.params,(c=o[l])!==null&&c!==void 0?c:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:BV(n.params),max:FV(n.params,s.rawValue),parser:Qs,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});class Ha{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Ut(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const HS={toComponents:n=>n.getComponents(),fromComponents:n=>new Ha(...n)};function zV(n){return Ha.isObject(n)?new Ha(n.x,n.y,n.z):new Ha}function HV(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function GV(n,e){return new d_({assembly:HS,components:[Ws(Object.assign(Object.assign({},n),n.x),e.x),Ws(Object.assign(Object.assign({},n),n.y),e.y),Ws(Object.assign(Object.assign({},n),n.z),e.z)]})}const WV=oi({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Ha.isObject(n))return null;const t=Zt(e,i=>Object.assign(Object.assign({},Vc(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(Mr),y:i.optional.custom(Mr),z:i.optional.custom(Mr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>zV,constraint:n=>GV(n.params,n.initialValue),equals:Ha.equals,writer:n=>HV},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new p_(n.document,{assembly:HS,axes:e.rawValue.getComponents().map((s,r)=>{var o;return qg({constraint:t.components[r],initialValue:s,params:Ho(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Qs,value:e,viewProps:n.viewProps})}});class Ga{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Ut(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const GS={toComponents:n=>n.getComponents(),fromComponents:n=>new Ga(...n)};function $V(n){return Ga.isObject(n)?new Ga(n.x,n.y,n.z,n.w):new Ga}function jV(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function XV(n,e){return new d_({assembly:GS,components:[Ws(Object.assign(Object.assign({},n),n.x),e.x),Ws(Object.assign(Object.assign({},n),n.y),e.y),Ws(Object.assign(Object.assign({},n),n.z),e.z),Ws(Object.assign(Object.assign({},n),n.w),e.w)]})}const qV=oi({id:"input-point4d",type:"input",accept:(n,e)=>{if(!Ga.isObject(n))return null;const t=Zt(e,i=>Object.assign(Object.assign({},Vc(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(Mr),x:i.optional.custom(Mr),y:i.optional.custom(Mr),z:i.optional.custom(Mr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>$V,constraint:n=>XV(n.params,n.initialValue),equals:Ga.equals,writer:n=>jV},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new p_(n.document,{assembly:GS,axes:e.rawValue.getComponents().map((s,r)=>{var o;return qg({constraint:t.components[r],initialValue:s,params:Ho(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Qs,value:e,viewProps:n.viewProps})}});function KV(n){const e=[],t=s_(n.options);return t&&e.push(t),new vh(e)}const YV=oi({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=Zt(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(_h)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>mS,constraint:n=>KV(n.params),writer:n=>xh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&Fd(i,gh);return s?new Nr(e,{props:new ot({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new Fc(e,{parser:r=>r,props:ot.fromObject({formatter:pv}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof Nr?new n_(n.controller):null}}),wh={monitor:{defaultInterval:200,defaultRows:3}},Mx=bt("mll");class ZV{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Mx()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(Mx("i")),i.style.height=`calc(var(${_S("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class f_{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new ZV(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}}const Sx=bt("sgl");class JV{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Sx()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Sx("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class m_{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new JV(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}const QV=oi({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Zt(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>fS},controller:n=>{var e;return n.value.rawValue.length===1?new m_(n.document,{formatter:gx,value:n.value,viewProps:n.viewProps}):new f_(n.document,{formatter:gx,rows:(e=n.params.rows)!==null&&e!==void 0?e:wh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});class ez extends Uc{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}}const mr=bt("grl");class tz{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(mr()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(ls,"svg");i.classList.add(mr("g")),i.style.height=`calc(var(${_S("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(ls,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(mr("t"),bt("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:e,clientHeight:t}=this.element,i=this.value.rawValue.length-1,s=this.props_.get("min"),r=this.props_.get("max"),o=[];this.value.rawValue.forEach((u,d)=>{if(u===void 0)return;const p=Rt(d,0,i,0,e),f=Rt(u,s,r,t,0);o.push([p,f].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const a=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){a.classList.remove(mr("t","a"));return}const c=Rt(this.cursor_.rawValue,0,i,0,e),h=Rt(l,s,r,t,0);a.style.left=`${c}px`,a.style.top=`${h}px`,a.textContent=`${this.formatter_(l)}`,a.classList.contains(mr("t","a"))||(a.classList.add(mr("t","a"),mr("t","in")),Ud(a),a.classList.remove(mr("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class WS{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=jt(-1),this.view=new tz(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!Kg(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new ta(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Ci(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return Ai(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const{clientWidth:t}=this.view.element;this.cursor_.rawValue=Math.floor(Rt(e.offsetX,0,t,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(Rt(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function fv(n){return Ut(n.format)?fi(2):n.format}function nz(n){var e;return n.value.rawValue.length===1?new m_(n.document,{formatter:fv(n.params),value:n.value,viewProps:n.viewProps}):new f_(n.document,{formatter:fv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:wh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function iz(n){var e,t,i;return new WS(n.document,{formatter:fv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:wh.monitor.defaultRows,props:ot.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function Cx(n){return n.view==="graph"}const sz=oi({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=Zt(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>Cx(n)?64:1,reader:n=>XM},controller:n=>Cx(n.params)?iz(n):nz(n),api:n=>n.controller.valueController instanceof WS?new ez(n.controller):null}),rz=oi({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=Zt(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>mS},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new f_(n.document,{formatter:pv,rows:(e=n.params.rows)!==null&&e!==void 0?e:wh.monitor.defaultRows,value:t,viewProps:n.viewProps}):new m_(n.document,{formatter:pv,value:t,viewProps:n.viewProps})}});class oz{constructor(){this.map_=new Map}get(e){var t;return(t=this.map_.get(e))!==null&&t!==void 0?t:null}has(e){return this.map_.has(e)}add(e,t){return this.map_.set(e,t),e.viewProps.handleDispose(()=>{this.map_.delete(e)}),t}}class az{constructor(e){this.target=e.target,this.reader_=e.reader,this.writer_=e.writer}read(){return this.reader_(this.target.read())}write(e){this.writer_(this.target,e)}inject(e){this.write(this.reader_(e))}}function lz(n,e){var t;const i=n.accept(e.target.read(),e.params);if(Ut(i))return null;const s={target:e.target,initialValue:i.initialValue,params:i.params},r=Zt(e.params,u=>({disabled:u.optional.boolean,hidden:u.optional.boolean,label:u.optional.string,tag:u.optional.string})),o=n.binding.reader(s),a=n.binding.constraint?n.binding.constraint(s):void 0,l=new az({reader:o,target:e.target,writer:n.binding.writer(s)}),c=new $3(jt(o(i.initialValue),{constraint:a,equals:n.binding.equals}),l),h=n.controller({constraint:a,document:e.document,initialValue:i.initialValue,params:i.params,value:c,viewProps:nr.create({disabled:r==null?void 0:r.disabled,hidden:r==null?void 0:r.hidden})});return new oF(e.document,{blade:Sl(),props:ot.fromObject({label:"label"in e.params?(t=r==null?void 0:r.label)!==null&&t!==void 0?t:null:e.target.key}),tag:r==null?void 0:r.tag,value:c,valueController:h})}class cz{constructor(e){this.target=e.target,this.reader_=e.reader}read(){return this.reader_(this.target.read())}}function hz(n,e){return e===0?new HF:new GF(n,e??wh.monitor.defaultInterval)}function uz(n,e){var t,i,s;const r=n.accept(e.target.read(),e.params);if(Ut(r))return null;const o={target:e.target,initialValue:r.initialValue,params:r.params},a=Zt(e.params,d=>({bufferSize:d.optional.number,disabled:d.optional.boolean,hidden:d.optional.boolean,interval:d.optional.number,label:d.optional.string})),l=n.binding.reader(o),c=(i=(t=a==null?void 0:a.bufferSize)!==null&&t!==void 0?t:n.binding.defaultBufferSize&&n.binding.defaultBufferSize(r.params))!==null&&i!==void 0?i:1,h=new uF({binding:new cz({reader:l,target:e.target}),bufferSize:c,ticker:hz(e.document,a==null?void 0:a.interval)}),u=n.controller({document:e.document,params:r.params,value:h,viewProps:nr.create({disabled:a==null?void 0:a.disabled,hidden:a==null?void 0:a.hidden})});return u.viewProps.bindDisabled(h.ticker),u.viewProps.handleDispose(()=>{h.ticker.dispose()}),new pF(e.document,{blade:Sl(),props:ot.fromObject({label:"label"in e.params?(s=a==null?void 0:a.label)!==null&&s!==void 0?s:null:e.target.key}),value:h,valueController:u})}class dz{constructor(e){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=e}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e,t){if(!nB(t.core))throw nn.notCompatible(e,t.id);t.type==="blade"?this.pluginsMap_.blades.unshift(t):t.type==="input"?this.pluginsMap_.inputs.unshift(t):t.type==="monitor"&&this.pluginsMap_.monitors.unshift(t)}createInput_(e,t,i){return this.pluginsMap_.inputs.reduce((s,r)=>s??lz(r,{document:e,target:t,params:i}),null)}createMonitor_(e,t,i){return this.pluginsMap_.monitors.reduce((s,r)=>s??uz(r,{document:e,params:i,target:t}),null)}createBinding(e,t,i){const s=t.read();if(Ut(s))throw new nn({context:{key:t.key},type:"nomatchingcontroller"});const r=this.createInput_(e,t,i);if(r)return r;const o=this.createMonitor_(e,t,i);if(o)return o;throw new nn({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const i=this.pluginsMap_.blades.reduce((s,r)=>s??zF(r,{document:e,params:t}),null);if(!i)throw new nn({type:"nomatchingview",context:{params:t}});return i}createInputBindingApi_(e){const t=this.pluginsMap_.inputs.reduce((i,s)=>{var r,o;return i||((o=(r=s.api)===null||r===void 0?void 0:r.call(s,{controller:e}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(e,t??new Uc(e))}createMonitorBindingApi_(e){const t=this.pluginsMap_.monitors.reduce((i,s)=>{var r,o;return i||((o=(r=s.api)===null||r===void 0?void 0:r.call(s,{controller:e}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(e,t??new Uc(e))}createBindingApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(aF(e))return this.createInputBindingApi_(e);if(fF(e))return this.createMonitorBindingApi_(e);throw nn.shouldNeverHappen()}createApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(rF(e))return this.createBindingApi(e);const t=this.pluginsMap_.blades.reduce((i,s)=>i??s.api({controller:e,pool:this}),null);if(!t)throw nn.shouldNeverHappen();return this.apiCache_.add(e,t)}}const pz=new oz;function fz(){const n=new dz(pz);return[VV,WV,qV,YV,RV,SV,MV,bV,oB,QV,rz,sz,bF,IF,dS].forEach(e=>{n.register("core",e)}),n}class mz extends ea{constructor(e){super(e),this.emitter_=new fn,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new fh(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class vz extends ea{}class gz extends ea{constructor(e){super(e),this.emitter_=new fn,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new fh(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class _z extends ea{constructor(e){super(e),this.emitter_=new fn,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new fh(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(e){this.controller.valueController.props.set("formatter",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}const bz=function(){return{id:"list",type:"blade",core:Ml,accept(n){const e=Zt(n,t=>({options:t.required.custom(_h),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string}));return e?{params:e}:null},controller(n){const e=new gh(i_(n.params.options)),t=jt(n.params.value,{constraint:e}),i=new Nr(n.document,{props:new ot({options:e.values.value("options")}),value:t,viewProps:n.viewProps});return new Go(n.document,{blade:n.blade,props:ot.fromObject({label:n.params.label}),value:t,valueController:i})},api(n){return!(n.controller instanceof Go)||!(n.controller.valueController instanceof Nr)?null:new mz(n.controller)}}}();class xz extends hS{constructor(e,t){super(e,t)}get element(){return this.controller.view.element}}class yz extends uv{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const Ax=bt("spr");class wz{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ax()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("hr");i.classList.add(Ax("r")),this.element.appendChild(i)}}class Tx extends $p{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new wz(e,{viewProps:t.viewProps})}))}}const Ez={id:"separator",type:"blade",core:Ml,accept(n){const e=Zt(n,t=>({view:t.required.constant("separator")}));return e?{params:e}:null},controller(n){return new Tx(n.document,{blade:n.blade,viewProps:n.viewProps})},api(n){return n.controller instanceof Tx?new vz(n.controller):null}},Mz={id:"slider",type:"blade",core:Ml,accept(n){const e=Zt(n,t=>({max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number}));return e?{params:e}:null},controller(n){var e,t;const i=(e=n.params.value)!==null&&e!==void 0?e:0,s=new ph({max:n.params.max,min:n.params.min}),r=jt(i,{constraint:s}),o=new Vd(n.document,Object.assign(Object.assign({},gS({formatter:(t=n.params.format)!==null&&t!==void 0?t:V3,keyScale:jt(1),max:s.values.value("max"),min:s.values.value("min"),pointerScale:YM(n.params,i)})),{parser:Qs,value:r,viewProps:n.viewProps}));return new Go(n.document,{blade:n.blade,props:ot.fromObject({label:n.params.label}),value:r,valueController:o})},api(n){return!(n.controller instanceof Go)||!(n.controller.valueController instanceof Vd)?null:new gz(n.controller)}},Sz=function(){return{id:"text",type:"blade",core:Ml,accept(n){const e=Zt(n,t=>({parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string}));return e?{params:e}:null},controller(n){var e;const t=jt(n.params.value),i=new Fc(n.document,{parser:n.params.parse,props:ot.fromObject({formatter:(e=n.params.format)!==null&&e!==void 0?e:s=>String(s)}),value:t,viewProps:n.viewProps});return new Go(n.document,{blade:n.blade,props:ot.fromObject({label:n.params.label}),value:t,valueController:i})},api(n){return!(n.controller instanceof Go)||!(n.controller.valueController instanceof Fc)?null:new _z(n.controller)}}}();function Cz(n){const e=n.createElement("div");return e.classList.add(bt("dfw")()),n.body&&n.body.appendChild(e),e}function Az(n,e,t){if(n.querySelector(`style[data-tp-style=${e}]`))return;const i=n.createElement("style");i.dataset.tpStyle=e,i.textContent=t,n.head.appendChild(i)}let Tz=class extends xz{constructor(e){var t,i;const s=e??{},r=(t=s.document)!==null&&t!==void 0?t:J3(),o=fz(),a=new yz(r,{expanded:s.expanded,blade:Sl(),props:ot.fromObject({title:s.title}),viewProps:nr.create()});super(a,o),this.pool_=o,this.containerElem_=(i=s.container)!==null&&i!==void 0?i:Cz(r),this.containerElem_.appendChild(this.element),this.doc_=r,this.usesDefaultWrapper_=!s.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw nn.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw nn.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){e.css&&Az(this.document,`plugin-${e.id}`,e.css),("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(i=>{this.pool_.register(e.id,i)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{display:block;height:16px;inset:0;margin:auto;opacity:0;position:absolute;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{inset:0;position:absolute}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;inset:0;position:absolute}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);content:"";display:block;inset:0;position:absolute}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin:auto;position:absolute}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin-bottom:auto;margin-top:auto;position:absolute}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);content:"";inset:0 0 2px;pointer-events:none;position:absolute}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[bz,Ez,Mz,dS,Sz]})}};new cS("4.0.5");function v_(n,e){on(e,!1);const[t,i]=qo(),s=()=>fs(f,"$existingParentStore",t),r=()=>fs(p,"$parentStore",t);let o=ie(e,"title",24,()=>{}),a=ie(e,"userExpandable",8,!0),l=ie(e,"expanded",12,!0),c=ie(e,"theme",24,()=>{}),h=ie(e,"scale",8,1),u=ie(e,"userCreatedPane",8,!0),d=ie(e,"tpPane",28,()=>{});const p=Ln(),f=Yt("parentStore");let g=[];Rn("registerPlugin",M=>{var S;d()===void 0?console.warn(`tpPane is undefined, failed to register plugin "${M.id}"`):g.includes(M.id)||((S=d())==null||S.registerPlugin(M),g.push(M.id))}),Rn("userCreatedPane",u()),s()!==void 0&&console.warn("<Panes> must not be nested"),ky(p,new Tz({expanded:l(),title:o()})),r().on("fold",()=>{r().expanded!==void 0&&l()!==r().expanded&&l(r().expanded)}),d(r()),Rn("parentStore",p),Si(()=>{r().dispose()});function v(M){if(d())if(M===1)d().element.style.removeProperty("transform-origin"),d().element.style.removeProperty("transform"),d().element.style.removeProperty("width");else{const S=Math.max(0,M);d(d().element.style.transformOrigin="0 0",!0),d(d().element.style.transform=`scale(${S})`,!0),d(d().element.style.width=`${100/S}%`,!0)}}function x(M){Xd().then(()=>{var S;((S=d())==null?void 0:S.expanded)!==void 0&&M!==void 0&&d().expanded!==M&&d(d().expanded=M,!0)})}tt(()=>Ae(d()),()=>{var M,S;(M=d())!=null&&M.element&&((S=d())==null||S.element.classList.add("svelte-tweakpane-ui"))}),tt(()=>(Ae(d()),Ae(h())),()=>{d()&&v(h())}),tt(()=>(Ae(d()),Ae(a())),()=>{d()&&GM(a(),d().element,"tp-rotv_b","tp-rotv_m")}),tt(()=>(Ae(d()),Ae(o())),()=>{d()&&o()!==void 0&&d(d().title=o().length>0?o():" ",!0)}),tt(()=>(Ae(d()),Ae(c())),()=>{d()&&i3(d().element,c())}),tt(()=>(Ae(d()),Ae(l())),()=>{d()&&x(l())}),ws(),ys();var b=pt(),_=Be(b);{var C=M=>{var S=pt(),P=Be(S);$s(P,e,"default",{}),Pe(M,S)};Pn(_,M=>{M(C)})}Pe(n,b),an(),i()}var Pz=Ft("<div><!></div>");function Xp(n,e){const t=Hn(e,["children","$$slots","$$events","$$legacy"]),i=Hn(t,["expanded","width","tpPane","theme"]);on(e,!1);let s=ie(e,"expanded",28,()=>{}),r=ie(e,"width",24,()=>{}),o=ie(e,"tpPane",28,()=>{}),a=ie(e,"theme",24,()=>({baseBorderRadius:"0px",baseShadowColor:"hsla(0, 0%, 0%, 0)"})),l=Ot();Ur(()=>{if(o()){const p=o().element.parentElement;I(l).append(o().element),p==null||p.remove()}else console.warn("tpPane is undefined")}),ys();var c=Pz();let h;var u=Jn(c),d=un(()=>Hp(i,"position"));v_(u,zn({get theme(){return a()}},()=>I(d),{get expanded(){return s()},set expanded(p){s(p)},get tpPane(){return o()},set tpPane(p){o(p)},children:(p,f)=>{var g=pt(),m=Be(g);$s(m,e,"default",{}),Pe(p,g)},$$slots:{default:!0},$$legacy:!0})),Qn(c),us(c,p=>st(l,p),()=>I(l)),sc(()=>h=_i(c,"",h,{width:r()===void 0?null:`${r()}px`})),Pe(n,c),an()}var Rz=Ft('<div style="display: none;"></div>');function mv(n,e){on(e,!1);const[t,i]=qo(),s=()=>fs(c,"$parentStore",t);let r=ie(e,"title",8,"Button"),o=ie(e,"label",24,()=>{}),a=ie(e,"disabled",8,!1),l=ie(e,"theme",24,()=>{});const c=Yt("parentStore"),h=Yt("userCreatedPane"),u=Fy();let d=Ot(),p=Ot(),f=Ot();function g(){I(p)&&I(p).dispose(),st(p,s().addButton({disabled:a(),index:I(f),label:o(),title:r()})),I(p).on("click",()=>{u("click")})}Ur(()=>{st(f,I(d)?Gg(I(d)):0)}),Si(()=>{var _;(_=I(p))==null||_.dispose()}),tt(()=>(I(f),s(),I(p)),()=>{I(f)!==void 0&&s()&&!I(p)&&g()}),tt(()=>(I(p),Ae(r())),()=>{I(p)&&hs(p,I(p).title=r())}),tt(()=>(I(p),Ae(o())),()=>{I(p)&&hs(p,I(p).label=o())}),tt(()=>(I(p),Ae(a())),()=>{I(p)&&hs(p,I(p).disabled=a())}),tt(()=>(Ae(l()),s(),al),()=>{l()&&s()&&(h||!al(s()))&&console.warn("Set theme on the <Pane> component, not on its children! (Check nested <Button> components for a theme prop.)")}),ws(),ys();var m=pt(),v=Be(m);{var x=_=>{var C=pt(),M=Be(C);{var S=P=>{var E=Rz();us(E,y=>st(d,y),()=>I(d)),Pe(P,E)};Pn(M,P=>{P(S)})}Pe(_,C)},b=_=>{Xp(_,{get theme(){return l()},userCreatedPane:!1,children:(C,M)=>{var S=pt(),P=Be(S);mv(P,{get disabled(){return a()},get label(){return o()},get title(){return r()},$$events:{click(E){cl.call(this,e,E)}}}),Pe(C,S)},$$slots:{default:!0}})};Pn(v,_=>{c?_(x):_(b,!1)})}Pe(n,m),an(),i()}class Lz{constructor(e){this.controller_=e}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get title(){var e;return(e=this.controller_.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller_.emitter.on(e,()=>{i(new Qo(this))}),this}}class Iz extends Qo{constructor(e,t,i){super(e),this.cell=t,this.index=i}}class Dz extends Gr{constructor(e){super(e),this.cellToApiMap_=new Map,this.emitter_=new jn;const t=this.controller.valueController;t.cellControllers.forEach((i,s)=>{const r=new Lz(i);this.cellToApiMap_.set(i,r),i.emitter.on("click",()=>{const o=s%t.size[0],a=Math.floor(s/t.size[0]);this.emitter_.emit("click",{event:new Iz(this,r,[o,a])})})})}cell(e,t){const i=this.controller.valueController,s=i.cellControllers[t*i.size[0]+e];return this.cellToApiMap_.get(s)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s.event)}),this}}class Nz{constructor(e,t){this.size=t.size;const[i,s]=this.size,r=[];for(let o=0;o<s;o++)for(let a=0;a<i;a++){const l=new hM(e,{props:We.fromObject(Object.assign({},t.cellConfig(a,o))),viewProps:Vo.create()});r.push(l)}this.cellCs_=r,this.viewProps=Vo.create(),this.viewProps.handleDispose(()=>{this.cellCs_.forEach(o=>{o.viewProps.set("disposed",!0)})}),this.view=new bM(e,{viewProps:this.viewProps,viewName:"btngrid"}),this.view.element.style.gridTemplateColumns=`repeat(${i}, 1fr)`,this.cellCs_.forEach(o=>{this.view.element.appendChild(o.view.element)})}get cellControllers(){return this.cellCs_}}class Px extends xl{constructor(e,t){const i=t.valueController,s=new ch(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:i.viewProps}),this.valueController=i,this.labelController=s}}Ct({id:"buttongrid",type:"blade",accept(n){const e=Mt(n,t=>({cells:t.required.function,size:t.required.array(t.required.number),view:t.required.constant("buttongrid"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new Px(n.document,{blade:n.blade,labelProps:We.fromObject({label:n.params.label}),valueController:new Nz(n.document,{cellConfig:n.params.cells,size:n.params.size})})},api(n){return n.controller instanceof Px?new Dz(n.controller):null}});class Oz extends Gr{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get value(){return this.controller.valueController.value.rawValue}set value(e){this.controller.valueController.value.rawValue=e}on(e,t){const i=t.bind(this);return this.controller.valueController.value.emitter.on(e,s=>{i(new Dp(this,s.rawValue,s.options.last))}),this}}function Di(n,e,t){return n*(1-t)+e*t}const kz=20,Uz=.001,mm=100;function Fz(n,e){let t=.25,i=.5,s=-1;for(let r=0;r<kz;r++){const[o,a]=n.curve(i);if(i+=t*(o<e?1:-1),s=a,t*=.5,Math.abs(e-o)<Uz)break}return s}class $o{constructor(e=0,t=0,i=1,s=1){this.cache_=[],this.comps_=[e,t,i,s]}get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(e){return kt(e)||!Array.isArray(e)?!1:typeof e[0]=="number"&&typeof e[1]=="number"&&typeof e[2]=="number"&&typeof e[3]=="number"}static equals(e,t){return e.x1===t.x1&&e.y1===t.y1&&e.x2===t.x2&&e.y2===t.y2}curve(e){const t=Di(0,this.x1,e),i=Di(0,this.y1,e),s=Di(this.x1,this.x2,e),r=Di(this.y1,this.y2,e),o=Di(this.x2,1,e),a=Di(this.y2,1,e),l=Di(t,s,e),c=Di(i,r,e),h=Di(s,o,e),u=Di(r,a,e);return[Di(l,h,e),Di(c,u,e)]}y(e){if(this.cache_.length===0){const t=[];for(let i=0;i<mm;i++)t.push(Fz(this,Xe(i,0,mm-1,0,1)));this.cache_=t}return this.cache_[Math.round(Xe(Gt(e,0,1),0,1,0,mm-1))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}}const $S={toComponents:n=>n.toObject(),fromComponents:n=>new $o(...n)};function Bz(n){const e=pn(2);return`cubic-bezier(${n.toObject().map(i=>e(i)).join(", ")})`}const Rx=[0,.5,.5,1];function Vz(n){const e=n.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!e)return new $o(...Rx);const t=[e[1],e[2],e[3],e[4]].reduce((i,s)=>{if(!i)return null;const r=Number(s);return isNaN(r)?null:[...i,r]},[]);return new $o(...t??Rx)}const ho=Ne("cbz");class zz{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ho()),t.viewProps.bindClassModifiers(this.element),t.foldable.bindExpandedClass(this.element,ho(void 0,"expanded")),Mi(t.foldable,"completed",tr(this.element,ho(void 0,"cpl")));const i=e.createElement("div");i.classList.add(ho("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(ho("b")),t.viewProps.bindDisabled(s);const r=e.createElementNS(St,"svg");r.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',s.appendChild(r),i.appendChild(s),this.buttonElement=s;const o=e.createElement("div");if(o.classList.add(ho("t")),i.appendChild(o),this.textElement=o,t.pickerLayout==="inline"){const a=e.createElement("div");a.classList.add(ho("p")),this.element.appendChild(a),this.pickerElement=a}else this.pickerElement=null}}const vm=Ne("cbzp");class Hz{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(vm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(vm("g")),this.element.appendChild(i),this.graphElement=i;const s=e.createElement("div");s.classList.add(vm("t")),this.element.appendChild(s),this.textElement=s}}function jS(n,e){const t=new MutationObserver(s=>{for(const r of s)r.type==="childList"&&r.addedNodes.forEach(o=>{o.contains(o)&&(e(),t.disconnect())})}),i=n.ownerDocument;t.observe(i.body,{attributes:!0,childList:!0,subtree:!0})}const vr=Ne("cbzg");function Gz(n,e){return t=>e(n(t))}class Wz{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(vr()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(vr("p")),this.element.appendChild(i),this.previewElement=i;const s=e.createElementNS(St,"svg");s.classList.add(vr("g")),this.element.appendChild(s),this.svgElem_=s;const r=e.createElementNS(St,"path");r.classList.add(vr("u")),this.svgElem_.appendChild(r),this.guideElem_=r;const o=e.createElementNS(St,"polyline");o.classList.add(vr("l")),this.svgElem_.appendChild(o),this.lineElem_=o,this.handleElems_=[e.createElement("div"),e.createElement("div")],this.handleElems_.forEach(a=>{a.classList.add(vr("h")),this.element.appendChild(a)}),this.vectorElems_=[e.createElementNS(St,"line"),e.createElementNS(St,"line")],this.vectorElems_.forEach(a=>{a.classList.add(vr("v")),this.svgElem_.appendChild(a)}),this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=t.selection,this.handleElems_.forEach((a,l)=>{Bi(this.sel_,Gz(c=>c===l,tr(a,vr("h","sel"))))}),jS(this.element,()=>{this.refresh()})}getVertMargin_(e){return e*.25}valueToPosition(e,t){const{clientWidth:i,clientHeight:s}=this.element,r=this.getVertMargin_(s);return{x:Xe(e,0,1,0,i),y:Xe(t,0,1,s-r,r)}}positionToValue(e,t){const i=this.element.getBoundingClientRect(),s=i.width,r=i.height,o=this.getVertMargin_(r);return{x:Gt(Xe(e,0,s,0,1),0,1),y:Xe(t,r-o,o,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map(r=>{const o=this.valueToPosition(0,r),a=this.valueToPosition(1,r);return[`M ${o.x},${o.y}`,`L ${a.x},${a.y}`].join(" ")}).join(" "));const e=this.value_.rawValue,t=[];let i=0;for(;;){const r=this.valueToPosition(...e.curve(i));if(t.push([r.x,r.y].join(",")),i>=1)break;i=Math.min(i+.05,1)}this.lineElem_.setAttributeNS(null,"points",t.join(" "));const s=e.toObject();[0,1].forEach(r=>{const o=this.valueToPosition(r,r),a=this.valueToPosition(s[r*2],s[r*2+1]),l=this.vectorElems_[r];l.setAttributeNS(null,"x1",String(o.x)),l.setAttributeNS(null,"y1",String(o.y)),l.setAttributeNS(null,"x2",String(a.x)),l.setAttributeNS(null,"y2",String(a.y));const c=this.handleElems_[r];c.style.left=`${a.x}px`,c.style.top=`${a.y}px`})}onValueChange_(){this.refresh()}}const Lx=24,Ix=400,Dx=1e3,Ca=Ne("cbzprv");class $z{constructor(e,t){this.stopped_=!0,this.startTime_=-1,this.requestId_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Ca()),t.viewProps.bindClassModifiers(this.element);const i=e.createElementNS(St,"svg");i.classList.add(Ca("g")),this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(St,"path");s.classList.add(Ca("t")),this.svgElem_.appendChild(s),this.ticksElem_=s;const r=e.createElement("div");r.classList.add(Ca("m")),this.element.appendChild(r),this.markerElem_=r,this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_),t.viewProps.handleDispose(this.onDispose_),jS(this.element,()=>{this.refresh()})}play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add(Ca("m","a")),this.startTime_=new Date().getTime()+Ix,this.stopped_=!1,this.requestId_=requestAnimationFrame(this.onTimer_)}stop(){cancelAnimationFrame(this.requestId_),this.stopped_=!0,this.markerElem_.classList.remove(Ca("m","a"))}onDispose_(){this.stop()}updateMarker_(e){const t=this.value_.rawValue.y(Gt(e,0,1));this.markerElem_.style.left=`${t*100}%`}refresh(){const{clientWidth:e,clientHeight:t}=this.svgElem_,i=[],s=this.value_.rawValue;for(let r=0;r<Lx;r++){const o=Xe(r,0,Lx-1,0,1),a=Xe(s.y(o),0,1,0,e);i.push(`M ${a},0 v${t}`)}this.ticksElem_.setAttributeNS(null,"d",i.join(" "))}onTimer_(){if(this.startTime_===null)return;const e=new Date().getTime()-this.startTime_,t=e/Dx;this.updateMarker_(t),e>Dx+Ix&&this.stop(),this.stopped_||(this.requestId_=requestAnimationFrame(this.onTimer_))}onValueChange_(){this.refresh(),this.play()}}function vv(n,e,t,i){const s=t-n,r=i-e;return Math.sqrt(s*s+r*r)}function jz(n,e,t,i){const s=vv(n,e,t,i),r=Math.atan2(i-e,t-n),o=Math.round(r/(Math.PI/4))*Math.PI/4;return{x:n+Math.cos(o)*s,y:e+Math.sin(o)*s}}class Xz{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.keyScale_=t.keyScale,this.value=t.value,this.sel_=$t(0),this.viewProps=t.viewProps,this.view=new Wz(e,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_),this.prevView_=new $z(e,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",s=>{s.stopImmediatePropagation(),s.preventDefault(),this.prevView_.play()}),this.view.previewElement.appendChild(this.prevView_.element);const i=new vn(this.view.element);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(e,t,i){const s=this.sel_.rawValue,r=this.value.rawValue.toObject(),o=this.view.positionToValue(e.x,e.y),a=t?jz(s,s,o.x,o.y):o;r[s*2]=a.x,r[s*2+1]=a.y,this.value.setRawValue(new $o(...r),i)}onPointerDown_(e){const t=e.data;if(!t.point)return;const i=this.value.rawValue,s=this.view.valueToPosition(i.x1,i.y1),r=vv(t.point.x,t.point.y,s.x,s.y),o=this.view.valueToPosition(i.x2,i.y2),a=vv(t.point.x,t.point.y,o.x,o.y);this.sel_.rawValue=r<=a?0:1,this.updateValue_(t.point,e.shiftKey,{forceEmit:!1,last:!1})}onPointerMove_(e){const t=e.data;t.point&&this.updateValue_(t.point,e.shiftKey,{forceEmit:!1,last:!1})}onPointerUp_(e){const t=e.data;t.point&&this.updateValue_(t.point,e.shiftKey,{forceEmit:!0,last:!0})}onKeyDown_(e){Dc(e.key)&&e.preventDefault();const t=this.sel_.rawValue,i=this.value.rawValue.toObject(),s=this.keyScale_.rawValue;i[t*2]+=dn(s,Gi(e)),i[t*2+1]+=dn(s,Ir(e)),this.value.setRawValue(new $o(...i),{forceEmit:!1,last:!1})}onKeyUp_(e){Dc(e.key)&&e.preventDefault();const t=this.keyScale_.rawValue,i=dn(t,Gi(e)),s=dn(t,Ir(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class qz{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Hz(e,{viewProps:this.viewProps}),this.gc_=new Xz(e,{keyScale:t.axis.textProps.value("keyScale"),value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);const i=Object.assign(Object.assign({},t.axis),{constraint:new Ip({max:1,min:0})}),s=Object.assign(Object.assign({},t.axis),{constraint:void 0});this.tc_=new $r(e,{assembly:$S,axes:[i,s,i,s],parser:Wn,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map(e=>e.inputElement)]}refresh(){this.gc_.refresh()}}class Nx{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=hh.create(t.expanded),this.view=new zz(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new Bp(e,{parser:Vz,props:We.fromObject({formatter:Bz}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_=t.pickerLayout==="popup"?new Fp(e,{viewProps:this.viewProps}):null;const i=new qz(e,{axis:t.axis,value:this.value,viewProps:this.viewProps});i.allFocusableElements.forEach(s=>{s.addEventListener("blur",this.onPopupChildBlur_),s.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Bi(this.popC_.shows,s=>{s&&i.refresh()}),Wr({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:s=>s,backward:(s,r)=>r})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),uh(this.foldable_,this.view.pickerElement))}onButtonBlur_(e){if(!this.popC_)return;const t=e.relatedTarget;(!t||!this.popC_.view.element.contains(t))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Op(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!lh(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_&&e.key==="Escape"&&(this.popC_.shows.rawValue=!1)}}function Kz(){return new Dr({assembly:$S,components:[0,1,2,3].map(n=>n%2===0?new Ip({min:0,max:1}):void 0)})}Ct({id:"cubicbezier",type:"blade",accept(n){const e=Mt(n,t=>({value:t.required.array(t.required.number),view:t.required.constant("cubicbezier"),expanded:t.optional.boolean,label:t.optional.string,picker:t.optional.custom(i=>i==="inline"||i==="popup"?i:void 0)}));return e?{params:e}:null},controller(n){var e,t;const i=new $o(...n.params.value),s=$t(i,{constraint:Kz(),equals:$o.equals}),r=new Nx(n.document,{axis:{textProps:We.fromObject({keyScale:.1,pointerScale:.01,formatter:pn(2)})},expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps});return new Nd(n.document,{blade:n.blade,props:We.fromObject({label:n.params.label}),value:s,valueController:r})},api(n){return!(n.controller instanceof Nd)||!(n.controller.valueController instanceof Nx)?null:new Oz(n.controller)}});class Yz extends Gr{get fps(){return this.controller.valueController.fps}get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}begin(){this.controller.valueController.begin()}end(){this.controller.valueController.end()}on(e,t){const i=t.bind(this);return this.controller.valueController.ticker.emitter.on(e,()=>{i(new Qo(this))}),this}}const Ox=20;class Zz{constructor(){this.start_=null,this.duration_=0,this.fps_=null,this.frameCount_=0,this.timestamps_=[]}get duration(){return this.duration_}get fps(){return this.fps_}begin(e){this.start_=e.getTime()}calculateFps_(e){if(this.timestamps_.length===0)return null;const t=this.timestamps_[0];return 1e3*(this.frameCount_-t.frameCount)/(e-t.time)}compactTimestamps_(){if(this.timestamps_.length<=Ox)return;const e=this.timestamps_.length-Ox;this.timestamps_.splice(0,e);const t=this.timestamps_[0].frameCount;this.timestamps_.forEach(i=>{i.frameCount-=t}),this.frameCount_-=t}end(e){if(this.start_===null)return;const t=e.getTime();this.duration_=t-this.start_,this.start_=null,this.fps_=this.calculateFps_(t),this.timestamps_.push({frameCount:this.frameCount_,time:t}),++this.frameCount_,this.compactTimestamps_()}}const Yl=Ne("fps");class Jz{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Yl()),t.viewProps.bindClassModifiers(this.element),this.graphElement=e.createElement("div"),this.graphElement.classList.add(Yl("g")),this.element.appendChild(this.graphElement);const i=e.createElement("div");i.classList.add(Yl("l")),this.element.appendChild(i);const s=e.createElement("span");s.classList.add(Yl("v")),s.textContent="--",i.appendChild(s),this.valueElement=s;const r=e.createElement("span");r.classList.add(Yl("u")),r.textContent="FPS",i.appendChild(r)}}class Qz{constructor(e,t){this.stopwatch_=new Zz,this.onTick_=this.onTick_.bind(this),this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.props=t.props,this.value_=t.value,this.viewProps=t.viewProps,this.view=new Jz(e,{viewProps:this.viewProps}),this.graphC_=new Hg(e,{formatter:pn(0),props:this.props,rows:t.rows,value:this.value_,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.graphC_.view.element),this.viewProps.handleDispose(()=>{this.graphC_.viewProps.set("disposed",!0),this.ticker.dispose()})}get fps(){return this.stopwatch_.fps}begin(){this.stopwatch_.begin(new Date)}end(){this.stopwatch_.end(new Date)}onTick_(){const e=this.fps;if(e!==null){const t=this.value_.rawValue;this.value_.rawValue=MO(t,e),this.view.valueElement.textContent=e.toFixed(0)}}}class kx extends xl{constructor(e,t){const i=t.valueController,s=new ch(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:i.viewProps}),this.valueController=i,this.labelController=s}}function eH(n,e){return e===0?new mM:new vM(n,e??wl.monitor.defaultInterval)}Ct({id:"fpsgraph",type:"blade",accept(n){const e=Mt(n,t=>({view:t.required.constant("fpsgraph"),interval:t.optional.number,label:t.optional.string,rows:t.optional.number,max:t.optional.number,min:t.optional.number}));return e?{params:e}:null},controller(n){var e,t,i,s;const r=(e=n.params.interval)!==null&&e!==void 0?e:500;return new kx(n.document,{blade:n.blade,labelProps:We.fromObject({label:n.params.label}),valueController:new Qz(n.document,{props:We.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:90,min:(i=n.params.min)!==null&&i!==void 0?i:0}),rows:(s=n.params.rows)!==null&&s!==void 0?s:2,ticker:eH(n.document,r),value:$t(wO(80)),viewProps:n.viewProps})})},api(n){return n.controller instanceof kx?new Yz(n.controller):null}});class Vi{constructor(e,t){this.min=e,this.max=t}static isObject(e){if(typeof e!="object"||e===null)return!1;const t=e.min,i=e.max;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.min===t.min&&e.max===t.max}get length(){return this.max-this.min}toObject(){return{min:this.min,max:this.max}}}const XS={fromComponents:n=>new Vi(n[0],n[1]),toComponents:n=>[n.min,n.max]};class qS{constructor(e){this.edge=e}constrain(e){var t,i,s,r,o,a,l,c;if(e.min<=e.max)return new Vi((i=(t=this.edge)===null||t===void 0?void 0:t.constrain(e.min))!==null&&i!==void 0?i:e.min,(r=(s=this.edge)===null||s===void 0?void 0:s.constrain(e.max))!==null&&r!==void 0?r:e.max);const h=(e.min+e.max)/2;return new Vi((a=(o=this.edge)===null||o===void 0?void 0:o.constrain(h))!==null&&a!==void 0?a:h,(c=(l=this.edge)===null||l===void 0?void 0:l.constrain(h))!==null&&c!==void 0?c:h)}}const gm=Ne("rsltxt");class tH{constructor(e,t){this.sliderView_=t.sliderView,this.textView_=t.textView,this.element=e.createElement("div"),this.element.classList.add(gm());const i=e.createElement("div");i.classList.add(gm("s")),i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(gm("t")),s.appendChild(this.textView_.element),this.element.appendChild(s)}}const uo=Ne("rsl");class nH{constructor(e,t){this.onSliderPropsChange_=this.onSliderPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.sliderProps_=t.sliderProps,this.sliderProps_.emitter.on("change",this.onSliderPropsChange_),this.element=e.createElement("div"),this.element.classList.add(uo()),t.viewProps.bindClassModifiers(this.element),this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_);const i=e.createElement("div");i.classList.add(uo("t")),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(uo("b")),i.appendChild(s),this.barElement=s;const r=["min","max"].map(o=>{const a=e.createElement("div");return a.classList.add(uo("k"),uo("k",o)),i.appendChild(a),a});this.knobElements=[r[0],r[1]],this.update_()}valueToX_(e){const t=this.sliderProps_.get("min"),i=this.sliderProps_.get("max");return Gt(Xe(e,t,i,0,1),0,1)*100}update_(){const e=this.value_.rawValue;e.length===0?this.element.classList.add(uo(void 0,"zero")):this.element.classList.remove(uo(void 0,"zero"));const t=[this.valueToX_(e.min),this.valueToX_(e.max)];this.barElement.style.left=`${t[0]}%`,this.barElement.style.right=`${100-t[1]}%`,this.knobElements.forEach((i,s)=>{i.style.left=`${t[s]}%`})}onSliderPropsChange_(){this.update_()}onValueChange_(){this.update_()}}class iH{constructor(e,t){this.grabbing_=null,this.grabOffset_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.sliderProps=t.sliderProps,this.viewProps=t.viewProps,this.value=t.value,this.view=new nH(e,{sliderProps:this.sliderProps,value:this.value,viewProps:t.viewProps});const i=new vn(this.view.trackElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}ofs_(){return this.grabbing_==="min"?this.view.knobElements[0].getBoundingClientRect().width/2:this.grabbing_==="max"?-this.view.knobElements[1].getBoundingClientRect().width/2:0}valueFromData_(e){if(!e.point)return null;const t=(e.point.x+this.ofs_())/e.bounds.width,i=this.sliderProps.get("min"),s=this.sliderProps.get("max");return Xe(t,0,1,i,s)}onPointerDown_(e){if(!e.data.point)return;const t=e.data.point.x/e.data.bounds.width,i=this.value.rawValue,s=this.sliderProps.get("min"),r=this.sliderProps.get("max"),o=Xe(i.min,s,r,0,1),a=Xe(i.max,s,r,0,1);Math.abs(a-t)<=.025?this.grabbing_="max":Math.abs(o-t)<=.025?this.grabbing_="min":t>=o&&t<=a?(this.grabbing_="length",this.grabOffset_=Xe(t-o,0,1,0,r-s)):t<o?(this.grabbing_="min",this.onPointerMove_(e)):t>a&&(this.grabbing_="max",this.onPointerMove_(e))}applyPointToValue_(e,t){const i=this.valueFromData_(e);if(i===null)return;const s=this.sliderProps.get("min"),r=this.sliderProps.get("max");if(this.grabbing_==="min")this.value.setRawValue(new Vi(i,this.value.rawValue.max),t);else if(this.grabbing_==="max")this.value.setRawValue(new Vi(this.value.rawValue.min,i),t);else if(this.grabbing_==="length"){const o=this.value.rawValue.length;let a=i-this.grabOffset_,l=a+o;a<s?(a=s,l=s+o):l>r&&(a=r-o,l=r),this.value.setRawValue(new Vi(a,l),t)}}onPointerMove_(e){this.applyPointToValue_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.applyPointToValue_(e.data,{forceEmit:!0,last:!0}),this.grabbing_=null}}class sH{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sc_=new iH(e,t);const i={constraint:t.constraint,textProps:t.textProps};this.tc_=new $r(e,{assembly:XS,axes:[i,i],parser:t.parser,value:this.value,viewProps:t.viewProps}),this.view=new tH(e,{sliderView:this.sc_.view,textView:this.tc_.view})}get textController(){return this.tc_}}function rH(n){return Vi.isObject(n)?new Vi(n.min,n.max):new Vi(0,0)}function oH(n,e){n.writeProperty("max",e.max),n.writeProperty("min",e.min)}function aH(n){const e=[],t=oh(n);t&&e.push(t);const i=rh(n);return i&&e.push(i),new qS(new Ms(e))}Ct({id:"input-interval",type:"input",accept:(n,e)=>{if(!Vi.isObject(n))return null;const t=Mt(e,i=>Object.assign(Object.assign({},ah(i)),{readonly:i.optional.constant(!1)}));return t?{initialValue:new Vi(n.min,n.max),params:t}:null},binding:{reader:n=>rH,constraint:n=>aH(n.params),equals:Vi.equals,writer:n=>oH},controller(n){const e=n.value,t=n.constraint;if(!(t instanceof qS))throw Hi.shouldNeverHappen();const i=(e.rawValue.min+e.rawValue.max)/2,s=We.fromObject(bl(n.params,i)),r=t.edge&&Ic(t.edge,ih);if(r)return new sH(n.document,{constraint:t.edge,parser:Wn,sliderProps:new We({keyScale:s.value("keyScale"),max:r.values.value("max"),min:r.values.value("min")}),textProps:s,value:e,viewProps:n.viewProps});const o={constraint:t.edge,textProps:s};return new $r(n.document,{assembly:XS,axes:[o,o],parser:Wn,value:e,viewProps:n.viewProps})}});class lH{constructor(e){this.controller_=e}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get title(){var e;return(e=this.controller_.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.props.set("title",e)}}class cH extends Dp{constructor(e,t,i,s,r){super(e,s,r),this.cell=t,this.index=i}}class hH extends Gr{constructor(e){super(e),this.cellToApiMap_=new Map,this.controller.valueController.cellControllers.forEach(i=>{const s=new lH(i);this.cellToApiMap_.set(i,s)})}get value(){return this.controller.value}cell(e,t){const i=this.controller.valueController,s=i.cellControllers[t*i.size[0]+e];return this.cellToApiMap_.get(s)}on(e,t){const i=t.bind(this);this.controller.value.emitter.on(e,s=>{const r=this.controller.valueController,o=r.findCellByValue(s.rawValue);if(!o)return;const a=this.cellToApiMap_.get(o);if(!a)return;const l=r.cellControllers.indexOf(o);i(new cH(this,a,[l%r.size[0],Math.floor(l/r.size[0])],s.rawValue))})}}const Zl=Ne("rad");class uH{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Zl()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(Zl("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(Zl("i")),s.name=t.name,s.type="radio",t.viewProps.bindDisabled(s),i.appendChild(s),this.inputElement=s;const r=e.createElement("div");r.classList.add(Zl("b")),i.appendChild(r);const o=e.createElement("div");o.classList.add(Zl("t")),r.appendChild(o),Mi(t.props,"title",a=>{o.textContent=a})}}class dH{constructor(e,t){this.props=t.props,this.viewProps=t.viewProps,this.view=new uH(e,{name:t.name,props:this.props,viewProps:this.viewProps})}}class gv{constructor(e,t){this.cellCs_=[],this.cellValues_=[],this.onCellInputChange_=this.onCellInputChange_.bind(this),this.size=t.size;const[i,s]=this.size;for(let r=0;r<s;r++)for(let o=0;o<i;o++){const a=new dH(e,{name:t.groupName,props:We.fromObject(Object.assign({},t.cellConfig(o,r))),viewProps:Vo.create()});this.cellCs_.push(a),this.cellValues_.push(t.cellConfig(o,r).value)}this.value=t.value,Bi(this.value,r=>{const o=this.findCellByValue(r);o&&(o.view.inputElement.checked=!0)}),this.viewProps=Vo.create(),this.view=new bM(e,{viewProps:this.viewProps,viewName:"radgrid"}),this.view.element.style.gridTemplateColumns=`repeat(${i}, 1fr)`,this.cellCs_.forEach(r=>{r.view.inputElement.addEventListener("change",this.onCellInputChange_),this.view.element.appendChild(r.view.element)})}get cellControllers(){return this.cellCs_}findCellByValue(e){const t=this.cellValues_.findIndex(i=>i===e);return t<0?null:this.cellCs_[t]}onCellInputChange_(e){const t=e.currentTarget,i=this.cellCs_.findIndex(s=>s.view.inputElement===t);i<0||(this.value.rawValue=this.cellValues_[i])}}(function(){return Ct({id:"radiogrid",type:"blade",accept(n){const e=Mt(n,t=>({cells:t.required.function,groupName:t.required.string,size:t.required.array(t.required.number),value:t.required.raw,view:t.required.constant("radiogrid"),label:t.optional.string}));return e?{params:e}:null},controller(n){const e=$t(n.params.value);return new Nd(n.document,{blade:n.blade,props:We.fromObject({label:n.params.label}),value:e,valueController:new gv(n.document,{groupName:n.params.groupName,cellConfig:n.params.cells,size:n.params.size,value:e})})},api(n){return!(n.controller instanceof Nd)||!(n.controller.valueController instanceof gv)?null:new hH(n.controller)}})})();function g_(n){return Ct({id:"input-radiogrid",type:"input",accept(e,t){if(!n.isType(e))return null;const i=Mt(t,s=>({cells:s.required.function,groupName:s.required.string,size:s.required.array(s.required.number),view:s.required.constant("radiogrid")}));return i?{initialValue:e,params:i}:null},binding:n.binding,controller:e=>new gv(e.document,{cellConfig:e.params.cells,groupName:e.params.groupName,size:e.params.size,value:e.value})})}g_({isType:n=>typeof n=="number",binding:{reader:n=>sh,writer:n=>Ss}});g_({isType:n=>typeof n=="string",binding:{reader:n=>Rg,writer:n=>Ss}});g_({isType:n=>typeof n=="boolean",binding:{reader:n=>Pg,writer:n=>Ss}});var pH=Function.prototype.toString,_m=Object.create,fH=Object.prototype.toString,mH=function(){function n(){this._keys=[],this._values=[]}return n.prototype.has=function(e){return!!~this._keys.indexOf(e)},n.prototype.get=function(e){return this._values[this._keys.indexOf(e)]},n.prototype.set=function(e,t){this._keys.push(e),this._values.push(t)},n}();function vH(){return new mH}function gH(){return new WeakMap}var _H=typeof WeakMap<"u"?gH:vH;function __(n){if(!n)return _m(null);var e=n.constructor;if(e===Object)return n===Object.prototype?{}:_m(n);if(e&&~pH.call(e).indexOf("[native code]"))try{return new e}catch{}return _m(n)}function bH(n){var e="";return n.global&&(e+="g"),n.ignoreCase&&(e+="i"),n.multiline&&(e+="m"),n.unicode&&(e+="u"),n.sticky&&(e+="y"),e}function xH(n){return n.flags}var yH=/test/g.flags==="g"?xH:bH;function KS(n){var e=fH.call(n);return e.substring(8,e.length-1)}function wH(n){return n[Symbol.toStringTag]||KS(n)}var EH=typeof Symbol<"u"?wH:KS,MH=Object.defineProperty,SH=Object.getOwnPropertyDescriptor,YS=Object.getOwnPropertyNames,b_=Object.getOwnPropertySymbols,ZS=Object.prototype,JS=ZS.hasOwnProperty,CH=ZS.propertyIsEnumerable,QS=typeof b_=="function";function AH(n){return YS(n).concat(b_(n))}var TH=QS?AH:YS;function qp(n,e,t){for(var i=TH(n),s=0,r=i.length,o=void 0,a=void 0;s<r;++s)if(o=i[s],!(o==="callee"||o==="caller")){if(a=SH(n,o),!a){e[o]=t.copier(n[o],t);continue}!a.get&&!a.set&&(a.value=t.copier(a.value,t));try{MH(e,o,a)}catch{e[o]=a.value}}return e}function PH(n,e){var t=new e.Constructor;e.cache.set(n,t);for(var i=0,s=n.length;i<s;++i)t[i]=e.copier(n[i],e);return t}function RH(n,e){var t=new e.Constructor;return e.cache.set(n,t),qp(n,t,e)}function eC(n,e){return n.slice(0)}function LH(n,e){return n.slice(0,n.size,n.type)}function IH(n,e){return new e.Constructor(eC(n.buffer))}function DH(n,e){return new e.Constructor(n.getTime())}function tC(n,e){var t=new e.Constructor;return e.cache.set(n,t),n.forEach(function(i,s){t.set(s,e.copier(i,e))}),t}function NH(n,e){return qp(n,tC(n,e),e)}function OH(n,e){var t=__(e.prototype);e.cache.set(n,t);for(var i in n)JS.call(n,i)&&(t[i]=e.copier(n[i],e));return t}function kH(n,e){var t=__(e.prototype);e.cache.set(n,t);for(var i in n)JS.call(n,i)&&(t[i]=e.copier(n[i],e));for(var s=b_(n),r=0,o=s.length,a=void 0;r<o;++r)a=s[r],CH.call(n,a)&&(t[a]=e.copier(n[a],e));return t}var UH=QS?kH:OH;function FH(n,e){var t=__(e.prototype);return e.cache.set(n,t),qp(n,t,e)}function bm(n,e){return new e.Constructor(n.valueOf())}function BH(n,e){var t=new e.Constructor(n.source,yH(n));return t.lastIndex=n.lastIndex,t}function Vu(n,e){return n}function nC(n,e){var t=new e.Constructor;return e.cache.set(n,t),n.forEach(function(i){t.add(e.copier(i,e))}),t}function VH(n,e){return qp(n,nC(n,e),e)}var zH=Array.isArray,x_=Object.assign,HH=Object.getPrototypeOf||function(n){return n.__proto__},iC={array:PH,arrayBuffer:eC,blob:LH,dataView:IH,date:DH,error:Vu,map:tC,object:UH,regExp:BH,set:nC},GH=x_({},iC,{array:RH,map:NH,object:FH,set:VH});function WH(n){return{Arguments:n.object,Array:n.array,ArrayBuffer:n.arrayBuffer,Blob:n.blob,Boolean:bm,DataView:n.dataView,Date:n.date,Error:n.error,Float32Array:n.arrayBuffer,Float64Array:n.arrayBuffer,Int8Array:n.arrayBuffer,Int16Array:n.arrayBuffer,Int32Array:n.arrayBuffer,Map:n.map,Number:bm,Object:n.object,Promise:Vu,RegExp:n.regExp,Set:n.set,String:bm,WeakMap:Vu,WeakSet:Vu,Uint8Array:n.arrayBuffer,Uint8ClampedArray:n.arrayBuffer,Uint16Array:n.arrayBuffer,Uint32Array:n.arrayBuffer,Uint64Array:n.arrayBuffer}}function sC(n){var e=x_({},iC,n),t=WH(e),i=t.Array,s=t.Object;function r(o,a){if(a.prototype=a.Constructor=void 0,!o||typeof o!="object")return o;if(a.cache.has(o))return a.cache.get(o);if(a.prototype=HH(o),a.Constructor=a.prototype&&a.prototype.constructor,!a.Constructor||a.Constructor===Object)return s(o,a);if(zH(o))return i(o,a);var l=t[EH(o)];return l?l(o,a):typeof o.then=="function"?o:s(o,a)}return function(a){return r(a,{Constructor:void 0,cache:_H(),copier:r,prototype:void 0})}}function $H(n){return sC(x_({},GH,n))}$H({});var jH=sC({}),XH=Object.getOwnPropertyNames,qH=Object.getOwnPropertySymbols,KH=Object.prototype.hasOwnProperty;function Ux(n,e){return function(i,s,r){return n(i,s,r)&&e(i,s,r)}}function bu(n){return function(t,i,s){if(!t||!i||typeof t!="object"||typeof i!="object")return n(t,i,s);var r=s.cache,o=r.get(t),a=r.get(i);if(o&&a)return o===i&&a===t;r.set(t,i),r.set(i,t);var l=n(t,i,s);return r.delete(t),r.delete(i),l}}function Fx(n){return XH(n).concat(qH(n))}var YH=Object.hasOwn||function(n,e){return KH.call(n,e)};function na(n,e){return n===e||!n&&!e&&n!==n&&e!==e}var ZH="__v",JH="__o",QH="_owner",Bx=Object.getOwnPropertyDescriptor,Vx=Object.keys;function e4(n,e,t){var i=n.length;if(e.length!==i)return!1;for(;i-- >0;)if(!t.equals(n[i],e[i],i,i,n,e,t))return!1;return!0}function t4(n,e){return na(n.getTime(),e.getTime())}function n4(n,e){return n.name===e.name&&n.message===e.message&&n.cause===e.cause&&n.stack===e.stack}function i4(n,e){return n===e}function zx(n,e,t){var i=n.size;if(i!==e.size)return!1;if(!i)return!0;for(var s=new Array(i),r=n.entries(),o,a,l=0;(o=r.next())&&!o.done;){for(var c=e.entries(),h=!1,u=0;(a=c.next())&&!a.done;){if(s[u]){u++;continue}var d=o.value,p=a.value;if(t.equals(d[0],p[0],l,u,n,e,t)&&t.equals(d[1],p[1],d[0],p[0],n,e,t)){h=s[u]=!0;break}u++}if(!h)return!1;l++}return!0}var s4=na;function r4(n,e,t){var i=Vx(n),s=i.length;if(Vx(e).length!==s)return!1;for(;s-- >0;)if(!rC(n,e,t,i[s]))return!1;return!0}function Jl(n,e,t){var i=Fx(n),s=i.length;if(Fx(e).length!==s)return!1;for(var r,o,a;s-- >0;)if(r=i[s],!rC(n,e,t,r)||(o=Bx(n,r),a=Bx(e,r),(o||a)&&(!o||!a||o.configurable!==a.configurable||o.enumerable!==a.enumerable||o.writable!==a.writable)))return!1;return!0}function o4(n,e){return na(n.valueOf(),e.valueOf())}function a4(n,e){return n.source===e.source&&n.flags===e.flags}function Hx(n,e,t){var i=n.size;if(i!==e.size)return!1;if(!i)return!0;for(var s=new Array(i),r=n.values(),o,a;(o=r.next())&&!o.done;){for(var l=e.values(),c=!1,h=0;(a=l.next())&&!a.done;){if(!s[h]&&t.equals(o.value,a.value,o.value,a.value,n,e,t)){c=s[h]=!0;break}h++}if(!c)return!1}return!0}function l4(n,e){var t=n.length;if(e.length!==t)return!1;for(;t-- >0;)if(n[t]!==e[t])return!1;return!0}function c4(n,e){return n.hostname===e.hostname&&n.pathname===e.pathname&&n.protocol===e.protocol&&n.port===e.port&&n.hash===e.hash&&n.username===e.username&&n.password===e.password}function rC(n,e,t,i){return(i===QH||i===JH||i===ZH)&&(n.$$typeof||e.$$typeof)?!0:YH(e,i)&&t.equals(n[i],e[i],i,i,n,e,t)}var h4="[object Arguments]",u4="[object Boolean]",d4="[object Date]",p4="[object Error]",f4="[object Map]",m4="[object Number]",v4="[object Object]",g4="[object RegExp]",_4="[object Set]",b4="[object String]",x4="[object URL]",y4=Array.isArray,Gx=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,Wx=Object.assign,w4=Object.prototype.toString.call.bind(Object.prototype.toString);function E4(n){var e=n.areArraysEqual,t=n.areDatesEqual,i=n.areErrorsEqual,s=n.areFunctionsEqual,r=n.areMapsEqual,o=n.areNumbersEqual,a=n.areObjectsEqual,l=n.arePrimitiveWrappersEqual,c=n.areRegExpsEqual,h=n.areSetsEqual,u=n.areTypedArraysEqual,d=n.areUrlsEqual;return function(f,g,m){if(f===g)return!0;if(f==null||g==null)return!1;var v=typeof f;if(v!==typeof g)return!1;if(v!=="object")return v==="number"?o(f,g,m):v==="function"?s(f,g,m):!1;var x=f.constructor;if(x!==g.constructor)return!1;if(x===Object)return a(f,g,m);if(y4(f))return e(f,g,m);if(Gx!=null&&Gx(f))return u(f,g,m);if(x===Date)return t(f,g,m);if(x===RegExp)return c(f,g,m);if(x===Map)return r(f,g,m);if(x===Set)return h(f,g,m);var b=w4(f);return b===d4?t(f,g,m):b===g4?c(f,g,m):b===f4?r(f,g,m):b===_4?h(f,g,m):b===v4?typeof f.then!="function"&&typeof g.then!="function"&&a(f,g,m):b===x4?d(f,g,m):b===p4?i(f,g,m):b===h4?a(f,g,m):b===u4||b===m4||b===b4?l(f,g,m):!1}}function M4(n){var e=n.circular,t=n.createCustomConfig,i=n.strict,s={areArraysEqual:i?Jl:e4,areDatesEqual:t4,areErrorsEqual:n4,areFunctionsEqual:i4,areMapsEqual:i?Ux(zx,Jl):zx,areNumbersEqual:s4,areObjectsEqual:i?Jl:r4,arePrimitiveWrappersEqual:o4,areRegExpsEqual:a4,areSetsEqual:i?Ux(Hx,Jl):Hx,areTypedArraysEqual:i?Jl:l4,areUrlsEqual:c4};if(t&&(s=Wx({},s,t(s))),e){var r=bu(s.areArraysEqual),o=bu(s.areMapsEqual),a=bu(s.areObjectsEqual),l=bu(s.areSetsEqual);s=Wx({},s,{areArraysEqual:r,areMapsEqual:o,areObjectsEqual:a,areSetsEqual:l})}return s}function S4(n){return function(e,t,i,s,r,o,a){return n(e,t,a)}}function C4(n){var e=n.circular,t=n.comparator,i=n.createState,s=n.equals,r=n.strict;if(i)return function(l,c){var h=i(),u=h.cache,d=u===void 0?e?new WeakMap:void 0:u,p=h.meta;return t(l,c,{cache:d,equals:s,meta:p,strict:r})};if(e)return function(l,c){return t(l,c,{cache:new WeakMap,equals:s,meta:void 0,strict:r})};var o={cache:void 0,equals:s,meta:void 0,strict:r};return function(l,c){return t(l,c,o)}}jr();jr({strict:!0});jr({circular:!0});jr({circular:!0,strict:!0});var oC=jr({createInternalComparator:function(){return na}});jr({strict:!0,createInternalComparator:function(){return na}});jr({circular:!0,createInternalComparator:function(){return na}});jr({circular:!0,createInternalComparator:function(){return na},strict:!0});function jr(n){n===void 0&&(n={});var e=n.circular,t=e===void 0?!1:e,i=n.createInternalComparator,s=n.createState,r=n.strict,o=r===void 0?!1:r,a=M4(n),l=E4(a),c=i?i(l):S4(l);return C4({circular:t,comparator:l,createState:s,equals:c,strict:o})}var A4=Ft('<div style="display: none;"></div>');function aC(n,e){on(e,!1);const[t,i]=qo(),s=()=>fs(f,"$parentStore",t);let r=ie(e,"object",12),o=ie(e,"key",12),a=ie(e,"disabled",12,!1),l=ie(e,"label",28,()=>{}),c=ie(e,"options",28,()=>{}),h=ie(e,"theme",24,()=>{}),u=ie(e,"ref",28,()=>{}),d=ie(e,"plugin",28,()=>{});const p=Yt("registerPlugin"),f=Yt("parentStore"),g=Yt("userCreatedPane");let m=Ot(),v=Ot(),x=Ot();function b(){I(m)&&I(m).dispose(),d()!==void 0&&p(d()),st(m,s().addBinding(r(),o(),{index:I(x),label:l(),...c(),disabled:a()})),u(I(m)),I(m).on("change",y)}Ur(()=>{st(x,I(v)?Gg(I(v)):0)}),Si(()=>{var z;(z=I(m))==null||z.dispose()});const _=Fy();function C(z){if(z instanceof File)return new File([z],z.name,{lastModified:z.lastModified,type:z.type});if(z instanceof HTMLImageElement){const H=new Image;return H.src=z.src,H}return jH(z)}let M=r(),S=C(r()[o()]),P=!1;function E(z){M!==z&&(P=!1),oC(z[o()],S)||(S=C(z[o()]),_("change",{value:C(z[o()]),origin:P?"internal":"external"}),!P&&I(m)&&(I(m).off("change",y),I(m).refresh(),I(m).on("change",y))),P=!1,M!==z&&(M=z,b())}function y(){P=!0,r(r()[o()]=C(r()[o()]),!0)}tt(()=>(I(m),Ae(u())),()=>{}),tt(()=>(Ae(c()),s(),I(x)),()=>{c(),s()!==void 0&&I(x)!==void 0&&b()}),tt(()=>(I(m),Ae(a())),()=>{I(m)!==void 0&&hs(m,I(m).disabled=a())}),tt(()=>(I(m),Ae(l())),()=>{I(m)!==void 0&&hs(m,I(m).label=l())}),tt(()=>(s(),Ae(r())),()=>{s()!==void 0&&E(r())}),tt(()=>(Ae(h()),s(),al),()=>{h()&&s()!==void 0&&(g||!al(s()))&&console.warn("Set theme on the <Pane> component, not on its children! (Check nested <Binding> components for a theme prop.)")}),ws(),ys();var L=pt(),k=Be(L);{var D=z=>{var H=pt(),ne=Be(H);{var G=ae=>{var se=A4();us(se,ge=>st(v,ge),()=>I(v)),Pe(ae,se)};Pn(ne,ae=>{ae(G)})}Pe(z,H)},W=z=>{Xp(z,{get theme(){return h()},userCreatedPane:!1,children:(H,ne)=>{var G=pt(),ae=Be(G);aC(ae,{get disabled(){return a()},set disabled(se){a(se)},get key(){return o()},set key(se){o(se)},get label(){return l()},set label(se){l(se)},get object(){return r()},set object(se){r(se)},get options(){return c()},set options(se){c(se)},get plugin(){return d()},set plugin(se){d(se)},get ref(){return u()},set ref(se){u(se)},$$events:{change(se){cl.call(this,e,se)}},$$legacy:!0}),Pe(H,G)},$$slots:{default:!0}})};Pn(k,z=>{f?z(D):z(W,!1)})}Pe(n,L),an(),i()}function T4(n,e){const t=Hn(e,["children","$$slots","$$events","$$legacy"]),i=Hn(t,["value","ref","options"]);on(e,!1);const s=Ot();let r=ie(e,"value",12),o=ie(e,"ref",28,()=>{}),a=ie(e,"options",24,()=>{});const l=Symbol("key");function c(){return r()}function h(){oC(r(),I(s)[l])||hs(s,I(s)[l]=r())}tt(()=>{},()=>{st(s,{[l]:c()})}),tt(()=>I(s),()=>{r(I(s)[l])}),tt(()=>Ae(r()),()=>{r(),h()}),ws(),ys(),aC(n,zn({key:l,get options(){return a()}},()=>i,{get object(){return I(s)},set object(u){st(s,u)},get ref(){return o()},set ref(u){o(u)},$$events:{change(u){cl.call(this,e,u)}},$$legacy:!0})),an()}function P4(n,e){const t=Hn(e,["children","$$slots","$$events","$$legacy"]),i=Hn(t,["options","ref","value"]);on(e,!1);let s=ie(e,"options",24,()=>{}),r=ie(e,"ref",28,()=>{}),o=ie(e,"value",12),a=Ot();tt(()=>Ae(s()),()=>{st(a,{...s(),readonly:!1})}),ws(),T4(n,zn({get options(){return I(a)}},()=>i,{get value(){return o()},set value(l){o(l)},get ref(){return r()},set ref(l){r(l)},$$events:{change(l){cl.call(this,e,l)}},$$legacy:!0})),an()}const Aa=Ne("ctn"),R4=Ne("input"),L4=Ne("btn");class I4{constructor(e,t){this.element=e.createElement("div"),this.container=e.createElement("div"),this.container.classList.add(Aa()),t.viewProps.bindClassModifiers(this.container),this.input=e.createElement("input"),this.input.classList.add(R4()),this.input.setAttribute("type","file"),this.input.setAttribute("accept",t.filetypes?t.filetypes.join(","):"*"),this.input.style.height=`calc(20px * ${t.lineCount})`,this.fileIcon=e.createElement("div"),this.fileIcon.classList.add(Aa("icon")),this.text=e.createElement("span"),this.text.classList.add(Aa("text")),this.warning=e.createElement("span"),this.warning.classList.add(Aa("warning")),this.warning.innerHTML=t.invalidFiletypeMessage,this.warning.style.display="none",this.deleteButton=e.createElement("button"),this.deleteButton.classList.add(L4("b")),this.deleteButton.innerHTML="Delete",this.deleteButton.style.display="none",this.container.appendChild(this.input),this.container.appendChild(this.fileIcon),this.element.appendChild(this.container),this.element.appendChild(this.warning),this.element.appendChild(this.deleteButton)}changeDraggingState(e){var t,i;e?(t=this.container)===null||t===void 0||t.classList.add(Aa("input_area_dragging")):(i=this.container)===null||i===void 0||i.classList.remove(Aa("input_area_dragging"))}}class D4{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new I4(e,{viewProps:this.viewProps,value:t.value,invalidFiletypeMessage:t.invalidFiletypeMessage,lineCount:t.lineCount,filetypes:t.filetypes}),this.config=t,this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.onDeleteClick=this.onDeleteClick.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.view.deleteButton.addEventListener("click",this.onDeleteClick),this.value.emitter.on("change",()=>this.handleValueChange()),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.element.removeEventListener("drop",this.onDrop),this.view.element.removeEventListener("dragover",this.onDragOver),this.view.element.removeEventListener("dragleave",this.onDragLeave),this.view.deleteButton.removeEventListener("click",this.onDeleteClick)})}onFile(e){const t=this.view.input;if(t.files&&t.files.length>0){const i=t.files[0];this.isFileValid(i)?this.value.setRawValue(i):this.showWarning()}}showWarning(){this.view.warning.style.display="block",setTimeout(()=>{this.view.warning.style.display="none"},5e3)}isFileValid(e){var t;const i=this.config.filetypes,s="."+((t=e.name.split(".").pop())===null||t===void 0?void 0:t.toLowerCase());return!(i&&i.length>0&&!i.includes(s)&&s)}onDeleteClick(){this.value.rawValue&&(this.value.setRawValue(null),this.view.input.value="",this.view.warning.style.display="none")}onDragOver(e){e.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}onDrop(e){if(e instanceof DragEvent&&(e.preventDefault(),e.dataTransfer&&e.dataTransfer.files)){const t=[e.dataTransfer.files][0];if(t.length==1){const i=t.item(0);i&&(this.isFileValid(i)?this.value.setRawValue(i):this.showWarning())}}this.view.changeDraggingState(!1)}handleValueChange(){const e=this.value.rawValue,t=this.view.container,i=this.view.text,s=this.view.fileIcon,r=this.view.deleteButton;e?(i.textContent=e.name,t.appendChild(i),t.contains(s)&&t.removeChild(s),this.view.warning.style.display="none",r.style.display="block",t.style.border="unset"):(i.textContent="",t.appendChild(s),t.removeChild(i),this.view.warning.style.display="none",r.style.display="none",t.style.border="1px dashed #717070")}}Ct({id:"file-input",type:"input",accept(n,e){if(typeof n!="string")return null;const t=Mt(e,i=>({view:i.required.constant("file-input"),invalidFiletypeMessage:i.optional.string,lineCount:i.optional.number,filetypes:i.optional.array(i.required.string)}));return t?{initialValue:n,params:t}:null},binding:{reader(n){return e=>e instanceof File?e:null},constraint(n){return new Ms([])},writer(n){return(e,t)=>{e.write(t)}}},controller(n){var e,t;const s="Unaccepted file type.";return new D4(n.document,{value:n.value,viewProps:n.viewProps,invalidFiletypeMessage:(e=n.params.invalidFiletypeMessage)!==null&&e!==void 0?e:s,lineCount:(t=n.params.lineCount)!==null&&t!==void 0?t:3,filetypes:n.params.filetypes})}});function N4(){const n=`
	<svg width="320" height="50" xmlns="http://www.w3.org/2000/svg">
  <style>
    text {
      font-family: "Menlo", monospace;
      font-size: 12px;
			fill: gray;
    }
  </style>
  <text x="50%" y="55%" text-anchor="middle">
    No Image
  </text>
</svg>`,e=new Blob([n],{type:"image/svg+xml"}),t=new Image;return t.src=URL.createObjectURL(e),t}function $x(n){const e=new Image;return e.crossOrigin="anonymous",e.src=n,e}const po=Ne("img");class O4{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(po()),t.viewProps.bindClassModifiers(this.element),this.input=e.createElement("input"),this.input.classList.add(po("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",t.extensions.join(",")),this.image_=e.createElement("img"),this.image_.id="tpimg_"+Math.random().toString(36).slice(2),this.image_.classList.add(po("image")),this.image_.classList.add(po(`image_${t.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=i=>t.clickCallback?t.clickCallback(i,this.input):this.input.click(),this.element.classList.add(po("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(e){this.image_.src=e}changeDraggingState(e){const t=this.element;e?t==null||t.classList.add(po("area_dragging")):t==null||t.classList.remove(po("area_dragging"))}}let xm=null;class k4{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new O4(e,{viewProps:this.viewProps,extensions:t.extensions,imageFit:t.imageFit,clickCallback:t.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragStart=this.onDragStart.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragstart",this.onDragStart),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.element.removeEventListener("drop",this.onDrop),this.view.element.removeEventListener("dragstart",this.onDragStart),this.view.element.removeEventListener("dragover",this.onDragOver),this.view.element.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",()=>this.handleValueChange()),this.handleValueChange()}onFile(e){const t=(e==null?void 0:e.target).files;if(!t||!t.length)return;const i=t[0];this.setValue(i)}onDrop(e){e.preventDefault();try{const{dataTransfer:t}=e,i=t==null?void 0:t.files[0];if(i)this.setValue(i);else{const s=t==null?void 0:t.getData("img-id");if(s){const r=document.getElementById(s);this.setValue(r)}else{const r=t==null?void 0:t.getData("url");if(!r)throw new Error("No url");this.setValue(r)}}}catch(t){console.error("Could not parse the dropped image",t)}finally{this.view.changeDraggingState(!1)}}onDragStart(e){var t,i;(t=e.dataTransfer)===null||t===void 0||t.setData("img-id",this.view.image_.id),(i=e.dataTransfer)===null||i===void 0||i.setDragImage(this.view.image_,0,0)}onDragOver(e){e.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(e){e instanceof HTMLImageElement?this.updateImage(e.src):typeof e=="string"||!e?((e==="placeholder"||!e)&&(e=this.handlePlaceholderImage().src),this.updateImage(e)):this.setValue(e)}updateImage(e){this.view.changeImage(e)}setValue(e){if(e instanceof HTMLImageElement)this.value.setRawValue(e);else if(e instanceof File){const t=URL.createObjectURL(e)+"#"+e.name;e.src=t;const i=$x(t);this.value.setRawValue(i||e)}else e?this.value.setRawValue($x(e)):this.value.setRawValue(this.handlePlaceholderImage())}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return xm||(xm=N4()),xm}}const U4=[".jpg",".png",".gif"];Ct({id:"input-image",type:"input",accept(n,e){if(!(n instanceof HTMLImageElement||typeof n=="string"))return null;const t=Mt(e,i=>({view:i.required.constant("input-image"),acceptUrl:i.optional.boolean,clickCallback:i.optional.function,imageFit:i.optional.custom(s=>s==="contain"||s==="cover"?s:void 0),extensions:i.optional.array(i.required.string)}));return t?{initialValue:n,params:t}:null},binding:{reader(n){return e=>e.src!==void 0?e.src===""?"placeholder":e.src:e},writer(n){return(e,t)=>{e.write(t)}}},controller(n){var e,t;return new k4(n.document,{value:n.value,imageFit:(e=n.params.imageFit)!==null&&e!==void 0?e:"cover",clickCallback:n.params.clickCallback,viewProps:n.viewProps,extensions:(t=n.params.extensions)!==null&&t!==void 0?t:U4})}});function F4(n,e){const t=Hn(e,["children","$$slots","$$events","$$legacy"]),i=Hn(t,["value","options","min","max","step","pointerScale","keyScale","format","ref"]);on(e,!1);let s=ie(e,"value",12),r=ie(e,"options",24,()=>{}),o=ie(e,"min",24,()=>{}),a=ie(e,"max",24,()=>{}),l=ie(e,"step",24,()=>{}),c=ie(e,"pointerScale",24,()=>{}),h=ie(e,"keyScale",24,()=>{}),u=ie(e,"format",24,()=>{}),d=ie(e,"ref",28,()=>{}),p=Ot(u()),f=Ot();tt(()=>(I(p),Ae(u())),()=>{I(p)!==u()&&st(p,u())}),tt(()=>(Ae(o()),Ae(a()),I(p),Ae(h()),Ae(c()),Ae(l()),Ae(r())),()=>{st(f,{min:o(),max:a(),format:I(p),keyScale:h(),pointerScale:c(),step:l(),...r()})}),ws(),P4(n,zn({get options(){return I(f)}},()=>i,{get value(){return s()},set value(g){s(g)},get ref(){return d()},set ref(g){d(g)},$$events:{change(g){cl.call(this,e,g)}},$$legacy:!0})),an()}const Zi=Ne("ckr");class B4{constructor(e,t){this.tickElems_=[],this.labelElems_=[],this.boundsWidth_=-1,this.onShowsTooltipChange_=this.onShowsTooltipChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.formatters_=t.formatters,this.unit_=t.unit,this.element=e.createElement("div"),this.element.classList.add(Zi(),Zi(void 0,`m${t.seriesId}`)),t.viewProps.bindClassModifiers(this.element),this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_),t.showsTooltip.emitter.on("change",this.onShowsTooltipChange_);const i=e.createElement("div");i.classList.add(Zi("w")),this.element.appendChild(i),this.offsetElem_=e.createElement("div"),this.offsetElem_.classList.add(Zi("o")),i.appendChild(this.offsetElem_),this.svgElem_=e.createElementNS(St,"svg"),this.svgElem_.classList.add(Zi("g")),this.offsetElem_.appendChild(this.svgElem_),this.tooltipElem_=e.createElement("div"),this.tooltipElem_.classList.add(Ne("tt")(),Zi("tt")),this.element.appendChild(this.tooltipElem_),this.waitToBeAdded_()}waitToBeAdded_(){const e=new IntersectionObserver(t=>{t.forEach(i=>{i.target!==this.element||i.intersectionRatio===0||(this.update(),e.disconnect())})},{root:null});e.observe(this.element)}rebuildScaleIfNeeded_(e){if(this.boundsWidth_===e)return;this.boundsWidth_=e,this.tickElems_.forEach(c=>{Lc(c)}),this.tickElems_=[],this.labelElems_.forEach(c=>{Lc(c)}),this.labelElems_=[];const t=this.element.ownerDocument,i=this.unit_.ticks,s=this.unit_.pixels,a=((Math.ceil(e/2/s)+1)*2+1)*i,l=s/i;for(let c=0;c<a;c++){const h=c*l;if(c%i===0){const u=t.createElementNS(St,"line");u.classList.add(Zi("mjt")),u.setAttributeNS(null,"x1",String(h)),u.setAttributeNS(null,"y1","0"),u.setAttributeNS(null,"x2",String(h)),u.setAttributeNS(null,"y2","2"),this.svgElem_.appendChild(u),this.tickElems_.push(u);const d=t.createElement("div");d.classList.add(Zi("l")),d.style.left=`${h}px`,this.offsetElem_.appendChild(d),this.labelElems_.push(d)}else{const u=t.createElementNS(St,"line");u.classList.add(Zi("mnt")),u.setAttributeNS(null,"x1",String(h)),u.setAttributeNS(null,"y1","0"),u.setAttributeNS(null,"x2",String(h)),u.setAttributeNS(null,"y2","2"),this.svgElem_.appendChild(u),this.tickElems_.push(u)}}}updateScale_(e){const t=this.unit_.value,i=this.unit_.pixels,s=this.value_.rawValue,r=Math.ceil(e/2/i)+1,o=s-s%t-t*r,a=c=>1-Math.pow(Gt(Math.abs(s-c)/(e/2*(t/i)),0,1),10);this.labelElems_.forEach((c,h)=>{const u=o+h*t;c.textContent=this.formatters_.ring(u),c.style.opacity=String(a(u))});const l=this.unit_.ticks;this.tickElems_.forEach((c,h)=>{const u=o+h/l*t;c.style.opacity=String(a(u))})}update(){const e=this.element.getBoundingClientRect().width,t=this.unit_.value,i=this.unit_.pixels,s=this.value_.rawValue,r=Math.ceil(e/2/i)+1,o=(s%t+t*r)*(i/t),a=e/2-o;this.offsetElem_.style.transform=`translateX(${a}px)`,this.tooltipElem_.textContent=this.formatters_.text(s),this.rebuildScaleIfNeeded_(e),this.updateScale_(e)}onValueChange_(){this.update()}onShowsTooltipChange_(e){e.rawValue?this.element.classList.add(Zi(void 0,"tt")):this.element.classList.remove(Zi(void 0,"tt"))}}class y_{constructor(e,t){this.ox_=0,this.ov_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.tooltipEnabled_=t.tooltipEnabled,this.unit_=t.unit,this.showsTooltip_=$t(!1),this.view=new B4(e,{formatters:t.formatters,seriesId:t.seriesId,showsTooltip:this.showsTooltip_,unit:t.unit,value:this.value,viewProps:this.viewProps});const i=new vn(this.view.element);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}onPointerDown_(e){const t=e.data;t.point&&(this.ox_=t.point.x,this.ov_=this.value.rawValue,this.tooltipEnabled_&&(this.showsTooltip_.rawValue=!0))}onPointerMove_(e){const t=e.data;if(!t.point)return;const i=t.point.x-this.ox_,s=this.unit_.pixels,r=this.unit_.value;this.value.setRawValue(this.ov_-i/s*r,{forceEmit:!1,last:!1})}onPointerUp_(){this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0}),this.showsTooltip_.rawValue=!1}}const ym=Ne("ckrtxt");class V4{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ym());const i=e.createElement("div");i.classList.add(ym("r")),i.appendChild(t.ringView.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(ym("t")),s.appendChild(t.textView.element),this.element.appendChild(s)}}class lC{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.rc_=new y_(e,{formatters:{ring:t.ringFormatter,text:t.textProps.get("formatter")},seriesId:t.seriesId,tooltipEnabled:!1,unit:t.ringUnit,value:this.value,viewProps:this.viewProps}),this.tc_=new yl(e,{parser:t.parser,props:t.textProps,value:this.value,viewProps:this.viewProps}),this.view=new V4(e,{ringView:this.rc_.view,textView:this.tc_.view})}}function cC(n){const e=[],t=oh(n);t&&e.push(t);const i=rh(n);return i&&e.push(i),new Ms(e)}function z4(n){return n===0||n===1||n===2?n:void 0}function jx(n){return n!==void 0?String(n):"0"}function H4(n){const e=pn(tv(n.value));return t=>{const i=e(t),s=i.substr(0,1);return i+(s==="-"||s==="+"?" ":"")}}Ct({id:"input-ring",type:"input",accept(n,e){if(typeof n!="number")return null;const t=Mt(e,i=>Object.assign(Object.assign({},ah(i)),{series:i.optional.custom(z4),unit:i.optional.object({pixels:i.required.number,ticks:i.required.number,value:i.required.number}),view:i.required.constant("cameraring"),wide:i.optional.boolean}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>sh,constraint:n=>cC(n.params),writer:n=>Ss},controller(n){var e,t,i;const s=(e=n.params.unit)!==null&&e!==void 0?e:{ticks:5,pixels:40,value:10},r=H4(s),o=bl(n.params,n.initialValue);if(n.params.wide)return new y_(n.document,{formatters:{ring:r,text:o.formatter},seriesId:(t=jx(n.params.series))!==null&&t!==void 0?t:"0",tooltipEnabled:!0,unit:s,value:n.value,viewProps:n.viewProps});const a=We.fromObject(o);return new lC(n.document,{parser:Wn,ringFormatter:r,ringUnit:s,seriesId:(i=jx(n.params.series))!==null&&i!==void 0?i:"0",textProps:a,value:n.value,viewProps:n.viewProps})}});Ct({id:"input-wheel",type:"input",accept(n,e){if(typeof n!="number")return null;const t=Mt(e,i=>Object.assign(Object.assign({},ah(i)),{amount:i.optional.number,view:i.required.constant("camerawheel"),wide:i.optional.boolean}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>sh,constraint:n=>cC(n.params),writer:n=>Ss},controller(n){var e,t;const i=pn(0),s=bl(n.params,n.initialValue);return n.params.wide?new y_(n.document,{formatters:{ring:i,text:s.formatter},seriesId:"w",tooltipEnabled:!0,unit:{ticks:10,pixels:40,value:((e=n.params.amount)!==null&&e!==void 0?e:s.pointerScale)*40},value:n.value,viewProps:n.viewProps}):new lC(n.document,{parser:Wn,ringFormatter:i,ringUnit:{ticks:10,pixels:40,value:((t=n.params.amount)!==null&&t!==void 0?t:s.pointerScale)*40},seriesId:"w",textProps:We.fromObject(s),value:n.value,viewProps:n.viewProps})}});class hC{multiply(e){return this.format(this.quat.multiply(e.quat))}premultiply(e){return this.format(e.multiply(this))}slerp(e,t){return this.format(this.quat.slerp(e.quat,t))}}function uC(n,e,t){return Math.min(Math.max(n,e),t)}function G4(n,e){return Math.floor(n/e)*e}function W4(n,e){return n-G4(n,e)}function fc(n){return W4(n+Math.PI,Math.PI*2)-Math.PI}class Tr extends hC{static fromQuaternion(e,t,i){const s=e.toMat3(),[r,o,a,l]=t==="XYZ"?[0,1,2,1]:t==="XZY"?[0,2,1,-1]:t==="YXZ"?[1,0,2,-1]:t==="YZX"?[1,2,0,1]:t==="ZXY"?[2,0,1,1]:[2,1,0,-1],c=[0,0,0],h=s[a+r*3];return c[o]=-l*Math.asin(uC(h,-1,1)),Math.abs(h)<.999999?(c[r]=l*Math.atan2(s[a+o*3],s[a*4]),c[a]=l*Math.atan2(s[o+r*3],s[r*4])):c[r]=l*Math.atan2(-s[o+a*3],s[o*4]),Math.abs(c[r])+Math.abs(c[a])>Math.PI&&(c[r]=fc(c[r]+Math.PI),c[o]=fc(Math.PI-c[o]),c[a]=fc(c[a]+Math.PI)),new Tr(...c,t).reunit(i)}constructor(e,t,i,s,r){super(),this.x=e??0,this.y=t??0,this.z=i??0,this.order=s??"XYZ",this.unit=r??"rad"}get quat(){return yt.fromEuler(this)}getComponents(){return[this.x,this.y,this.z]}toEuler(e,t){return this.reorder(e).reunit(t)}format(e){return e instanceof Tr?e.reorder(this.order):e.toEuler(this.order,this.unit)}reorder(e){return e===this.order?this:this.quat.toEuler(e,this.unit)}reunit(e){const t={deg:Math.PI/180,rad:1,turn:2*Math.PI}[this.unit],i={deg:180/Math.PI,rad:1,turn:.5/Math.PI}[e],s=t*i;return new Tr(s*this.x,s*this.y,s*this.z,this.order,e)}}class yt extends hC{static fromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return new yt(e.x*s,e.y*s,e.z*s,Math.cos(i))}static fromEuler(e){const t=e.reunit("rad"),[i,s,r,o]=t.order==="XYZ"?[0,1,2,1]:t.order==="XZY"?[0,2,1,-1]:t.order==="YXZ"?[1,0,2,-1]:t.order==="YZX"?[1,2,0,1]:t.order==="ZXY"?[2,0,1,1]:[2,1,0,-1],a=t.getComponents(),l=.5*a[i],c=.5*o*a[s],h=.5*a[r],u=Math.cos(l),d=Math.cos(c),p=Math.cos(h),f=Math.sin(l),g=Math.sin(c),m=Math.sin(h),v=[0,0,0,p*d*u+m*g*f];return v[i]=p*d*f-m*g*u,v[s]=o*(p*g*u+m*d*f),v[r]=m*d*u-p*g*f,new yt(...v)}static lookRotation(e,t){const{normal:i,tangent:s,binormal:r}=e.orthoNormalize(t),o=r.x,a=s.x,l=i.x,c=r.y,h=s.y,u=i.y,d=r.z,p=s.z,f=i.z,g=o+h+f;if(g>0){const m=.5/Math.sqrt(g+1);return new yt((p-u)*m,(l-d)*m,(c-a)*m,.25/m)}else if(o>h&&o>f){const m=2*Math.sqrt(1+o-h-f);return new yt(.25*m,(a+c)/m,(l+d)/m,(p-u)/m)}else if(h>f){const m=2*Math.sqrt(1+h-o-f);return new yt((a+c)/m,.25*m,(u+p)/m,(l-d)/m)}else{const m=2*Math.sqrt(1+f-o-h);return new yt((l+d)/m,(u+p)/m,.25*m,(c-a)/m)}}constructor(e,t,i,s){super(),this.x=e??0,this.y=t??0,this.z=i??0,this.w=s??1}get quat(){return this}getComponents(){return[this.x,this.y,this.z,this.w]}toEuler(e,t){return Tr.fromQuaternion(this,e,t)}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const e=this.length;return e===0?new yt:new yt(this.x/e,this.y/e,this.z/e,this.w/e)}get negated(){return new yt(-this.x,-this.y,-this.z,-this.w)}get ban360s(){return this.w<0?this.negated:this}multiply(e){const t=e.quat;return new yt(this.w*t.x+this.x*t.w+this.y*t.z-this.z*t.y,this.w*t.y-this.x*t.z+this.y*t.w+this.z*t.x,this.w*t.z+this.x*t.y-this.y*t.x+this.z*t.w,this.w*t.w-this.x*t.x-this.y*t.y-this.z*t.z)}format(e){return e.quat}slerp(e,t){let i=e.quat;if(t===0)return this;if(t===1)return i;const s=this.ban360s;i=i.ban360s;let r=s.w*i.w+s.x*i.x+s.y*i.y+s.z*i.z;if(r<0&&(i=i.negated,r=-r),r>=1)return s;const o=1-r*r;if(o<=Number.EPSILON){const u=1-t;return new yt(u*s.x+t*i.x,u*s.y+t*i.y,u*s.z+t*i.z,u*s.w+t*i.w).normalized}const a=Math.sqrt(o),l=Math.atan2(a,r),c=Math.sin((1-t)*l)/a,h=Math.sin(t*l)/a;return new yt(s.x*c+i.x*h,s.y*c+i.y*h,s.z*c+i.z*h,s.w*c+i.w*h)}toMat3(){const{x:e,y:t,z:i,w:s}=this;return[1-2*t*t-2*i*i,2*e*t+2*i*s,2*e*i-2*t*s,2*e*t-2*i*s,1-2*e*e-2*i*i,2*t*i+2*e*s,2*e*i+2*t*s,2*t*i-2*e*s,1-2*e*e-2*t*t]}}class dC{constructor(){this.offset=[0,0,-5],this.fov=30,this.aspect=1,this.viewport=[0,0,1,1]}project(e){const t=(this.viewport[0]+this.viewport[2])*.5,i=(this.viewport[1]+this.viewport[3])*.5,s=this.viewport[2]-this.viewport[0],r=this.viewport[3]-this.viewport[1],o=1/Math.tan(this.fov*Math.PI/360),a=-(e.z+this.offset[2]),l=t+(e.x+this.offset[0])/a*o*s*.5/this.aspect,c=i-(e.y+this.offset[1])/a*o*r*.5;return[l,c]}}class zt{constructor(e,t,i){this.element=e.createElementNS(St,"path"),this.vertices=t,this.projector=i}setRotation(e){let t="";return this.vertices.forEach((i,s)=>{const r=i.applyQuaternion(e),[o,a]=this.projector.project(r);t+=`${s===0?"M":"L"}${o} ${a}`}),this.element.setAttributeNS(null,"d",t),this}}class wt{constructor(e,t,i){this.x=e??0,this.y=t??0,this.z=i??0}getComponents(){return[this.x,this.y,this.z]}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const e=this.length;return e===0?new wt:new wt(this.x/e,this.y/e,this.z/e)}get negated(){return new wt(-this.x,-this.y,-this.z)}add(e){return new wt(this.x+e.x,this.y+e.y,this.z+e.z)}sub(e){return new wt(this.x-e.x,this.y-e.y,this.z-e.z)}scale(e){return new wt(this.x*e,this.y*e,this.z*e)}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}cross(e){return new wt(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}orthoNormalize(e){const t=this.normalized;e=e.normalized;let i=t.dot(e);i===1&&(Math.abs(t.y)>Math.abs(t.z)?e=new wt(0,0,1):e=new wt(0,1,0),i=t.dot(e)),e=e.sub(t.scale(i)).normalized;const s=e.cross(t);return{normal:t,tangent:e,binormal:s}}applyQuaternion(e){const t=e.w*this.x+e.y*this.z-e.z*this.y,i=e.w*this.y+e.z*this.x-e.x*this.z,s=e.w*this.z+e.x*this.y-e.y*this.x,r=-e.x*this.x-e.y*this.y-e.z*this.z;return new wt(t*e.w+r*-e.x+i*-e.z-s*-e.y,i*e.w+r*-e.y+s*-e.x-t*-e.z,s*e.w+r*-e.z+t*-e.y-i*-e.x)}}function Yn(n,e){const t=e.z>0?new yt(0,0,0,1):new yt(0,0,1,0);return Math.abs(n.z)>.9999?t:yt.lookRotation(n,e)}function zd(n,e,t,i,s,r=1){const o=[];for(let a=0;a<t;a++){const l=n+e*a/(t-1),c=new wt;c[i]=r*Math.cos(l),c[s]=r*Math.sin(l),o.push(c)}return o}const He=Ne("rotationgizmo"),Ta=new wt(0,0,0),$4=new wt(1,0,0),j4=new wt(0,1,0),fo=new wt(0,0,1),Pa=new wt(0,0,-1),Xx=new wt(.7,0,0),qx=new wt(0,.7,0),Kx=new wt(0,0,.7),Yx=new wt(-.7,0,0),Zx=new wt(0,-.7,0),Jx=new wt(0,0,-.7),Qx=new yt(0,0,0,1);function Ra(n,e,t){const i=n.createElementNS(St,"g"),s=n.createElementNS(St,"circle");s.classList.add(He(e)),s.setAttributeNS(null,"cx","0"),s.setAttributeNS(null,"cy","0"),s.setAttributeNS(null,"r","8"),i.appendChild(s);const r=n.createElementNS(St,"text");return r.classList.add(He("labeltext")),r.setAttributeNS(null,"y","4"),r.setAttributeNS(null,"text-anchor","middle"),r.setAttributeNS(null,"font-size","10"),r.textContent=t,i.appendChild(r),i}class X4{get xArcBElement(){return this.xArcBC_.element}get yArcBElement(){return this.yArcBC_.element}get zArcBElement(){return this.zArcBC_.element}get xArcFElement(){return this.xArcFC_.element}get yArcFElement(){return this.yArcFC_.element}get zArcFElement(){return this.zArcFC_.element}get rArcElement(){return this.rArcC_.element}constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.onModeChange_=this.onModeChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(He()),t.pickerLayout==="popup"&&this.element.classList.add(He(void 0,"p"));const i=e.createElement("div");i.classList.add(He("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(St,"svg");s.classList.add(He("g")),this.padElement.appendChild(s),this.svgElem_=s,this.projector_=new dC,this.projector_.viewport=[0,0,136,136];const r=zd(0,Math.PI,33,"x","y"),o=zd(0,2*Math.PI,65,"x","y",1.1);this.xArcB_=new zt(e,r,this.projector_),this.xArcB_.element.classList.add(He("arcx")),this.svgElem_.appendChild(this.xArcB_.element),this.yArcB_=new zt(e,r,this.projector_),this.yArcB_.element.classList.add(He("arcy")),this.svgElem_.appendChild(this.yArcB_.element),this.zArcB_=new zt(e,r,this.projector_),this.zArcB_.element.classList.add(He("arcz")),this.svgElem_.appendChild(this.zArcB_.element),this.xArcBC_=new zt(e,r,this.projector_),this.xArcBC_.element.classList.add(He("arcc")),this.svgElem_.appendChild(this.xArcBC_.element),this.yArcBC_=new zt(e,r,this.projector_),this.yArcBC_.element.classList.add(He("arcc")),this.svgElem_.appendChild(this.yArcBC_.element),this.zArcBC_=new zt(e,r,this.projector_),this.zArcBC_.element.classList.add(He("arcc")),this.svgElem_.appendChild(this.zArcBC_.element);const a=e.createElementNS(St,"g");s.classList.add(He("axes")),this.svgElem_.appendChild(a),this.axesElem_=a,this.xAxis_=new zt(e,[Ta,Xx],this.projector_),this.xAxis_.element.classList.add(He("axisx")),this.axesElem_.appendChild(this.xAxis_.element),this.yAxis_=new zt(e,[Ta,qx],this.projector_),this.yAxis_.element.classList.add(He("axisy")),this.axesElem_.appendChild(this.yAxis_.element),this.zAxis_=new zt(e,[Ta,Kx],this.projector_),this.zAxis_.element.classList.add(He("axisz")),this.axesElem_.appendChild(this.zAxis_.element),this.xnAxis_=new zt(e,[Ta,Yx],this.projector_),this.xnAxis_.element.classList.add(He("axisn")),this.axesElem_.appendChild(this.xnAxis_.element),this.ynAxis_=new zt(e,[Ta,Zx],this.projector_),this.ynAxis_.element.classList.add(He("axisn")),this.axesElem_.appendChild(this.ynAxis_.element),this.znAxis_=new zt(e,[Ta,Jx],this.projector_),this.znAxis_.element.classList.add(He("axisn")),this.axesElem_.appendChild(this.znAxis_.element),this.xArcF_=new zt(e,r,this.projector_),this.xArcF_.element.classList.add(He("arcx")),this.svgElem_.appendChild(this.xArcF_.element),this.yArcF_=new zt(e,r,this.projector_),this.yArcF_.element.classList.add(He("arcy")),this.svgElem_.appendChild(this.yArcF_.element),this.zArcF_=new zt(e,r,this.projector_),this.zArcF_.element.classList.add(He("arcz")),this.svgElem_.appendChild(this.zArcF_.element),this.xArcFC_=new zt(e,r,this.projector_),this.xArcFC_.element.classList.add(He("arcc")),this.svgElem_.appendChild(this.xArcFC_.element),this.yArcFC_=new zt(e,r,this.projector_),this.yArcFC_.element.classList.add(He("arcc")),this.svgElem_.appendChild(this.yArcFC_.element),this.zArcFC_=new zt(e,r,this.projector_),this.zArcFC_.element.classList.add(He("arcc")),this.svgElem_.appendChild(this.zArcFC_.element),this.rArc_=new zt(e,o,this.projector_),this.rArc_.element.classList.add(He("arcr")),this.rArc_.setRotation(Qx),this.svgElem_.appendChild(this.rArc_.element),this.rArcC_=new zt(e,o,this.projector_),this.rArcC_.element.classList.add(He("arcc")),this.rArcC_.setRotation(Qx),this.svgElem_.appendChild(this.rArcC_.element);const l=e.createElementNS(St,"g");s.classList.add(He("labels")),this.svgElem_.appendChild(l),this.labelsElem_=l,this.xLabel=Ra(e,"labelcirclex","X"),this.labelsElem_.appendChild(this.xLabel),this.yLabel=Ra(e,"labelcircley","Y"),this.labelsElem_.appendChild(this.yLabel),this.zLabel=Ra(e,"labelcirclez","Z"),this.labelsElem_.appendChild(this.zLabel),this.xnLabel=Ra(e,"labelcirclen","-X"),this.labelsElem_.appendChild(this.xnLabel),this.ynLabel=Ra(e,"labelcirclen","-Y"),this.labelsElem_.appendChild(this.ynLabel),this.znLabel=Ra(e,"labelcirclen","-Z"),this.labelsElem_.appendChild(this.znLabel);const c=()=>{this.xArcB_.element.classList.add(He("arcx_hover")),this.xArcF_.element.classList.add(He("arcx_hover"))},h=()=>{this.xArcB_.element.classList.remove(He("arcx_hover")),this.xArcF_.element.classList.remove(He("arcx_hover"))};this.xArcBC_.element.addEventListener("mouseenter",c),this.xArcBC_.element.addEventListener("mouseleave",h),this.xArcFC_.element.addEventListener("mouseenter",c),this.xArcFC_.element.addEventListener("mouseleave",h);const u=()=>{this.yArcB_.element.classList.add(He("arcy_hover")),this.yArcF_.element.classList.add(He("arcy_hover"))},d=()=>{this.yArcB_.element.classList.remove(He("arcy_hover")),this.yArcF_.element.classList.remove(He("arcy_hover"))};this.yArcBC_.element.addEventListener("mouseenter",u),this.yArcBC_.element.addEventListener("mouseleave",d),this.yArcFC_.element.addEventListener("mouseenter",u),this.yArcFC_.element.addEventListener("mouseleave",d);const p=()=>{this.zArcB_.element.classList.add(He("arcz_hover")),this.zArcF_.element.classList.add(He("arcz_hover"))},f=()=>{this.zArcB_.element.classList.remove(He("arcz_hover")),this.zArcF_.element.classList.remove(He("arcz_hover"))};this.zArcBC_.element.addEventListener("mouseenter",p),this.zArcBC_.element.addEventListener("mouseleave",f),this.zArcFC_.element.addEventListener("mouseenter",p),this.zArcFC_.element.addEventListener("mouseleave",f);const g=()=>{this.rArc_.element.classList.add(He("arcr_hover"))},m=()=>{this.rArc_.element.classList.remove(He("arcr_hover"))};this.rArcC_.element.addEventListener("mouseenter",g),this.rArcC_.element.addEventListener("mouseleave",m),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,t.mode.emitter.on("change",this.onModeChange_),this.mode_=t.mode,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const e=this.value.rawValue.quat.normalized;this.xAxis_.setRotation(e),this.yAxis_.setRotation(e),this.zAxis_.setRotation(e),this.xnAxis_.setRotation(e),this.ynAxis_.setRotation(e),this.znAxis_.setRotation(e);const t=$4.applyQuaternion(e),i=j4.applyQuaternion(e),s=fo.applyQuaternion(e),r=t.negated,o=i.negated,a=s.negated;[{el:this.xAxis_.element,v:t},{el:this.yAxis_.element,v:i},{el:this.zAxis_.element,v:s},{el:this.xnAxis_.element,v:r},{el:this.ynAxis_.element,v:o},{el:this.znAxis_.element,v:a}].map(({el:l,v:c})=>(this.axesElem_.removeChild(l),{el:l,v:c})).sort((l,c)=>l.v.z-c.v.z).forEach(({el:l})=>{this.axesElem_.appendChild(l)}),this.xArcB_.setRotation(Yn(t,Pa)),this.yArcB_.setRotation(Yn(i,Pa)),this.zArcB_.setRotation(Yn(s,Pa)),this.xArcBC_.setRotation(Yn(t,Pa)),this.yArcBC_.setRotation(Yn(i,Pa)),this.zArcBC_.setRotation(Yn(s,Pa)),this.xArcF_.setRotation(Yn(t,fo)),this.yArcF_.setRotation(Yn(i,fo)),this.zArcF_.setRotation(Yn(s,fo)),this.xArcFC_.setRotation(Yn(t,fo)),this.yArcFC_.setRotation(Yn(i,fo)),this.zArcFC_.setRotation(Yn(s,fo)),[{el:this.xLabel,v:Xx},{el:this.yLabel,v:qx},{el:this.zLabel,v:Kx},{el:this.xnLabel,v:Yx},{el:this.ynLabel,v:Zx},{el:this.znLabel,v:Jx}].forEach(({el:l,v:c})=>{const[h,u]=this.projector_.project(c.applyQuaternion(e));l.setAttributeNS(null,"transform",`translate( ${h}, ${u} )`)}),[{el:this.xLabel,v:t},{el:this.yLabel,v:i},{el:this.zLabel,v:s},{el:this.xnLabel,v:r},{el:this.ynLabel,v:o},{el:this.znLabel,v:a}].map(({el:l,v:c})=>(this.labelsElem_.removeChild(l),{el:l,v:c})).sort((l,c)=>l.v.z-c.v.z).forEach(({el:l})=>{this.labelsElem_.appendChild(l)})}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}onModeChange_(){const e=this.mode_.rawValue,t=e==="angle-x"?"add":"remove",i=e==="angle-y"?"add":"remove",s=e==="angle-z"?"add":"remove",r=e==="angle-r"?"add":"remove";this.xArcB_.element.classList[t](He("arcx_active")),this.yArcB_.element.classList[i](He("arcy_active")),this.zArcB_.element.classList[s](He("arcz_active")),this.xArcF_.element.classList[t](He("arcx_active")),this.yArcF_.element.classList[i](He("arcy_active")),this.zArcF_.element.classList[s](He("arcz_active")),this.rArc_.element.classList[r](He("arcr_active"))}}function pC(n){return uC(n,0,1)}function q4(n){if(n<=0)return 0;if(n>=1)return 1;const e=1-n,t=e*(e*(e*(e*(e*(e*(e*-6+7))))));return pC(1-t)}function K4(n,e,t){return pC((t-n)/(e-n))}const Or=1/Math.sqrt(2),Y4=new wt(1,0,0),Z4=new wt(0,1,0),J4=new wt(0,0,1),Q4=new yt(0,0,0,1),eG=new yt(Or,0,0,Or),tG=new yt(0,-Or,0,Or),nG=new yt(-Or,0,0,Or),iG=new yt(0,Or,0,Or),sG=new yt(0,1,0,0);class rG{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.mode_=$t("free"),this.view=new X4(e,{value:this.value,mode:this.mode_,viewProps:this.viewProps,pickerLayout:t.pickerLayout}),this.ptHandler_=new vn(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_);const i=new vn(this.view.xArcBElement);i.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-x")),i.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const s=new vn(this.view.xArcFElement);s.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-x")),s.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const r=new vn(this.view.yArcBElement);r.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-y")),r.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const o=new vn(this.view.yArcFElement);o.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-y")),o.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const a=new vn(this.view.zArcBElement);a.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-z")),a.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const l=new vn(this.view.zArcFElement);l.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-z")),l.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const c=new vn(this.view.rArcElement);c.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-r")),c.emitter.on("up",()=>this.changeModeIfNotAuto_("free")),[{el:this.view.xLabel,q:tG},{el:this.view.yLabel,q:eG},{el:this.view.zLabel,q:Q4},{el:this.view.xnLabel,q:iG},{el:this.view.ynLabel,q:nG},{el:this.view.znLabel,q:sG}].forEach(({el:h,q:u})=>{new vn(h).emitter.on("down",()=>this.autoRotate_(u))}),this.px_=null,this.py_=null,this.angleState_=null}handlePointerEvent_(e){if(!e.point)return;const t=this.mode_.rawValue,i=e.point.x,s=e.point.y;if(t!=="auto")if(t==="free"){if(this.px_!=null&&this.py_!=null){const r=i-this.px_,o=s-this.py_,a=Math.sqrt(r*r+o*o);if(a===0)return;const l=new wt(o/a,r/a,0),c=yt.fromAxisAngle(l,a/68);this.value.rawValue=this.value.rawValue.premultiply(c)}this.px_=i,this.py_=s}else if(t==="angle-r"){const r=e.bounds.width/2,o=e.bounds.height/2,a=Math.atan2(s-o,i-r);if(this.angleState_==null){const l=new wt(0,0,1);this.angleState_={initialRotation:this.value.rawValue,initialAngle:a,axis:l,reverseAngle:!0}}else{const{initialRotation:l,initialAngle:c,axis:h}=this.angleState_,u=-fc(a-c),d=yt.fromAxisAngle(h,u);this.value.rawValue=l.premultiply(d)}}else{const r=e.bounds.width/2,o=e.bounds.height/2,a=Math.atan2(s-o,i-r);if(this.angleState_==null){const l=t==="angle-x"?Y4:t==="angle-y"?Z4:J4,c=l.applyQuaternion(this.value.rawValue.quat).z>0;this.angleState_={initialRotation:this.value.rawValue,initialAngle:a,axis:l,reverseAngle:c}}else{const{initialRotation:l,initialAngle:c,axis:h,reverseAngle:u}=this.angleState_;let d=fc(a-c);d=u?-d:d;const p=yt.fromAxisAngle(h,d);this.value.rawValue=l.multiply(p)}}}onPointerDown_(e){this.handlePointerEvent_(e.data)}onPointerMove_(e){this.handlePointerEvent_(e.data)}onPointerUp_(){this.px_=null,this.py_=null,this.angleState_=null}onPadKeyDown_(e){Dc(e.key)&&e.preventDefault();const t=dn(1,Gi(e)),i=dn(1,Ir(e));if(t!==0||i!==0){const s=new wt(-i,t,0),r=yt.fromAxisAngle(s,Math.PI/16);this.value.rawValue=this.value.rawValue.premultiply(r)}}changeModeIfNotAuto_(e){this.mode_.rawValue!=="auto"&&(this.mode_.rawValue=e)}autoRotate_(e){this.mode_.rawValue="auto";const t=this.value.rawValue,i=Date.now(),s=()=>{const r=Date.now(),o=q4(K4(0,300,r-i));if(this.value.rawValue=t.slerp(e,o),o===1){this.mode_.rawValue="free";return}requestAnimationFrame(s)};requestAnimationFrame(s)}}const mo=Ne("rotationswatch"),oG=new wt(1,0,0),aG=new wt(0,1,0),xu=new wt(0,0,1),lG=new yt(0,0,0,1);class cG{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(mo()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(mo("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElementNS(St,"svg");s.classList.add(mo("g")),i.appendChild(s),this.svgElem_=s,this.projector_=new dC,this.projector_.viewport=[0,0,20,20];const r=zd(0,Math.PI,33,"x","y"),o=zd(0,2*Math.PI,65,"x","y");this.rArc_=new zt(e,o,this.projector_),this.rArc_.element.classList.add(mo("arcr")),s.appendChild(this.rArc_.element),this.rArc_.setRotation(lG),this.xArc_=new zt(e,r,this.projector_),this.xArc_.element.classList.add(mo("arc")),s.appendChild(this.xArc_.element),this.yArc_=new zt(e,r,this.projector_),this.yArc_.element.classList.add(mo("arc")),s.appendChild(this.yArc_.element),this.zArc_=new zt(e,r,this.projector_),this.zArc_.element.classList.add(mo("arc")),s.appendChild(this.zArc_.element),this.update_()}update_(){const e=this.value.rawValue.quat.normalized,t=oG.applyQuaternion(e),i=aG.applyQuaternion(e),s=xu.applyQuaternion(e);this.xArc_.setRotation(Yn(t,xu)),this.yArc_.setRotation(Yn(i,xu)),this.zArc_.setRotation(Yn(s,xu))}onValueChange_(){this.update_()}}class hG{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new cG(e,{value:this.value,viewProps:this.viewProps})}}const gr=Ne("rotation");class uG{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(gr()),t.foldable.bindExpandedClass(this.element,gr(void 0,"expanded")),Mi(t.foldable,"completed",tr(this.element,gr(void 0,"cpl"))),t.rotationMode==="quaternion"&&this.element.classList.add(gr("quat"));const i=e.createElement("div");i.classList.add(gr("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(gr("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(gr("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(gr("g")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}class fC{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=hh.create(t.expanded),this.swatchC_=new hG(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new $r(e,{assembly:t.assembly,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new uG(e,{rotationMode:t.rotationMode,foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new Fp(e,{viewProps:this.viewProps}):null;const s=new rG(e,{value:this.value,viewProps:this.viewProps,pickerLayout:t.pickerLayout});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.gizmoC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),Wr({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.gizmoC_.view.element),uh(this.foldable_,this.view.pickerElement))}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.gizmoC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Op(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!lh(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function wm(n,e){const t=Math.pow(.1,n);return{baseStep:t,constraint:e,textProps:We.fromObject({formatter:pn(n),keyScale:t,pointerScale:t})}}function Co(n){if(!n)return;const e=[];return kt(n.step)||e.push(new eM(n.step)),(!kt(n.max)||!kt(n.min))&&e.push(new Ip({max:n.max,min:n.min})),new Ms(e)}function ey(n,e){return{toComponents:t=>t.getComponents(),fromComponents:t=>new Tr(t[0],t[1],t[2],n,e)}}function ty(n,e,t){return typeof(n==null?void 0:n.x)=="number"&&typeof(n==null?void 0:n.y)=="number"&&typeof(n==null?void 0:n.z)=="number"?new Tr(n.x,n.y,n.z,e,t):new Tr(0,0,0,e,t)}function dG(n){switch(n){case"XYZ":case"XZY":case"YXZ":case"YZX":case"ZXY":case"ZYX":return n;default:return}}function pG(n){switch(n){case"rad":case"deg":case"turn":return n;default:return}}Ct({id:"rotation",type:"input",accept(n,e){var t,i;const s=Mt(e,r=>({view:r.required.constant("rotation"),label:r.optional.string,picker:r.optional.custom(Vp),expanded:r.optional.boolean,rotationMode:r.required.constant("euler"),x:r.optional.custom(ti),y:r.optional.custom(ti),z:r.optional.custom(ti),order:r.optional.custom(dG),unit:r.optional.custom(pG)}));return s?{initialValue:ty(n,(t=s.order)!==null&&t!==void 0?t:"XYZ",(i=s.unit)!==null&&i!==void 0?i:"rad"),params:s}:null},binding:{reader({params:n}){return e=>{var t,i;return ty(e,(t=n.order)!==null&&t!==void 0?t:"XYZ",(i=n.unit)!==null&&i!==void 0?i:"rad")}},constraint({params:n}){var e,t;return new Dr({assembly:ey((e=n.order)!==null&&e!==void 0?e:"XYZ",(t=n.unit)!==null&&t!==void 0?t:"rad"),components:[Co("x"in n?n.x:void 0),Co("y"in n?n.y:void 0),Co("z"in n?n.z:void 0)]})},writer(n){return(e,t)=>{e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)}}},controller({document:n,value:e,constraint:t,params:i,viewProps:s}){var r,o;if(!(t instanceof Dr))throw Hi.shouldNeverHappen();const a="expanded"in i?i.expanded:void 0,l="picker"in i?i.picker:void 0,c=(r=i.unit)!==null&&r!==void 0?r:"rad",h={rad:2,deg:0,turn:2}[c];return new fC(n,{axes:[wm(h,t.components[0]),wm(h,t.components[1]),wm(h,t.components[2])],assembly:ey((o=i.order)!==null&&o!==void 0?o:"XYZ",c),rotationMode:"euler",expanded:a??!1,parser:Wn,pickerLayout:l??"popup",value:e,viewProps:s})}});const ny={toComponents:n=>[n.x,n.y,n.z,n.w],fromComponents:n=>new yt(n[0],n[1],n[2],n[3])};function yu(n){return{baseStep:.01,constraint:n,textProps:We.fromObject({formatter:e=>Math.abs(e)<.995?e.toFixed(2).replace("0.","."):e.toFixed(1),keyScale:.01,pointerScale:.01})}}function iy(n){return typeof(n==null?void 0:n.x)=="number"&&typeof(n==null?void 0:n.y)=="number"&&typeof(n==null?void 0:n.z)=="number"&&typeof(n==null?void 0:n.w)=="number"?new yt(n.x,n.y,n.z,n.w):new yt(0,0,0,1)}Ct({id:"rotation",type:"input",accept(n,e){const t=Mt(e,i=>({view:i.required.constant("rotation"),label:i.optional.string,picker:i.optional.custom(Vp),expanded:i.optional.boolean,rotationMode:i.optional.constant("quaternion"),x:i.optional.custom(ti),y:i.optional.custom(ti),z:i.optional.custom(ti),w:i.optional.custom(ti)}));return t?{initialValue:iy(n),params:t}:null},binding:{reader(n){return e=>iy(e)},constraint({params:n}){return new Dr({assembly:ny,components:[Co("x"in n?n.x:void 0),Co("y"in n?n.y:void 0),Co("z"in n?n.z:void 0),Co("w"in n?n.w:void 0)]})},writer(n){return(e,t)=>{e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)}}},controller({document:n,value:e,constraint:t,params:i,viewProps:s}){if(!(t instanceof Dr))throw Hi.shouldNeverHappen();const r="expanded"in i?i.expanded:void 0,o="picker"in i?i.picker:void 0;return new fC(n,{axes:[yu(t.components[0]),yu(t.components[1]),yu(t.components[2]),yu(t.components[3])],assembly:ny,rotationMode:"quaternion",expanded:r??!1,parser:Wn,pickerLayout:o??"popup",value:e,viewProps:s})}});function Em(n,e){const t=Hn(e,["children","$$slots","$$events","$$legacy"]),i=Hn(t,["value","wide"]);on(e,!1);let s=ie(e,"value",12),r=ie(e,"wide",24,()=>{}),o=Ot();function a(l){var h;const c=(h=I(o))==null?void 0:h.element.querySelector("div.tp-sldtxtv_t");l?c==null||c.style.setProperty("display","none"):c==null||c.style.removeProperty("display")}tt(()=>(I(o),Ae(r())),()=>{I(o)&&r()!==void 0&&a(r())}),ws(),F4(n,zn(()=>i,{get value(){return s()},set value(l){s(l)},get ref(){return I(o)},set ref(l){st(o,l)},$$events:{change(l){cl.call(this,e,l)}},$$legacy:!0})),an()}class sy{constructor(e,t){this.step=e,this.edge=t}constrain(e){var t,i;return(i=(t=this.edge)===null||t===void 0?void 0:t.constrain(e))!==null&&i!==void 0?i:e}}const fG={fromComponents:n=>n[0],toComponents:n=>[n]},Mm=Ne("step");class mG{constructor(e,t){this.buttonsView_=t.buttonsView,this.textView_=t.textView,this.element=e.createElement("div"),this.element.classList.add(Mm());const i=e.createElement("div");i.classList.add(Mm("s")),i.appendChild(this.buttonsView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Mm("t")),s.appendChild(this.textView_.element),this.element.appendChild(s)}}const Sm=Ne("step");class vG{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Sm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.textContent="-",i.classList.add(Sm("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.btnMinus=i;const s=e.createElement("button");s.textContent="+",s.classList.add(Sm("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.btnPlus=s}}class gG{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.step=t.constraint?t.constraint.step:1,this.view=new vG(e,{value:this.value,viewProps:t.viewProps}),this.view.btnMinus.addEventListener("click",()=>{var i;const s=(i=this.value.rawValue)!==null&&i!==void 0?i:0;this.value.setRawValue(s-this.step,{forceEmit:!0,last:!0})}),this.view.btnPlus.addEventListener("click",()=>{var i;const s=(i=this.value.rawValue)!==null&&i!==void 0?i:0;this.value.setRawValue(s+this.step,{forceEmit:!0,last:!0})})}}class _G{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sc_=new gG(e,t);const i={constraint:t.constraint.edge,textProps:t.textProps};this.tc_=new $r(e,{assembly:fG,axes:[i],parser:t.parser,value:this.value,viewProps:t.viewProps}),this.view=new mG(e,{buttonsView:this.sc_.view,textView:this.tc_.view})}get textController(){return this.tc_}}Ct({id:"input-stepper",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=Mt(e,i=>{var s;return{view:i.required.constant("stepper"),max:i.optional.number,min:i.optional.number,step:(s=i.optional.number)!==null&&s!==void 0?s:1}});return t?{initialValue:n,params:t}:null},binding:{reader(n){return e=>typeof e=="number"?e:0},writer(n){return(e,t)=>{e.write(t)}},constraint(n){const e=[],t=oh(n.params);t&&e.push(t);const i=rh(n.params);return i&&e.push(i),new sy(n.params.step?n.params.step:1,new Ms(e))}},controller(n){const e=n.value,t=n.constraint;if(!(t instanceof sy))throw Hi.shouldNeverHappen();const i=We.fromObject(bl(n.params,e.rawValue));return new _G(n.document,{constraint:t,parser:Wn,textProps:i,value:e,viewProps:n.viewProps})}});const ry=Ne("txtr");class bG{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(ry()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.rows=t.rows,i.cols=22,i.placeholder=t.placeholder,i.classList.add(ry("i")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){this.inputElement.value=this.value_.rawValue}onChange_(){this.refresh()}}class xG{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.rows=t.rows,this.placeholder=t.placeholder,this.view=new bG(e,{value:this.value,viewProps:this.viewProps,rows:this.rows,placeholder:this.placeholder}),this.view.inputElement.addEventListener("keyup",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value;this.value.rawValue=i,this.view.refresh()}}Ct({id:"input-template",type:"input",accept(n,e){if(typeof n!="string")return null;const t=Mt(e,i=>({view:i.required.constant("textarea"),rows:i.optional.number,placeholder:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{reader(n){return e=>typeof e=="string"?e:""},writer(n){return(e,t)=>{e.write(t)}}},controller(n){var e,t;return new xG(n.document,{value:n.value,rows:(e=n.params.rows)!==null&&e!==void 0?e:3,placeholder:(t=n.params.placeholder)!==null&&t!==void 0?t:"Enter text here",viewProps:n.viewProps})}});var yG=Ft('<div style="display: none;"><!></div>');function _v(n,e){on(e,!1);const[t,i]=qo(),s=()=>fs(d,"$folderStore",t),r=()=>fs(u,"$parentStore",t);let o=ie(e,"title",8,"Folder"),a=ie(e,"disabled",8,!1),l=ie(e,"expanded",12,!0),c=ie(e,"userExpandable",8,!0),h=ie(e,"theme",24,()=>{});const u=Yt("parentStore"),d=Ln(),p=Yt("userCreatedPane");let f=Ot(),g=Ot(),m=Ot(void 0);Rn("parentStore",d);function v(){ky(d,r().addFolder({disabled:a(),expanded:l(),index:I(g),title:o()})),s().on("fold",()=>{l(s().expanded)}),st(m,s())}Ur(()=>{st(g,I(f)?Gg(I(f)):0)}),Si(()=>{var M;(M=s())==null||M.dispose()}),tt(()=>(r(),I(m),I(g)),()=>{r()&&!I(m)&&I(g)!==void 0&&v()}),tt(()=>(I(m),Ae(c())),()=>{I(m)&&GM(c(),I(m).element,"tp-fldv_b","tp-fldv_m")}),tt(()=>(I(m),Ae(o())),()=>{I(m)&&hs(m,I(m).title=o())}),tt(()=>(I(m),Ae(a())),()=>{I(m)&&hs(m,I(m).disabled=a())}),tt(()=>(I(m),Ae(l())),()=>{I(m)&&l()!==void 0&&hs(m,I(m).expanded=l())}),tt(()=>(Ae(h()),r(),al),()=>{h()&&r()&&(p||!al(r()))&&console.warn("Set theme on the <Pane> component, not on its children! (Check nested <Folder> components for a theme prop.)")}),ws(),ys();var x=pt(),b=Be(x);{var _=M=>{var S=pt(),P=Be(S);{var E=y=>{var L=yG(),k=Jn(L);$s(k,e,"default",{}),Qn(L),us(L,D=>st(f,D),()=>I(f)),Pe(y,L)};Pn(P,y=>{y(E)})}Pe(M,S)},C=M=>{Xp(M,{get theme(){return h()},userCreatedPane:!1,children:(S,P)=>{var E=pt(),y=Be(E);_v(y,{get disabled(){return a()},get title(){return o()},get userExpandable(){return c()},get expanded(){return l()},set expanded(L){l(L)},children:(L,k)=>{var D=pt(),W=Be(D);$s(W,e,"default",{}),Pe(L,D)},$$slots:{default:!0},$$legacy:!0}),Pe(S,E)},$$slots:{default:!0}})};Pn(b,M=>{u?M(_):M(C,!1)})}Pe(n,x),an(),i()}var Cm={local:{},session:{}};function wG(n){return n==="local"?localStorage:sessionStorage}function oy(n,e,t){var i,s,r,o,a,l,c,h;const u=(i=void 0)!=null?i:JSON,d=(s=void 0)!=null?s:"local",p=(r=void 0)!=null?r:!0,f=(a=(o=void 0)!=null?o:void 0)!=null?a:M=>console.error(`Error when writing value from persisted store "${n}" to ${d}`,M),g=(l=void 0)!=null?l:(M,S)=>console.error(`Error when parsing ${M?'"'+M+'"':"value"} from persisted store "${n}"`,S),m=(c=void 0)!=null?c:M=>M,v=(h=void 0)!=null?h:M=>M,x=typeof window<"u"&&typeof document<"u",b=x?wG(d):null;function _(M,S){const P=v(S);try{b==null||b.setItem(M,u.stringify(P))}catch(E){f(E)}}function C(){function M(y){try{return u.parse(y)}catch(L){g(y,L)}}const S=b==null?void 0:b.getItem(n);if(S==null)return e;const P=M(S);return P==null?e:m(P)}if(!Cm[d][n]){const M=C(),S=Ln(M,y=>{if(x&&d=="local"&&p){const L=k=>{if(k.key===n&&k.newValue){let D;try{D=u.parse(k.newValue)}catch(z){g(k.newValue,z);return}const W=m(D);y(W)}};return window.addEventListener("storage",L),()=>window.removeEventListener("storage",L)}}),{subscribe:P,set:E}=S;Cm[d][n]={set(y){E(y),_(n,y)},update(y){return S.update(L=>{const k=y(L);return _(n,k),k})},reset(){this.set(e)},subscribe:P}}return Cm[d][n]}const wu="svelte-tweakpane-ui-draggable-position-",EG="1",La=[];let Am=1e3;var MG=Ft("<div><!></div>");function SG(n,e){const t=Hn(e,["children","$$slots","$$events","$$legacy"]),i=Hn(t,["storePositionLocally","localStoreId","tpPane","expanded","collapseChildrenToFit","x","y","width","resizable","userExpandable","minWidth","maxWidth","title","scale","padding"]);on(e,!1);const[s,r]=qo(),o=()=>fs(I(f),"$positionStore",s),a=Ot(),l=!0,c=3;let h,u=ie(e,"storePositionLocally",8,!0),d=ie(e,"localStoreId",8,EG),p=ie(e,"tpPane",28,()=>{}),f=Ot();u()&&$_(st(f,oy(`${wu}${d()}`,{x:0,y:0,expanded:!0,width:350})),"$positionStore",s);let g=ie(e,"expanded",28,()=>{var O;return((O=o())==null?void 0:O.expanded)??!0}),m=ie(e,"collapseChildrenToFit",8,!1),v=ie(e,"x",28,()=>{var O;return((O=o())==null?void 0:O.x)??0}),x=ie(e,"y",28,()=>{var O;return((O=o())==null?void 0:O.y)??0}),b=ie(e,"width",28,()=>{var O;return((O=o())==null?void 0:O.width)??256}),_=ie(e,"resizable",8,!0),C=ie(e,"userExpandable",8,!0),M=ie(e,"minWidth",8,200),S=ie(e,"maxWidth",8,600),P=ie(e,"title",8,"Tweakpane"),E=ie(e,"scale",8,1),y=ie(e,"padding",8,"0"),L=Ot(),k,D,W=Ot(),z=Ot(),H=Ot(),ne=Ot(),G=Ot(),ae=Ot(Am);function se(){d()!==void 0&&(La.includes(d())&&console.warn('Multiple instances of <Pane> with `mode="draggable"` and `storePositionLocally=true` detected. You must explicitly set unique localStoreId property on each component to avoid collisions.'),La.push(d()))}function ge(){d()&&(La.splice(La.indexOf(d()),1),localStorage.removeItem(`${wu}${d()}`))}function Oe(O){O!==void 0&&I(f)!==void 0&&g()!==void 0&&b()!==void 0&&v()!==void 0&&x()!==void 0&&$_(st(f,oy(`${wu}${d()}`,{x:v(),y:x(),expanded:g(),width:b()})),"$positionStore",s)}function Ze(){if(v()!==void 0&&x()!==void 0&&b()!==void 0){const O=I(ne),he=I(G);st(ne,document.documentElement.clientWidth),st(G,document.documentElement.clientHeight);const oe=I(ne)-O,fe=I(G)-he,Ue=(v()+b()/2)/I(ne),le=(x()+I(z)/2)/I(G);!Number.isNaN(oe)&&Ue>=.5&&v(v()+oe),!Number.isNaN(fe)&&le>=.5&&x(x()+fe)}}const J=O=>{O.stopPropagation()};let ce=0,_e=0,pe=0,Re=0;const nt=O=>{O.stopPropagation(),O.target&&b()!==void 0&&O.target===D&&b(b()<I(a)?I(a):M())},Le=O=>{v()!==void 0&&x()!==void 0&&O.button===0&&O.target instanceof HTMLElement&&(Re=0,h=O,Qe(),q(),O.target===k&&(k.style.cursor="grabbing"),hs(L,I(L).style.transition="width 0s ease"),O.target.setPointerCapture(O.pointerId),ce=b()??0,_e=v()-O.pageX,pe=x()-O.pageY)},rt=O=>{O.target instanceof HTMLElement&&b()!==void 0&&M()!==void 0&&v()!==void 0&&x()!==void 0&&(O.target===k?(Re+=Math.hypot(O.movementX,O.movementY),v(O.pageX+_e),x(O.pageY+pe)):O.target===D&&b(om(O.pageX+_e+ce-v(),M(),I(a))))},mt=()=>{if((h==null?void 0:h.target)instanceof HTMLElement){const{target:O}=h,he=O.getBoundingClientRect(),oe=new PointerEvent("pointercancel",{bubbles:!0,clientX:he.left+he.width/2,clientY:he.top+he.height/2,composed:!0,pointerId:h.pointerId,pointerType:h.pointerType});O.dispatchEvent(oe)}},Ge=O=>{O.stopImmediatePropagation(),O.target instanceof HTMLElement&&(O.target.hasPointerCapture(O.pointerId)&&O.target.releasePointerCapture(O.pointerId),O.target===k&&k.style.removeProperty("cursor"),I(L).style.removeProperty("transition"),O.type==="pointerup"&&l&&O.target===k&&Re<c&&C()&&p()&&p(p().expanded=!p().expanded,!0),h=void 0,te(),N())},N=()=>{k.addEventListener("pointerdown",Le),D==null||D.addEventListener("pointerdown",Le)},Qe=()=>{k.removeEventListener("pointerdown",Le),D==null||D.removeEventListener("pointerdown",Le)},q=()=>{window.addEventListener("blur",mt),k.addEventListener("pointermove",rt),k.addEventListener("pointerup",Ge),k.addEventListener("pointercancel",Ge),D==null||D.addEventListener("pointermove",rt),D==null||D.addEventListener("pointerup",Ge),D==null||D.addEventListener("pointercancel",Ge)},te=()=>{window.removeEventListener("blur",mt),k.removeEventListener("pointermove",rt),k.removeEventListener("pointerup",Ge),k.removeEventListener("pointercancel",Ge),D==null||D.removeEventListener("pointermove",rt),D==null||D.removeEventListener("pointerup",Ge),D==null||D.removeEventListener("pointercancel",Ge)},K=O=>{O.preventDefault()};Ur(()=>{var he;Ze(),p()?I(L).append(p().element):console.warn("no tpPane in draggable"),I(L).addEventListener("touchmove",K,{passive:!1});const O=I(L).querySelector(".tp-rotv_t");O&&(k=O,k.addEventListener("click",J),k.addEventListener("dblclick",nt),D=(he=k.parentElement)==null?void 0:he.appendChild(document.createElement("div")),D&&(D.className="tp-custom-width-handle",D.textContent="â",D.addEventListener("click",J),D.addEventListener("dblclick",nt)),N())}),Si(()=>{var O;Qe(),te(),k.removeEventListener("click",J),k.removeEventListener("dblclick",nt),D==null||D.removeEventListener("click",J),D==null||D.removeEventListener("dblclick",nt),(O=I(L))==null||O.removeEventListener("touchmove",K),d()!==void 0&&La.splice(La.indexOf(d()),1)});function de(O){D&&(D.style.display=O?"block":"none")}function Y(O,he=Number.MAX_SAFE_INTEGER){if(he>0)for(const oe of O)if("expanded"in oe)oe.expanded&&(he--,oe.expanded=!1),"children"in oe&&Y(oe.children,he);else{const fe=r3(oe);fe&&s3(oe)&&(he--,fe.click())}}tt(()=>(Ae(p()),Ae(_())),()=>{p()&&_()&&de(_())}),tt(()=>(I(L),Ae(E()),I(W)),()=>{if(I(L))if(E()===void 0||E()===1)st(z,I(W));else{const O=window.getComputedStyle(I(L)),he=Number.parseFloat(O.paddingTop)+Number.parseFloat(O.paddingBottom);st(z,(I(W)-he)*E()+he)}}),tt(()=>(I(z),I(ne),I(G),Ae(v()),Ae(x()),Ae(b()),Ae(M()),Ae(S()),Ae(m()),Ae(p()),I(H)),()=>{I(z)!==void 0&&I(ne)!==void 0&&I(G)!==void 0&&v()!==void 0&&x()!==void 0&&b()!==void 0&&M()!==void 0&&S()!==void 0&&(m()&&I(z)>I(G)&&p()&&Y(p().children),v(om(v(),0,Math.max(0,I(ne)-I(H)))),x(om(x(),0,Math.max(0,I(G)-I(z)))),I(ne)<I(H)&&b(Math.max(M(),Math.min(S(),I(ne)))))}),tt(()=>(Ae(S()),I(ne),Ae(v())),()=>{st(a,Math.min(S()??600,I(ne)-(v()??0)))}),tt(()=>(Ae(d()),Ae(u())),()=>{d(),u()&&se()}),tt(()=>(Ae(d()),Ae(u())),()=>{d(),!u()&&ge()}),tt(()=>Ae(d()),()=>{d()!==`${wu}${d()}`&&Oe(d())}),tt(()=>(Ae(u()),Ae(d()),Ae(v()),Ae(x()),Ae(b()),Ae(g()),I(f)),()=>{var O;u()&&d()!==void 0&&v()!==void 0&&x()!==void 0&&b()!==void 0&&g()!==void 0&&((O=I(f))==null||O.set({x:v(),y:x(),expanded:g(),width:b()}))}),ws(),ys();var T=MG();sf("resize",JC,Ze);let w,U;var j=Jn(T),Z=un(()=>Hp(i,"position"));v_(j,zn({get scale(){return E()},get title(){return P()}},()=>I(Z),{get expanded(){return g()},set expanded(O){g(O)},get tpPane(){return p()},set tpPane(O){p(O)},children:(O,he)=>{var oe=pt(),fe=Be(oe);$s(fe,e,"default",{}),Pe(O,oe)},$$slots:{default:!0},$$legacy:!0})),Qn(T),us(T,O=>st(L,O),()=>I(L)),sc(O=>{w=Gu(T,1,"draggable-container svelte-ex9mcb",null,w,O),U=_i(T,"",U,{left:`${v()??""}px`,padding:y(),top:`${x()??""}px`,width:`${b()??""}px`,"z-index":I(ae)})},[()=>({"not-collapsable":!C(),"not-resizable":!_()})],ZC),Y_(T,"clientHeight",O=>st(W,O)),Y_(T,"clientWidth",O=>st(H,O)),sf("focus",T,()=>{st(ae,++Am)},!0),sf("pointerdown",T,()=>{st(ae,++Am)},!0),Pe(n,T),an(),r()}var CG=Ft('<div style="display: none;"><!></div>');function AG(n,e){const t=Hn(e,["children","$$slots","$$events","$$legacy"]),i=Hn(t,["expanded","x","y","width","title","tpPane"]);on(e,!1);let s=ie(e,"expanded",28,()=>{}),r=ie(e,"x",24,()=>{}),o=ie(e,"y",24,()=>{}),a=ie(e,"width",24,()=>{}),l=ie(e,"title",8,"Tweakpane"),c=ie(e,"tpPane",28,()=>{}),h=Ot();tt(()=>Ae(c()),()=>{var f;(f=c())!=null&&f.element.parentElement&&st(h,c().element.parentElement)}),tt(()=>(I(h),Ae(r())),()=>{I(h)!==void 0&&r()!==void 0&&(I(h).style.setProperty("right","unset"),I(h).style.setProperty("left",`${r()}px`))}),tt(()=>(I(h),Ae(o())),()=>{I(h)!==void 0&&o()!==void 0&&I(h).style.setProperty("top",`${o()}px`)}),tt(()=>(I(h),Ae(a())),()=>{I(h)!==void 0&&a()!==void 0&&I(h).style.setProperty("width",`${a()}px`)}),ws(),ys();var u=CG(),d=Jn(u),p=un(()=>Hp(i,"position"));v_(d,zn({get title(){return l()}},()=>I(p),{get expanded(){return s()},set expanded(f){s(f)},get tpPane(){return c()},set tpPane(f){c(f)},children:(f,g)=>{var m=pt(),v=Be(m);$s(v,e,"default",{}),Pe(f,m)},$$slots:{default:!0},$$legacy:!0})),Qn(u),Pe(n,u),an()}function TG(n,e){const t=Hn(e,["children","$$slots","$$events","$$legacy"]),i=Hn(t,["expanded","position","width","tpPane","x","y"]);on(e,!1);let s=ie(e,"expanded",28,()=>{}),r=ie(e,"position",24,()=>{}),o=ie(e,"width",28,()=>{}),a=ie(e,"tpPane",28,()=>{}),l=ie(e,"x",28,()=>{}),c=ie(e,"y",28,()=>{});QC(()=>{(t.position==="inline"||t.position==="fixed")&&(l(t.x),c(t.y),o(t.width),s(t.expanded))}),ys();var h=pt(),u=Be(h);{var d=f=>{var g=pt(),m=Be(g);{var v=x=>{SG(x,zn(()=>i,{get expanded(){return s()},set expanded(b){s(b)},get tpPane(){return a()},set tpPane(b){a(b)},get width(){return o()},set width(b){o(b)},get x(){return l()},set x(b){l(b)},get y(){return c()},set y(b){c(b)},children:(b,_)=>{var C=pt(),M=Be(C);$s(M,e,"default",{}),Pe(b,C)},$$slots:{default:!0},$$legacy:!0}))};Pn(m,x=>{x(v)})}Pe(f,g)},p=(f,g)=>{{var m=x=>{var b=un(()=>Hp(i,"storePositionLocally"));Xp(x,zn({get width(){return o()}},()=>I(b),{get expanded(){return s()},set expanded(_){s(_)},get tpPane(){return a()},set tpPane(_){a(_)},children:(_,C)=>{var M=pt(),S=Be(M);$s(S,e,"default",{}),Pe(_,M)},$$slots:{default:!0},$$legacy:!0}))},v=(x,b)=>{{var _=C=>{var M=pt(),S=Be(M);{var P=E=>{AG(E,zn({get width(){return o()}},()=>i,{get expanded(){return s()},set expanded(y){s(y)},get tpPane(){return a()},set tpPane(y){a(y)},get x(){return l()},set x(y){l(y)},get y(){return c()},set y(y){c(y)},children:(y,L)=>{var k=pt(),D=Be(k);$s(D,e,"default",{}),Pe(y,k)},$$slots:{default:!0},$$legacy:!0}))};Pn(S,E=>{E(P)})}Pe(C,M)};Pn(x,C=>{r()==="fixed"&&C(_)},b)}};Pn(f,x=>{r()==="inline"?x(m):x(v,!1)},g)}};Pn(u,f=>{r()===void 0||r()==="draggable"?f(d):f(p,!1)})}Pe(n,h),an()}class PG extends Gr{measureStart(e){this.controller.valueController.measureStart(e)}measureEnd(){return this.controller.valueController.measureEnd()}measure(e,t){this.controller.valueController.measure(e,t)}measureAsync(e,t){return this.controller.valueController.measureAsync(e,t)}get measureHandler(){return this.controller.valueController.measureHandler}set measureHandler(e){this.controller.valueController.measureHandler=e}}class ay extends xl{constructor(e,t){const i=t.valueController,s=new ch(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:i.viewProps}),this.valueController=i,this.labelController=s}}class RG{measureStart(){const e=performance.now();return()=>performance.now()-e}}function ly(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(i.next(h))}catch(u){o(u)}}function l(h){try{c(i.throw(h))}catch(u){o(u)}}function c(h){h.done?r(h.value):s(h.value).then(a,l)}c((i=i.apply(n,[])).next())})}class mC{constructor(){this.map=new Map,this.keySet=new Set}get(e){return this.map.get(e)}getOrCreate(e,t){this.keySet.has(e)||this.keySet.add(e);let i=this.map.get(e);return i==null&&(i=t(),this.map.set(e,i)),i}set(e,t){this.keySet.has(e)||this.keySet.add(e),this.map.set(e,t)}resetUsedSet(){this.keySet.clear()}vaporize(e){for(const[t,i]of this.map.entries())this.keySet.has(t)||(this.map.delete(t),e==null||e([t,i]))}}function LG(n){n.splice(0,n.length)}function Eu(n){let e=0;return n.forEach(t=>e+=t),e}class IG{constructor(e){this.__recalcForEach=0,this.__countUntilRecalc=0,this.__history=[],this.__index=0,this.__count=0,this.__cache=0,this.__length=e,this.__recalcForEach=e;for(let t=0;t<e;t++)this.__history[t]=0}get mean(){const e=Math.min(this.__count,this.__length);return e===0?0:this.__cache/e}get recalcForEach(){return this.__recalcForEach}set recalcForEach(e){const t=e-this.__recalcForEach;this.__recalcForEach=e,this.__countUntilRecalc=Math.max(0,this.__countUntilRecalc+t)}reset(){this.__index=0,this.__count=0,this.__cache=0,this.__countUntilRecalc=0;for(let e=0;e<this.__length;e++)this.__history[e]=0}push(e){const t=this.__history[this.__index];this.__history[this.__index]=e,this.__count++,this.__index=(this.__index+1)%this.__length,this.__countUntilRecalc===0?this.recalc():(this.__countUntilRecalc--,this.__cache-=t,this.__cache+=e)}recalc(){this.__countUntilRecalc=this.__recalcForEach;const e=this.__history.slice(0,Math.min(this.__count,this.__length)).reduce((t,i)=>t+i,0);this.__cache=e}}function bv(n,e){if(typeof e!="function")return bv(n,r=>r<e);const t=e;let i=0,s=n.length;for(;i<s;){const r=i+s>>1,o=n[r];t(o)?i=r+1:s=r}return i}class DG{constructor(e){this.__history=[],this.__sorted=[],this.__index=0,this.__length=e}get median(){return this.percentile(50)}percentile(e){return this.__history.length===0?0:this.__sorted[Math.round(e*.01*(this.__history.length-1))]}reset(){this.__index=0,this.__history=[],this.__sorted=[]}push(e){const t=this.__history[this.__index];if(this.__history[this.__index]=e,this.__index=(this.__index+1)%this.__length,this.__sorted.length===this.__length){const s=bv(this.__sorted,t);this.__sorted.splice(s,1)}const i=bv(this.__sorted,e);this.__sorted.splice(i,0,e)}}function Ia(n,e){let t=0;for(let i=0;i<n.length;i++)t+=n[i]*e[i];return t}function w_(n){return Math.min(Math.max(n,0),1)}function NG(n){return`rgb( ${n.map(t=>w_(t)*256).join(", ")} )`}function OG(n){const e=[.13572138,4.6153926,-42.66032258,132.13108234],t=[.09140261,2.19418839,4.84296658,-14.18503333],i=[.1066733,12.64194608,-60.58204836,110.36276771],s=[-152.94239396,59.28637943],r=[4.27729857,2.82956604],o=[-89.90310912,27.34824973];n=w_(n);const a=[1,n,n*n,n*n*n],l=[a[2],a[3]].map(h=>h*a[2]),c=[Ia(a,e)+Ia(l,s),Ia(a,t)+Ia(l,r),Ia(a,i)+Ia(l,o)];return NG(c)}const _r=Ne("profiler");class kG{constructor(e,t){this.targetDelta=t.targetDelta,this.deltaUnit=t.deltaUnit,this.fractionDigits=t.fractionDigits,this.calcMode=t.calcMode,this.element=e.createElement("div"),this.element.classList.add(_r()),t.viewProps.bindClassModifiers(this.element),this.svgRootElement_=e.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgRootElement_.classList.add(_r("root")),this.element.appendChild(this.svgRootElement_),this.entryContainerElement_=e.createElementNS("http://www.w3.org/2000/svg","g"),this.entryContainerElement_.classList.add(_r("container")),this.entryContainerElement_.setAttribute("transform","translate( 1, 1 )"),this.svgRootElement_.appendChild(this.entryContainerElement_),this.tooltipElement_=e.createElement("div"),this.tooltipElement_.classList.add(_r("tooltip")),this.tooltipElement_.style.display="none",this.element.appendChild(this.tooltipElement_),this.tooltipInsideElement_=e.createElement("div"),this.tooltipInsideElement_.classList.add(_r("tooltipinside")),this.tooltipElement_.appendChild(this.tooltipInsideElement_),this.labelElement_=e.createElement("div"),this.labelElement_.classList.add(_r("label")),this.labelElement_.textContent=this.deltaToDisplayDelta_(0),this.element.appendChild(this.labelElement_),this.entryElementCacheMap_=new mC,this.hoveringEntry_=null}update(e){const t=this.entryToDelta_(e);this.labelElement_.textContent=this.deltaToDisplayDelta_(t),this.entryElementCacheMap_.resetUsedSet();const i=160/Math.max(this.targetDelta,t);let s=0;for(const r of e.children)this.addEntry_(r,"",this.entryContainerElement_,i).setAttribute("transform",`translate( ${s}, 0 )`),s+=this.entryToDelta_(r)*i;this.entryElementCacheMap_.vaporize(([r,o])=>{o.remove(),this.hoveringEntry_===r&&(this.hoveringEntry_=null)}),this.updateTooltip_()}updateTooltip_(){const e=this.hoveringEntry_;if(e){const t=this.entryElementCacheMap_.get(e),i=t==null?void 0:t.getAttribute("data-delta"),s=this.deltaToDisplayDelta_(parseFloat(i??"0.0")),r=`${e}
${s}`;this.tooltipElement_.style.display="block",this.tooltipInsideElement_.textContent=r}else this.tooltipElement_.style.display="none"}addEntry_(e,t,i,s){const r=`${t}/${e.name}`,o=this.entryElementCacheMap_.getOrCreate(r,()=>{const h=document.createElementNS("http://www.w3.org/2000/svg","g");h.classList.add(_r("entry")),i.appendChild(h),this.entryElementCacheMap_.set(r,h);const u=document.createElementNS("http://www.w3.org/2000/svg","rect");return u.classList.add(_r("entryrect")),h.appendChild(u),u.addEventListener("mouseenter",()=>{this.hoveringEntry_=r,this.updateTooltip_()}),u.addEventListener("mouseleave",()=>{this.hoveringEntry_=null,this.updateTooltip_()}),h}),a=this.entryToDelta_(e);o.setAttribute("data-delta",`${a}`);const l=o.childNodes[0];l.setAttribute("width",`${Math.max(.01,a*s-1)}px`),l.setAttribute("height","9px");const c=.15+.7*w_(a/this.targetDelta);if(l.setAttribute("fill",OG(c)),e.children.length>0){let h=0;e.children.forEach(u=>{this.addEntry_(u,r,o,s).setAttribute("transform",`translate( ${h}, 10 )`),h+=this.entryToDelta_(u)*s})}return o}entryToDelta_(e){if(this.calcMode==="frame")return e.delta;if(this.calcMode==="mean")return e.deltaMean;if(this.calcMode==="median")return e.deltaMedian;throw new Error('Unreachable! calcMode must be one of "frame", "mean", or "median"')}deltaToDisplayDelta_(e){return`${e.toFixed(this.fractionDigits)} ${this.deltaUnit}`}}class UG{constructor(e,t){this.targetDelta=t.targetDelta,this.bufferSize=t.bufferSize,this.onTick_=this.onTick_.bind(this),this.ticker_=t.ticker,this.ticker_.emitter.on("tick",this.onTick_),this.viewProps=t.viewProps,this.view=new kG(e,{targetDelta:this.targetDelta,deltaUnit:t.deltaUnit,fractionDigits:t.fractionDigits,calcMode:t.calcMode,viewProps:this.viewProps}),this.viewProps.handleDispose(()=>{this.ticker_.dispose()}),this.measureHandler=t.measureHandler,this.rootCalcCacheStack_=[this.createNewEntryCalcCache_()]}measureStart(e){const i=this.rootCalcCacheStack_[this.rootCalcCacheStack_.length-1].childrenCacheMap.getOrCreate(e,()=>this.createNewEntryCalcCache_());i.childrenCacheMap.resetUsedSet(),LG(i.childrenPromiseDelta),this.rootCalcCacheStack_.push(i),i.measureEnd=this.measureHandler.measureStart()}measureEnd(){return ly(this,void 0,void 0,function*(){const e=this.rootCalcCacheStack_[this.rootCalcCacheStack_.length-1],t=this.rootCalcCacheStack_[this.rootCalcCacheStack_.length-2],i=Promise.resolve(e.measureEnd());e.measureEnd=null,t.childrenPromiseDelta.push(i),this.rootCalcCacheStack_.pop(),e.childrenCacheMap.vaporize();const s=yield Promise.all(e.childrenPromiseDelta),r=Eu(s),o=(yield i)-r;e.meanCalc.push(o),e.medianCalc.push(o),e.latest=o})}measure(e,t){this.measureStart(e),t(),this.measureEnd()}measureAsync(e,t){return ly(this,void 0,void 0,function*(){this.measureStart(e),yield t(),this.measureEnd()})}renderEntry(){return this.renderEntryFromCalcCache_("",this.rootCalcCacheStack_[0])}renderEntryFromCalcCache_(e,t){const i=[];for(const p of t.childrenCacheMap.keySet){const f=t.childrenCacheMap.get(p);i.push(this.renderEntryFromCalcCache_(p,f))}const s=t.latest,r=t.meanCalc.mean,o=t.medianCalc.median,a=Eu(i.map(p=>p.delta)),l=Eu(i.map(p=>p.deltaMean)),c=Eu(i.map(p=>p.deltaMedian)),h=s+a,u=r+l,d=o+c;return{name:e,delta:h,deltaMean:u,deltaMedian:d,selfDelta:s,selfDeltaMean:r,selfDeltaMedian:o,children:i}}onTick_(){this.view.update(this.renderEntry())}createNewEntryCalcCache_(){return{meanCalc:new IG(this.bufferSize),medianCalc:new DG(this.bufferSize),latest:0,measureEnd:null,childrenCacheMap:new mC,childrenPromiseDelta:[]}}}function FG(n,e){return e===0?new mM:new vM(n,e??wl.monitor.defaultInterval)}function BG(n){switch(n){case"frame":case"mean":case"median":return n;default:return}}function VG(n){if(typeof n=="object"&&n!=null&&"measureStart"in n)return n;typeof n=="object"&&n!=null&&"measure"in n&&console.warn("The API of `ProfilerBladeDefaultMeasureHandler` has been changed in v0.4.0! Please define `measureStart` instead of `measure`. Fallback to the default measure handler.")}Ct({id:"profiler",type:"blade",accept(n){const e=Mt(n,t=>({view:t.required.constant("profiler"),targetDelta:t.optional.number,bufferSize:t.optional.number,deltaUnit:t.optional.string,fractionDigits:t.optional.number,calcMode:t.optional.custom(BG),label:t.optional.string,interval:t.optional.number,measureHandler:t.optional.custom(VG)}));return e?{params:e}:null},controller(n){var e,t,i,s,r,o,a;const l=(e=n.params.interval)!==null&&e!==void 0?e:500,c=(t=n.params.targetDelta)!==null&&t!==void 0?t:16.67,h=(i=n.params.bufferSize)!==null&&i!==void 0?i:30,u=(s=n.params.deltaUnit)!==null&&s!==void 0?s:"ms",d=(r=n.params.fractionDigits)!==null&&r!==void 0?r:2,p=(o=n.params.calcMode)!==null&&o!==void 0?o:"mean",f=(a=n.params.measureHandler)!==null&&a!==void 0?a:new RG;return new ay(n.document,{blade:n.blade,labelProps:We.fromObject({label:n.params.label}),valueController:new UG(n.document,{ticker:FG(n.document,l),targetDelta:c,bufferSize:h,deltaUnit:u,fractionDigits:d,calcMode:p,viewProps:n.viewProps,measureHandler:f})})},api(n){return n.controller instanceof ay?new PG(n.controller):null}});class cy{constructor(){this.drawer=e=>`L ${e[0]} ${e[1]}`}}class zG{constructor(){this.drawer=(e,t,i)=>{const[s,r]=this.controlPoint(i[t-1],i[t-2],e),[o,a]=this.controlPoint(e,i[t-1],i[t+1],!0);return`C ${s},${r} ${o},${a} ${e[0]},${e[1]}`}}controlPoint(e,t,i,s){const r=t||e,o=i||e,a=.2,l=o[0]-r[0],c=o[1]-r[1],h=Math.sqrt(Math.pow(l,2)+Math.pow(c,2))*a,u=Math.atan2(c,l)+(s?Math.PI:0),d=e[0]+Math.cos(u)*h,p=e[1]+Math.sin(u)*h;return[d,p]}}const hy=Ne("wfm");class HG{constructor(e,t){switch(this.element=e.createElement("div"),this.element.classList.add(hy()),t.viewProps.bindClassModifiers(this.element),this.svgElem=e.createElementNS(St,"svg"),this.svgElem.classList.add(hy("g")),this.element.appendChild(this.svgElem),this.pathElem=e.createElementNS(St,"path"),this.svgElem.appendChild(this.pathElem),this.props=t.props,this.value=t.value,this.value.emitter.on("change",this.onValueChange_.bind(this)),this.props.get("lineStyle")){case"linear":this.lineDrawerProvider=new cy;break;case"bezier":this.lineDrawerProvider=new zG;break;default:this.lineDrawerProvider=new cy;break}this.refresh(),t.viewProps.handleDispose(()=>{this.value.emitter.off("change",this.onValueChange_)})}svgPath(e,t){return e.reduce((s,r,o,a)=>o===0?`M ${r[0]},${r[1]}`:`${s} ${t(r,o,a)}`,"")}refresh(){var e,t;const i=this.svgElem.getBoundingClientRect(),s=this.value.rawValue[0];if(s){const r=(e=this.props.get("min"))!==null&&e!==void 0?e:Math.min(...s)-1,o=(t=this.props.get("max"))!==null&&t!==void 0?t:Math.max(...s)+1,a=o-r,l=[],c=s.length-1,h=s.length>32?0:i.width/(s.length-1),u=a>50?0:i.height/a;this.element.style.backgroundSize=`${h}px ${u}px`,s.forEach((p,f)=>{if(p===void 0)return;const g=Xe(f,0,c,0,i.width),m=Xe(p,r,o,i.height,0);l.push([Math.floor(g),Math.floor(m)])});const d=this.svgPath(l,this.lineDrawerProvider.drawer);this.pathElem.setAttributeNS(null,"d",d)}}onValueChange_(){this.refresh()}}class GG{constructor(e,t){this.value=t.value,this.props=t.props,this.viewProps=t.viewProps,this.viewProps.handleDispose(()=>{}),this.view=new HG(e,{value:this.value,viewProps:this.viewProps,props:this.props})}}function WG(n){return"view"in n&&n.view==="waveform"}function uy(n){return typeof n=="object"?"length"in n:!1}Ct({id:"monitor-waveform",type:"monitor",accept:(n,e)=>{if(!uy(n))return null;const t=Mt(e,i=>({max:i.optional.number,min:i.optional.number,style:i.optional.custom(s=>s==="linear"||s==="bezier"?s:void 0),view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>WG(n)?64:1,reader:n=>e=>uy(e)?e:[]},controller:n=>{var e,t,i;return new GG(n.document,{props:We.fromObject({max:(e="max"in n.params?n.params.max:null)!==null&&e!==void 0?e:null,min:(t="min"in n.params?n.params.min:null)!==null&&t!==void 0?t:null,lineStyle:(i="style"in n.params?n.params.style:null)!==null&&i!==void 0?i:"linear"}),value:n.value,viewProps:n.viewProps})}});function dy(n,e){if(e===Mw)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===Ad||e===Uv){let t=n.getIndex();if(t===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=t.count-2,s=[];if(e===Ad)for(let o=1;o<=i;o++)s.push(t.getX(0)),s.push(t.getX(o)),s.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(s.push(t.getX(o)),s.push(t.getX(o+1)),s.push(t.getX(o+2))):(s.push(t.getX(o+2)),s.push(t.getX(o+1)),s.push(t.getX(o)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=n.clone();return r.setIndex(s),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}class $G extends ri{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new YG(t)}),this.register(function(t){return new ZG(t)}),this.register(function(t){return new o5(t)}),this.register(function(t){return new a5(t)}),this.register(function(t){return new l5(t)}),this.register(function(t){return new QG(t)}),this.register(function(t){return new e5(t)}),this.register(function(t){return new t5(t)}),this.register(function(t){return new n5(t)}),this.register(function(t){return new KG(t)}),this.register(function(t){return new i5(t)}),this.register(function(t){return new JG(t)}),this.register(function(t){return new r5(t)}),this.register(function(t){return new s5(t)}),this.register(function(t){return new XG(t)}),this.register(function(t){return new c5(t)}),this.register(function(t){return new h5(t)})}load(e,t,i,s){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=Sr.extractUrlBase(e);o=Sr.resolveURL(c,this.path)}else o=Sr.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){s?s(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},l=new ts(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,o,function(h){t(h),r.manager.itemEnd(e)},a)}catch(h){a(h)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let r;const o={},a={},l=new TextDecoder;if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===vC){try{o[ut.KHR_BINARY_GLTF]=new u5(e)}catch(u){s&&s(u);return}r=JSON.parse(o[ut.KHR_BINARY_GLTF].content)}else r=JSON.parse(l.decode(e));else r=e;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new M5(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](c);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,o[u.name]=!0}if(r.extensionsUsed)for(let h=0;h<r.extensionsUsed.length;++h){const u=r.extensionsUsed[h],d=r.extensionsRequired||[];switch(u){case ut.KHR_MATERIALS_UNLIT:o[u]=new qG;break;case ut.KHR_DRACO_MESH_COMPRESSION:o[u]=new d5(r,this.dracoLoader);break;case ut.KHR_TEXTURE_TRANSFORM:o[u]=new p5;break;case ut.KHR_MESH_QUANTIZATION:o[u]=new f5;break;default:d.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,s)}parseAsync(e,t){const i=this;return new Promise(function(s,r){i.parse(e,t,s,r)})}}function jG(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const ut={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class XG{constructor(e){this.parser=e,this.name=ut.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const r=t[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const h=new ve(16777215);l.color!==void 0&&h.setRGB(l.color[0],l.color[1],l.color[2],Gn);const u=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new hg(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new cg(h),c.distance=u;break;case"spot":c=new lg(h),c.distance=u,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),ks(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),s=Promise.resolve(c),t.cache.add(i,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}}class qG{constructor(){this.name=ut.KHR_MATERIALS_UNLIT}getMaterialType(){return yi}extendParams(e,t,i){const s=[];e.color=new ve(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],Gn),e.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(e,"map",r.baseColorTexture,gn))}return Promise.all(s)}}class KG{constructor(e){this.parser=e,this.name=ut.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class YG{constructor(e){this.parser=e,this.name=ut.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Wi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ee(a,a)}return Promise.all(r)}}class ZG{constructor(e){this.parser=e,this.name=ut.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Wi}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}}class JG{constructor(e){this.parser=e,this.name=ut.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Wi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}class QG{constructor(e){this.parser=e,this.name=ut.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Wi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new ve(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=s.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],Gn)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,gn)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class e5{constructor(e){this.parser=e,this.name=ut.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Wi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class t5{constructor(e){this.parser=e,this.name=ut.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Wi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new ve().setRGB(a[0],a[1],a[2],Gn),Promise.all(r)}}class n5{constructor(e){this.parser=e,this.name=ut.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Wi}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class i5{constructor(e){this.parser=e,this.name=ut.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Wi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new ve().setRGB(a[0],a[1],a[2],Gn),o.specularColorTexture!==void 0&&r.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,gn)),Promise.all(r)}}class s5{constructor(e){this.parser=e,this.name=ut.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Wi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(r)}}class r5{constructor(e){this.parser=e,this.name=ut.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Wi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}}class o5{constructor(e){this.parser=e,this.name=ut.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class a5{constructor(e){this.parser=e,this.name=ut.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class l5{constructor(e){this.parser=e,this.name=ut.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class c5{constructor(e){this.name=ut.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=s.byteOffset||0,c=s.byteLength||0,h=s.count,u=s.byteStride,d=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,u,d,s.mode,s.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(h*u);return o.decodeGltfBuffer(new Uint8Array(p),h,u,d,s.mode,s.filter),p})})}else return null}}class h5{constructor(e){this.name=ut.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=t.meshes[i.mesh];for(const c of s.primitives)if(c.mode!==Ni.TRIANGLES&&c.mode!==Ni.TRIANGLE_STRIP&&c.mode!==Ni.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(h=>(l[c]=h,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const h=c.pop(),u=h.isGroup?h.children:[h],d=c[0].count,p=[];for(const f of u){const g=new De,m=new R,v=new In,x=new R(1,1,1),b=new jv(f.geometry,f.material,d);for(let _=0;_<d;_++)l.TRANSLATION&&m.fromBufferAttribute(l.TRANSLATION,_),l.ROTATION&&v.fromBufferAttribute(l.ROTATION,_),l.SCALE&&x.fromBufferAttribute(l.SCALE,_),b.setMatrixAt(_,g.compose(m,v,x));for(const _ in l)if(_==="_COLOR_0"){const C=l[_];b.instanceColor=new No(C.array,C.itemSize,C.normalized)}else _!=="TRANSLATION"&&_!=="ROTATION"&&_!=="SCALE"&&f.geometry.setAttribute(_,l[_]);ft.prototype.copy.call(b,f),this.parser.assignFinalMaterial(b),p.push(b)}return h.isGroup?(h.clear(),h.add(...p),h):p[0]}))}}const vC="glTF",Ql=12,py={JSON:1313821514,BIN:5130562};class u5{constructor(e){this.name=ut.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Ql),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==vC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Ql,r=new DataView(e,Ql);let o=0;for(;o<s;){const a=r.getUint32(o,!0);o+=4;const l=r.getUint32(o,!0);if(o+=4,l===py.JSON){const c=new Uint8Array(e,Ql+o,a);this.content=i.decode(c)}else if(l===py.BIN){const c=Ql+o;this.body=e.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class d5{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ut.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const h in o){const u=xv[h]||h.toLowerCase();a[u]=o[h]}for(const h in e.attributes){const u=xv[h]||h.toLowerCase();if(o[h]!==void 0){const d=i.accessors[e.attributes[h]],p=Wa[d.componentType];c[u]=p.name,l[u]=d.normalized===!0}}return t.getDependency("bufferView",r).then(function(h){return new Promise(function(u,d){s.decodeDracoFile(h,function(p){for(const f in p.attributes){const g=p.attributes[f],m=l[f];m!==void 0&&(g.normalized=m)}u(p)},a,c,Gn,d)})})}}class p5{constructor(){this.name=ut.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class f5{constructor(){this.name=ut.KHR_MESH_QUANTIZATION}}class gC extends fl{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let o=0;o!==s;o++)t[o]=i[r+o];return t}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,h=s-t,u=(i-t)/h,d=u*u,p=d*u,f=e*c,g=f-c,m=-2*p+3*d,v=p-d,x=1-m,b=v-d+u;for(let _=0;_!==a;_++){const C=o[g+_+a],M=o[g+_+l]*h,S=o[f+_+a],P=o[f+_]*h;r[_]=x*C+b*M+m*S+v*P}return r}}const m5=new In;class v5 extends gC{interpolate_(e,t,i,s){const r=super.interpolate_(e,t,i,s);return m5.fromArray(r).normalize().toArray(r),r}}const Ni={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Wa={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},fy={9728:xn,9729:sn,9984:Yd,9985:Fa,9986:wo,9987:ki},my={33071:xi,33648:qa,10497:Rr},Tm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xv={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},br={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},g5={CUBICSPLINE:void 0,LINEAR:el,STEP:Qa},Pm={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function _5(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new pl({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ms})),n.DefaultMaterial}function vo(n,e,t){for(const i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function ks(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function b5(n,e,t){let i=!1,s=!1,r=!1;for(let c=0,h=e.length;c<h;c++){const u=e[c];if(u.POSITION!==void 0&&(i=!0),u.NORMAL!==void 0&&(s=!0),u.COLOR_0!==void 0&&(r=!0),i&&s&&r)break}if(!i&&!s&&!r)return Promise.resolve(n);const o=[],a=[],l=[];for(let c=0,h=e.length;c<h;c++){const u=e[c];if(i){const d=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):n.attributes.position;o.push(d)}if(s){const d=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):n.attributes.normal;a.push(d)}if(r){const d=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):n.attributes.color;l.push(d)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const h=c[0],u=c[1],d=c[2];return i&&(n.morphAttributes.position=h),s&&(n.morphAttributes.normal=u),r&&(n.morphAttributes.color=d),n.morphTargetsRelative=!0,n})}function x5(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,s=t.length;i<s;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function y5(n){let e;const t=n.extensions&&n.extensions[ut.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Rm(t.attributes):e=n.indices+":"+Rm(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,s=n.targets.length;i<s;i++)e+=":"+Rm(n.targets[i]);return e}function Rm(n){let e="";const t=Object.keys(n).sort();for(let i=0,s=t.length;i<s;i++)e+=t[i]+":"+n[t[i]]+";";return e}function yv(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function w5(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":n.search(/\.ktx2($|\?)/i)>0||n.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const E5=new De;class M5{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new jG,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=-1,r=!1,o=-1;if(typeof navigator<"u"){const a=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(a)===!0;const l=a.match(/Version\/(\d+)/);s=i&&l?parseInt(l[1],10):-1,r=a.indexOf("Firefox")>-1,o=r?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&s<17||r&&o<98?this.textureLoader=new bE(this.options.manager):this.textureLoader=new AE(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ts(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:i,userData:{}};return vo(r,a,s),ks(a,s),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const o=t[s].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const o=e[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),r=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,h]of o.children.entries())r(h,a.children[c])};return r(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[ut.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){i.load(Sr.resolveURL(t.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteLength||0,r=t.byteOffset||0;return i.slice(r,r+s)})}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const o=Tm[s.type],a=Wa[s.componentType],l=s.normalized===!0,c=new a(s.count*o);return Promise.resolve(new dt(c,o,l))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=Tm[s.type],c=Wa[s.componentType],h=c.BYTES_PER_ELEMENT,u=h*l,d=s.byteOffset||0,p=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,f=s.normalized===!0;let g,m;if(p&&p!==u){const v=Math.floor(d/p),x="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+v+":"+s.count;let b=t.cache.get(x);b||(g=new c(a,v*p,s.count*p/h),b=new Zc(g,p/h),t.cache.add(x,b)),m=new Lr(b,l,d%p/h,f)}else a===null?g=new c(s.count*l):g=new c(a,d,s.count*l),m=new dt(g,l,f);if(s.sparse!==void 0){const v=Tm.SCALAR,x=Wa[s.sparse.indices.componentType],b=s.sparse.indices.byteOffset||0,_=s.sparse.values.byteOffset||0,C=new x(o[1],b,s.sparse.count*v),M=new c(o[2],_,s.sparse.count*l);a!==null&&(m=new dt(m.array.slice(),m.itemSize,m.normalized)),m.normalized=!1;for(let S=0,P=C.length;S<P;S++){const E=C[S];if(m.setX(E,M[S*l]),l>=2&&m.setY(E,M[S*l+1]),l>=3&&m.setZ(E,M[S*l+2]),l>=4&&m.setW(E,M[S*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}m.normalized=f}return m})}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e].source,o=t.images[r];let a=this.textureLoader;if(o.uri){const l=i.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,i){const s=this,r=this.json,o=r.textures[e],a=r.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(h){h.flipY=!1,h.name=o.name||a.name||"",h.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(h.name=a.uri);const d=(r.samplers||{})[o.sampler]||{};return h.magFilter=fy[d.magFilter]||sn,h.minFilter=fy[d.minFilter]||ki,h.wrapS=my[d.wrapS]||Rr,h.wrapT=my[d.wrapT]||Rr,h.generateMipmaps=!h.isCompressedTexture&&h.minFilter!==xn&&h.minFilter!==sn,s.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const i=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const o=s.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(u){c=!0;const d=new Blob([u],{type:o.mimeType});return l=a.createObjectURL(d),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(u){return new Promise(function(d,p){let f=d;t.isImageBitmapLoader===!0&&(f=function(g){const m=new Wt(g);m.needsUpdate=!0,d(m)}),t.load(Sr.resolveURL(u,r.path),f,void 0,p)})}).then(function(u){return c===!0&&a.revokeObjectURL(l),ks(u,o),u.userData.mimeType=o.mimeType||w5(o.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),u});return this.sourceCache[e]=h,h}assignTexture(e,t,i,s){const r=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),r.extensions[ut.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[ut.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[ut.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return s!==void 0&&(o.colorSpace=s),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new dp,En.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new $n,En.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(s||r||o){let a="ClonedMaterial:"+i.uuid+":";s&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return pl}loadMaterial(e){const t=this,i=this.json,s=this.extensions,r=i.materials[e];let o;const a={},l=r.extensions||{},c=[];if(l[ut.KHR_MATERIALS_UNLIT]){const u=s[ut.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),c.push(u.extendParams(a,r,t))}else{const u=r.pbrMetallicRoughness||{};if(a.color=new ve(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const d=u.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],Gn),a.opacity=d[3]}u.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",u.baseColorTexture,gn)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=bi);const h=r.alphaMode||Pm.OPAQUE;if(h===Pm.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===Pm.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==yi&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new ee(1,1),r.normalTexture.scale!==void 0)){const u=r.normalTexture.scale;a.normalScale.set(u,u)}if(r.occlusionTexture!==void 0&&o!==yi&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==yi){const u=r.emissiveFactor;a.emissive=new ve().setRGB(u[0],u[1],u[2],Gn)}return r.emissiveTexture!==void 0&&o!==yi&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,gn)),Promise.all(c).then(function(){const u=new o(a);return r.name&&(u.name=r.name),ks(u,r),t.associations.set(u,{materials:e}),r.extensions&&vo(s,u,r),u})}createUniqueName(e){const t=gt.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function r(a){return i[ut.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return vy(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],h=y5(c),u=s[h];if(u)o.push(u.promise);else{let d;c.extensions&&c.extensions[ut.KHR_DRACO_MESH_COMPRESSION]?d=r(c):d=vy(new Ye,c,t),s[h]={primitive:c,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,s=this.extensions,r=i.meshes[e],o=r.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const h=o[l].material===void 0?_5(this.cache):this.getDependency("material",o[l].material);a.push(h)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],u=[];for(let p=0,f=h.length;p<f;p++){const g=h[p],m=o[p];let v;const x=c[p];if(m.mode===Ni.TRIANGLES||m.mode===Ni.TRIANGLE_STRIP||m.mode===Ni.TRIANGLE_FAN||m.mode===void 0)v=r.isSkinnedMesh===!0?new $v(g,x):new Kt(g,x),v.isSkinnedMesh===!0&&v.normalizeSkinWeights(),m.mode===Ni.TRIANGLE_STRIP?v.geometry=dy(v.geometry,Uv):m.mode===Ni.TRIANGLE_FAN&&(v.geometry=dy(v.geometry,Ad));else if(m.mode===Ni.LINES)v=new ns(g,x);else if(m.mode===Ni.LINE_STRIP)v=new Js(g,x);else if(m.mode===Ni.LINE_LOOP)v=new Xv(g,x);else if(m.mode===Ni.POINTS)v=new pp(g,x);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(v.geometry.morphAttributes).length>0&&x5(v,r),v.name=t.createUniqueName(r.name||"mesh_"+e),ks(v,r),m.extensions&&vo(s,v,m),t.assignFinalMaterial(v),u.push(v)}for(let p=0,f=u.length;p<f;p++)t.associations.set(u[p],{meshes:e,primitives:p});if(u.length===1)return r.extensions&&vo(s,u[0],r),u[0];const d=new wi;r.extensions&&vo(s,d,r),t.associations.set(d,{meshes:e});for(let p=0,f=u.length;p<f;p++)d.add(u[p]);return d})}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new _n(sp.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(t=new ml(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),ks(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let s=0,r=t.joints.length;s<r;s++)i.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const r=s.pop(),o=s,a=[],l=[];for(let c=0,h=o.length;c<h;c++){const u=o[c];if(u){a.push(u);const d=new De;r!==null&&d.fromArray(r.array,c*16),l.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new Jc(a,l)})}loadAnimation(e){const t=this.json,i=this,s=t.animations[e],r=s.name?s.name:"animation_"+e,o=[],a=[],l=[],c=[],h=[];for(let u=0,d=s.channels.length;u<d;u++){const p=s.channels[u],f=s.samplers[p.sampler],g=p.target,m=g.node,v=s.parameters!==void 0?s.parameters[f.input]:f.input,x=s.parameters!==void 0?s.parameters[f.output]:f.output;g.node!==void 0&&(o.push(this.getDependency("node",m)),a.push(this.getDependency("accessor",v)),l.push(this.getDependency("accessor",x)),c.push(f),h.push(g))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(u){const d=u[0],p=u[1],f=u[2],g=u[3],m=u[4],v=[];for(let x=0,b=d.length;x<b;x++){const _=d[x],C=p[x],M=f[x],S=g[x],P=m[x];if(_===void 0)continue;_.updateMatrix&&_.updateMatrix();const E=i._createAnimationTracks(_,C,M,S,P);if(E)for(let y=0;y<E.length;y++)v.push(E[y])}return new sl(r,void 0,v)})}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=s.weights.length;l<c;l++)a.morphTargetInfluences[l]=s.weights[l]}),o})}loadNode(e){const t=this.json,i=this,s=t.nodes[e],r=i._loadNodeShallow(e),o=[],a=s.children||[];for(let c=0,h=a.length;c<h;c++)o.push(i.getDependency("node",a[c]));const l=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([r,Promise.all(o),l]).then(function(c){const h=c[0],u=c[1],d=c[2];d!==null&&h.traverse(function(p){p.isSkinnedMesh&&p.bind(d,E5)});for(let p=0,f=u.length;p<f;p++)h.add(u[p]);return h})}_loadNodeShallow(e){const t=this.json,i=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],o=r.name?s.createUniqueName(r.name):"",a=[],l=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),r.camera!==void 0&&a.push(s.getDependency("camera",r.camera).then(function(c){return s._getNodeRef(s.cameraCache,r.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let h;if(r.isBone===!0?h=new up:c.length>1?h=new wi:c.length===1?h=c[0]:h=new ft,h!==c[0])for(let u=0,d=c.length;u<d;u++)h.add(c[u]);if(r.name&&(h.userData.name=r.name,h.name=o),ks(h,r),r.extensions&&vo(i,h,r),r.matrix!==void 0){const u=new De;u.fromArray(r.matrix),h.applyMatrix4(u)}else r.translation!==void 0&&h.position.fromArray(r.translation),r.rotation!==void 0&&h.quaternion.fromArray(r.rotation),r.scale!==void 0&&h.scale.fromArray(r.scale);return s.associations.has(h)||s.associations.set(h,{}),s.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],s=this,r=new wi;i.name&&(r.name=s.createUniqueName(i.name)),ks(r,i),i.extensions&&vo(t,r,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(s.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let h=0,u=l.length;h<u;h++)r.add(l[h]);const c=h=>{const u=new Map;for(const[d,p]of s.associations)(d instanceof En||d instanceof Wt)&&u.set(d,p);return h.traverse(d=>{const p=s.associations.get(d);p!=null&&u.set(d,p)}),u};return s.associations=c(r),r})}_createAnimationTracks(e,t,i,s,r){const o=[],a=e.name?e.name:e.uuid,l=[];br[r.path]===br.weights?e.traverse(function(d){d.morphTargetInfluences&&l.push(d.name?d.name:d.uuid)}):l.push(a);let c;switch(br[r.path]){case br.weights:c=ko;break;case br.rotation:c=Uo;break;case br.translation:case br.scale:c=Fo;break;default:switch(i.itemSize){case 1:c=ko;break;case 2:case 3:default:c=Fo;break}break}const h=s.interpolation!==void 0?g5[s.interpolation]:el,u=this._getArrayFromAccessor(i);for(let d=0,p=l.length;d<p;d++){const f=new c(l[d]+"."+br[r.path],t.array,u,h);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(f),o.push(f)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=yv(t.constructor),s=new Float32Array(t.length);for(let r=0,o=t.length;r<o;r++)s[r]=t[r]*i;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const s=this instanceof Uo?v5:gC;return new s(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function S5(n,e,t){const i=e.attributes,s=new yn;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(s.set(new R(l[0],l[1],l[2]),new R(c[0],c[1],c[2])),a.normalized){const h=yv(Wa[a.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new R,l=new R;for(let c=0,h=r.length;c<h;c++){const u=r[c];if(u.POSITION!==void 0){const d=t.json.accessors[u.POSITION],p=d.min,f=d.max;if(p!==void 0&&f!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(f[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(f[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(f[2]))),d.normalized){const g=yv(Wa[d.componentType]);l.multiplyScalar(g)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}n.boundingBox=s;const o=new wn;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,n.boundingSphere=o}function vy(n,e,t){const i=e.attributes,s=[];function r(o,a){return t.getDependency("accessor",o).then(function(l){n.setAttribute(a,l)})}for(const o in i){const a=xv[o]||o.toLowerCase();a in n.attributes||s.push(r(i[o],a))}if(e.indices!==void 0&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});s.push(o)}return ht.workingColorSpace!==Gn&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ht.workingColorSpace}" not supported.`),ks(n,e),S5(n,e,t),Promise.all(s).then(function(){return e.targets!==void 0?b5(n,e.targets,t):n})}const C5=n=>{const e={nodes:{},materials:{}};return n&&n.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e};function A5(n,e){const t=typeof n=="string"?e:n,i=MN($G,{extend(o){t!=null&&t.dracoLoader&&o.setDRACOLoader(t.dracoLoader),t!=null&&t.meshoptDecoder&&o.setMeshoptDecoder(t.meshoptDecoder),t!=null&&t.ktx2Loader&&o.setKTX2Loader(t.ktx2Loader)}}),s=o=>i.load(o,{transform(a){return{...a,...C5(a.scene)}}}),r=typeof n=="string"?n:void 0;return r?s(r):{load:s}}const gy=n=>!!(n!=null&&n.isObject3D),T5=n=>!!(n!=null&&n.subscribe)&&typeof n.subscribe=="function";function P5(n,e){const t=T5(n)?n:Ln(void 0),i=Ht(gy(n)?n:gy(e)?e:void 0),s=jc([i,t],([c,h])=>c??(h==null?void 0:h.scene)),r=Ht({}),o=new DE(void 0);Vn([t,s],async([c,h])=>{if(!c||!c.animations.length||!h)return;await Xd();const u=c.animations.reduce((d,p)=>{const f=o.clipAction(p,h);return{...d,[p.name]:f}},{});return r.set(u),()=>{Object.values(u).forEach(d=>{const p=d;p.stop(),o.uncacheClip(p.getClip())})}});const{start:a,stop:l}=gl(c=>{o.update(c)},{autoStart:!1});return Vn(r,c=>{Object.keys(c).length?a():l()}),{gltf:t,root:i,mixer:o,actions:r}}const go=n=>({subscribe:n.subscribe,get current(){return n.current}});let mc=0;const E_=Ht(!1),Kp=Ht(!1),M_=Ht(void 0),S_=Ht(0),C_=Ht(0),_C=Ht([]),A_=Ht(0),{onStart:Lm,onLoad:Im,onError:Dm}=Jo;Jo.onStart=(n,e,t)=>{Lm==null||Lm(n,e,t),Kp.set(!0),M_.set(n),S_.set(e),C_.set(t);const i=(e-mc)/(t-mc);A_.set(i),i===1&&E_.set(!0)};Jo.onLoad=()=>{Im==null||Im(),Kp.set(!1)};Jo.onError=n=>{Dm==null||Dm(n),_C.update(e=>[...e,n])};Jo.onProgress=(n,e,t)=>{e===t&&(mc=t),Kp.set(!0),M_.set(n),S_.set(e),C_.set(t);const i=(e-mc)/(t-mc)||1;A_.set(i),i===1&&E_.set(!0)};go(Kp),go(M_),go(S_),go(C_),go(_C),go(A_),go(E_);new R;new R;new R;new wn;new De;new Br;new R;const jo=new R,Yp=new R,R5=new R,L5=new ee,I5=(n,e,t)=>{const i=jo.setFromMatrixPosition(n.matrixWorld);i.project(e);const s=t.width/2,r=t.height/2;return[i.x*s+s,-(i.y*r)+r]},D5=(n,e)=>{const t=jo.setFromMatrixPosition(n.matrixWorld),i=Yp.setFromMatrixPosition(e.matrixWorld),s=t.sub(i),r=e.getWorldDirection(R5);return s.angleTo(r)>Math.PI/2},N5=(n,e,t,i)=>{const s=jo.setFromMatrixPosition(n.matrixWorld),r=Yp.copy(jo);r.project(e),t.setFromCamera(L5.set(r.x,r.y),e);const o=t.intersectObjects(i,!0);if(o.length){const a=o[0].distance;return s.distanceTo(t.ray.origin)<a}return!0},O5=(n,e)=>{if(On(e,"OrthographicCamera"))return e.zoom;if(On(e,"PerspectiveCamera")){const t=jo.setFromMatrixPosition(n.matrixWorld),i=Yp.setFromMatrixPosition(e.matrixWorld),s=e.fov*Math.PI/180,r=t.distanceTo(i);return 1/(2*Math.tan(s/2)*r)}else return 1},k5=(n,e,t)=>{const i=jo.setFromMatrixPosition(n.matrixWorld),s=Yp.setFromMatrixPosition(e.matrixWorld),r=i.distanceTo(s),o=(t[1]-t[0])/(e.far-e.near),a=t[1]-o*e.far;return Math.round(o*r+a)},An=n=>Math.abs(n)<1e-10?0:n,bC=(n,e,t="")=>{const{elements:i}=n;return`${t}matrix3d(
    ${An(e[0]*i[0])},${An(e[1]*i[1])},${An(e[2]*i[2])},${An(e[3]*i[3])},
    ${An(e[4]*i[4])},${An(e[5]*i[5])},${An(e[6]*i[6])},${An(e[7]*i[7])},
    ${An(e[8]*i[8])},${An(e[9]*i[9])},${An(e[10]*i[10])},${An(e[11]*i[11])},
    ${An(e[12]*i[12])},${An(e[13]*i[13])},${An(e[14]*i[14])},${An(e[15]*i[15])}
  )`},U5=(n=>e=>bC(e,n))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),F5=(n=>(e,t)=>bC(e,n(t),"translate(-50%,-50%)"))(n=>[1/n,1/n,1/n,1,-1/n,-1/n,-1/n,-1,1/n,1/n,1/n,1,1,1,1,1]),B5=(n,e,t)=>{if(On(n,"OrthographicCamera"))return 1;if(On(n,"PerspectiveCamera")){const{width:i,height:s}=t,r=n.getWorldPosition(jo).distanceTo(e),o=n.fov*Math.PI/180,l=2*Math.tan(o/2)*r*(i/s);return i/l}throw new Error("getViewportFactor needs a Perspective or Orthographic Camera")},V5=`
#include <common>
#include <logdepthbuf_pars_vertex>
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    #include <logdepthbuf_vertex>
}`,_y=`
#include <logdepthbuf_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4(0.0,0.0,0.0,0.0);
}`,z5=`
#include <common>
#include <logdepthbuf_pars_vertex>

void main() {
  vec2 center = vec2(0., 1.);
  float rotation = 0.0;
  
  // This is somewhat arbitrary, but it seems to work well
  // Need to figure out how to derive this dynamically if it even matters
  float size = 0.03;

  vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  vec2 scale = vec2(
    length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) ),
    length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) )
  );

  bool isPerspective = isPerspectiveMatrix( projectionMatrix );
  if ( isPerspective ) scale *= - mvPosition.z;

  vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
  rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
  mvPosition.xy += rotatedPosition;

  gl_Position = projectionMatrix * mvPosition;
  #include <logdepthbuf_vertex>
}`;let Mu=!1,Hd=0,by="",xy="",yy="";const wy=(n,e)=>{Hd===1&&!Mu?(by=n.style.zIndex,xy=n.style.position,yy=n.style.pointerEvents,n.style.zIndex=`${Math.floor(e/2)}`,n.style.position="absolute",n.style.pointerEvents="none",Mu=!0):Hd===0&&Mu&&(n.style.zIndex=by,n.style.position=xy,n.style.pointerEvents=yy,Mu=!1)};var H5=Ft("<!> <!>",1),G5=Ft("<div><div><div><!></div></div></div>"),W5=Ft("<div><!></div>"),$5=Ft("<!> <!>",1);function j5(n,e){on(e,!0);const[t,i]=qo(),s=()=>fs(M,"$size",t),r=()=>fs(_,"$camera",t);let o=ie(e,"autoRender",3,!0),a=ie(e,"eps",3,.001),l=ie(e,"center",3,!1),c=ie(e,"fullscreen",3,!1),h=ie(e,"sprite",3,!1),u=ie(e,"transform",3,!1),d=ie(e,"occlude",3,!1),p=ie(e,"zIndexRange",19,()=>[16777271,0]),f=ie(e,"calculatePosition",3,I5),g=ie(e,"as",3,"div"),m=ie(e,"pointerEvents",3,"auto"),v=ie(e,"ref",15),x=ie(e,"visible",15),b=kr(e,["$$slots","$$events","$$legacy","autoRender","eps","center","fullscreen","portal","distanceFactor","sprite","transform","occlude","castShadow","receiveShadow","material","geometry","zIndexRange","calculatePosition","as","wrapperClass","pointerEvents","ref","visible","style","children"]);x(!0);const{camera:_,scene:C,size:M,dom:S,canvas:P}=_l(),E=new wi;let y=document.createElement(g()),L=0,k=[0,0],D=Xa(void 0),W=Xa(void 0),z=!1;const H=new Kt,ne=new mg;let G=un(()=>d()&&d()!=="blending"||Array.isArray(d())&&d().length>0),ae=new De,se=un(()=>s().width),ge=un(()=>s().height),Oe=un(()=>I(se)/2),Ze=un(()=>I(ge)/2),J=un(()=>r().projectionMatrix.elements[5]*I(Ze)),ce=un(()=>B5(r(),new R,s()));hn(()=>{e.wrapperClass&&(y.className=e.wrapperClass)}),hn(()=>(d()==="blending"&&(Hd+=1,wy(P,p()[0])),()=>{Hd-=1,wy(P,p()[0])}));const _e=()=>{_.current.updateMatrixWorld(),E.updateWorldMatrix(!0,!1);const Qe=u()?k:f()(E,_.current,s());if(u()||Math.abs(L-_.current.zoom)>a()||Math.abs(k[0]-Qe[0])>a()||Math.abs(k[1]-Qe[1])>a()){const q=D5(E,_.current);let te=!1;I(G)&&(Array.isArray(d())?te=d():d()!=="blending"&&(te=[C]));const K=x();if(te){const T=N5(E,_.current,ne,te);x(T&&!q)}else x(!q);K!==x()&&(e.onvisibilitychange?e.onvisibilitychange(x()):y.style.display=x()?"block":"none");const de=Math.floor(p()[0]/2),Y=d()?I(G)?[p()[0],de]:[de-1,0]:p();if(y.style.zIndex=`${k5(E,_.current,Y)}`,u()&&I(D)&&I(W)){const{isOrthographicCamera:T,top:w,left:U,bottom:j,right:Z}=_.current,O=U5(_.current.matrixWorldInverse),he=T?`scale(${I(J)})translate(${An(-(Z+U)/2)}px,${An((w+j)/2)}px)`:`translateZ(${I(J)}px)`;h()?(ae.copy(_.current.matrixWorldInverse).transpose().copyPosition(ae).scale(E.scale),ae.elements[3]=ae.elements[7]=ae.elements[11]=0,ae.elements[15]=1):ae.copy(E.matrixWorld),y.style.width=`${I(se)}px`,y.style.height=`${I(ge)}px`,y.style.perspective=T?"":`${I(J)}px`,I(D).style.transform=`${he}${O}translate(${I(Oe)}px,${I(Ze)}px)`,I(W).style.transform=F5(ae,1/((e.distanceFactor||10)/400))}else{const T=e.distanceFactor===void 0?1:O5(E,_.current)*e.distanceFactor;y.style.transform=`translate3d(${Qe[0]}px,${Qe[1]}px,0) scale(${T})`}k=Qe,L=_.current.zoom}if(!I(G)&&!z)if(u()&&I(D)){const q=I(D).children[0];if(q!=null&&q.clientWidth&&(q!=null&&q.clientHeight)){const{isOrthographicCamera:te}=_.current;if(te||e.geometry){const{scale:K}=b;K&&(Array.isArray(K)?H.scale.set(1/K[0],1/K[1],1/K[2]):H.scale.setScalar(1/K))}else{const K=(e.distanceFactor??10)/400,de=q.clientWidth*K,Y=q.clientHeight*K;H.scale.set(de,Y,1)}z=!0}}else{const q=y.children[0];if(q!=null&&q.clientWidth&&(q!=null&&q.clientHeight)){const te=1/I(ce),K=q.clientWidth*te,de=q.clientHeight*te;H.scale.set(K,de,1),z=!0}H.lookAt(_.current.position)}},{start:pe,stop:Re}=gl(_e,{autoStart:!1});Bs(()=>{if(o())return pe(),()=>{Re()}});let nt=un(()=>(C.updateMatrixWorld(),f()(E,r(),s())));const Le=Qe=>{const q=e.portal??S;if(!q){console.warn("<HTML>: target is undefined.");return}return q.append(Qe),{destroy:()=>Qe.remove()}};var rt=$5(),mt=Be(rt);lt(mt,zn({is:E},()=>b,{get ref(){return v()},set ref(Qe){v(Qe)},children:(Qe,q)=>{var te=pt(),K=Be(te);{var de=Y=>{lt(Y,{is:H,get castShadow(){return e.castShadow},get receiveShadow(){return e.receiveShadow},children:(T,w)=>{var U=H5(),j=Be(U);{var Z=Ue=>{lt(Ue,{get is(){return e.geometry}})},O=Ue=>{var le=pt(),Ee=Be(le);Nn(Ee,()=>lt.PlaneGeometry,(ke,Ie)=>{Ie(ke,{})}),Pe(Ue,le)};Pn(j,Ue=>{e.geometry?Ue(Z):Ue(O,!1)})}var he=vt(j,2);{var oe=Ue=>{lt(Ue,{get is(){return e.material}})},fe=(Ue,le)=>{{var Ee=Ie=>{var be=pt(),at=Be(be);Nn(at,()=>lt.ShaderMaterial,(qe,At)=>{At(qe,{side:bi,vertexShader:z5,fragmentShader:_y})}),Pe(Ie,be)},ke=Ie=>{var be=pt(),at=Be(be);Nn(at,()=>lt.ShaderMaterial,(qe,At)=>{At(qe,{side:bi,vertexShader:V5,fragmentShader:_y})}),Pe(Ie,be)};Pn(Ue,Ie=>{u()?Ie(ke,!1):Ie(Ee)},le)}};Pn(he,Ue=>{e.material?Ue(oe):Ue(fe,!1)})}Pe(T,U)},$$slots:{default:!0}})};Pn(K,Y=>{d()&&!I(G)&&Y(de)})}Pe(Qe,te)},$$slots:{default:!0}}));var Ge=vt(mt,2);c1(Ge,g,!1,(Qe,q)=>{h1(Qe,w=>Le==null?void 0:Le(w)),us(Qe,w=>y=w,()=>y);let te;sc(()=>te=m1(Qe,te,{style:"",[Da]:{position:"absolute",top:"0",left:"0","pointer-events":u()?"none":void 0,overflow:u()?"hidden":void 0,transform:u()?void 0:`translate3d(${I(nt)[0]}px,${I(nt)[1]}px,0)`,"transform-origin":u()?void 0:"0 0"}}));var K=pt(),de=Be(K);{var Y=w=>{var U=G5();let j;var Z=Jn(U);let O;var he=Jn(Z),oe=Jn(he);Qi(oe,()=>e.children??cs,()=>({render:_e,startRendering:pe,stopRendering:Re})),Qn(he),Qn(Z),us(Z,fe=>st(W,fe),()=>I(W)),Qn(U),us(U,fe=>st(D,fe),()=>I(D)),sc(()=>{j=_i(U,"",j,{position:"absolute",top:"0",left:"0","transform-style":"preserve-3d","pointer-events":"none",width:`${I(se)}px`,height:`${I(ge)}px`}),O=_i(Z,"",O,{position:"absolute","pointer-events":m()}),Gu(he,1,Um(e.class)),_i(he,e.style)}),Pe(w,U)},T=w=>{var U=W5();let j;var Z=Jn(U);Qi(Z,()=>e.children??cs,()=>({render:_e,startRendering:pe,stopRendering:Re})),Qn(U),sc(()=>{j=_i(U,e.style,j,{position:"absolute",transform:l()?"translate3d(-50%,-50%,0)":"none",top:c()?`${-I(ge)/2}px`:void 0,left:c()?`${-I(se)/2}px`:void 0,width:c()?`${I(se)}px`:void 0,height:c()?`${I(ge)}px`:void 0}),Gu(U,1,Um(e.class))}),Pe(w,U)};Pn(de,w=>{u()?w(Y):w(T,!1)})}Pe(q,K)}),Pe(n,rt);var N=an({render:_e,startRendering:pe,stopRendering:Re});return i(),N}function X5(n,e){on(e,!0);let t=ie(e,"speed",3,1),i=ie(e,"floatIntensity",3,1),s=ie(e,"floatingRange",19,()=>[-.1,.1]),r=ie(e,"rotationSpeed",3,0),o=ie(e,"rotationIntensity",3,0),a=ie(e,"seed",19,()=>1e4*Math.random()),l=ie(e,"ref",15),c=kr(e,["$$slots","$$events","$$legacy","speed","floatIntensity","floatingRange","rotationSpeed","rotationIntensity","seed","ref","children"]);const h=new wi,u=new wi;let d=a();const p=sp.mapLinear;let f=un(()=>Array.isArray(t())?t():[t(),t(),t()]),g=un(()=>Array.isArray(i())?i():[i(),i(),i()]),m=un(()=>s().length===3?s():[[0,0],s(),[0,0]]),v=un(()=>Array.isArray(r())?r():[r(),r(),r()]),x=un(()=>Array.isArray(o())?o():[o(),o(),o()]);gl(b=>{d+=b,u.position.x=p(Math.sin(d/4*I(f)[0])/10,-.1,.1,...I(m)[0])*I(g)[0],u.position.y=p(Math.sin(d/4*I(f)[1])/10,-.1,.1,...I(m)[1])*I(g)[1],u.position.z=p(Math.sin(d/4*I(f)[2])/10,-.1,.1,...I(m)[2])*I(g)[2],u.rotation.x=Math.cos(d/4*I(v)[0])/8*I(x)[0],u.rotation.y=Math.sin(d/4*I(v)[1])/8*I(x)[1],u.rotation.z=Math.sin(d/4*I(v)[2])/20*I(x)[2],u.updateMatrix()}),lt(n,zn({is:h},()=>c,{children:(b,_)=>{lt(b,{is:u,matrixAutoUpdate:!1,get ref(){return l()},set ref(C){l(C)},children:(C,M)=>{var S=pt(),P=Be(S);Qi(P,()=>e.children??cs,()=>({ref:u})),Pe(C,S)},$$slots:{default:!0}})},$$slots:{default:!0}})),an()}const q5="Right",K5="Top",Y5="Front",Z5="Left",J5="Bottom",Q5="Back";[q5,K5,Y5,Z5,J5,Q5].map(n=>n.toLocaleLowerCase());new yn;new R;me.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new ee(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};Oi.line={uniforms:Hv.merge([me.common,me.fog,me.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};new ct;new R;new R;new ct;new ct;new ct;new R;new De;new NE;new R;new yn;new wn;new ct;const Ey={type:"change"},T_={type:"start"},xC={type:"end"},Su=new Br,My=new Us,eW=Math.cos(70*sp.DEG2RAD),mn=new R,ci=2*Math.PI,Nt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},Nm=1e-6;let tW=class extends kE{constructor(e,t=null){super(e,t),this.state=Nt.NONE,this.target=new R,this.cursor=new R,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:To.ROTATE,MIDDLE:To.DOLLY,RIGHT:To.PAN},this.touches={ONE:yo.ROTATE,TWO:yo.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new R,this._lastQuaternion=new In,this._lastTargetPosition=new R,this._quat=new In().setFromUnitVectors(e.up,new R(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Ld,this._sphericalDelta=new Ld,this._scale=1,this._panOffset=new R,this._rotateStart=new ee,this._rotateEnd=new ee,this._rotateDelta=new ee,this._panStart=new ee,this._panEnd=new ee,this._panDelta=new ee,this._dollyStart=new ee,this._dollyEnd=new ee,this._dollyDelta=new ee,this._dollyDirection=new R,this._mouse=new ee,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=iW.bind(this),this._onPointerDown=nW.bind(this),this._onPointerUp=sW.bind(this),this._onContextMenu=uW.bind(this),this._onMouseWheel=aW.bind(this),this._onKeyDown=lW.bind(this),this._onTouchStart=cW.bind(this),this._onTouchMove=hW.bind(this),this._onMouseDown=rW.bind(this),this._onMouseMove=oW.bind(this),this._interceptControlDown=dW.bind(this),this._interceptControlUp=pW.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Ey),this.update(),this.state=Nt.NONE}update(e=null){const t=this.object.position;mn.copy(t).sub(this.target),mn.applyQuaternion(this._quat),this._spherical.setFromVector3(mn),this.autoRotate&&this.state===Nt.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(i)&&isFinite(s)&&(i<-Math.PI?i+=ci:i>Math.PI&&(i-=ci),s<-Math.PI?s+=ci:s>Math.PI&&(s-=ci),i<=s?this._spherical.theta=Math.max(i,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+s)/2?Math.max(i,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let r=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),r=o!=this._spherical.radius}if(mn.setFromSpherical(this._spherical),mn.applyQuaternion(this._quatInverse),t.copy(this.target).add(mn),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=mn.length();o=this._clampDistance(a*this._scale);const l=a-o;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),r=!!l}else if(this.object.isOrthographicCamera){const a=new R(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),r=l!==this.object.zoom;const c=new R(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(a),this.object.updateMatrixWorld(),o=mn.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(Su.origin.copy(this.object.position),Su.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Su.direction))<eW?this.object.lookAt(this.target):(My.setFromNormalAndCoplanarPoint(this.object.up,this.target),Su.intersectPlane(My,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),r=!0)}return this._scale=1,this._performCursorZoom=!1,r||this._lastPosition.distanceToSquared(this.object.position)>Nm||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Nm||this._lastTargetPosition.distanceToSquared(this.target)>Nm?(this.dispatchEvent(Ey),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?ci/60*this.autoRotateSpeed*e:ci/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){mn.setFromMatrixColumn(t,0),mn.multiplyScalar(-e),this._panOffset.add(mn)}_panUp(e,t){this.screenSpacePanning===!0?mn.setFromMatrixColumn(t,1):(mn.setFromMatrixColumn(t,0),mn.crossVectors(this.object.up,mn)),mn.multiplyScalar(e),this._panOffset.add(mn)}_pan(e,t){const i=this.domElement;if(this.object.isPerspectiveCamera){const s=this.object.position;mn.copy(s).sub(this.target);let r=mn.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*r/i.clientHeight,this.object.matrix),this._panUp(2*t*r/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),s=e-i.left,r=t-i.top,o=i.width,a=i.height;this._mouse.x=s/o*2-1,this._mouse.y=-(r/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(ci*this._rotateDelta.x/t.clientHeight),this._rotateUp(ci*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._rotateStart.set(i,s)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._panStart.set(i,s)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,s=e.pageY-t.y,r=Math.sqrt(i*i+s*s);this._dollyStart.set(0,r)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),s=.5*(e.pageX+i.x),r=.5*(e.pageY+i.y);this._rotateEnd.set(s,r)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(ci*this._rotateDelta.x/t.clientHeight),this._rotateUp(ci*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._panEnd.set(i,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,s=e.pageY-t.y,r=Math.sqrt(i*i+s*s);this._dollyEnd.set(0,r),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new ee,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}};function nW(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function iW(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function sW(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(xC),this.state=Nt.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function rW(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case To.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=Nt.DOLLY;break;case To.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Nt.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Nt.ROTATE}break;case To.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Nt.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Nt.PAN}break;default:this.state=Nt.NONE}this.state!==Nt.NONE&&this.dispatchEvent(T_)}function oW(n){switch(this.state){case Nt.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case Nt.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case Nt.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function aW(n){this.enabled===!1||this.enableZoom===!1||this.state!==Nt.NONE||(n.preventDefault(),this.dispatchEvent(T_),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(xC))}function lW(n){this.enabled!==!1&&this._handleKeyDown(n)}function cW(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case yo.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=Nt.TOUCH_ROTATE;break;case yo.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=Nt.TOUCH_PAN;break;default:this.state=Nt.NONE}break;case 2:switch(this.touches.TWO){case yo.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=Nt.TOUCH_DOLLY_PAN;break;case yo.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=Nt.TOUCH_DOLLY_ROTATE;break;default:this.state=Nt.NONE}break;default:this.state=Nt.NONE}this.state!==Nt.NONE&&this.dispatchEvent(T_)}function hW(n){switch(this._trackPointer(n),this.state){case Nt.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case Nt.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case Nt.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case Nt.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=Nt.NONE}}function uW(n){this.enabled!==!1&&n.preventDefault()}function dW(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function pW(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const fW=()=>EN("threlte-controls",{orbitControls:Ln(void 0),trackballControls:Ln(void 0)});function mW(n,e){on(e,!0);const[t,i]=qo(),s=()=>fs(a,"$parent",t);let r=ie(e,"ref",15),o=kr(e,["$$slots","$$events","$$legacy","ref","children"]);const a=YE(),{dom:l,invalidate:c}=_l();if(!On(s(),"Camera"))throw new Error("Parent missing: <OrbitControls> need to be a child of a <Camera>");const h=new tW(s(),l),{orbitControls:u}=fW(),{start:d,stop:p}=gl(()=>{h.update()},{autoStart:!1,autoInvalidate:!1});hn(()=>{e.autoRotate||e.enableDamping?d():p()}),hn(()=>{const f=g=>{var m;c(),(m=e.onchange)==null||m.call(e,g)};return u.set(h),h.addEventListener("change",f),()=>{u.set(void 0),h.removeEventListener("change",f)}}),lt(n,zn({is:h},()=>o,{get ref(){return r()},set ref(f){r(f)},children:(f,g)=>{var m=pt(),v=Be(m);Qi(v,()=>e.children??cs,()=>({ref:h})),Pe(f,m)},$$slots:{default:!0}})),an(),i()}new De;new De;new Kt;`${ze.logdepthbuf_pars_vertex}${ze.fog_pars_vertex}${ze.logdepthbuf_vertex}${ze.fog_vertex}`;`${ze.tonemapping_fragment}${ze.colorspace_fragment}`;const vW=`
uniform sampler2D pointTexture;
uniform float fade;
uniform float opacity;

varying vec3 vColor;
void main() {
	float pointOpacity = 1.0;
	if (fade == 1.0) {
		float d = distance(gl_PointCoord, vec2(0.5, 0.5));
		pointOpacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));
	}
	gl_FragColor = vec4(vColor, pointOpacity * opacity);

	${ze.tonemapping_fragment}
	${ze.colorspace_fragment}
}`,gW=`uniform float time;
attribute float size;
varying vec3 vColor;
void main() {
	vColor = color;
	vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);
	gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(time + 100.0));
	gl_Position = projectionMatrix * mvPosition;
}`;var _W=Ft("<!> <!> <!>",1);function bW(n,e){on(e,!0);let t=ie(e,"count",3,5e3),i=ie(e,"radius",3,50),s=ie(e,"depth",3,50),r=ie(e,"factor",3,6),o=ie(e,"saturation",3,1),a=ie(e,"lightness",3,.8),l=ie(e,"speed",3,1),c=ie(e,"fade",3,!0),h=ie(e,"opacity",3,1),u=ie(e,"ref",15),d=kr(e,["$$slots","$$events","$$legacy","count","radius","depth","factor","saturation","lightness","speed","fade","opacity","ref","children"]);const p=new pp,f=new R,g=new Ld,m=new ve,v=y=>f.setFromSpherical(g.set(y,Math.acos(1-Math.random()*2),Math.random()*2*Math.PI));let x=new dt(new Float32Array(t()*3),3),b=new dt(new Float32Array(t()*3),3),_=new dt(new Float32Array(t()),1);hn(()=>{x=new dt(new Float32Array(t()*3),3),b=new dt(new Float32Array(t()*3),3),_=new dt(new Float32Array(t()),1)}),hn(()=>{const y=s()/t();let L=i()+s();for(let k=0;k<t();k+=1){L-=y*Math.random();const D=v(L);x.setXYZ(k,D.x,D.y,D.z),m.setHSL(k/t(),o(),a()),b.setXYZ(k,m.r,m.g,m.b),_.setX(k,(.5+.5*Math.random())*r())}});const{stop:C,start:M}=gl(y=>{S.time.value+=y*l()},{autoStart:!1});hn(()=>l()===0?C():M());const S={time:{value:0},fade:{value:1},opacity:{value:1}},P=new zi({uniforms:S,vertexShader:gW,fragmentShader:vW});hn(()=>{S.fade.value=c()?1:0}),hn(()=>{S.opacity.value=h()});const E=new Ye;E.setAttribute("position",x),E.setAttribute("color",b),E.setAttribute("size",_),lt(n,zn({is:p},()=>d,{get ref(){return u()},set ref(y){u(y)},children:(y,L)=>{var k=_W(),D=Be(k);lt(D,{is:E});var W=vt(D,2);lt(W,{is:P,blending:Wu,depthWrite:!1,transparent:!0,vertexColors:!0});var z=vt(W,2);Qi(z,()=>e.children??cs,()=>({ref:p})),Pe(y,k)},$$slots:{default:!0}})),an()}const xW=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,yW=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhIntersectFirstHit(		bvh,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)	_bvhIntersectFirstHit(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,wW=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,EW=wW,MW=`
	${xW}
	${yW}
`;`${EW}${MW}${ze.tonemapping_fragment}${ze.colorspace_fragment}`;new yn;new ve;typeof window<"u"&&document.createElement("div");const SW=n=>{const{camera:e}=_l();let t=n.current.clientWidth,i=n.current.clientHeight;const s=new ResizeObserver(([r])=>{t=r.contentRect.width,i=r.contentRect.height});return Vn(n,r=>(r&&s.observe(r),()=>{r&&s.unobserve(r)})),(r,o)=>{o.pointer.update(a=>(a.set(r.offsetX/t*2-1,-(r.offsetY/i)*2+1),a)),o.raycaster.setFromCamera(o.pointer.current,e.current)}},yC=Symbol("interactivity-context"),CW=()=>Yt(yC),AW=n=>{const e=Ht(Rp().dom),t={enabled:Ht(!0),pointer:Ht(new ee),pointerOverTarget:Ht(!1),lastEvent:void 0,raycaster:new mg,initialClick:[0,0],initialHits:[],hovered:new Map,interactiveObjects:[],target:e,handlers:new WeakMap,compute:SW(e),filter:n==null?void 0:n.filter,addInteractiveObject:(i,s)=>{t.interactiveObjects.indexOf(i)>-1||(t.handlers.set(i,s),t.interactiveObjects.push(i))},removeInteractiveObject:i=>{const s=t.interactiveObjects.indexOf(i);t.interactiveObjects.splice(s,1),t.handlers.delete(i)}};return Rn(yC,t),t},wC=()=>{const n=CW();if(!n)throw new Error("No interactivity context found. Did you forget to implement interactivity()?");return n},Sy=["onclick","oncontextmenu","ondblclick","onwheel","onpointerup","onpointerdown","onpointerover","onpointerout","onpointerenter","onpointerleave","onpointermove","onpointermissed"],TW=()=>{wN("interactivity",n=>{if(!On(n.ref,"Object3D")||!Object.entries(n.props).some(([s,r])=>r!==void 0&&Sy.includes(s)))return;const{addInteractiveObject:t,removeInteractiveObject:i}=wC();return ID.pre(()=>[n.ref],([s])=>(t(s,n.props),()=>{i(s)})),{pluginProps:Sy}})};function Cy(n){return`${(n.eventObject||n.object).uuid}/${n.index}${n.instanceId}`}const Ay=[["click",!1],["contextmenu",!1],["dblclick",!1],["wheel",!1],["pointerdown",!0],["pointerup",!0],["pointerleave",!0],["pointerenter",!0],["pointermove",!0],["pointercancel",!0]],PW=n=>{const{handlers:e}=wC(),t=c=>{const h=c.offsetX-n.initialClick[0],u=c.offsetY-n.initialClick[1];return Math.round(Math.hypot(h,u))},i=c=>{var h,u;for(const d of n.hovered.values())if(c.length===0||!c.some(p=>p.object===d.object&&p.index===d.index&&p.instanceId===d.instanceId)){const{eventObject:p}=d;n.hovered.delete(Cy(d));const f=e.get(p);if(f){const g={...d,intersections:c};(h=f.onpointerout)==null||h.call(f,g),(u=f.onpointerleave)==null||u.call(f,g)}}},s=()=>{if(!n.enabled.current)return[];const c=[],h=n.raycaster.intersectObjects(n.interactiveObjects,!0),u=n.filter===void 0?h:n.filter(h,n);for(const d of u){let p=d.object;for(;p;)e.has(p)&&c.push({...d,eventObject:p}),p=p.parent}return c},r=(c,h)=>{var u,d;for(const p of h)(d=(u=e.get(p))==null?void 0:u.onpointermissed)==null||d.call(u,c)},o=c=>c==="pointerleave"||c==="pointercancel"?()=>{n.pointerOverTarget.set(!1),i([])}:c==="pointerenter"?()=>{n.pointerOverTarget.set(!0)}:h=>{var m,v,x,b;const u=c==="pointermove",d=c==="click"||c==="contextmenu"||c==="dblclick";n.compute(h,n);const p=s(),f=d?t(h):0;c==="pointerdown"&&(n.initialClick=[h.offsetX,h.offsetY],n.initialHits=p.map(_=>_.eventObject)),d&&p.length===0&&f<=2&&r(h,n.interactiveObjects),u&&i(p);let g=!1;e:for(const _ of p){const C={stopped:g,..._,intersections:p,stopPropagation(){if(g=!0,C.stopped=!0,n.hovered.size>0&&Array.from(n.hovered.values()).some(S=>S.eventObject===_.eventObject)){const S=p.slice(0,p.indexOf(_));i([...S,_])}},camera:n.raycaster.camera,delta:f,nativeEvent:h,pointer:n.pointer.current,ray:n.raycaster.ray},M=e.get(_.eventObject);if(!M)return;if(u){if(M.onpointerover||M.onpointerenter||M.onpointerout||M.onpointerleave){const S=Cy(C),P=n.hovered.get(S);P?P.stopped&&C.stopPropagation():(n.hovered.set(S,C),(m=M.onpointerover)==null||m.call(M,C),(v=M.onpointerenter)==null||v.call(M,C))}(x=M.onpointermove)==null||x.call(M,C)}else M[`on${c}`]?(!d||n.initialHits.includes(_.eventObject))&&(r(h,n.interactiveObjects.filter(S=>!n.initialHits.includes(S))),(b=M[`on${c}`])==null||b.call(M,C)):d&&n.initialHits.includes(_.eventObject)&&r(h,n.interactiveObjects.filter(S=>!n.initialHits.includes(S)));if(g)break e}},a=c=>{Ay.forEach(([h])=>{c.removeEventListener(h,o(h))})},l=c=>{Ay.forEach(([h,u])=>{c.addEventListener(h,o(h),{passive:u})})};Vn(n.target,c=>(c&&l(c),()=>{c&&a(c)}))},RW=n=>{const e=AW(n);return TW(),PW(e),e};for(let n=0;n<256;n++)(n<16?"0":"")+n.toString(16);new ml(-1,1,1,-1,0,1);class LW extends Ye{constructor(){super(),this.setAttribute("position",new Te([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Te([0,2,0,0,2,0],2))}}new LW;var EC={exports:{}};EC.exports=Zp;EC.exports.default=Zp;function Zp(n,e,t){t=t||2;var i=e&&e.length,s=i?e[0]*t:n.length,r=MC(n,0,s,t,!0),o=[];if(!r||r.next===r.prev)return o;var a,l,c,h,u,d,p;if(i&&(r=kW(n,e,r,t)),n.length>80*t){a=c=n[0],l=h=n[1];for(var f=t;f<s;f+=t)u=n[f],d=n[f+1],u<a&&(a=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-a,h-l),p=p!==0?32767/p:0}return zc(r,o,t,a,l,p,0),o}function MC(n,e,t,i,s){var r,o;if(s===Mv(n,e,t,i)>0)for(r=e;r<t;r+=i)o=Ty(r,n[r],n[r+1],o);else for(r=t-i;r>=e;r-=i)o=Ty(r,n[r],n[r+1],o);return o&&Jp(o,o.next)&&(Gc(o),o=o.next),o}function Xo(n,e){if(!n)return n;e||(e=n);var t=n,i;do if(i=!1,!t.steiner&&(Jp(t,t.next)||qt(t.prev,t,t.next)===0)){if(Gc(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function zc(n,e,t,i,s,r,o){if(n){!o&&r&&zW(n,i,s,r);for(var a=n,l,c;n.prev!==n.next;){if(l=n.prev,c=n.next,r?DW(n,i,s,r):IW(n)){e.push(l.i/t|0),e.push(n.i/t|0),e.push(c.i/t|0),Gc(n),n=c.next,a=c.next;continue}if(n=c,n===a){o?o===1?(n=NW(Xo(n),e,t),zc(n,e,t,i,s,r,2)):o===2&&OW(n,e,t,i,s,r):zc(Xo(n),e,t,i,s,r,1);break}}}}function IW(n){var e=n.prev,t=n,i=n.next;if(qt(e,t,i)>=0)return!1;for(var s=e.x,r=t.x,o=i.x,a=e.y,l=t.y,c=i.y,h=s<r?s<o?s:o:r<o?r:o,u=a<l?a<c?a:c:l<c?l:c,d=s>r?s>o?s:o:r>o?r:o,p=a>l?a>c?a:c:l>c?l:c,f=i.next;f!==e;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&Ua(s,a,r,l,o,c,f.x,f.y)&&qt(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function DW(n,e,t,i){var s=n.prev,r=n,o=n.next;if(qt(s,r,o)>=0)return!1;for(var a=s.x,l=r.x,c=o.x,h=s.y,u=r.y,d=o.y,p=a<l?a<c?a:c:l<c?l:c,f=h<u?h<d?h:d:u<d?u:d,g=a>l?a>c?a:c:l>c?l:c,m=h>u?h>d?h:d:u>d?u:d,v=wv(p,f,e,t,i),x=wv(g,m,e,t,i),b=n.prevZ,_=n.nextZ;b&&b.z>=v&&_&&_.z<=x;){if(b.x>=p&&b.x<=g&&b.y>=f&&b.y<=m&&b!==s&&b!==o&&Ua(a,h,l,u,c,d,b.x,b.y)&&qt(b.prev,b,b.next)>=0||(b=b.prevZ,_.x>=p&&_.x<=g&&_.y>=f&&_.y<=m&&_!==s&&_!==o&&Ua(a,h,l,u,c,d,_.x,_.y)&&qt(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;b&&b.z>=v;){if(b.x>=p&&b.x<=g&&b.y>=f&&b.y<=m&&b!==s&&b!==o&&Ua(a,h,l,u,c,d,b.x,b.y)&&qt(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;_&&_.z<=x;){if(_.x>=p&&_.x<=g&&_.y>=f&&_.y<=m&&_!==s&&_!==o&&Ua(a,h,l,u,c,d,_.x,_.y)&&qt(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function NW(n,e,t){var i=n;do{var s=i.prev,r=i.next.next;!Jp(s,r)&&SC(s,i,i.next,r)&&Hc(s,r)&&Hc(r,s)&&(e.push(s.i/t|0),e.push(i.i/t|0),e.push(r.i/t|0),Gc(i),Gc(i.next),i=n=r),i=i.next}while(i!==n);return Xo(i)}function OW(n,e,t,i,s,r){var o=n;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&WW(o,a)){var l=CC(o,a);o=Xo(o,o.next),l=Xo(l,l.next),zc(o,e,t,i,s,r,0),zc(l,e,t,i,s,r,0);return}a=a.next}o=o.next}while(o!==n)}function kW(n,e,t,i){var s=[],r,o,a,l,c;for(r=0,o=e.length;r<o;r++)a=e[r]*i,l=r<o-1?e[r+1]*i:n.length,c=MC(n,a,l,i,!1),c===c.next&&(c.steiner=!0),s.push(GW(c));for(s.sort(UW),r=0;r<s.length;r++)t=FW(s[r],t);return t}function UW(n,e){return n.x-e.x}function FW(n,e){var t=BW(n,e);if(!t)return e;var i=CC(t,n);return Xo(i,i.next),Xo(t,t.next)}function BW(n,e){var t=e,i=n.x,s=n.y,r=-1/0,o;do{if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){var a=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(a<=i&&a>r&&(r=a,o=t.x<t.next.x?t:t.next,a===i))return o}t=t.next}while(t!==e);if(!o)return null;var l=o,c=o.x,h=o.y,u=1/0,d;t=o;do i>=t.x&&t.x>=c&&i!==t.x&&Ua(s<h?i:r,s,c,h,s<h?r:i,s,t.x,t.y)&&(d=Math.abs(s-t.y)/(i-t.x),Hc(t,n)&&(d<u||d===u&&(t.x>o.x||t.x===o.x&&VW(o,t)))&&(o=t,u=d)),t=t.next;while(t!==l);return o}function VW(n,e){return qt(n.prev,n,e.prev)<0&&qt(e.next,n,n.next)<0}function zW(n,e,t,i){var s=n;do s.z===0&&(s.z=wv(s.x,s.y,e,t,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,HW(s)}function HW(n){var e,t,i,s,r,o,a,l,c=1;do{for(t=n,n=null,r=null,o=0;t;){for(o++,i=t,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||t.z<=i.z)?(s=t,t=t.nextZ,a--):(s=i,i=i.nextZ,l--),r?r.nextZ=s:n=s,s.prevZ=r,r=s;t=i}r.nextZ=null,c*=2}while(o>1);return n}function wv(n,e,t,i,s){return n=(n-t)*s|0,e=(e-i)*s|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function GW(n){var e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function Ua(n,e,t,i,s,r,o,a){return(s-o)*(e-a)>=(n-o)*(r-a)&&(n-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(r-a)>=(s-o)*(i-a)}function WW(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!$W(n,e)&&(Hc(n,e)&&Hc(e,n)&&jW(n,e)&&(qt(n.prev,n,e.prev)||qt(n,e.prev,e))||Jp(n,e)&&qt(n.prev,n,n.next)>0&&qt(e.prev,e,e.next)>0)}function qt(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function Jp(n,e){return n.x===e.x&&n.y===e.y}function SC(n,e,t,i){var s=Au(qt(n,e,t)),r=Au(qt(n,e,i)),o=Au(qt(t,i,n)),a=Au(qt(t,i,e));return!!(s!==r&&o!==a||s===0&&Cu(n,t,e)||r===0&&Cu(n,i,e)||o===0&&Cu(t,n,i)||a===0&&Cu(t,e,i))}function Cu(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Au(n){return n>0?1:n<0?-1:0}function $W(n,e){var t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&SC(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function Hc(n,e){return qt(n.prev,n,n.next)<0?qt(n,e,n.next)>=0&&qt(n,n.prev,e)>=0:qt(n,e,n.prev)<0||qt(n,n.next,e)<0}function jW(n,e){var t=n,i=!1,s=(n.x+e.x)/2,r=(n.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&s<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function CC(n,e){var t=new Ev(n.i,n.x,n.y),i=new Ev(e.i,e.x,e.y),s=n.next,r=e.prev;return n.next=e,e.prev=n,t.next=s,s.prev=t,i.next=t,t.prev=i,r.next=i,i.prev=r,i}function Ty(n,e,t,i){var s=new Ev(n,e,t);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Gc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Ev(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Zp.deviation=function(n,e,t,i){var s=e&&e.length,r=s?e[0]*t:n.length,o=Math.abs(Mv(n,0,r,t));if(s)for(var a=0,l=e.length;a<l;a++){var c=e[a]*t,h=a<l-1?e[a+1]*t:n.length;o-=Math.abs(Mv(n,c,h,t))}var u=0;for(a=0;a<i.length;a+=3){var d=i[a]*t,p=i[a+1]*t,f=i[a+2]*t;u+=Math.abs((n[d]-n[f])*(n[p+1]-n[d+1])-(n[d]-n[p])*(n[f+1]-n[d+1]))}return o===0&&u===0?0:Math.abs((u-o)/o)};function Mv(n,e,t,i){for(var s=0,r=e,o=t-i;r<t;r+=i)s+=(n[o]-n[r])*(n[r+1]+n[o+1]),o=r;return s}Zp.flatten=function(n){for(var e=n[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0,s=0;s<n.length;s++){for(var r=0;r<n[s].length;r++)for(var o=0;o<e;o++)t.vertices.push(n[s][r][o]);s>0&&(i+=n[s-1].length,t.holes.push(i))}return t};new ee;new ee;var Py;(n=>{function e(s){let r=s.slice();return r.sort(n.POINT_COMPARATOR),n.makeHullPresorted(r)}n.makeHull=e;function t(s){if(s.length<=1)return s.slice();let r=[];for(let a=0;a<s.length;a++){const l=s[a];for(;r.length>=2;){const c=r[r.length-1],h=r[r.length-2];if((c.x-h.x)*(l.y-h.y)>=(c.y-h.y)*(l.x-h.x))r.pop();else break}r.push(l)}r.pop();let o=[];for(let a=s.length-1;a>=0;a--){const l=s[a];for(;o.length>=2;){const c=o[o.length-1],h=o[o.length-2];if((c.x-h.x)*(l.y-h.y)>=(c.y-h.y)*(l.x-h.x))o.pop();else break}o.push(l)}return o.pop(),r.length==1&&o.length==1&&r[0].x==o[0].x&&r[0].y==o[0].y?r:r.concat(o)}n.makeHullPresorted=t;function i(s,r){return s.x<r.x?-1:s.x>r.x?1:s.y<r.y?-1:s.y>r.y?1:0}n.POINT_COMPARATOR=i})(Py||(Py={}));var XW=Ft("<!> <!>",1),qW=Ft("<!> <!> <!>",1),KW=Ft("<!> <!>",1),YW=Ft("<!> <!>",1);function ZW(n,e){on(e,!0);let t=ie(e,"ref",15);ie(e,"name",3,"hello");let i=ie(e,"position",19,()=>[0,0,0]),s=kr(e,["$$slots","$$events","$$legacy","fallback","error","children","ref","name","position"]);t(new wi);const r=A5(o1+"/RawGLTF/bot/ybot.glb"),{actions:o,mixer:a}=P5(r,t());return lt(n,zn({get is(){return t()},dispose:!1},()=>s,{children:(l,c)=>{var h=YW(),u=Be(h);l1(u,()=>r,p=>{var f=pt(),g=Be(f);Qi(g,()=>e.fallback??cs),Pe(p,f)},(p,f)=>{var g=pt(),m=Be(g);Nn(m,()=>lt.Group,(v,x)=>{x(v,{name:"Scene",get position(){return i()},children:(b,_)=>{var C=KW(),M=Be(C);Nn(M,()=>lt.Mesh,(P,E)=>{E(P,{position:[0,1.8,1.5],children:(y,L)=>{var k=XW(),D=Be(k);Nn(D,()=>lt.MeshStandardMaterial,(z,H)=>{H(z,{color:"red"})});var W=vt(D,2);Nn(W,()=>lt.OctahedronGeometry,(z,H)=>{H(z,{args:[.1,6]})}),Pe(y,k)},$$slots:{default:!0}})});var S=vt(M,2);Nn(S,()=>lt.Group,(P,E)=>{E(P,{name:"Armature",rotation:[Math.PI/2,0,0],scale:.01,children:(y,L)=>{var k=qW(),D=Be(k);lt(D,{get is(){return I(f).nodes.mixamorigHips}});var W=vt(D,2);Nn(W,()=>lt.SkinnedMesh,(H,ne)=>{ne(H,{name:"Alpha_Joints",get geometry(){return I(f).nodes.Alpha_Joints.geometry},get material(){return I(f).materials.Alpha_Joints_MAT},get skeleton(){return I(f).nodes.Alpha_Joints.skeleton},castShadow:!0,children:(G,ae)=>{var se=pt(),ge=Be(se);Nn(ge,()=>lt.MeshStandardMaterial,(Oe,Ze)=>{Ze(Oe,{color:"white",emissive:"white",emissiveIntensity:2})}),Pe(G,se)},$$slots:{default:!0}})});var z=vt(W,2);Nn(z,()=>lt.SkinnedMesh,(H,ne)=>{ne(H,{name:"Alpha_Surface",get geometry(){return I(f).nodes.Alpha_Surface.geometry},get material(){return I(f).materials.Alpha_Body_MAT},get skeleton(){return I(f).nodes.Alpha_Surface.skeleton},castShadow:!0,children:(G,ae)=>{var se=pt(),ge=Be(se);Nn(ge,()=>lt.MeshStandardMaterial,(Oe,Ze)=>{Ze(Oe,{color:"#d4af37",roughness:.3,metalness:.8})}),Pe(G,se)},$$slots:{default:!0}})}),Pe(y,k)},$$slots:{default:!0}})}),Pe(b,C)},$$slots:{default:!0}})}),Pe(p,g)},(p,f)=>{var g=pt(),m=Be(g);Qi(m,()=>e.error??cs,()=>({error:I(f)})),Pe(p,g)});var d=vt(u,2);Qi(d,()=>e.children??cs,()=>({ref:t()})),Pe(l,h)},$$slots:{default:!0}})),an({actions:o,mixer:a})}const Om=2;var JW=Ft("<!> <!>",1),QW=Ft("<!> <!>",1),e$=Ft("<!> <!>",1),t$=Ft("<!> <!> <!>",1);function n$(n){var e=t$(),t=Be(e);lt.Mesh(t,{receiveShadow:!0,rotation:[-Math.PI*.5,0,0],children:(r,o)=>{var a=JW(),l=Be(a);lt.PlaneGeometry(l,{args:[10,5]});var c=vt(l,2);lt.MeshStandardMaterial(c,{side:Om,color:"red"}),Pe(r,a)},$$slots:{default:!0}});var i=vt(t,2);lt.Mesh(i,{receiveShadow:!0,rotation:[0,0,0],position:[0,2.5,-2.5],children:(r,o)=>{var a=QW(),l=Be(a);lt.PlaneGeometry(l,{args:[10,5]});var c=vt(l,2);lt.MeshStandardMaterial(c,{side:Om,color:"green"}),Pe(r,a)},$$slots:{default:!0}});var s=vt(i,2);lt.Mesh(s,{receiveShadow:!0,rotation:[0,-Math.PI*.5,0],position:[5,2.5,0],children:(r,o)=>{var a=e$(),l=Be(a);lt.PlaneGeometry(l,{args:[5,5]});var c=vt(l,2);lt.MeshStandardMaterial(c,{side:Om,color:"blue"}),Pe(r,a)},$$slots:{default:!0}}),Pe(n,e)}function Ry(n){return Object.prototype.toString.call(n)==="[object Date]"}function i$(n){return n}function s$(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}function Sv(n,e){if(n===e||n!==n)return()=>n;const t=typeof n;if(t!==typeof e||Array.isArray(n)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(n)){const i=e.map((s,r)=>Sv(n[r],s));return s=>i.map(r=>r(s))}if(t==="object"){if(!n||!e)throw new Error("Object cannot be null");if(Ry(n)&&Ry(e)){const r=n.getTime(),a=e.getTime()-r;return l=>new Date(r+l*a)}const i=Object.keys(e),s={};return i.forEach(r=>{s[r]=Sv(n[r],e[r])}),r=>{const o={};return i.forEach(a=>{o[a]=s[a](r)}),o}}if(t==="number"){const i=e-n;return s=>n+s*i}return()=>e}var Fs,ja,$c,Ao;const P_=class P_{constructor(e,t={}){As(this,Fs,vc(void 0));As(this,ja,vc(void 0));As(this,$c);As(this,Ao,null);en(this,Fs).v=en(this,ja).v=e,Tl(this,$c,t)}static of(e,t){const i=new P_(e(),t);return Oy(()=>{i.set(e())}),i}set(e,t){var u;st(en(this,ja),e);let{delay:i=0,duration:s=400,easing:r=i$,interpolate:o=Sv}={...en(this,$c),...t};if(s===0)return(u=en(this,Ao))==null||u.abort(),st(en(this,Fs),e),Promise.resolve();const a=as.now()+i;let l,c=!1,h=en(this,Ao);return Tl(this,Ao,g1(d=>{if(d<a)return!0;if(!c){c=!0;const f=en(this,Fs).v;l=o(f,e),typeof s=="function"&&(s=s(f,e)),h==null||h.abort()}const p=d-a;return p>s?(st(en(this,Fs),e),!1):(st(en(this,Fs),l(r(p/s))),!0)})),en(this,Ao).promise}get current(){return I(en(this,Fs))}get target(){return I(en(this,ja))}set target(e){this.set(e)}};Fs=new WeakMap,ja=new WeakMap,$c=new WeakMap,Ao=new WeakMap;let Gd=P_;var r$=Ft('<div id="computer-wrap" class="svelte-1kpsuq2"><button>Hello</button> <button>Hello</button> <button>Hello</button> <button>Hello</button> <button>Hello</button> <button>Hello</button></div>'),o$=Ft("<!> <!>",1),a$=Ft("<!> <!> <!> <!>",1),l$=Ft("<!> <!>",1),c$=Ft("<!> <!> <!> <!> <!> <!> <!> <!>",1);function h$(n,e){on(e,!0),RW();let t=Xa(void 0),i=Xa(void 0);const s=W_({x:0,y:0,z:0}),r={duration:500,easing:s$},o=[-8,6,8],a=[0,1,0];let l=new Gd([0,0,0],r),c=new Gd(o,r);const h={home:{lookAtPosition:a,cameraPosition:o},dummy:{lookAtPosition:a,cameraPosition:o}};let u=W_([]);const d=P=>{u.push(P)};function p(P){if(P==null)return console.log("ERROR! NO OBJECT TO LOOK AT");let E=[I(t).target.x,I(t).target.y,I(t).target.z];l.set(E,{duration:0}),l.target=P.lookAtPosition;let y=[I(i).position.x,I(i).position.y,I(i).position.z];c.set(y,{duration:0}),c.target=P.cameraPosition}function f(){console.log("HEGAS")}Ur(()=>{I(t).saveState()});var g=c$(),m=Be(g);Nn(m,()=>lt.Mesh,(P,E)=>{E(P,{onclick:f,children:(y,L)=>{var k=o$(),D=Be(k);X5(D,{scale:.7,floatIntensity:5,children:(G,ae)=>{j5(G,{transform:!0,geometry:new Ko,children:(se,ge)=>{var Oe=r$(),Ze=Jn(Oe);_i(Ze,"",{},{display:"block"});var J=vt(Ze,2);_i(J,"",{},{display:"block"});var ce=vt(J,2);_i(ce,"",{},{display:"block"});var _e=vt(ce,2);_i(_e,"",{},{display:"block"});var pe=vt(_e,2);_i(pe,"",{},{display:"block"});var Re=vt(pe,2);_i(Re,"",{},{display:"block"}),Qn(Oe),Pe(se,Oe)},$$slots:{default:!0}})},$$slots:{default:!0}});var W=vt(D,2);const z=un(()=>[s.x,s.y,s.z]);var H=()=>this,ne=G=>d(G);ZW(W,{name:"hello",get position(){return I(z)},get ref(){return H()},set ref(G){ne(G)}}),Pe(y,k)},$$slots:{default:!0}})});var v=vt(m,2);n$(v);var x=vt(v,2);bW(x,{speed:1});var b=vt(x,2);Nn(b,()=>lt.Mesh,(P,E)=>{E(P,{geometry:new Vr,material:new pl})});var _=vt(b,2);Nn(_,()=>lt.DirectionalLight,(P,E)=>{E(P,{color:"white",castShadow:!0,position:[1,5,2],intensity:2})});var C=vt(_,2);Nn(C,()=>lt.AmbientLight,(P,E)=>{E(P,{color:"white",intensity:2})});var M=vt(C,2);Nn(M,()=>lt.PerspectiveCamera,(P,E)=>{E(P,{makeDefault:!0,get position(){return c.current},get ref(){return I(i)},set ref(y){st(i,y,!0)},children:(y,L)=>{mW(y,{enableDamping:!0,dampingFactor:.1,get target(){return l.current},get ref(){return I(t)},set ref(k){st(t,k,!0)}})},$$slots:{default:!0}})});var S=vt(M,2);TG(S,{position:"fixed",title:"Tweakin",children:(P,E)=>{var y=l$(),L=Be(y);_v(L,{title:"Orbit",children:(D,W)=>{mv(D,{label:"Orbit",title:"Reset Orbit Target",$$events:{click:()=>p(h.home)}})},$$slots:{default:!0}});var k=vt(L,2);_v(k,{label:"Dummy",children:(D,W)=>{var z=a$(),H=Be(z);Em(H,{label:"X",get value(){return s.x},set value(se){s.x=se}});var ne=vt(H,2);Em(ne,{label:"Y",get value(){return s.y},set value(se){s.y=se}});var G=vt(ne,2);Em(G,{label:"Z",get value(){return s.z},set value(se){s.z=se}});var ae=vt(G,2);mv(ae,{label:"Dummy",title:"Look At Dummy",$$events:{click:()=>p(h.dummy)}}),Pe(D,z)},$$slots:{default:!0}}),Pe(P,y)},$$slots:{default:!0}}),Pe(n,g),an()}var u$=Ft('<main class="svelte-1tsx0w8"><div id="canvas" class="svelte-1tsx0w8"><!></div></main> <nav class="fixed w-full h-32 flex items-center px-16 gap-16"><p>Alalwani<br>Mohammad<br>Samir</p> <p> <br> </p></nav>',1);function d$(n,e){on(e,!1);let t=new Date,i=t.getUTCDate(),s=t.toLocaleString("default",{month:"long"}),r=t.getFullYear();ys();var o=u$(),a=Be(o),l=Jn(a),c=Jn(l);eN(c,{children:(f,g)=>{h$(f,{})},$$slots:{default:!0}}),Qn(l),Qn(a);var h=vt(a,2),u=vt(Jn(h),2),d=Jn(u);d.nodeValue=`${i??""} ${s??""} `;var p=vt(d,2,!0);p.nodeValue=r,Qn(u),Qn(h),Pe(n,o),an()}function m6(n){d$(n,{})}export{m6 as component};
